<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.0.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="Hexo, NexT" />


<meta name="description" content="人苦不知足，既得陇，复望蜀">
<meta property="og:type" content="website">
<meta property="og:title" content="修子范语">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="修子范语">
<meta property="og:description" content="人苦不知足，既得陇，复望蜀">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="修子范语">
<meta name="twitter:description" content="人苦不知足，既得陇，复望蜀">






  <link rel="canonical" href="http://yoursite.com/"/>


  <title>修子范语</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">修子范语</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Alfredo's Notes</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/14/Pro Git读书笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/14/Pro Git读书笔记/" itemprop="url">Pro Git 笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-14T00:00:00+08:00">2018-02-14</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书笔记/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/14/Pro Git读书笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/14/Pro Git读书笔记/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>git 版本管理通过 SHA-1 哈希算法为工作区的文件生成快照实现，存放于本地暂存区或版本库中（.git 目录下保存所有快照信息）。hash 算法基于文件内容和目录结构，git 保存的信息都通过 hash 值(SHA-1 哈希算法校验和/SHA-1 checksum)进行索引。修改工作区/working tree 的文件后(modified)，通过 git add 命令提交到暂存区/staging range(staged)，再通过 git commit 命令提交到版本库/git directory(commited)；若文件未变更，将沿用原有的快照。因此本地多版本管理不需要远程交互。</p>
<p>当文件提交到暂存区时(stage)，git 会为每个文件计算校验和/checksum，在 git 仓库中保存 blob 对象以引用文件快照，校验和将保存到暂存区中。当提交到版本库时(commit)，git 会计算目录的校验和并构建树对象(blod 文件对象将以索引形式存储在树对象中)，随后创建提交对象，该提交对象包含作者名、电邮、message、指向上述树对象的指针、指向之前提交版本的指针。git 仓库可理解为存储系列提交对象的单链表结构(以哈希算法的校验和值作为索引)。在多分支开发的特殊情况下，提交对象会转变为树形结构(单链表可视为只有主干的树)，即多个提交对象的 parent 指针可以指向同一个提交对象父节点，提交历史产生分叉。在提交对象模型的基础上，git 分支就是指向某个提交对象的移动指针(通过校验和指向提交对象，文件形式存储)，其提交历史来自于提交对象模型，形成单链表结构。多分支管理、及单分支的回滚和提交动作均衍生于树结构的提交对象模型，分支仅承担着指向改变的任务；创建新分支即是创建一个指向当前提交对象的指针；提交时，创建新的提交对象，并改变当前分支的指向。在 git 中，HEAD 指针用于指向当前工作的分支，通过改变 HEAD 指针的指向即为切换分支操作。需要说明的是，当切换回较旧的分支时，不只改变了 HEAD 指针的指向，同时也使工作目录变更为该分支指向的提交对象，即资源快照。多分支开发时，新的提交对象将作为提交对象模型的叶子节点，这一过程也可以通过 HEAD 指针感知当前的提交对象属于哪个分支。因此在 git 中，分支不是多次提交记录的集合，而是在抽象所有提交记录为单一的模型后、衍伸而来的理念。遵照这样的设计，master 分支和其他分支拥有相同的特征，只是 master 分支会在 git 仓库初始化时被创建。</p>
<p>合并/merge 分支时，会向上遍历文档对象模型，寻找共同的祖先节点作为合并基础。若待合并分支的提交/commit 动作在当前工作分支(work-in-progress branch)之后产生，当前分支将采用快进/fast-forward 方式修改，即将当前分支指向待合并分支的提交对象，指针右移。合并分叉分支时，即待合并的两个分支为同时开发，将获取这两个分支的提交对象，以及他们共同祖先节点的提交对象作为合并基础，作三方合并(three-way merge)，最终将构建出新的提交对象(该提交对象有两个父节点，使文档对象模型由树结构转变为合流结构)。若两个分叉分支同时对同一块区域做更改，git 不会自动合并，将产生一个合并冲突(merge conflict)，并阻止 git 的后续执行流程，如构建新的提交对象等，git 还会为冲突文件注入标准的冲突解决标记(standard conflict-resolution markers)。通过 git status 命令可查看冲突文件。冲突解决标记中，以 &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD 起始部分为当前工作分支内容，以 &gt;&gt;&gt;&gt;&gt;&gt;&gt; branchname 结束部分为待合并分支内容，中间以 =======。解决冲突后，需要依序提交到暂存区和版本库中，将产生一条合并记录，可能包含冲突解决记录。合并分支可使用 git mergetool 命令，启用图形化合并工具，参看 Git Branching。</p>
<p>远程引用(remote references)是对远程仓库中分支、标签等的引用或指针。更恰当的说，引用内容即为远程分支中的提交对象模型，单链表形式。远程跟踪分支(remote-tracking branches)将远程分支的引用保存在本地，不受用户影响，git fetch|pull|push 操作时更新引用，使本地 shortname/branchname 指向远程服务器的同名分支。远程引用采用 shortname/branchname 形式命名分支。当 git clone 命令执行时，将在本地创建 origin/master 分支和 master 分支，两者均指向相同的提交对象模型。当用户在 master 分支开发并提交时，另一用户将自己的代码 push 到远程 master 分支上，本地 origin/master 的指向将不作改变；假使在这时候执行 git fetch 命令，将抓取远程仓库新添加的提交对象，本地 origin/master 也将右移、指向另一用户创建的提交对象上，提交对象模型转化为树形结构。</p>
<p>参考：<br><a href="https://git-scm.com/book/zh/v2/Git-分支-分支简介" target="_blank" rel="noopener">分支简介</a><br><a href="https://git-scm.com/book/zh/v2/Git-分支-分支的新建与合并" target="_blank" rel="noopener">分支的新建与合并</a></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>git 配置分为三类，系统级，用户级，和项目级；优先级从右到左。git config 命令中，–system 选项指定系统级，–global 选项指定用户级，两者均没有为项目级。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">"John Doe"</span> <span class="comment"># 指定用户</span></span><br><span class="line">git config --global user.email johndoe@example.com <span class="comment"># 指定邮箱</span></span><br><span class="line">git config --global core.editor emacs <span class="comment"># 指定编辑器，默认为系统自带编辑器，可选 vim, emacs, notepad++</span></span><br><span class="line">git config --list <span class="comment"># 查看配置</span></span><br><span class="line">git config user.name <span class="comment"># 查看用户配置</span></span><br><span class="line">git config --global credential.helper cache <span class="comment"># 将 https 推送需要的用户密码缓存在内存中，时效为几分钟</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 别名</span></span><br><span class="line">git config --global alias.co checkout <span class="comment"># git co 将等价于 git checkout</span></span><br><span class="line">git config --global alias.br branch</span><br><span class="line">git config --global alias.ci commit</span><br><span class="line">git config --global alias.st status</span><br><span class="line">git config --global alias.unstage <span class="string">'reset HEAD --'</span> <span class="comment"># git unstage 将等价于 git reset Head -- </span></span><br><span class="line">git config --global alias.last <span class="string">'log -1 HEAD'</span> <span class="comment"># git last 查看最后一次提交信息</span></span><br><span class="line">git config --global alias.visual <span class="string">'!npm'</span> <span class="comment"># git visual 将调用外部命令 npm</span></span><br></pre></td></tr></table></figure>
<h3 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">help</span> config <span class="comment"># 打印 git config 命令的完整手册</span></span><br><span class="line">man git-confgi <span class="comment"># 同上</span></span><br><span class="line">git-config -h|--<span class="built_in">help</span> <span class="comment"># 简要帮助信息</span></span><br></pre></td></tr></table></figure>
<h3 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h3><ol>
<li>保存快照不吃磁盘空间吗？git 命令在运行时比较文件差异，如 add, commit？那执行效率如何提升？</li>
<li>数据库怎样存储历史版本数据？</li>
<li>游戏在用户端以补丁形式下载并更新，若代码使用 git 管理，怎样做到根据文件差异只做局部封信，而不是全量下载并更新？同样的，git pull 等命令怎样做到效率地只修改局部资源？</li>
<li>在多分支开发，又相继合并到 master 分支的情形下，提交对象链表会形成怎样的构造？根据提交时间形成单链表形式？</li>
</ol>
<h2 id="Git-Basics"><a href="#Git-Basics" class="headerlink" title="Git Basics"></a>Git Basics</h2><h3 id="创建本地仓库"><a href="#创建本地仓库" class="headerlink" title="创建本地仓库"></a>创建本地仓库</h3><p>创建 git 本地仓库，指定 git init 或 git clone <url> [projectName] 命令（projectName 用于指定本地目录名）。git clone 将拷贝远程仓库的所有版本及所有文件（当服务器磁盘损坏时，方便使用本地仓库的命令将远程仓库的资源回滚到拷贝前），创建 .git 目录，并检出最新分支。git clone 时，可使用 https 协议 或 git:// 起始的 SSH 协议。</url></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init <span class="comment"># 创建 git 本地仓库</span></span><br><span class="line">git <span class="built_in">clone</span> &lt;url&gt; [projectName] <span class="comment"># 克隆远程仓库，指定远程仓库的简称默认为 origin，且本地 master 分支将跟踪/track 远程 master，可使用 git pull|push 命令</span></span><br></pre></td></tr></table></figure>
<h3 id="文件状态"><a href="#文件状态" class="headerlink" title="文件状态"></a>文件状态</h3><p>工作区的文件状态有两种，已追踪/tracked, 未追踪/untracked。暂存区的最新快照中包含某文件，该文件即被追踪；若不包含，该文件即未追踪。已追踪文件又分为三种状态，未变更/unmodified, 已变更/modified, 已提交到暂存区/staged。在切换分支时，git 会校验工作区的文件改动是否提交到版本库中，未提交，则阻止切换，用以防止丢失工作区的改动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">git status <span class="comment"># 获取文件状态</span></span><br><span class="line">git status -s|--short <span class="comment"># 文件状态扼要信息。?? 未追踪文件，A 新增文件提交到到暂存区，M 修改文件提交到暂存区，MM 暂存区和工作区文件状态</span></span><br><span class="line">git diff <span class="comment"># 工作区和暂存区文件差异，显示文件更新细节，包括添加的行、删除的行，合称为文件更新补丁/patch</span></span><br><span class="line">git diff --staged|--cached <span class="comment"># 暂存区和版本库文件差异</span></span><br><span class="line">git difftool <span class="comment"># 使用 Araxis, emerge, vimdiff 等软件以图形化或其他格式显示文件差异</span></span><br><span class="line">git difftool -tool-help <span class="comment"># 查看系统支持的 git diff 插件</span></span><br><span class="line">git add &lt;files&gt; <span class="comment"># 工作区文件提交到暂存区，将产生暂存区的历史快照/historical snapshort。参数为文件或目录路径</span></span><br><span class="line">git commit <span class="comment"># 暂存区快照提交版本去，需由命令行编辑器设置 message，# 起始内容将被忽略。命令行编辑器中默认以 # 添加 git status 输出内容。-v 选项可用于注入 git diff 完整信息</span></span><br><span class="line">git commit -m <span class="string">'message'</span> <span class="comment"># 设置 message 并提交</span></span><br><span class="line">git commit -a <span class="comment"># 直接将工作区中已追踪的文件提交到版本库，跳过暂存区</span></span><br><span class="line">git rm &lt;pattern&gt; <span class="comment"># 暂存区删除文件，工作区也作相应删除，需要提交到版本库。直接删除工作区中文件，不会影响暂存区</span></span><br><span class="line">git rm -f|--force &lt;pattern&gt; <span class="comment"># 修改后文件提交到暂存区，与版本库中文件有差异，需使用 -f 选项强制删除</span></span><br><span class="line">git rm --cached &lt;pattern&gt; <span class="comment"># 暂存区删除文件，但保留工作区文件，适用于未配置 .gitignore 的文件</span></span><br><span class="line">git mv file_from file_to <span class="comment"># 移动文件，可实现文件重命名。重命名时，等同于 mv file_from file_to; git rm file_from; git add file_to。git 没有显式追踪文件移动操作，通过执行的命令获知用户重命名行为</span></span><br></pre></td></tr></table></figure>
<h3 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h3><p>.gitignore 配置文件，即忽略文件列表。可设置多个 .gitignore 文件，当前文件所在目录自底向上获取 .gitignore 文件，作为优先级顺序。编写 .gitignore 文件可使用标准 glob 模式(shell 中简易正则，<em> 零或多个任意字符，*</em> 任意中间目录，其余同正则)；空行或 ‘#’ 开头将被忽略；’/‘ 开头相对于工程目录；’/‘ 结尾匹配目录；’!’ 开头置否值。</p>
<h3 id="commit-历史记录"><a href="#commit-历史记录" class="headerlink" title="commit 历史记录"></a>commit 历史记录</h3><p>无论本地仓库，还是克隆下来的远程仓库，都可以使用 git log 命令查看提交记录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> <span class="comment"># 显示提交记录，反序排列，包含 SHA-1 哈希算法校验和(作为索引), 作者, 日期, message</span></span><br><span class="line">git <span class="built_in">log</span> -p|--patch <span class="comment"># 显示内容差异</span></span><br><span class="line">git <span class="built_in">log</span> --<span class="built_in">stat</span> <span class="comment"># 显示每次更新的文件修改统计信息</span></span><br><span class="line">git <span class="built_in">log</span> --shortstat <span class="comment"># 只显示 --stat 中最后的行数修改添加移除统计</span></span><br><span class="line">git <span class="built_in">log</span> --name-only <span class="comment"># 仅在提交信息后显示已修改的文件清单</span></span><br><span class="line">git <span class="built_in">log</span> --name-status <span class="comment"># 显示新增、修改、删除的文件清单</span></span><br><span class="line">git <span class="built_in">log</span> --abbrev-commit <span class="comment"># 仅显示 SHA-1 的前几个字符，而非所有的 40 个字符</span></span><br><span class="line">git <span class="built_in">log</span> --relative-date <span class="comment"># 使用较短的相对时间显示，如 '2 weeks ago'</span></span><br><span class="line">git <span class="built_in">log</span> --graph <span class="comment"># 显示 ASCII 图形表示的分支合并历史</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=oneline <span class="comment"># 指定显示格式，--pretty 选项的可选值为 oneline, short, full, fuller, format。其中，oneline 以一行展示提交信息</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=format:<span class="string">"%h - %an, %ar : %s"</span> <span class="comment"># 指定输出信息的模板字符串，用于提取分析报告。占位符包含 %H 提交对象/commit的完整哈希字串, %h 提交对象的简短哈希字串, %T 树对象/tree的完整哈希字串, %t, %P 父对象/parent的完整哈希字串, %p, %an 作者, %ae 作者的邮箱, %ad 作者修订日期, %ar 作者的相对修订日期, %cn 提交者, %ce, %cd, %cr, %s 说明</span></span><br><span class="line">git <span class="built_in">log</span> --oneline <span class="comment"># --pretty=oneline --abbrev-commit 简写形式</span></span><br><span class="line">git <span class="built_in">log</span> -&lt;n&gt; <span class="comment"># -n 指定只显示最后两次提交记录，如 -2。通常不需要使用。因为 git log 显示采用分页形式，用户只能看到第一页</span></span><br><span class="line">git <span class="built_in">log</span> --since|--after=2.weeks <span class="comment"># --since 选项指定起始时间，可用相对时间或绝对时间，如 '2 years 1 day 3 minutes ago'</span></span><br><span class="line">git <span class="built_in">log</span> --until|--before=<span class="string">"2008-01-15"</span> <span class="comment"># 同上，指定结束时间</span></span><br><span class="line">git <span class="built_in">log</span> --author=authorname <span class="comment"># 过滤作者</span></span><br><span class="line">git <span class="built_in">log</span> --committer=committername <span class="comment"># 过滤提交者</span></span><br><span class="line">git <span class="built_in">log</span> --grep=messagekey <span class="comment"># 按 message 中关键字检索，与 --author 合用时为或匹配，添加 --all-match 选项强制匹配 grep 指定关键字</span></span><br><span class="line">git <span class="built_in">log</span> -S function_name <span class="comment"># 指定字符串检索更改相应字符串的提交记录</span></span><br><span class="line">git <span class="built_in">log</span> --no-merges <span class="comment"># 不显示 merge 记录</span></span><br><span class="line">git <span class="built_in">log</span> --filename <span class="comment"># 作为最后一个选项，检索更改相应文件或目录的提交记录</span></span><br></pre></td></tr></table></figure>
<h3 id="撤销"><a href="#撤销" class="headerlink" title="撤销"></a>撤销</h3><p>撤销操作不能回滚，容易引起数据丢失。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend <span class="comment"># 合并上一次提交记录，适用于文件漏提交等轻微改动场景。若暂存区文件未作更新，commit 快照将保持不变，只更改 message 或者连 message 也未作更改。只保留当前的提交记录；撤销上一次提交记录，即不会存在于提交记录中</span></span><br><span class="line">git reset HEAD &lt;filename&gt; <span class="comment"># 暂存区文件重置为提交前状态。执行 git status 命令，工作位已更改文件的状态为 unstaged。git reset 命令不加选项，只更改暂存区。git reset --hard 命令将可能导致工作区的当前进度全部丢失，相当危险</span></span><br><span class="line">git checkout -- &lt;file&gt; <span class="comment">#  使用暂存区的文件替换工作区的文件，即工作区文件回滚</span></span><br></pre></td></tr></table></figure>
<h3 id="远程协作"><a href="#远程协作" class="headerlink" title="远程协作"></a>远程协作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git remote <span class="comment"># 列出远程服务器的简称，默认为 origin</span></span><br><span class="line">git remote -v <span class="comment"># 列出远程服务器的简称和 url 列表，同一个项目可能指定了多个远程仓库。fetch, push 操作的服务器资源也可能不同，由远程仓库决定</span></span><br><span class="line">remote add &lt;shortname&gt; &lt;url&gt; <span class="comment"># 添加远程仓库</span></span><br><span class="line">git fetch &lt;shortname|url&gt; <span class="comment"># 抓取远程仓库资源，包含所有分支，并创建本地远程跟踪分支，却不会创建可修改、供开发的本地同名分支。只下载远程仓库资源，需手动 merge</span></span><br><span class="line">git pull <span class="comment"># 若本地分支跟踪远程分支，git pull 命令自动拉取远程仓库中指定的分支，并尝试 merge</span></span><br><span class="line">git pull &lt;remotename&gt; &lt;branchname&gt; <span class="comment"># 拉取远程分支资源，并尝试 merge。选项 remotename 指定远程仓库，branchname 指定分支</span></span><br><span class="line">git push <span class="comment"># 若本地分支跟踪远程分支，git push 将资源推送到远程仓库下的指定分支</span></span><br><span class="line">git push &lt;remotename&gt; &lt;branchname&gt; <span class="comment"># 推送资源到指定远程下的指定分支</span></span><br><span class="line">git remote show &lt;remotename&gt; <span class="comment"># 查看远程仓库 fetch|push 操作的 url，包含的分支，以及跟踪分支信息</span></span><br><span class="line">git remote rename shortname_before shortname_after <span class="comment"># 改写远程仓库的简称，同时改变分支名，如更新为 shortname_after/master</span></span><br><span class="line">git remote remove|rm &lt;remotename&gt; <span class="comment"># 本地移除某远程仓库，同时影响其下分支和配置，对远程仓库无影响</span></span><br></pre></td></tr></table></figure>
<h3 id="打标签"><a href="#打标签" class="headerlink" title="打标签"></a>打标签</h3><p>git 标签分为两种，轻量标签lightweight, 附注标签 annotated。轻量标签通过 git tag 不带选项创建，附注标签通过 git tag -a 创建。附注标签以对象形式存储在 git 数据库中，包含标签作者，电邮，日期，标签信息/message，并且可以使用 GPG 签名和验证。git tag 命令通常用来发布不再修改的版本(通过 git push <tagname> 命令)，且发布以后，不能再作修改，需要在本地创建新分支拉取标签资源，作适当修改后再发布。</tagname></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git tag <span class="comment"># 列出所有标签，以字母顺序罗列</span></span><br><span class="line">git tag -l|-list &lt;pattern&gt; <span class="comment"># 只罗列匹配的标签，如 git tag -l "v1.8.5*"。pattern 中若含有通配符，-l 选项不可缺失</span></span><br><span class="line">git tag &lt;tagname&gt; <span class="comment"># 创建轻量标签，git show &lt;tagname&gt; 时只显示 commit 信息</span></span><br><span class="line">git tag -a &lt;tagname&gt; -m <span class="string">"message"</span> <span class="comment"># 创建附注标签，git show &lt;tagname&gt; 时除显示 commit 信息外，还显示标签作者，电邮，日期，标签信息等</span></span><br><span class="line">git show &lt;tagname&gt; <span class="comment"># 查看标签信息及对应的提交信息</span></span><br><span class="line">git tag -a &lt;tagname&gt; &lt;checksum&gt; <span class="comment"># 提交后再打标签，选项 checksum 为 hash算法校验和，即快照的索引，可以只包含部分 hash 值</span></span><br><span class="line">git push origin &lt;tagname&gt; <span class="comment"># 将标签推送到远程共享服务器上</span></span><br><span class="line">git push --tags <span class="comment"># 将本地所有标签推送到服务器上</span></span><br><span class="line">git checkout &lt;tagname&gt; <span class="comment"># 检出标签，但不能真正检出标签，本地仓库会进入 "detached HEAD" 状态，提交将不从属于任何分支，只有 commit checksum 校验和能被 git 感知到</span></span><br><span class="line">git checkout -b &lt;branchnam&gt; &lt;tagname&gt; <span class="comment"># 在本地创建新分支，并拉取指定标签资源。修改后，重新创建标签并 push</span></span><br></pre></td></tr></table></figure>
<h3 id="疑问-1"><a href="#疑问-1" class="headerlink" title="疑问"></a>疑问</h3><ol>
<li>暂存区存在的意义？</li>
<li>强制删除的意义？</li>
<li>commit 提交记录以何种形式存储，才能实现快速检索？关于 git database？</li>
<li>本地版本库如何回滚？</li>
<li>git pull|push 只拉取或推送快照，还是所有历史记录？</li>
<li>git 远程服务器对版本管理的实现是否和本地相同，可否指定局域网中某台机器作为拉取资源的源头？</li>
<li>打标签只针对 commit 操作？且标签只针对不会再修改的版本？git push origin [tagname] 推送到共享服务器和 git push origin [branchname] 的差异？</li>
<li>切换分支时，为什么需要提交到版本库，而不是暂存库，这样就可以避免工作区的变更丢失了？</li>
</ol>
<h2 id="Git-Branching"><a href="#Git-Branching" class="headerlink" title="Git Branching"></a>Git Branching</h2><h3 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h3><p>分支原理见 Getting Started。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --oneline --decorate <span class="comment"># --decorate 选项用于查询各个分支及 HEAD 指针指向哪个提交对象</span></span><br><span class="line">git <span class="built_in">log</span> --oneline --decorate --graph --all <span class="comment"># 查看提交历史的分叉情况，各个分支及 HEAD 指针的指向</span></span><br><span class="line">git branch <span class="comment"># 查看所有分支，带 '*' 的为当前分支</span></span><br><span class="line">git branch -v <span class="comment"># 查看所有分支最后一次提交记录</span></span><br><span class="line">git branch --merged <span class="comment"># 查看已合并到当前分支的所有分支</span></span><br><span class="line">git branch --no-merged <span class="comment"># 查看未合并到当前分支的所有分支</span></span><br><span class="line">git branch --merged &lt;branchname&gt; <span class="comment"># 查看已合并到 branchname 分支的所有分支</span></span><br><span class="line">git branch --no-merged &lt;branchname&gt; <span class="comment"># 查看未合并到 branchname 分支的所有分支</span></span><br><span class="line">git branch &lt;branchname&gt; <span class="comment"># 创建分支，但不切换分支</span></span><br><span class="line">git branch -d &lt;branchname&gt; <span class="comment"># 删除分支，branchname 未合并到当前分支，将不予删除</span></span><br><span class="line">git branch -D &lt;branchname&gt; <span class="comment"># 强制删除分支</span></span><br><span class="line">git checkout &lt;branchname&gt; <span class="comment"># 切换分支，即改变 HEAD 指针指向。修改文件但未提交到版本库的，git 将阻止切换</span></span><br><span class="line">git checkout -b &lt;branchname&gt; <span class="comment"># 创建并切换分支</span></span><br><span class="line">git merge &lt;branchname&gt; <span class="comment"># 将 branchname 分支合并到当前分支</span></span><br><span class="line">git status <span class="comment"># 查看冲突文件</span></span><br><span class="line">git mergetool <span class="comment"># 使用图形化工具解决冲突，默认使用 opendiff 工具，可选用工具包含 opendiff, kdiff3, tkdiff, xxdiff, meld, tortoisemerge, gvimdiff, diffuse, diffmerge, ecmerge, p4merge, araxis, bc3, codecompare, vimdiff, emerge</span></span><br><span class="line">git mergetool --tool-help <span class="comment"># 合并工具帮助信息</span></span><br></pre></td></tr></table></figure>
<h3 id="工作流"><a href="#工作流" class="headerlink" title="工作流"></a>工作流</h3><p>推荐使用的本地开发工作流/workflow 有两种，长期分支模式(Long-Running Branches)，特性分支模式(Topic Branches)。当然，这只是一种参考。</p>
<p>长期分支模式根据稳定性创建分支，需要较高稳定性的分支创建在前，较低稳定性的创建在后，如 master 分支先于 develop 分支，develop 分支先于 topic 分支，合并时依序将 topic 分支合并到 develop 分支，develop 分支合并到 master 分支。适用于大型项目，作为分支创建的基础结构，在每个分支可以再次使用特性分支模式。</p>
<p>特性分支模式适用于开发者想法多变的场景，比如在 master 分支基础创建 hotfix 分支，接着创建 hotfix_v2，同时开发 hotfix, hotfix_v2 分支，最终又启用 hotfix 分支；与此同时，开发过程中 master 分支不只产生了新的提交，后续又创建了实现新想法的 idea 分支，最后将 hotfix_v2, idea 分支合并到 master 分支。</p>
<h3 id="远程分支"><a href="#远程分支" class="headerlink" title="远程分支"></a>远程分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git ls-remote &lt;shortname&gt; <span class="comment"># 查看远程引用清单</span></span><br><span class="line">git remote show &lt;shortname&gt; <span class="comment"># 查看远程引用详细信息</span></span><br><span class="line">git push &lt;shortname&gt; &lt;branch&gt; <span class="comment"># 将当前分支的提交内容推送到远程 branch 分支，git 自动将分支名扩展为 refs/heads/branch:refs/heads/branch，意为将本地 branch 分支推送并更新远程 branch 分支</span></span><br><span class="line">git push shortname localebranch:remotebranch <span class="comment"># 推送本地 localebranch 分支，将其作为远程 remotebranch 分支</span></span><br><span class="line">git merge shortname/branchname <span class="comment"># 将远程跟踪分支 shortname/branchname 合并到当前分支，合并前须 git fetch</span></span><br><span class="line">git checkout -b localebranch shortname/remotebranch <span class="comment"># 通过远程跟踪分支创建本地分支，自动跟踪远程分支，可使用 git pull|push 简化拉取、提交操作；且可以在命令行中使用 @&#123;upstream&#125; 或 @&#123;u&#125; 代替 shortname/remotebranch</span></span><br><span class="line">git checkout --track shortname/remotebranch <span class="comment"># 上一条命令的简写形式，创建 remotebranch 同名分支</span></span><br><span class="line">git checkout remotebranch <span class="comment"># 上一条命令的简写形式，条件是本地未存在 remotebranch 同名分支，远程存在</span></span><br><span class="line">git branch -u|--<span class="built_in">set</span>-upstream-to shortname/remotebranch <span class="comment"># 当前分支切换跟踪远程 remotebranch 分支</span></span><br><span class="line">git branch -vv <span class="comment"># 查看本地分支在跟踪哪个远程分支，以及ahead, behind, up to date等提交状态。这条命令基于最后一次 fetch 的数据，命令本身没有连接服务器</span></span><br><span class="line">git fetch &lt;shortname|url&gt; <span class="comment"># 抓取远程仓库资源，包含所有分支，并创建本地远程跟踪分支，却不会创建可修改、供开发的本地同名分支。只下载远程仓库资源，不会更改工作区内容，需手动 merge</span></span><br><span class="line">git pull <span class="comment"># git fetch, git merge 命令的结合，拉取数据并合并</span></span><br><span class="line">git push origin --delete remotebranch <span class="comment"># 删除远程分支</span></span><br></pre></td></tr></table></figure>
<h3 id="变基"><a href="#变基" class="headerlink" title="变基"></a>变基</h3><p>参考：<br><a href="https://git-scm.com/book/en/v2" target="_blank" rel="noopener">https://git-scm.com/book/en/v2</a><br><a href="https://git-scm.com/book/zh/v2" target="_blank" rel="noopener">https://git-scm.com/book/zh/v2</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/13/mocha使用指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/13/mocha使用指南/" itemprop="url">mocha使用指南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-13T18:50:11+08:00">2018-02-13</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/" itemprop="url" rel="index"><span itemprop="name">前端工程化</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/13/mocha使用指南/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/13/mocha使用指南/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>mocha 是一款可运行在 node 环境或浏览器上的测试框架。</p>
<p>mocha 本身没有实现断言库，可使用 chai, should.js, expect.js, better-assert, unexpected 等断言库或 node 内置的 assert 模块。断言库错误输出需有 actual, expected 属性。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="BDD"><a href="#BDD" class="headerlink" title="BDD"></a>BDD</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BDD 风格，describe/context, it/specify, before, after, beforeEach, afterEach</span></span><br><span class="line"><span class="keyword">var</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line">describe(<span class="string">'Array'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="comment">// 测试套件</span></span><br><span class="line">  describe(<span class="string">'#indexOf()'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">'should return -1 when the value is not present'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="comment">// 测试单元</span></span><br><span class="line">      assert.equal([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].indexOf(<span class="number">4</span>), <span class="number">-1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="TDD"><a href="#TDD" class="headerlink" title="TDD"></a>TDD</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TDD 风格，suite, test, suiteSetup, suiteTeardown, setup, teardown</span></span><br><span class="line">suite(<span class="string">'Array'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  setup(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  suite(<span class="string">'#indexOf()'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    test(<span class="string">'should return -1 when not present'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      assert.equal(<span class="number">-1</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].indexOf(<span class="number">4</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="EXPORTS"><a href="#EXPORTS" class="headerlink" title="EXPORTS"></a>EXPORTS</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EXPORTS 风格，before, after, beforeEach, afterEach</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  before: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="string">'Array'</span>: &#123;<span class="comment">// 对象作为测试套件</span></span><br><span class="line">    <span class="string">'#indexOf()'</span>: &#123;</span><br><span class="line">      <span class="string">'should return -1 when not present'</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="comment">// 函数为测试单元</span></span><br><span class="line">        [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].indexOf(<span class="number">4</span>).should.equal(<span class="number">-1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="QUNIT"><a href="#QUNIT" class="headerlink" title="QUNIT"></a>QUNIT</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// QUNIT 风格，suite, test, before, after, beforeEach, afterEach</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ok</span>(<span class="params">expr, msg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!expr) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">suite(<span class="string">'Array'</span>);</span><br><span class="line"></span><br><span class="line">test(<span class="string">'#length'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">  ok(arr.length == <span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">test(<span class="string">'#indexOf()'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">  ok(arr.indexOf(<span class="number">1</span>) == <span class="number">0</span>);</span><br><span class="line">  ok(arr.indexOf(<span class="number">2</span>) == <span class="number">1</span>);</span><br><span class="line">  ok(arr.indexOf(<span class="number">3</span>) == <span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">suite(<span class="string">'String'</span>);</span><br><span class="line"></span><br><span class="line">test(<span class="string">'#length'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ok(<span class="string">'foo'</span>.length == <span class="number">3</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="REQUIRE"><a href="#REQUIRE" class="headerlink" title="REQUIRE"></a>REQUIRE</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// REQUIRE 风格，使用 require 注入</span></span><br><span class="line"><span class="keyword">var</span> testCase = <span class="built_in">require</span>(<span class="string">'mocha'</span>).describe;</span><br><span class="line"><span class="keyword">var</span> pre = <span class="built_in">require</span>(<span class="string">'mocha'</span>).before;</span><br><span class="line"><span class="keyword">var</span> assertions = <span class="built_in">require</span>(<span class="string">'mocha'</span>).it;</span><br><span class="line"><span class="keyword">var</span> assert = <span class="built_in">require</span>(<span class="string">'chai'</span>).assert;</span><br><span class="line"></span><br><span class="line">testCase(<span class="string">'Array'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  pre(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  testCase(<span class="string">'#indexOf()'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    assertions(<span class="string">'should return -1 when not present'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      assert.equal([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].indexOf(<span class="number">4</span>), <span class="number">-1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>mocha 后跟测试文件名（可使用通配符），或将测试脚本放在 test 目录里，执行 mocha 命令测试 test 目录下的测试脚本（默认只执行第一层）。浏览器端使用 mocha.setup 方法配置 mocha。</p>
<p>选项（可以将命令行参数放在 mocha.opts 文件里，也可以 mocha.opts 文件里指定测试目录）：</p>
<ul>
<li>-u, –ui <name> 测试脚本编码风格，可选值 bdd|tdd|qunit|exports。</name></li>
<li>–recursive 使用 mocha 测试 test 目录下所有文件。</li>
<li>-g, –grep <pattern> 只测试匹配正则的 it 。</pattern></li>
<li>-f, –fgrep <string> 只测试包含字符串的 it。</string></li>
<li>-i, –invert 反转 grep, fgrep 选项。</li>
<li>–bail, -b 有一个测试脚本未通过时，就停止测试。</li>
<li>-d, –debug 启动 debug 模式。</li>
<li>–debug-brk enable node’s debugger breaking on the first line???</li>
<li>-gc, –expose-gc expose gc extension???</li>
<li>–harmony<_classes,_generators,...> all node –harmony* flags are available???</_classes,_generators,...></li>
<li>–es_staging 启用所有 staged 特征???</li>
<li>-S, –sort 排序测试文件。</li>
<li>–compilers <ext>:<module>,… 指定测编译器，如 mocha –compilers js:babel-core/register。若需使用 Map、Set 等，须在测试脚本前 import ‘babel-polyfill’。</module></ext></li>
<li>-r, –require <name> 加载特定的模块，如 ‘babel-polyfill’。</name></li>
<li>–file <file> 测试时加载指定文件。</file></li>
<li>–globals <names> 以 ‘,’ 分割形式注入全局变量。</names></li>
<li>-A, –async-only 测试脚本只能使用异步编程，回调或 promise 形式。</li>
<li>-w, –watch 监视文件变动，自动运行测试脚本。</li>
<li>-t, –timeout <ms> 指定测试时的超时时间，默认为 2000 ms。</ms></li>
<li>-s, –slow <ms> 高亮显示超过指定时间的测试报告，默认为 75 ms。</ms></li>
<li>–check-leaks 检测全局变量泄漏。</li>
<li>–growl, -G 将报告显示在桌面。</li>
<li>-R, –reporter <name> 指定报告打印形式，默认是 spec 格式，可选值 tap, dot, nyan, mochawesome 网页报告（须先安装 npm install –dev mochawesome）。</name></li>
<li>-O, –reporter-options <k=v,k2=v2,...>，打印选项。</k=v,k2=v2,...></li>
<li>–reporters 显示所有报告格式。</li>
<li>-c, –colors 显示颜色。</li>
<li>-C, –no-colors 不显示颜色。</li>
<li>–full-trace 显示完整的堆栈信息。</li>
<li>生成规格文件，如 mocha –recursive -R markdown &gt; spec.md 或 mocha –recursive -R doc &gt; spec.html。<br>…</li>
</ul>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><h3 id="钩子函数"><a href="#钩子函数" class="headerlink" title="钩子函数"></a>钩子函数</h3><ul>
<li>before，在测试用例之前执行</li>
<li>after，在测试用例之后执行</li>
<li>beforeEach，在每个单元测试前执行</li>
<li>afterEach，在每个单元测试后执行</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 钩子允许在 describe 外围，回调将在测试脚本之前或之后执行</span></span><br><span class="line">beforeEach(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'before every test in every file'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'hooks'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 钩子函数以匿名函数使用，允许携带描述；命名函数不能</span></span><br><span class="line">  before(<span class="string">'some description'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// runs before all tests in this block</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 钩子支持同步或异步编程</span></span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span>(<span class="params">done</span>) </span>&#123;</span><br><span class="line">    db.clear(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> done(err);</span><br><span class="line">      db.save([tobi, loki, jane], done);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// test cases</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="异步测试"><a href="#异步测试" class="headerlink" title="异步测试"></a>异步测试</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 回调函数形式</span></span><br><span class="line">describe(<span class="string">'User'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  describe(<span class="string">'#save()'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">'should save without error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">done</span>) </span>&#123;<span class="comment">// done 只能执行一次，两次及以上会报错</span></span><br><span class="line">      <span class="keyword">var</span> user = <span class="keyword">new</span> User(<span class="string">'Luna'</span>);</span><br><span class="line">      user.save(done);<span class="comment">// done 能自动识别并处理 err 错误</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// promise 形式</span></span><br><span class="line">describe(<span class="string">'#find()'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">'respond with matching records'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// db.find(&#123; type: 'User' &#125;) 返回 promise</span></span><br><span class="line">    <span class="keyword">return</span> db.find(&#123; <span class="attr">type</span>: <span class="string">'User'</span> &#125;).should.eventually.have.length(<span class="number">3</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// async 函数形式</span></span><br><span class="line">describe(<span class="string">'#find()'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">'responds with matching records'</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> users = <span class="keyword">await</span> db.find(&#123; <span class="attr">type</span>: <span class="string">'User'</span> &#125;);</span><br><span class="line">    users.should.have.length(<span class="number">3</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="延迟执行"><a href="#延迟执行" class="headerlink" title="延迟执行"></a>延迟执行</h3><p>命令行选项 –delay 用于延迟，相应测试脚本使用 setTimeout 包裹。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do some setup</span></span><br><span class="line"></span><br><span class="line">  describe(<span class="string">'my suite'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  run();</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure>
<h3 id="搁置测试"><a href="#搁置测试" class="headerlink" title="搁置测试"></a>搁置测试</h3><p>使测试处于 pending 状态，仍然会打印报告。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'Array'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  describe(<span class="string">'#indexOf()'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// pending test below</span></span><br><span class="line">    it(<span class="string">'should return -1 when the value is not present'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="限制测试"><a href="#限制测试" class="headerlink" title="限制测试"></a>限制测试</h3><ul>
<li>describe, it 调用 only 方法将只运行指定测试脚本，添加的钩子仍会执行。</li>
<li>describe, it 调用 skip 方法将避免某些脚本的执行。skip 也可以在 mocha 运行过程中调用，或在钩子中调用，两者均使用 this.skip()。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// only 方法限制只执行某些测试脚本</span></span><br><span class="line">describe(<span class="string">'Array'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  describe.only(<span class="string">'#indexOf()'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it.only(<span class="string">'should return -1 unless present'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// this test will be run</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should return the index when present'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// this test will not be run</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// skip 方法跳过执行指定测试脚本</span></span><br><span class="line">describe(<span class="string">'Array'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  describe(<span class="string">'#indexOf()'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it.skip(<span class="string">'should return -1 unless present'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// this test will not be run</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should return the index when present'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// this test will be run</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// mocha 运行时 skip</span></span><br><span class="line">it(<span class="string">'should only test in the correct environment'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* check test environment */</span>) &#123;</span><br><span class="line">    <span class="comment">// make assertions</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.skip();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 钩子 skip</span></span><br><span class="line">before(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* check test environment */</span>) &#123;</span><br><span class="line">    <span class="comment">// setup code</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.skip();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h3><ul>
<li>retries(num)，指定重复执行测试脚本 num 次，不推荐在单元测试中使用。</li>
<li>slow(time)，高亮显示超过指定时间的测试报告，默认为 75 ms。</li>
<li>timeout(time)，设定超时时间，可在 describe, it 或钩子 中调用。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// retries</span></span><br><span class="line">describe(<span class="string">'retries'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Retry all tests in this suite up to 4 times</span></span><br><span class="line">  <span class="keyword">this</span>.retries(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    browser.get(<span class="string">'http://www.yahoo.com'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'should succeed on the 3rd try'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Specify this test to only retry up to 2 times</span></span><br><span class="line">    <span class="keyword">this</span>.retries(<span class="number">2</span>);</span><br><span class="line">    expect($(<span class="string">'.foo'</span>).isDisplayed()).to.eventually.be.true;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// slow</span></span><br><span class="line">describe(<span class="string">'something slow'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.slow(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'should take long enough for me to go make a sandwich'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// timeout</span></span><br><span class="line">describe(<span class="string">'a suite of tests'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.timeout(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'should take less than 500ms'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">done</span>)</span>&#123;</span><br><span class="line">    setTimeout(done, <span class="number">300</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'should take less than 500ms as well'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">done</span>)</span>&#123;</span><br><span class="line">    setTimeout(done, <span class="number">250</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/12/chai使用指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/12/chai使用指南/" itemprop="url">chai使用指南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-12T19:12:35+08:00">2018-02-12</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/" itemprop="url" rel="index"><span itemprop="name">前端工程化</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/12/chai使用指南/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/12/chai使用指南/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>chai 是一款辅助 TDD 测试驱动开发, BDD 行为驱动开发 的断言库。</p>
<p>有关 TDD 和 BDD，可参考：<br><a href="https://www.cnblogs.com/Leo_wl/p/4780678.html" target="_blank" rel="noopener">开发人员看测试之TDD和BDD</a><br><a href="http://blog.jobbole.com/110560/" target="_blank" rel="noopener">TDD 已死？让我们再聊聊 TDD</a><br><a href="http://blog.csdn.net/dc_726/article/details/49688379" target="_blank" rel="noopener">BDD敏捷开发入门与实战</a></p>
<p>chai 的 TDD 模块只包含 assert 一种， BDD 模块包含 except, should 两种。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul>
<li>chai.config.includeStack = false，错误输出中是否包含堆栈信息</li>
<li>chai.config.showDiff = true，是否显示 diff</li>
<li>chai.config.truncateThreshold = 40，错误输出中 actual, expexted 打印字符串上限???</li>
</ul>
<h2 id="api手册"><a href="#api手册" class="headerlink" title="api手册"></a>api手册</h2><h3 id="TDD测试"><a href="#TDD测试" class="headerlink" title="TDD测试"></a>TDD测试</h3><h4 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h4><p>类似 node 的同名模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> assert = <span class="built_in">require</span>(<span class="string">'chai'</span>).assert</span><br><span class="line">  , foo = <span class="string">'bar'</span></span><br><span class="line">  , beverages = &#123; <span class="attr">tea</span>: [ <span class="string">'chai'</span>, <span class="string">'matcha'</span>, <span class="string">'oolong'</span> ] &#125;;</span><br><span class="line"></span><br><span class="line">assert.typeOf(foo, <span class="string">'string'</span>); <span class="comment">// without optional message</span></span><br><span class="line">assert.typeOf(foo, <span class="string">'string'</span>, <span class="string">'foo is a string'</span>);</span><br><span class="line">assert.equal(foo, <span class="string">'bar'</span>, <span class="string">'foo equal `bar`'</span>);</span><br><span class="line">assert.lengthOf(foo, <span class="number">3</span>, <span class="string">'foo`s value has a length of 3'</span>);</span><br><span class="line">assert.lengthOf(beverages.tea, <span class="number">3</span>, <span class="string">'beverages has 3 types of tea'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="apis"><a href="#apis" class="headerlink" title="apis"></a>apis</h4><ul>
<li>assert(expression, message)，参数 expression 为待测试的语句</li>
<li>.fail(actual, expected, [message], [operator])，operator 为操作（默认为 !=）</li>
<li>.ifError(object)，校验真值时抛出错误</li>
<li>.isOk/isNotOk/isTrue/isNotTrue/isFalse/isNotFalse/isNull/isNotNull/isNaN/isNotNaN/<br>isUndefined/isDefined/isFunction/isNotFunction/isObject/isNotObject/isArray/isNotArray/<br>isString/isNotString/isNumber/isNotNumber/isFinite/isBoolean/isNotBoolean(object, [message])</li>
<li>.exists/notExists(value, [message])，校验 value 不是 null 或 undefined</li>
<li>.typeOf/notTypeOf(value, type, [message]) 类型校验</li>
<li>.instanceOf/notInstanceOf(object, constructor, [message])</li>
<li>.match/notMatch(value, regexp, [message])</li>
<li>.equal/notEqual/strictEqual/notStrictEqual/deepEqual/notDeepEqual(actual, expected, [message])，’==’, ‘===’ 或 深度相等</li>
<li>.isAbove/isAtLeast/isBelow/isAtMost(valueToCheck, valueToBeAbove, [message])，以操作符 ‘&gt;’, ‘&gt;=’, ‘&lt;’, ‘&lt;=’ 校验</li>
<li>.operator(val1, operator, val2, [message])，’&gt;’, ‘&lt;’ 操作符校验</li>
<li>.closeTo(actual, expected, delta, [message])，actual 在 expected - delta, expected + delta 之间</li>
<li>.approximately(actual, expected, delta, [message])，同上</li>
<li>.changes/doesNotChange/increases/doesNotIncrease/decreases/<br>doesNotDecrease(function, object, property, [message])，校验函数执行时是否改变对象属性</li>
<li>.changesBy/changesButNotBy/ncreasesBy/increasesButNotBy/decreasesBy/<br>doesNotDecreaseBy/decreasesButNotBy(function, object, property, delta, [message])，校验属性数值改变 + delta</li>
<li>.lengthOf(object, length, [message])，校验字符串或数组的长度</li>
<li>.isExtensible/isNotExtensible/isSealed/isNotSealed/isFrozen/isNotFrozen(object)</li>
<li>.isEmpty/isNotEmpty(target)，校验对象、数组、字符串、Map、Set非空</li>
<li>.oneOf(inList, list, [message])</li>
<li>.include/notInclude/deepInclude/notDeepInclude/nestedInclude/notNestedInclude/<br>deepNestedInclude/notDeepNestedInclude/ownInclude/notOwnInclude/<br>deepOwnInclude/notDeepOwnInclude(haystack, needle, [message])，校验是否包含数组项，子字符串，或者对象属性的截取。deep 为深度匹配，nest 以分隔符 . 或者 [] 校验嵌套属性，own 校验是否自有属性</li>
<li>sameMembers/notSameMembers/sameDeepMembers/notSameDeepMembers/<br>sameOrderedMembers/notSameOrderedMembers/<br>sameDeepOrderedMembers/notSameDeepOrderedMembers(set1, set2, [message])，校验 set 是否有相同的成员。orderd 顺序相同</li>
<li>.includeMembers/notIncludeMembers/includeDeepMembers/notIncludeDeepMembers/<br>includeOrderedMembers/notIncludeOrderedMembers/<br>includeDeepOrderedMembers/notIncludeDeepOrderedMembers(superset, subset, [message])</li>
<li>.property/notProperty/nestedProperty/notNestedProperty(object, property, [message])</li>
<li>.propertyVal/notPropertyVal/deepPropertyVal/notDeepPropertyVal/<br>notNestedProperty/notNestedPropertyVal/<br>deepNestedPropertyVal/notDeepNestedPropertyVal(object, property, value, [message])</li>
<li>.hasAnyKeys/hasAllKeys/containsAllKeys/doesNotHaveAnyKeys/<br>doesNotHaveAllKeys/hasAnyDeepKeys/hasAllDeepKeys/<br>containsAllDeepKeys/doesNotHaveAnyDeepKeys/doesNotHaveAllDeepKeys(object, [keys], [message])</li>
<li>.throws/doesNotThrow(fn, [errorLike/string/regexp], [string/regexp], [message])，校验函数 fn 将抛出指定类型及文案的错误</li>
</ul>
<h3 id="TDD测试-except-should"><a href="#TDD测试-except-should" class="headerlink" title="TDD测试 - except, should"></a>TDD测试 - except, should</h3><h4 id="except"><a href="#except" class="headerlink" title="except"></a>except</h4><p>提供链式调用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> expect = <span class="built_in">require</span>(<span class="string">'chai'</span>).expect</span><br><span class="line">  , foo = <span class="string">'bar'</span></span><br><span class="line">  , beverages = &#123; <span class="attr">tea</span>: [ <span class="string">'chai'</span>, <span class="string">'matcha'</span>, <span class="string">'oolong'</span> ] &#125;;</span><br><span class="line"></span><br><span class="line">expect(foo).to.be.a(<span class="string">'string'</span>);</span><br><span class="line">expect(foo).to.equal(<span class="string">'bar'</span>);</span><br><span class="line">expect(foo).to.have.lengthOf(<span class="number">3</span>);</span><br><span class="line">expect(beverages).to.have.property(<span class="string">'tea'</span>).with.lengthOf(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<h4 id="should"><a href="#should" class="headerlink" title="should"></a>should</h4><p>增强了 Object.property 功能，因此需先显示调用 chai.should 函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> should = <span class="built_in">require</span>(<span class="string">'chai'</span>).should() <span class="comment">//actually call the function</span></span><br><span class="line">  , foo = <span class="string">'bar'</span></span><br><span class="line">  , beverages = &#123; <span class="attr">tea</span>: [ <span class="string">'chai'</span>, <span class="string">'matcha'</span>, <span class="string">'oolong'</span> ] &#125;;</span><br><span class="line"></span><br><span class="line">foo.should.be.a(<span class="string">'string'</span>);</span><br><span class="line">foo.should.equal(<span class="string">'bar'</span>);</span><br><span class="line">foo.should.have.lengthOf(<span class="number">3</span>);</span><br><span class="line">beverages.should.have.property(<span class="string">'tea'</span>).with.lengthOf(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<h4 id="语言链修饰符"><a href="#语言链修饰符" class="headerlink" title="语言链修饰符"></a>语言链修饰符</h4><p>语言链修饰符用于增强代码的可读性，包含 to, be, been, isthat, and, has, have, with, at, of, same</p>
<h4 id="apis-1"><a href="#apis-1" class="headerlink" title="apis"></a>apis</h4><ul>
<li>not 将断言置否，即否值满足断言，如 expect(function () {}).to.not.throw();</li>
<li>deep 深比较，如 expect({a: 1}).to.deep.equal({a: 1});</li>
<li>nested 嵌套属性，以 . 或 [] 分割，如 expect({a: {b: [‘x’, ‘y’]}}).to.have.nested.property(‘a.b[1]’);</li>
<li>own 如 expect({a: 1}).to.have.own.property(‘a’);</li>
<li>ordered 顺序比较，如 expect([1, 2]).to.have.ordered.members([1, 2]).but.not.have.ordered.members([2, 1]);</li>
<li>any/all 如 expect({a: 1, b: 2}).to.not.have.any.keys(‘c’, ‘d’);</li>
<li>.a/an(type[, msg]) 如 expect({a: 1}).to.be.an(‘object’);</li>
<li>.include(val[, msg]) 如 expect(‘foobar’).to.include(‘foo’);</li>
<li>.ok/true/false/null/undefined/NaN/exist/empty/arguments/finite 如 expect(arguments).to.be.arguments;</li>
<li>.eql(obj[, msg]) 如 expect({a: 1}).to.eql({a: 1}).but.not.equal({a: 1});</li>
<li>.above/least/below/most(n[, msg]) 如 expect(1).to.be.at.least(2);</li>
<li>.within(start, finish[, msg]) 如 expect(2).to.be.within(1, 3);</li>
<li>.instanceof(constructor[, msg]) 如 expect({a: 1}).to.not.be.an.instanceof(Array);</li>
<li>.property(name[, val[, msg]]) 如 expect({x: {a: 1}}).to.have.deep.property(‘x’, {a: 1});</li>
<li>.ownPropertyDescriptor(name[, descriptor[, msg]]) 如 expect({a: 1}).to.have.ownPropertyDescriptor(‘a’);</li>
<li>.lengthOf(n[, msg]) 如 expect([1, 2, 3]).to.have.lengthOf(3);</li>
<li>.match(re[, msg]) 如 expect(‘foobar’).to.match(/^foo/);</li>
<li>.string(str[, msg]) 包含子字符串，如 expect(‘foobar’).to.not.have.string(‘taco’);</li>
<li>.keys(key1[, key2[, …]]) 如 expect({a: 1, b: 2}).to.have.all.keys(‘a’, ‘b’);</li>
<li>.throw([errorLike], [errMsgMatcher], [msg]) 校验函数必须抛出错误，如 expect(badFn).to.throw();</li>
<li>.respondTo(method[, msg]) 校验对象是否有某方法，可以是继承的，如 expect(new Cat()).to.respondTo(‘meow’);</li>
<li>.itself 自有属性，如 expect(Cat).itself.to.respondTo(‘hiss’).but.not.respondTo(‘meow’);</li>
<li>.satisfy(matcher[, msg]) 校验是否匹配 matcher，如 expect(1).to.satisfy(function(num) { return num &gt; 0; });</li>
<li>.closeTo(expected, delta[, msg]) 校验值在 expected - delta ~ expected + delta 范围内，如 expect(1.5).to.be.closeTo(1, 0.5);</li>
<li>.members(set[, msg]) 如 expect([1, 2, 3]).to.have.members([2, 1, 3]);</li>
<li>.oneOf(list[, msg]) 如 expect(1).to.be.oneOf([1, 2, 3]);</li>
<li>.change(subject[, prop[, msg]]) 执行函数后，引起对象或其属性改变，如 expect(addDot).to.change(myObj, ‘dots’);</li>
<li>.increase(subject[, prop[, msg]]) 值增加</li>
<li>.decrease(subject[, prop[, msg]]) 值减少</li>
<li>.by(delta[, msg]) 如 expect(addTwo).to.increase(myObj, ‘val’).by(2);</li>
<li>.extensible/sealed/frozen 对象可扩展性</li>
<li>.fail(actual, expected, [message], [operator])，operator 为操作（默认为 !=）</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/11/Enzyme使用指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/11/Enzyme使用指南/" itemprop="url">Enzyme使用指南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-11T00:00:00+08:00">2018-02-11</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/" itemprop="url" rel="index"><span itemprop="name">前端工程化</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/11/Enzyme使用指南/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/11/Enzyme使用指南/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Enzyme 是一款 react 组件测试工具。</p>
<p>Enzyme 基于 <a href="https://github.com/cheeriojs/cheerio" target="_blank" rel="noopener">cheerio</a> 实现虚拟 dom 的查找和遍历；而 cheerio 号称为服务器端的 jquery 实现。</p>
<p>Enzyme 本身不实现测试和断言库，你可以选择使用 Mocha/chai, Jasmine, Jest 等测试或断言库。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><ol>
<li>安装 npm i –save-dev enzyme。</li>
<li>针对项目中使用的 react 版本，安装 enzyme-adapter-react-16, enzyme-adapter-react-15（15.5.0 版本起）, enzyme-adapter-react-15.4（15.0.0 ~ 15.4.x）, enzyme-adapter-react-14, enzyme-adapter-react-13 适配器。</li>
<li><p>配置 enzyme 以使用适配器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Enzyme <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> Adapter <span class="keyword">from</span> <span class="string">'enzyme-adapter-react-16'</span>;</span><br><span class="line"></span><br><span class="line">Enzyme.configure(&#123; <span class="attr">adapter</span>: <span class="keyword">new</span> Adapter() &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写测试用例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; expect &#125; <span class="keyword">from</span> <span class="string">'chai'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shallow &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> sinon <span class="keyword">from</span> <span class="string">'sinon'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MyComponent <span class="keyword">from</span> <span class="string">'./MyComponent'</span>;</span><br><span class="line"><span class="keyword">import</span> Foo <span class="keyword">from</span> <span class="string">'./Foo'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'&lt;MyComponent /&gt;'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">'renders three &lt;Foo /&gt; components'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = shallow(&lt;MyComponent /&gt;);</span><br><span class="line">    expect(wrapper.find(Foo)).to.have.length(3);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it('renders an `.icon-star`', () =&gt; &#123;</span><br><span class="line">    const wrapper = shallow(&lt;MyComponent /&gt;);</span><br><span class="line">    expect(wrapper.find('.icon-star')).to.have.length(1);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it('renders children when passed in', () =&gt; &#123;</span><br><span class="line">    const wrapper = shallow((</span><br><span class="line">      &lt;MyComponent&gt;</span><br><span class="line">        &lt;div className="unique" /&gt;</span><br><span class="line">      &lt;/MyComponent&gt;</span><br><span class="line">    ));</span><br><span class="line">    expect(wrapper.contains(&lt;div className="unique" /&gt;)).to.equal(true);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it('simulates click events', () =&gt; &#123;</span><br><span class="line">    const onButtonClick = sinon.spy();</span><br><span class="line">    const wrapper = shallow(&lt;Foo onButtonClick=&#123;onButtonClick&#125; /&gt;);</span><br><span class="line">    wrapper.find('button').simulate('click');</span><br><span class="line">    expect(onButtonClick).to.have.property('callCount', 1);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="api-手册"><a href="#api-手册" class="headerlink" title="api 手册"></a>api 手册</h2><h3 id="渲染模式"><a href="#渲染模式" class="headerlink" title="渲染模式"></a>渲染模式</h3><ol>
<li>浅渲染：shallow(node[, options]) =&gt; ShallowWrapper。参数 node 为 ReactElement，options.context 传入组件的context，options.disableLifecycleMethods 生命周期方法是否有效。</li>
<li>完整渲染：mount(node[, options]) =&gt; ReactWrapper。options.context 传入组件的context，options.attachTo 生命周期方法是否有效。需要完整的 dom api，所以需要安装 <a href="https://github.com/jsdom/jsdom" target="_blank" rel="noopener">jsdom</a> 库。</li>
<li>静态渲染：render(node[, options]) =&gt; CheerioWrapper，渲染为 html，通过 cheerio 解析 html。</li>
</ol>
<h3 id="wrapper-api"><a href="#wrapper-api" class="headerlink" title="wrapper api"></a>wrapper api</h3><ol>
<li>.find(selector) =&gt; Wrapper</li>
<li>.findWhere(predicate) =&gt; Wrapper</li>
<li>.filter(selector) =&gt; Wrapper</li>
<li>.filterWhere(predicate) =&gt; Wrapper</li>
<li>.hostNodes() =&gt; Wrapper，事先存在于文档中 host 节点</li>
<li>.contains(nodeOrNodes) =&gt; Boolean</li>
<li>.containsMatchingElement(node) =&gt; Boolean</li>
<li>.containsAllMatchingElements(nodes) =&gt; Boolean</li>
<li>.containsAnyMatchingElements(nodes) =&gt; Boolean</li>
<li>.equals(node) =&gt; Boolean</li>
<li>.matchesElement(node) =&gt; Boolean</li>
<li>.hasClass(className) =&gt; Boolean</li>
<li>.is(selector) =&gt; Boolean</li>
<li>.exists() =&gt; Boolean</li>
<li>.isEmpty() =&gt; Boolean</li>
<li>.isEmptyRender() =&gt; Boolean</li>
<li>.not(selector) =&gt; Wrapper</li>
<li>.children() =&gt; Wrapper</li>
<li>.childAt(index) =&gt; Wrapper</li>
<li>.parents() =&gt; Wrapper</li>
<li>.parent() =&gt; Wrapper</li>
<li>.closest(selector) =&gt; Wrapper</li>
<li>.shallow([options]) =&gt; Wrapper，ShallowWrapper 独有</li>
<li>.render() =&gt; CheerioWrapper</li>
<li>.unmount() =&gt; Wrapper。ReactWrapper 独有 .mount() =&gt; Wrapper 方法</li>
<li>.text() =&gt; String</li>
<li>.html() =&gt; String</li>
<li>.get(index) =&gt; ReactElement</li>
<li>.getElement() =&gt; ReactElement。ReactWrapper 中为 .getNode() =&gt; ReactElement 方法</li>
<li>.getElements() =&gt; Array<reactelement>。ReactWrapper 中为 .getNodes() =&gt; Array<reactelement> 方法。ReactWrapper 独有 .getDOMNode() =&gt; DOMComponent 方法。</reactelement></reactelement></li>
<li>.at(index) =&gt; Wrapper</li>
<li>.first() =&gt; Wrapper</li>
<li>.last() =&gt; Wrapper</li>
<li>.state([key]) =&gt; Any</li>
<li>.context([key]) =&gt; Any</li>
<li>.props() =&gt; Object</li>
<li>.prop(key) =&gt; Any</li>
<li>.key() =&gt; String</li>
<li>.simulate(event[, data]) =&gt; Wrapper，模拟点击事件等</li>
<li>.setState(nextState) =&gt; Wrapper</li>
<li>.setProps(nextProps) =&gt; Wrapper</li>
<li>.setContext(context) =&gt; Wrapper</li>
<li>.instance() =&gt; ReactComponent</li>
<li>.update() =&gt; Wrapper，调用 forceUpdate 方法强制更新组件实例。调用实例方法后，需要调用 .update 强制刷新 props。</li>
<li>.debug() =&gt; String，.children 返回已渲染的节点，.children().debug() 返回渲染实际配置格式</li>
<li>.type() =&gt; String|Function|null</li>
<li>.name() =&gt; String</li>
<li>.forEach(fn) =&gt; Wrapper</li>
<li>.map(fn) =&gt; Array</li>
<li>.reduce(fn[, initialValue]) =&gt; Any</li>
<li>.reduceRight(fn[, initialValue]) =&gt; Any</li>
<li>.slice([begin[, end]]) =&gt; Wrapper</li>
<li>.tap(intercepter) =&gt; Self</li>
<li>.some(selector) =&gt; Boolean</li>
<li>.someWhere(predicate) =&gt; Boolean</li>
<li>.every(selector) =&gt; Boolean</li>
<li>.everyWhere(predicate) =&gt; Boolean</li>
<li>.dive([options]) =&gt; Wrapper，ShallowWrapper 独有</li>
<li>.ref(refName) =&gt; Wrapper，ReactWrapper 独有</li>
<li>.detach() =&gt; void，ReactWrapper 独有</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/10/storybook使用指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/10/storybook使用指南/" itemprop="url">storybook使用指南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-10T20:44:57+08:00">2018-02-10</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/" itemprop="url" rel="index"><span itemprop="name">前端工程化</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/10/storybook使用指南/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/10/storybook使用指南/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>storybook 在应用之外，为 UI 组件提供了独立的开发、调试环境。react-transition-group 类库的测试工作即通过 storybook 实现。</p>
<p>storybook 支持调试 react, vue, angular, react-native 组件。<a href="https://storybook.js.org/" target="_blank" rel="noopener">storybook官网</a></p>
<h2 id="操作指南"><a href="#操作指南" class="headerlink" title="操作指南"></a>操作指南</h2><ol>
<li>全局安装 @storybook/cli</li>
<li>项目目录安装依赖：react 项目为 @storybook/react，vue 项目为 @storybook/vue，angular 项目为 @storybook/angular。同时需要安装 babel-core。</li>
<li><p>package.json 添加</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// -h 选项 指定以 127.0.0.1 作为主机</span><br><span class="line">// -p 选项 指定以 9001 作为端口号</span><br><span class="line">// -s 选项 指定 public 作为为静态文件目录</span><br><span class="line">// -c 选项 指定以 .storybook 作为配置目录</span><br><span class="line">// -o 选项 指定以 .out 作为打包文件目录</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"storybook"</span>: <span class="string">"start-storybook -h 127.0.0.1 -p 9001 -s ./public -c .storybook"</span>,</span><br><span class="line">    <span class="attr">"build:storybook"</span>: <span class="string">"build-storybook -s ./public -c .storybook -o .out"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建配置文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .storybook/config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; configure &#125; <span class="keyword">from</span> <span class="string">'@storybook/react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadStories</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'../stories/index.js'</span>);</span><br><span class="line">  <span class="comment">// You can require as many stories as you need.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">configure(loadStories, <span class="built_in">module</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写 story。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stories/index.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; storiesOf &#125; <span class="keyword">from</span> <span class="string">'@storybook/react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; action &#125; <span class="keyword">from</span> <span class="string">'@storybook/addon-actions'</span>;</span><br><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'../components/Button'</span>;<span class="comment">// 来自于工程目录</span></span><br><span class="line"></span><br><span class="line">storiesOf(<span class="string">'Button'</span>, <span class="built_in">module</span>)</span><br><span class="line">  .add(<span class="string">'with text'</span>, () =&gt; (</span><br><span class="line">    &lt;Button onClick=&#123;action(<span class="string">'clicked'</span>)&#125;&gt;Hello Button&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">  ))</span></span><br><span class="line"><span class="regexp">  .add('with some emoji', () =&gt; (</span></span><br><span class="line"><span class="regexp">    &lt;Button onClick=&#123;action('clicked')&#125;&gt;😀 😎 👍 💯&lt;/</span>Button&gt;</span><br><span class="line">  ));</span><br></pre></td></tr></table></figure>
</li>
<li><p>npm run storybook，将在 9001 端口启动服务，Button 按钮下有 with text, with some emoji 两个 story。</p>
</li>
<li>npm run build:storybook，打包输出静态文件。通过 storybook-deployer 工具可以将静态文件发布到 github 上，或者通过 build-storybook 命令将文件打包到 docs 目录中，作为 github pages 的根目录。</li>
</ol>
<h3 id="贴示"><a href="#贴示" class="headerlink" title="贴示"></a>贴示</h3><ol>
<li><p>storybook 内部集成 webpack，通过 babel 编译 js，.babelrc 文件可替代 storybook 的默认配置；支持 css, json, 图片等静态文件的加载。<br>自定义 webpack 配置通过在 .storybook 目录中添加 webpack.config.js 实现，如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 除了 babel-loader 外，默认配置中的其余加载器全部停用</span></span><br><span class="line"><span class="comment">// 这种配置方式不能用于配置 babel-loader（第一个加载器）, entry, output</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">        loaders: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>, <span class="string">"sass-loader"</span>],</span><br><span class="line">        include: path.resolve(__dirname, <span class="string">'../'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="comment">// 这种配置方式不能用于替换 babel-loader（第一个加载器）, entry, output，所有已存在的插件</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">storybookBaseConfig, configType, defaultConfig</span>) =&gt;</span> &#123;</span><br><span class="line">  storybookBaseConfig.module.rules.push(&#123;</span><br><span class="line">    test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">    loaders: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>, <span class="string">"sass-loader"</span>],</span><br><span class="line">    include: path.resolve(__dirname, <span class="string">'../'</span>)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> storybookBaseConfig;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>html，head 头部添加标签。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// .storybook/preview-head.html 配置文件将如下标签注入到渲染导入组件的 iframe 中，不影响 storybook 主界面</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://use.typekit.net/xxxyyy.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">try</span>&#123; Typekit.load(); &#125; <span class="keyword">catch</span>(e)&#123; &#125;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// .storybook/preview-head.html 配置文件，将影响 storybook 主界面</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过访问 <a href="http://localhost:9009/iframe.html?selectedKind=Button&amp;selectedStory=with+text&amp;dataId=0" target="_blank" rel="noopener">http://localhost:9009/iframe.html?selectedKind=Button&amp;selectedStory=with+text&amp;dataId=0</a> 可以访问 Button 下的 with text 这个 story，浏览器显示将不带左边栏。</p>
</li>
</ol>
<h2 id="辅助测试"><a href="#辅助测试" class="headerlink" title="辅助测试"></a>辅助测试</h2><h3 id="Structural-Testing"><a href="#Structural-Testing" class="headerlink" title="Structural Testing"></a>Structural Testing</h3><p>Structural Testing 结构测试的目的是判断页面元素是否异常，缺失或增加等。</p>
<p>在 storybook 中，借助 <a href="https://facebook.github.io/jest/blog/2016/07/27/jest-14.html" target="_blank" rel="noopener">Jest’s snapshot testing</a> 实现结构测试。针对 react，Jest 将为虚拟 DOM 拍摄快照，将其转化为 json 数据，在下一次运行时比对两张快照是否有偏差。</p>
<p>具体步骤为：</p>
<ol>
<li>安装 @storybook/addon-storyshots 插件。</li>
<li><p>编写 storyshots.test.js 文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> initStoryshots <span class="keyword">from</span> <span class="string">'@storybook/addon-storyshots'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getStorybook() 函数获取所有 story</span></span><br><span class="line">initStoryshots(&#123; <span class="comment">/* configuration options */</span> &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行 storyshots.test.js 脚本，可用于测试组件逻辑是否崩盘。</p>
</li>
</ol>
<p>参考文档：<a href="http://onetwo.ren/ReactStorybook%E7%9A%84%E5%90%84%E7%A7%8D%E6%95%85%E4%BA%8B/" target="_blank" rel="noopener">ReactStorybook 的各种故事</a></p>
<h3 id="interaction-testing"><a href="#interaction-testing" class="headerlink" title="interaction testing"></a>interaction testing</h3><p>关于 interaction testing 交互测试，可以通过模拟用户输入，在 <a href="https://github.com/airbnb/enzyme" target="_blank" rel="noopener">Enzyme</a> 测试框架 Jest, Mocha 实现。</p>
<p>在 storybook 中，交互测试可通过 <a href="https://github.com/mthuret/storybook-addon-specifications" target="_blank" rel="noopener">storybook-addon-specifications</a> 插件实现。</p>
<p>具体步骤为：</p>
<ol>
<li>安装 storybook-addon-specifications 插件。</li>
<li><p>编写 .storybook/addons.js 配置文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'storybook-addon-specifications/register'</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加测试文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; storiesOf &#125; <span class="keyword">from</span> <span class="string">'@kadira/storybook'</span></span><br><span class="line"><span class="keyword">import</span> &#123; specs, describe, it &#125; <span class="keyword">from</span> <span class="string">'storybook-addon-specifications'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;mount&#125; <span class="keyword">from</span> <span class="string">"enzyme"</span>;</span><br><span class="line"><span class="keyword">import</span> expect <span class="keyword">from</span> <span class="string">"expect"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stories = storiesOf(<span class="string">'Button'</span>, <span class="built_in">module</span>);</span><br><span class="line"></span><br><span class="line">stories.add(<span class="string">'Hello World'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> story =</span><br><span class="line">    &lt;button onClick=&#123;action(<span class="string">'Hello World'</span>)&#125;&gt;</span><br><span class="line">      Hello World</span><br><span class="line">    &lt;<span class="regexp">/button&gt;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ describe 首参必须与 story 名字相同</span></span><br><span class="line"><span class="regexp">  specs(() =&gt; describe('Hello World', function () &#123;</span></span><br><span class="line"><span class="regexp">    it('Should have the Hello World label', function () &#123;</span></span><br><span class="line"><span class="regexp">      let output = mount(story);</span></span><br><span class="line"><span class="regexp">      expect(output.text()).toContain('Hello World');</span></span><br><span class="line"><span class="regexp">    &#125;);</span></span><br><span class="line"><span class="regexp">  &#125;));</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return story;</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><h3 id="使用插件"><a href="#使用插件" class="headerlink" title="使用插件"></a>使用插件</h3><p>在 storybook 中，插件分为两类，装饰器 Decorator（通过封装 react 组件实现，如 storybook-router） 或 以面板形式注入的 Native Addon（如 addon-actions）。</p>
<ol>
<li><p>添加 .storybook/addons.js 配置文件用于向页面添加右下方插件面板。如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'@storybook/addon-actions/register'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'@storybook/addon-links/register'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'@storybook/addon-notes/register'</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写 stroy</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; storiesOf &#125; <span class="keyword">from</span> <span class="string">'@storybook/react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; action &#125; <span class="keyword">from</span> <span class="string">'@storybook/addon-actions'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; WithNotes &#125; <span class="keyword">from</span> <span class="string">'@storybook/addon-notes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'./Button'</span>;</span><br><span class="line"></span><br><span class="line">storiesOf(<span class="string">'Button'</span>, <span class="built_in">module</span>)</span><br><span class="line">  .add(<span class="string">'with some emoji'</span>, () =&gt; (</span><br><span class="line">    &lt;WithNotes notes=&#123;<span class="string">'Here we use some emoji as the Button text. Doesn&amp;apos;t it look nice?'</span>&#125;&gt;</span><br><span class="line">      &lt;Button onClick=&#123;action(<span class="string">'clicked'</span>)&#125;&gt;😀 😎 👍 💯&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>WithNotes&gt;</span><br><span class="line">  ));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用装饰器 1</span></span><br><span class="line"><span class="keyword">import</span> &#123; storiesOf &#125; <span class="keyword">from</span> <span class="string">'@storybook/react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; action &#125; <span class="keyword">from</span> <span class="string">'@storybook/addon-actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'./button'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> styles = &#123;</span><br><span class="line">  textAlign: <span class="string">'center'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> CenterDecorator = <span class="function">(<span class="params">storyFn</span>) =&gt;</span> (</span><br><span class="line">  &lt;div style=&#123;styles&#125;&gt;</span><br><span class="line">    &#123; storyFn() &#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">storiesOf('Button', module)</span></span><br><span class="line"><span class="regexp">  .addDecorator(CenterDecorator)</span></span><br><span class="line"><span class="regexp">  .add('with text', () =&gt; (</span></span><br><span class="line"><span class="regexp">    &lt;Button onClick=&#123;action('clicked')&#125;&gt;Hello Button&lt;/</span>Button&gt;</span><br><span class="line">  ))</span><br><span class="line">  .add(<span class="string">'with some emojies'</span>, () =&gt; (</span><br><span class="line">    &lt;Button onClick=&#123;action(<span class="string">'clicked'</span>)&#125;&gt;😀 😎 👍 💯&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">  ));</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 使用装饰器 2</span></span><br><span class="line"><span class="regexp">import &#123; storiesOf, addDecorator &#125; from '@storybook/</span>react<span class="string">';</span></span><br><span class="line"><span class="string">import &#123; action &#125; from '</span>@storybook/addon-actions<span class="string">';</span></span><br><span class="line"><span class="string">import &#123; linkTo &#125; from '</span>@storybook/addon-links<span class="string">';</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">import Button from '</span>./button<span class="string">';</span></span><br><span class="line"><span class="string">import Welcome from '</span>./welcome<span class="string">';</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const styles = &#123;</span></span><br><span class="line"><span class="string">  textAlign: '</span>center<span class="string">',</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">const CenterDecorator = (storyFn) =&gt; (</span></span><br><span class="line"><span class="string">  &lt;div style=&#123;styles&#125;&gt;</span></span><br><span class="line"><span class="string">    &#123; storyFn() &#125;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string">addDecorator(CenterDecorator);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">storiesOf('</span>Welcome<span class="string">', module)</span></span><br><span class="line"><span class="string">  .add('</span>to Storybook<span class="string">', () =&gt; (</span></span><br><span class="line"><span class="string">    &lt;Welcome showApp=&#123;linkTo('</span>Button<span class="string">')&#125;/&gt;</span></span><br><span class="line"><span class="string">  ));</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">storiesOf('</span>Button<span class="string">', module)</span></span><br><span class="line"><span class="string">  .add('</span><span class="keyword">with</span> text<span class="string">', () =&gt; (</span></span><br><span class="line"><span class="string">    &lt;Button onClick=&#123;action('</span>clicked<span class="string">')&#125;&gt;Hello Button&lt;/Button&gt;</span></span><br><span class="line"><span class="string">  ))</span></span><br><span class="line"><span class="string">  .add('</span><span class="keyword">with</span> some emojies<span class="string">', () =&gt; (</span></span><br><span class="line"><span class="string">    &lt;Button onClick=&#123;action('</span>clicked<span class="string">')&#125;&gt;😀 😎 👍 💯&lt;/Button&gt;</span></span><br><span class="line"><span class="string">  ));</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="插件清单"><a href="#插件清单" class="headerlink" title="插件清单"></a>插件清单</h3><ol>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/storyshots" target="_blank" rel="noopener">Storyshots</a>: 快照测试。</li>
<li><a href="https://github.com/mthuret/storybook-addon-specifications" target="_blank" rel="noopener">Specs</a>: 交互测试。</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/notes" target="_blank" rel="noopener">Notes</a>: 在 story 中添加备注。</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/info" target="_blank" rel="noopener">Info</a>: 用于创建 css 框架手册。</li>
<li><a href="https://github.com/tuchk4/storybook-readme" target="_blank" rel="noopener">Readme</a>: 将 markdown 导入为 story。</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/actions" target="_blank" rel="noopener">actions</a>: 显示事件的 event 对象。</li>
<li><a href="https://github.com/truffls/storybook-addon-intl" target="_blank" rel="noopener">Intl</a>: 添加 locales 面板，用于切换语言。</li>
<li><a href="https://github.com/Sambego/storybook-state" target="_blank" rel="noopener">State</a>: 添加 state 面板，展示或更新 state，重绘视图。</li>
<li><a href="https://github.com/evgenykochetkov/react-storybook-addon-props-combinations" target="_blank" rel="noopener">Props Combinations</a>: 配置可能有的props，一次性绘出多个组件作对比。</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/knobs" target="_blank" rel="noopener">Knobs</a>: 页面上变更 props 重绘视图。</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/links" target="_blank" rel="noopener">Links</a>: 通过 linkTo 函数或 LinkTo 组件链接多个 story，支持点击跳转。</li>
<li><a href="https://github.com/gvaldambrini/storybook-router" target="_blank" rel="noopener">Story-router</a>: 装饰器，支持 storybook 使用 react-router 等路由组件。</li>
<li><a href="https://github.com/storybook-eol/addon-backgrounds" target="_blank" rel="noopener">Backgrounds</a>: 切换背景图或背景颜色。</li>
<li><a href="https://github.com/joscha/storybook-addon-i18n-tools" target="_blank" rel="noopener">i18n tools</a>: 切换文字对齐方式，左对齐或右对齐。</li>
<li><a href="https://github.com/react-theming/storybook-addon-material-ui" target="_blank" rel="noopener">Material-UI</a>: 添加并切换自定义主题。</li>
<li><a href="https://github.com/philcockfield/storybook-host" target="_blank" rel="noopener">Host</a>: 装饰器，在页面上以盒模式展示组件。</li>
<li><a href="https://github.com/Checkfront/react-storybook-addon-chapters" target="_blank" rel="noopener">Chapters</a>: 在同一个 story 中以章节形式展示多个组件。</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/options" target="_blank" rel="noopener">Options</a>: 调整 storybook 页面外观，切换为全屏等。</li>
<li><a href="https://github.com/storybooks/storybook-addon-console" target="_blank" rel="noopener">Console</a>: 将浏览器控制台 console 信息输出到 storybook log 面板。</li>
<li><a href="https://github.com/storybooks/addon-jsx" target="_blank" rel="noopener">JSX preview</a>: 展示及拷贝 JSX 代码。</li>
<li><a href="https://github.com/buildit/storybook-addon-versions" target="_blank" rel="noopener">Versions</a>: 添加版本号，查看各版本的变化。</li>
<li><a href="https://github.com/abhiaiyer91/apollo-storybook-decorator" target="_blank" rel="noopener">Apollo</a>: 添加 Apollo client，模拟 GraphQL 查询。</li>
<li><a href="https://github.com/tsuyoshiwada/storybook-chrome-screenshot" target="_blank" rel="noopener">Screenshot</a>: 保存网页截图。</li>
<li><a href="https://storybook.js.org/addons/addon-gallery/" target="_blank" rel="noopener">Styles</a>: storybook 预览界面添加自定义样式。</li>
<li><a href="https://github.com/hharnisc/storybook-addon-figma" target="_blank" rel="noopener">Figma</a>: 添加 Figma 设计面板。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/07/浅析react-transition-group源码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/07/浅析react-transition-group源码/" itemprop="url">浅析react-transition-group源码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-07T23:19:17+08:00">2018-02-07</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/react/" itemprop="url" rel="index"><span itemprop="name">react</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/07/浅析react-transition-group源码/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/07/浅析react-transition-group源码/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="react-transition-group-1-版本回顾"><a href="#react-transition-group-1-版本回顾" class="headerlink" title="react-transition-group 1 版本回顾"></a>react-transition-group 1 版本回顾</h2><p>react-transition-group 1 版本在子组件创建、删除过程通过添加 class 控制 css 动效。</p>
<p>介于 css transition 动效在元素添加到页面过程就会执行，因此这个过程无需调控动效的执行。而当有元素被移除时，我们需要容器组件驻留被删除的子组件，等到动效执行完成后，才实际删除该子组件。</p>
<p>针对这一问题，react-transition-group 提供了 TransitionGroup 容器组件。其 state.children 属性为实际待绘制的组件，当组件更新时，通过比对 state.children, props.children，就可以获知新增了哪些组件、移除了哪些组件（用户配置的子组件通过 key 键存储成映射结构）。当子组件被移除时，触发 performLeave 方法，以调用子组件的 componentWillLeave 方法添加样式类、执行动效；再通过 componentWillLeave 方法的回调函数，更新 TransitionGroup 容器的 state.children，触发子组件的实际移除行为。</p>
<p>当采用上述逻辑处理子组件的移除动效时，为着处理逻辑的统一，react-transition-group 针对 componentDidMount 或 componentDidUpdate 时创建的子组件也采用相同的处理逻辑。子组件的钩子函数 componentWillAppear, componentDidAppear, componentWillEnter, componentDidEnter, componentWillLeave, componentDidLeave 将分别得到执行。当独立使用  TransitionGroup 容器时，我们可以借助这些钩子函数操控节点的样式以触发 css 动效，或者组织 js 动效，或者实现懒加载等等。</p>
<p>在 TransitionGroup 容器的基础上，CSSTransitionGroupChild 组件用于装饰子组件，在 componentWillAppear 等钩子函数添加样式类以执行 css 动效，通过 setTimeout 或 transitionEnd 事件更新 TransitionGroup 容器的 state.children 属性。CSSTransitionGroup 组件用于将 props 配置上提，而不是通过 CSSTransitionGroupChild 给每个子组件外加一个壳子。</p>
<h2 id="react-transition-group-2-版本"><a href="#react-transition-group-2-版本" class="headerlink" title="react-transition-group 2 版本"></a>react-transition-group 2 版本</h2><h3 id="Transition"><a href="#Transition" class="headerlink" title="Transition"></a>Transition</h3><p>相比于 1 版本通过判断子组件的有无添加动效，react-transition-group 2 版本可通过向子组件传递状态值（props.children 以函数形式配置；若为ReactElement，则无任何作用）控制子组件的创建和删除过程，这一点和 react-motion 类库相仿。关于 react-motion，笔者将在后续文章中加以分析。</p>
<p>上述思路的简单实现是通过容器组件向子组件传递 props.status，用于判断动效是在执行中 transitionExcute，还是执行完成 transitionEnd。若执行完成，将触发移除组件的操作。为此，react-transition-group 2 提供了 Transition 容器组件，props.status 状态分别在子组件创建和移除阶段添置了两个值，合计四种状态，即 ENTERING, ENTERED, EXITING, EXITED 。ENTERING, ENTERED 状态针对新创建的子组件，EXITING, EXITED 状态针对待移除的子组件。Transition 组件内部实现的主要业务逻辑就是协调 ENTERING 到 ENTERED，EXITING 到 EXITED 状态的自动变更。对于不需要动效的场景，状态将直接置为 ENTERED, EXITED；在 Transition 组件中，作为动效开关的是 props.appear, props.enter, props.exit 属性。</p>
<p>除此之外，有必要区分组件在创建过程 onEnter 还是在移除过程 onExit，以便于控制组件的挂载状态。然而 onEnter, onExit 两个状态值不适用于动效结束时仍保留组件的场景。为此，Transition 组件使用 props.in 属性表示组件的显示状态，结合 props.unmountOnExit 属性即表示在动效执行完成后，不必移除组件。子组件不能通过获得的 status 值控制自身的挂载状态，Transition 容器通过将 status 置为 UNMOUNTED，并在其 render 方法中输出 null，以控制子组件的显隐。这样的设计也满足了对子组件挂载时机的微调。像 1 版本中那样，通常情况下，子组件往往而在。不同的是，在组件初始化时通过将 props.mountOnEnter 属性置为真值，且 props.in 为否值，子组件将不在视图显示；当更新组件时，props.in 属性首次切换为真值时，才将 status 置为 EXITED，以便在实际视图中创建子组件，从而启动动效。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">  <span class="keyword">super</span>(props, context);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> parentGroup = context.transitionGroup;</span><br><span class="line">  <span class="comment">// In the context of a TransitionGroup all enters are really appears</span></span><br><span class="line">  <span class="keyword">let</span> appear = parentGroup &amp;&amp; !parentGroup.isMounting ?</span><br><span class="line">    props.enter :</span><br><span class="line">    props.appear;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> initialStatus;</span><br><span class="line">  <span class="keyword">this</span>.nextStatus = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (props.in) &#123;<span class="comment">// in 为真值，创建并显示组件</span></span><br><span class="line">    <span class="keyword">if</span> (appear) &#123;<span class="comment">// appear 为真值，执行动效</span></span><br><span class="line">      initialStatus = EXITED;<span class="comment">// updateStatus 方法中满足 initialStatus 非 null 校验，以执行 performEnter 方法</span></span><br><span class="line">      <span class="keyword">this</span>.nextStatus = ENTERING;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">// appear 为否值，不执行动效</span></span><br><span class="line">      initialStatus = ENTERED;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// mountOnEnter 为真值，意味着延迟挂载；unmountOnExit 为否值的情形，主要为着避过 updateStatus 中对 &#123; state: EXITED &#125; 的处理逻辑，即动效执行结束后移除组件</span></span><br><span class="line">    <span class="keyword">if</span> (props.unmountOnExit || props.mountOnEnter) &#123;</span><br><span class="line">      initialStatus = UNMOUNTED;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 悬空</span></span><br><span class="line">      initialStatus = EXITED;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.state = &#123; <span class="attr">status</span>: initialStatus &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.nextCallback = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">this</span>.updateStatus(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; status &#125; = <span class="keyword">this</span>.pendingState || <span class="keyword">this</span>.state;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (nextProps.in) &#123;</span><br><span class="line">    <span class="comment">// 子组件已被移除或初始化未被挂载，status 置为 EXITED，便于添加子组件</span></span><br><span class="line">    <span class="keyword">if</span> (status === UNMOUNTED) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">status</span>: EXITED &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 子组件尚未在视图中，执行显示动效</span></span><br><span class="line">    <span class="keyword">if</span> (status !== ENTERING &amp;&amp; status !== ENTERED) &#123;</span><br><span class="line">      <span class="keyword">this</span>.nextStatus = ENTERING;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 子组件已在视图中，执行移除动效</span></span><br><span class="line">    <span class="keyword">if</span> (status === ENTERING || status === ENTERED) &#123;</span><br><span class="line">      <span class="keyword">this</span>.nextStatus = EXITING;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentDidUpdate() &#123;</span><br><span class="line">  <span class="keyword">this</span>.updateStatus();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updateStatus(mounting = <span class="literal">false</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> nextStatus = <span class="keyword">this</span>.nextStatus;<span class="comment">// 只有两种可能，ENTERING 或 EXITING</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (nextStatus !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.nextStatus = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.cancelNextCallback();</span><br><span class="line">    <span class="keyword">const</span> node = ReactDOM.findDOMNode(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nextStatus === ENTERING) &#123;</span><br><span class="line">      <span class="keyword">this</span>.performEnter(node, mounting);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.performExit(node);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="comment">// 动效执行完成后 state 置为 EXITED 时，且 unmountOnExit 为真，移除子组件</span></span><br><span class="line">    <span class="keyword">this</span>.props.unmountOnExit &amp;&amp;</span><br><span class="line">    <span class="keyword">this</span>.state.status === EXITED</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">status</span>: UNMOUNTED &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（当初始化时，props.in 置为否值，子组件将不予渲染或渲染后无动效；当更新时置为否值，子组件已在视图中，执行 performExit 方法，好启动 exit 动效。）</p>
<p>上述代码中，performEnter, performExit 方法用于操控容器组件在 props.timeout 时间后自动从 ENTERING 切换到 ENTERED 状态，或者从 EXITING 切换到 EXITED 状态。这两个方法均调用了 safeSetState 方法，该方法的意义是设置 pendingState 属性，以避免动效的多次执行；以及通过调用 onTransitionEnd 方法执行变更 status 的逻辑。onTransitionEnd 方法的延迟机制通过监听 transitionEnd 事件（借助于 props.addEventLinstener 配置）或者使用 setTimeout 执行回调实现，变更 status 状态的回调通过 setNextCallback 方法免于多次执行。</p>
<p>Transition 容器在根据 props.in, props.appear, props.enter, props.exit, props.mountOnEnter, props.unmountOnExit 属性自动处理 status 状态的同时，还设置了多个在适当时机执行的钩子函数，包含 props.onEnter, props.onEntering, props.onEntered, props.onExit, props.onExiting, props.onExited 配置项。</p>
<h3 id="CSSTransition"><a href="#CSSTransition" class="headerlink" title="CSSTransition"></a>CSSTransition</h3><p>在 react-transition-group 2 版本内部，props.onEnter 等钩子在实现 CSSTransition 组件时极有意义。因为 Transition 容器传给 props.children 函数的 status 只包含 enter, exit 相关状态，没有 appear 状态。而 onEnter, onEntering, onEntered 钩子的次参即为是否在 appear 状态中（通过 context.transitionGroup.isMounting 或 mounting 获知），CSSTransition 组件即在此基础上实现，通过钩子更新 props.children 对应节点的 class（依次由 <em>-appear, </em>-appear-active, <em>-enter, </em>-enter-active, <em>-enter-done, </em>-exit, <em>-exit-active, </em>-exit-done 变更，* 通过 props.classNames 设置，该属性也设置为对象）。与 1 版本相同，2 版本在类名变更的同时，访问了 node.scrollTop 促使浏览器重绘；也可以在 props.children 中执行 onEnter 等方法阻止 js 动效或懒加载等逻辑。CSSTransition 组件同样向上抛出 props.onEnter, props.onEntering, props.onEntered, props.onExit, props.onExiting, props.onExited 钩子。</p>
<h3 id="TransitionGroup"><a href="#TransitionGroup" class="headerlink" title="TransitionGroup"></a>TransitionGroup</h3><p>TransitionGroup 的处理逻辑和 1 版本相同，即通过 state.children 控制待渲染的元素，以实现 exit 动效执行时仍驻留子组件的场景。不同的是，1 版本会用 CSSTransitionGroupChild 包装子组件，2 版本需要用户传入 Transition 组件作为 TransitionGroup 的子组件。当然，因为 2 版本中，Transition 组件动效执行时机和组件渲染状态的弱关联，促使 TransitionGroup 容器的 componentWillReceiveProps 方法中更新 state.children 的逻辑也不一样。</p>
<p>TransitionGroup 的一般适用场景为当子组件添加时，执行 enter 动效；当子组件移除时，执行 exit 动效。在这样的场景中，子组件的渲染状态不受 TransitionGroup 控制，也即 TransitionGroup 容器对子组件的 props.in 属性的调控必须与子组件的渲染状态向匹配。在 TransitionGroup 容器初始化阶段，传入子组件的 props.in 属性必然为真值，因为在这阶段，子组件都会得到渲染。在更新阶段，当子组件移除时，通过设置 props.in 为否值，触发 exit 动效；当子组件 exit 动效执行阶段，子组件又被添加，通过设置 props.in 为真值，使 enter, exit 动效得以执行；当子组件 exit 动效执行完成、且组件已移除后，处理逻辑同 exit 动效执行阶段；当子组件维持原样，传入子组件的 props.in 属性维持原值，props.oEnter, props.onExit 属性则同步为子组件最新的 props 值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">  <span class="keyword">super</span>(props, context);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initial children should all be entering, dependent on appear</span></span><br><span class="line">  <span class="keyword">this</span>.state = &#123;</span><br><span class="line">    children: getChildMapping(props.children, child =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> cloneElement(child, &#123;</span><br><span class="line">        onExited: <span class="keyword">this</span>.handleExited.bind(<span class="keyword">this</span>, child),</span><br><span class="line">        <span class="keyword">in</span>: <span class="literal">true</span>,</span><br><span class="line">        appear: <span class="keyword">this</span>.getProp(child, <span class="string">'appear'</span>),</span><br><span class="line">        enter: <span class="keyword">this</span>.getProp(child, <span class="string">'enter'</span>),</span><br><span class="line">        exit: <span class="keyword">this</span>.getProp(child, <span class="string">'exit'</span>),</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">  <span class="keyword">let</span> prevChildMapping = <span class="keyword">this</span>.state.children;</span><br><span class="line">  <span class="keyword">let</span> nextChildMapping = getChildMapping(nextProps.children);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> children = mergeChildMappings(prevChildMapping, nextChildMapping);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.keys(children).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> child = children[key]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isValidElement(child)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hasPrev = key <span class="keyword">in</span> prevChildMapping;</span><br><span class="line">    <span class="keyword">const</span> hasNext = key <span class="keyword">in</span> nextChildMapping;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> prevChild = prevChildMapping[key];</span><br><span class="line">    <span class="comment">// child 在移除过程中</span></span><br><span class="line">    <span class="keyword">const</span> isLeaving = isValidElement(prevChild) &amp;&amp; !prevChild.props.in;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// child 新添加或者移除动效尚未执行完成，执行 enter 动效</span></span><br><span class="line">    <span class="keyword">if</span> (hasNext &amp;&amp; (!hasPrev || isLeaving)) &#123;</span><br><span class="line">      <span class="comment">// console.log('entering', key)</span></span><br><span class="line">      children[key] = cloneElement(child, &#123;</span><br><span class="line">        onExited: <span class="keyword">this</span>.handleExited.bind(<span class="keyword">this</span>, child),</span><br><span class="line">        <span class="keyword">in</span>: <span class="literal">true</span>,</span><br><span class="line">        exit: <span class="keyword">this</span>.getProp(child, <span class="string">'exit'</span>, nextProps),</span><br><span class="line">        enter: <span class="keyword">this</span>.getProp(child, <span class="string">'enter'</span>, nextProps),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 组件已移除，执行 exit 动效</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!hasNext &amp;&amp; hasPrev &amp;&amp; !isLeaving) &#123;</span><br><span class="line">      <span class="comment">// console.log('leaving', key)</span></span><br><span class="line">      children[key] = cloneElement(child, &#123; <span class="attr">in</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 组件动效特性未作改变，保留原值</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (hasNext &amp;&amp; hasPrev &amp;&amp; isValidElement(prevChild)) &#123;</span><br><span class="line">      <span class="comment">// console.log('unchanged', key)</span></span><br><span class="line">      children[key] = cloneElement(child, &#123;</span><br><span class="line">        onExited: <span class="keyword">this</span>.handleExited.bind(<span class="keyword">this</span>, child),</span><br><span class="line">        <span class="keyword">in</span>: prevChild.props.in,</span><br><span class="line">        exit: <span class="keyword">this</span>.getProp(child, <span class="string">'exit'</span>, nextProps),</span><br><span class="line">        enter: <span class="keyword">this</span>.getProp(child, <span class="string">'enter'</span>, nextProps),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; children &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>handleExited 方法用于当子组件 exit 动效执行完成且移除后，更新 TransitionGroup 容器的 state.children 属性，附带调用原始传入子组件的 props.onExited 方法（实际传入子组件的 props.onExited 方法被改写为 handleExited 方法）。</p>
<p>在变更 state.children 的处理逻辑之外，TransitionGroup 向外提供 props.appear, props.enter, props.exit, props.component, props.childFactory 配置项。props.appear, props.enter, props.exit 为当子组件元素没有同名 props 属性时，使用 TransitionGroup 容器的 props 属性；props.component 为外层包裹元素（适配 react 中 props.children 不能置为数组的特性，react 16 可能不需要）；props.childFactory 用于装饰子元素。</p>
<p>2 版本没有提供 CSSTransitionGroup 组件，因为在 TransitionGroup 组件下挂载 CSSTransition 组件即能实现与 1 版本中 CSSTransitionGroup 相同的效果，通过调整节点的 class 实现动效。在这里，CSSTransition 组件作为特殊的 Transition 组件。除此而外，Transition, CSSTransition 组件都向外暴露 props.onEnter, props.onEntering, props.onEntered, props.onExit, props.onExiting, props.onExited 配置钩子，因此相较于 1 版本中通过 CSSTransitionGroup 自应用的 CSSTransitionGroupChild 组件，2 版本能对 css 动效实现更细微的控制。</p>
<p>此外，TransitionGroup 组件会通过 context 属性向 Transition 子组件传递 transitionGroup 属性，以使 Transition 子组件能够感知动效处于 appear 阶段还是 enter 阶段。Transition 组件又通过 getChildContext 方法，将其子孙组件的 transitionGroup 属性置为 null，其意义时，当父 Transition 嵌套子 Transition 时，子 Transition 不至于尝试通过 context.transitionGroup 属性判断动效在 appear 阶段还是 enter 阶段。</p>
<h3 id="ReplaceTransition"><a href="#ReplaceTransition" class="headerlink" title="ReplaceTransition"></a>ReplaceTransition</h3><p>2 版本中，ReplaceTransition 用于通过控制 props.in 切换显示两个子组件中的一个。因此实际使用过程中，需要有容器包裹，通过容器更新传入 ReplaceTransition 组件中的props.in；循环切换需要在容器中设置定时器（循环切换过程中，不支持其中任意一个子组件 exit 动效，适用场景相对较小）。ReplaceTransition 组价向外提供 props.onEnter, props.onEntering, props.onEntered, props.onExit, props.onExiting, props.onExited 等配置属性，前三个为第一个子组件 enter 动效相关钩子，后三个为第二个子组件 enter 动效相关钩子。其 ReplaceTransition 组价支持在 enter 发生过程中调用子组件的 props.onEnter, props.onEntering, props.onEntered, props.onExit, props.onExiting, props.onExited，前三个钩子为第一个子组件独有，后三个为第二个子组件独有。源码不作赘述。</p>
<h2 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h2><p>无论 1 版本的核心模块 TransitionGroup，还是 2 版本的核心模块 Transition，都通过容器管理子组件的动效执行过程。1 版本切入的视角在于通过判断子组件从列表中创建、移除的过程，触发调用子组件的 componentWillAppear 等方法，以管理动效。对于 css 动效，1 版本又通过包含特定 componentWillAppear 等实例方法的 CSSTransitionGroupChild 包装用户实际开发的子组件，从而对接上 TransitionGroup 容器，使子组件中的动效得到管理。2 版本在处理上更为细致，独立对待用户开发的动效组件，而不是视为列表形式。2 版本通过 Transition 容器将子组件可能包含的 enter, exit 动效抽象为 state.status，并传入子组件，由子组件自身通过 status 启用特定的动效；并且同样提供了以钩子方式（props.onEnter 等配置方法）管理动效的实现，2 版本自身的 CSSTransition 组件即通过钩子调节添加到节点上的 class。若说 1 版本还滞留于子组件从列表中移入移出的视点，2 版本的观察角度则从列表中脱离，实打实地介入了子组件动效执行周期的管理，will - excute - did，并向下注入执行状态。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/06/webpack插件指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/06/webpack插件指南/" itemprop="url">webpack插件指南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-06T23:38:53+08:00">2018-02-06</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/" itemprop="url" rel="index"><span itemprop="name">前端工程化</span></a></span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/06/webpack插件指南/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/06/webpack插件指南/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="HotModuleReplacementPlugin"><a href="#HotModuleReplacementPlugin" class="headerlink" title="HotModuleReplacementPlugin"></a>HotModuleReplacementPlugin</h2><p>内置为 webpack.HotModuleReplacementPlugin，热替换插件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.HotModuleReplacementPlugin(&#123;</span><br><span class="line">  multiStep: boolean,<span class="comment">// 设置为 true 时，插件会分成两步构建文件。首先编译热加载 chunks，之后再编译剩余的通常的资源</span></span><br><span class="line">  fullBuildTimeout: number,<span class="comment">// 当 multiStep 启用时，表示两步构建之间的延时</span></span><br><span class="line">  requestTimeout: number<span class="comment">// 下载 manifest 的延时</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="DllPlugin-DLLReferencePlugin"><a href="#DllPlugin-DLLReferencePlugin" class="headerlink" title="DllPlugin, DLLReferencePlugin"></a>DllPlugin, DLLReferencePlugin</h2><p>内置为 webpack.DllPlugin, webpack.DllReferencePlugin，用于提升编译速度。</p>
<p>DllPlugin 插件会生成一个 manifest.json 文件，该文件包含了从 require 和 import 的 request 到模块 id 的映射，用于让 DLLReferencePlugin 映射到相关的依赖上去。通过引用 manifest.json 文件来把依赖的名称映射到模块的 id 上，之后再在需要的时候通过内置的 <strong>webpack_require</strong> 函数来 require 他们。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.vendor.config.js</span></span><br><span class="line"><span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">  context: __dirname,<span class="comment">// manifest 文件中请求的上下文(context)(默认值为 webpack 的上下文(context))</span></span><br><span class="line">  name: <span class="string">"[name]_[hash]"</span>,<span class="comment">// 暴露出的 DLL 的函数名</span></span><br><span class="line">  path: path.join(__dirname, <span class="string">"manifest.json"</span>),<span class="comment">// manifest.json 文件的绝对路径</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.app.config.js</span></span><br><span class="line"><span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">  context: __dirname,<span class="comment">// 绝对路径， manifest.json (或者是内容属性)中请求的上下文</span></span><br><span class="line">  manifest: <span class="built_in">require</span>(<span class="string">"./manifest.json"</span>),<span class="comment">// 包含 content 和 name 的对象</span></span><br><span class="line">  content: <span class="built_in">require</span>(<span class="string">"./manifest.json"</span>).content,<span class="comment">// 请求到模块 id 的映射 (默认值为 manifest.content)</span></span><br><span class="line">  name: manifest.name,<span class="comment">// dll 脚本的名称 (默认值为 manifest.name)</span></span><br><span class="line">  scope: <span class="literal">undefined</span>,<span class="comment">// 开启作用域模块，如 scope = "xyz"， dll 中的名为 abc 的文件可通过 require("xyz/abc") 加载。默认为映射模式，即通过 require("abc") 加载。且 dll 文件不会被打包到 bundle 中</span></span><br><span class="line">  sourceType: <span class="string">"commonsjs2"</span><span class="comment">// dll 如何向外提供全局函数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="DefinePlugin"><a href="#DefinePlugin" class="headerlink" title="DefinePlugin"></a>DefinePlugin</h2><p>内置为 webpack.DefinePlugin，定义全局变量。使用场景如，由变量区分开发环境或生产环境，开发环境打印日志，生产环境不打印。变量的值将被转换为字符串，且以文本替换的形式传入代码中，所以需要包裹单双引号或使用 JSON.stringify，如 ‘“production”‘, JSON.stringify(‘production’)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">  PRODUCTION: <span class="built_in">JSON</span>.stringify(<span class="literal">true</span>),<span class="comment">// 以文本形式传入 true</span></span><br><span class="line">  VERSION: <span class="built_in">JSON</span>.stringify(<span class="string">"5fa3b9"</span>),</span><br><span class="line">  BROWSER_SUPPORTS_HTML5: <span class="literal">true</span>,</span><br><span class="line">  TWO: <span class="string">"1+1"</span>,</span><br><span class="line">  <span class="string">"typeof window"</span>: <span class="built_in">JSON</span>.stringify(<span class="string">"object"</span>),<span class="comment">// 替换 typeof window 文本</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 功能标记</span></span><br><span class="line">  <span class="string">'NICE_FEATURE'</span>: <span class="built_in">JSON</span>.stringify(<span class="literal">true</span>),</span><br><span class="line">  <span class="string">'EXPERIMENTAL_FEATURE'</span>: <span class="built_in">JSON</span>.stringify(<span class="literal">false</span>),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 服务 Url</span></span><br><span class="line">  <span class="string">'SERVICE_URL'</span>: <span class="built_in">JSON</span>.stringify(<span class="string">"http://dev.example.com"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="EnvironmentPlugin"><a href="#EnvironmentPlugin" class="headerlink" title="EnvironmentPlugin"></a>EnvironmentPlugin</h2><p>内置为 webpack.EnvironmentPlugin，使用 DefinePlugin 快捷设置 process.env 环境变量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">等同于 new webpack.DefinePlugin(&#123;</span></span><br><span class="line"><span class="comment">  'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV),</span></span><br><span class="line"><span class="comment">  'process.env.DEBUG': JSON.stringify(process.env.DEBUG)</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">new</span> webpack.EnvironmentPlugin([<span class="string">'NODE_ENV'</span>, <span class="string">'DEBUG'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用默认值</span></span><br><span class="line"><span class="keyword">new</span> webpack.EnvironmentPlugin(&#123;</span><br><span class="line">  NODE_ENV: <span class="string">'development'</span>, <span class="comment">// 除非有定义 process.env.NODE_ENV，否则就使用 'development'</span></span><br><span class="line">  DEBUG: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="ProvidePlugin"><a href="#ProvidePlugin" class="headerlink" title="ProvidePlugin"></a>ProvidePlugin</h2><p>内置为 webpack.ProvidePlugin，当某变量没有赋值时，自动 import 或 require 相应的模块，并导出其中的方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动加载 jquery</span></span><br><span class="line"><span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">  $: <span class="string">'jquery'</span>,</span><br><span class="line">  jQuery: <span class="string">'jquery'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注入 lodash.map 方法</span></span><br><span class="line"><span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">  _map: [<span class="string">'lodash'</span>, <span class="string">'map'</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="CommonsChunkPlugin"><a href="#CommonsChunkPlugin" class="headerlink" title="CommonsChunkPlugin"></a>CommonsChunkPlugin</h2><p>内置为 webpack.optimize.CommonsChunkPlugin，提取公共代码，结合 entry 属性使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    vendor: [<span class="string">"jquery"</span>, <span class="string">"other-lib"</span>],</span><br><span class="line">    app: <span class="string">"./entry"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: string|string[],<span class="comment">// 字符串或数组，若设为已经存在的打包文件 chunk 名称，将把该 chunk 提取到公共文件中。如果该选项被忽略，同时 `options.async` 或者 `options.children` 被设置，所有的 chunk 都会被使用，否则 `options.filename` 会用于作为 chunk 名</span></span><br><span class="line">      filename: string,<span class="comment">// 公共文件名模板，使用和 output.filename 相同的占位符。不设置，将保留原 chunk 的名称</span></span><br><span class="line">      minChunks: number|<span class="literal">Infinity</span>|<span class="function">(<span class="params"><span class="built_in">module</span>, count</span>) =&gt;</span> boolean,<span class="comment">// 生成公共文件前，需要传入的 chunk 数量。设为 Infinity，会马上生成 公共chunk，但里面没有模块。默认是 chunk 的数量</span></span><br><span class="line">      chunks: string[],<span class="comment">// 选择 chunk 的来源。如果被忽略，所有的入口 chunk 都会被选择</span></span><br><span class="line">      children: boolean,<span class="comment">// 如果设置为 true，入口 chunk 的依赖都会被并入公共文件中，以避免 chunk 的依赖包含重复代码</span></span><br><span class="line">      <span class="keyword">async</span>: boolean|string,<span class="comment">// 如果设置为 true，与上面相同，入口 chunk 的依赖被并入公共文件中，且使用异步加载</span></span><br><span class="line">      minSize: number<span class="comment">// 在 公共chunk 被创建立之前，所有公共模块的最少大小</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 入口 chunk 依赖路径中包含 "somelib" 字样的脚本，这些脚本将被视为一个 chunk，chunk 的 keyname 是 "my-single-lib-chunk"，最终打包到 "my-single-lib-chunk.js" 中</span></span><br><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  name: <span class="string">"vendor"</span>,</span><br><span class="line">  minChunks: ffunction(<span class="built_in">module</span>, count) &#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.resource &amp;&amp; (<span class="regexp">/somelib/</span>).test(<span class="built_in">module</span>.resource) &amp;&amp; count === <span class="number">3</span>; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 避免提取 css, scss 文件，且公共文件只能在 node_modules 下</span></span><br><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  name: <span class="string">"vendor"</span>,</span><br><span class="line">  minChunks: <span class="function"><span class="keyword">function</span> (<span class="params">module</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">module</span>.resource &amp;&amp; (<span class="regexp">/^.*\.(css|scss)$/</span>).test(<span class="built_in">module</span>.resource)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.context &amp;&amp; <span class="built_in">module</span>.context.indexOf(<span class="string">"node_modules"</span>) !== <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 webpack 注入页面的脚本提取到公共文件，文件名 "manifest" 不能和入口 chunk 重名</span></span><br><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  name: <span class="string">"manifest"</span>,</span><br><span class="line">  minChunks: <span class="literal">Infinity</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line">[</span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">    name: <span class="string">"vendor"</span>,</span><br><span class="line">    minChunks: <span class="function"><span class="keyword">function</span>(<span class="params">module</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">module</span>.context &amp;&amp; <span class="built_in">module</span>.context.indexOf(<span class="string">"node_modules"</span>) !== <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">    name: <span class="string">"manifest"</span>,</span><br><span class="line">    minChunks: <span class="literal">Infinity</span></span><br><span class="line">  &#125;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="SourceMapDevToolPlugin"><a href="#SourceMapDevToolPlugin" class="headerlink" title="SourceMapDevToolPlugin"></a>SourceMapDevToolPlugin</h2><p>内置为 webpack.SourceMapDevToolPlugin，对 webpackConfig.devtool 添加的 SourceMap 予以更细粒度的控制。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.SourceMapDevToolPlugin(&#123;</span><br><span class="line">  test,<span class="comment">// 指定资源，test 默认是 .js 和 .css 文件</span></span><br><span class="line">  include,</span><br><span class="line">  exclude,</span><br><span class="line">  filename: <span class="string">'[name].js.map'</span>,<span class="comment">// SourceMap 的输出文件名。如果没有提供值，则 source map 是内联的</span></span><br><span class="line">  append,<span class="comment">// 追加到原始资源。通常以 #sourceMappingURL 注释。[url] 替换为 source map 文件的 URL。false 禁止追加</span></span><br><span class="line">  moduleFilenameTemplate,<span class="comment">// SourceMap 的输出文件名模板</span></span><br><span class="line">  fallbackModuleFilenameTemplate,<span class="comment">// SourceMap 的输出文件名后备方案</span></span><br><span class="line">  <span class="built_in">module</span>: <span class="literal">true</span>,<span class="comment">// 为 false 时， loader 不再生成 source map，并且转换过的代码被用作源码</span></span><br><span class="line">  columns: <span class="literal">true</span>,<span class="comment">//  为 false 时，source map 中的列映射(column mapping)被忽略，并且使用更快速的 source map 实现</span></span><br><span class="line">  lineToLine: &#123;<span class="comment">// 匹配的模块使用简单快速的行到行 source map</span></span><br><span class="line">    test,</span><br><span class="line">    include,</span><br><span class="line">    exclude</span><br><span class="line">  &#125; </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="MinChunkSizePlugin"><a href="#MinChunkSizePlugin" class="headerlink" title="MinChunkSizePlugin"></a>MinChunkSizePlugin</h2><p>内置为 webpack.optimize.MinChunkSizePlugin，通过合并小于 minChunkSize 大小的 chunk，将 chunk 体积保持在指定大小限制以上。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.MinChunkSizePlugin(&#123;</span><br><span class="line">  minChunkSize: <span class="number">10000</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="BannerPlugin"><a href="#BannerPlugin" class="headerlink" title="BannerPlugin"></a>BannerPlugin</h2><p>内置为 webpack.BannerPlugin，为每个 chunk 文件头部添加 banner。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.BannerPlugin(banner)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">new</span> webpack.BannerPlugin(&#123;</span><br><span class="line">  banner: <span class="string">"hash:[hash], chunkhash:[chunkhash], name:[name], filebase:[filebase], query:[query], file:[file]"</span>,</span><br><span class="line">  raw: <span class="literal">false</span>,<span class="comment">// 如果值为 true，将直出，不作为注释</span></span><br><span class="line">  entryOnly: <span class="literal">false</span>,<span class="comment">// 如果值为 true，将只在入口 chunks 文件中添加</span></span><br><span class="line">  test: <span class="literal">null</span>,</span><br><span class="line">  include: <span class="literal">null</span>,</span><br><span class="line">  exclude: <span class="literal">null</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="IgnorePlugin"><a href="#IgnorePlugin" class="headerlink" title="IgnorePlugin"></a>IgnorePlugin</h2><p>内置为 webpack.IgnorePlugin，打包时避过指定资源。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.IgnorePlugin(</span><br><span class="line">  requestRegExp,<span class="comment">// 测试资源请求路径的正则表达式</span></span><br><span class="line">  [contextRegExp]<span class="comment">// (可选) 测试资源上下文(目录)的正则表达式</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例，moment 类库中 locale 资源将不予打包</span></span><br><span class="line"><span class="keyword">new</span> webpack.IgnorePlugin(<span class="regexp">/^\.\/locale$/</span>, /moment$/)</span><br></pre></td></tr></table></figure>
<h2 id="NormalModuleReplacementPlugin"><a href="#NormalModuleReplacementPlugin" class="headerlink" title="NormalModuleReplacementPlugin"></a>NormalModuleReplacementPlugin</h2><p>内置为 webpack.NormalModuleReplacementPlugin，替换指定资源，适用场景为生产环境下的某配置文件比开发环境的配置文件有更高优先级。高级用法是指定环境变量，通过环境变量指定待加载的资源。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生产环境修改 webpack.config.js，加载 './config.production.js' 文件；开发环境不使用 NormalModuleReplacementPlugin 插件，加载 'some/path/config.development.js' 文件</span></span><br><span class="line"><span class="keyword">new</span> webpack.NormalModuleReplacementPlugin(</span><br><span class="line">  /some\/path\/config\.development\.js/,</span><br><span class="line">  <span class="string">'./config.production.js'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 高级用法，通过环境变量加载文件，开发环境默认加载带 VERSION_A 字样文件；生产环境设 env.APP_TARGET = 'VERSION_B'，加载 VERSION_B 文件</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">env</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> appTarget = env.APP_TARGET || <span class="string">'VERSION_A'</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> webpack.NormalModuleReplacementPlugin(<span class="regexp">/(.*)-APP_TARGET(\.*)/</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resource</span>) </span>&#123;</span><br><span class="line">        resource.request = resource.request.replace(<span class="regexp">/-APP_TARGET/</span>, <span class="string">`-<span class="subst">$&#123;appTarget&#125;</span>`</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ContextReplacementPlugin"><a href="#ContextReplacementPlugin" class="headerlink" title="ContextReplacementPlugin"></a>ContextReplacementPlugin</h2><p>内置为 webpack.ContextReplacementPlugin，替换 webpack 文件查找规则。在 webpack 中，当 require(‘./locale/‘ + name + ‘.json’)，webpack 将查找目录 (‘./locale/‘) 下符合正则表达式 (/^.*.json$/)的文件，由于 name 在编译时(compile time)还是未知的，webpack 会将每个文件都作为模块引入到 bundle 中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.ContextReplacementPlugin，替换(</span><br><span class="line">  resourceRegExp: <span class="built_in">RegExp</span>,<span class="comment">// 如果资源（或目录）符合 resourceRegExp 正则表达式，插件会替换默认资源为 newContentResource</span></span><br><span class="line">  newContentResource?: string,<span class="comment">// 如果 newContentResource 为相对路径，会相对于前一匹配资源路径去解析</span></span><br><span class="line">  newContentRecursive?: boolean,<span class="comment">// 是否使用递归查找</span></span><br><span class="line">  newContentRegExp?: <span class="built_in">RegExp</span>,<span class="comment">// 用于筛选新上下文里的资源</span></span><br><span class="line">  newContentCallback?: <span class="function"><span class="params">data</span> =&gt;</span> <span class="keyword">void</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例</span></span><br><span class="line"><span class="keyword">new</span> webpack.ContextReplacementPlugin(<span class="regexp">/moment[\/\\]locale$/</span>, /de|fr|hu/)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> webpack.ContextReplacementPlugin，替换(</span><br><span class="line">  resourceRegExp: <span class="built_in">RegExp</span>,</span><br><span class="line">  newContentCallback?: <span class="function"><span class="params">data</span> =&gt;</span> <span class="keyword">void</span><span class="comment">// 首参为为上下文模块工厂(ContextModuleFactory)的 data 对象，需要覆写该对象的 request 属性</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例</span></span><br><span class="line"><span class="keyword">new</span> webpack.ContextReplacementPlugin(<span class="regexp">/^\.\/locale$/</span>, (context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/\/moment\//</span>.test(context.context)) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line">  <span class="built_in">Object</span>.assign(context, &#123;</span><br><span class="line">    regExp: <span class="regexp">/^\.\/\w+/</span>,</span><br><span class="line">    request: <span class="string">'../../locale'</span>, <span class="comment">// 相对路径</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">new</span> webpack.ContextReplacementPlugin(</span><br><span class="line">  resourceRegExp: <span class="built_in">RegExp</span>,</span><br><span class="line">  newContentResource: string,</span><br><span class="line">  newContentCreateContextMap: object <span class="comment">// 将运行时请求(runtime-request)映射到编译时请求(compile-time request)</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例</span></span><br><span class="line"><span class="keyword">new</span> ContextReplacementPlugin(<span class="regexp">/selector/</span>, <span class="string">'./folder'</span>, &#123;</span><br><span class="line">  <span class="string">'./request'</span>: <span class="string">'./request'</span>,</span><br><span class="line">  <span class="string">'./other-request'</span>: <span class="string">'./new-request'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="HtmlWebpackPlugin"><a href="#HtmlWebpackPlugin" class="headerlink" title="HtmlWebpackPlugin"></a>HtmlWebpackPlugin</h2><p>html-webpack-plugin 插件，创建 html 文件，自动加载打包资源。</p>
<p>注入 html 模板的变量包含，htmlWebpackPlugin = { files, options }, webpack, webpackConfig。</p>
<p>支持的事件包含，html-webpack-plugin-before-html-generation, html-webpack-plugin-before-html-processing, html-webpack-plugin-alter-asset-tags, html-webpack-plugin-after-html-processing, html-webpack-plugin-after-emit, 同步事件 tml-webpack-plugin-alter-chunks。在自定义插件中使用。</p>
<p>参考文档：<a href="https://github.com/jantimon/html-webpack-plugin" target="_blank" rel="noopener">https://github.com/jantimon/html-webpack-plugin</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">  title: <span class="string">''</span>,<span class="comment">// 注入 html 的 title</span></span><br><span class="line">  filename: <span class="string">'index.html'</span>,<span class="comment">// 影响加载资源的位置</span></span><br><span class="line">  template: <span class="string">''</span>,<span class="comment">// html, ejs, jade 模板的路径</span></span><br><span class="line">  inject: <span class="literal">true</span> | <span class="string">'head'</span> | <span class="string">'body'</span> | <span class="literal">false</span>,<span class="comment">// 静态资源注入位置，默认在 body 底层</span></span><br><span class="line">  favicon: <span class="string">''</span>,<span class="comment">// 图标路径</span></span><br><span class="line">  minify: &#123;&#125;,<span class="comment">// 传递给 html-minifier 的选项，用于优化输出</span></span><br><span class="line">  hash: <span class="literal">true</span> | <span class="literal">false</span>,<span class="comment">// 设为真时，js, css 资源名将加上 hash 值，用于刷新缓存</span></span><br><span class="line">  cache: <span class="literal">true</span>,<span class="comment">// 设为真时，只有文件变更时，才重新请求</span></span><br><span class="line">  showErrors: <span class="literal">true</span>,<span class="comment">// 显示错误</span></span><br><span class="line">  chunks: [],<span class="comment">// 添加 chunk，如用于单元测试的脚本</span></span><br><span class="line">  chunksSortMode: <span class="string">'auto'</span>,<span class="comment">// chunk 排序方式，可选值 'none' | 'auto' | 'dependency' |'manual' | &#123;function&#125; </span></span><br><span class="line">  excludeChunks: [],<span class="comment">// 避免引用某些 chunk</span></span><br><span class="line">  xhtml: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="UglifyjsWebpackPlugin"><a href="#UglifyjsWebpackPlugin" class="headerlink" title="UglifyjsWebpackPlugin"></a>UglifyjsWebpackPlugin</h2><p>uglifyjs-webpack-plugin 插件，压缩 js 脚本。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> UglifyJSPlugin(&#123;</span><br><span class="line">  test,<span class="comment">// 定位资源</span></span><br><span class="line">  include,</span><br><span class="line">  exclude,</span><br><span class="line">  parallel: <span class="literal">false</span>,<span class="comment">// 使用多进程并行运行和文件缓存来提高构建速度，如 &#123; cache: true, workers: 2 &#125;，parallel.workers 为 cpu 核数</span></span><br><span class="line">  sourceMap: <span class="literal">false</span>,<span class="comment">// 生成 source map，会减慢编译的速度。cheap-source-map 选项不适用于此插件</span></span><br><span class="line">  uglifyOptions: &#123;<span class="comment">// 压缩选项，供 uglifyJs 使用</span></span><br><span class="line">    ie8: <span class="literal">false</span>,<span class="comment">// 支持 ie8</span></span><br><span class="line">    ecma: <span class="number">8</span>,<span class="comment">// es 语法版本号，可选项 5, 6, 7, 8，影响 parse, compress, output 选项</span></span><br><span class="line">    parse: &#123;&#125;,<span class="comment">// parse 选项</span></span><br><span class="line">    mangle: &#123;&#125;,<span class="comment">// 名称矫正??? </span></span><br><span class="line">    output: &#123;<span class="comment">// 默认最佳压缩</span></span><br><span class="line">      comments: <span class="literal">false</span>,</span><br><span class="line">      beautify: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    compress: &#123;&#125;,<span class="comment">// parse 选项</span></span><br><span class="line">    warnings: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  extractComments: <span class="literal">true</span>,<span class="comment">// 函数，提取注释</span></span><br><span class="line">  warningsFilter: <span class="literal">undefined</span><span class="comment">// 过滤警告，如 source =&gt; Boolean</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="ExtractTextWebpackPlugin"><a href="#ExtractTextWebpackPlugin" class="headerlink" title="ExtractTextWebpackPlugin"></a>ExtractTextWebpackPlugin</h2><p>extract-text-webpack-plugin 插件，提取 css 文件。</p>
<p>ExtractTextPlugin.extract 在已经存在的 loader 中，创建一个提取 css 的 loader。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ExtractTextWebpackPlugin(filename | &#123; </span><br><span class="line">  id: string,<span class="comment">// 此插件实例的唯一 ident（仅限高级用途，默认情况下自动生成）</span></span><br><span class="line">  filename: string,<span class="comment">// 生成文件的文件名，占位符包含 [name], [id], [contenthash]。ExtractTextPlugin 对 每个入口 chunk 都生成一个对应的文件</span></span><br><span class="line">  allChunks: <span class="literal">false</span>,<span class="comment">// 默认情况下，从入口 chunk 提取 css。当使用 CommonsChunkPlugin，且使用 ExtractTextPlugin.extract 在公共 chunk 中有提取 css 时，allChunks 须置为真</span></span><br><span class="line">  disable: <span class="literal">false</span>,<span class="comment">// 禁用插件</span></span><br><span class="line">  ignoreOrder: <span class="literal">false</span>,<span class="comment">// 禁用检查</span></span><br><span class="line">  threshold: <span class="number">0</span>,<span class="comment">// 大于该值的文件将被压缩</span></span><br><span class="line">  minRatio: <span class="number">0.8</span>,<span class="comment">// 压缩比大于该值的将被压缩</span></span><br><span class="line">  deleteOriginalAssets: <span class="literal">false</span><span class="comment">// 是否删除原始资源</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ExtractTextPlugin.extract</span></span><br><span class="line">ExtractTextPlugin.extract(&#123;</span><br><span class="line">  loader: <span class="string">'[name]-loader'</span>,</span><br><span class="line">  options: &#123;</span><br><span class="line">    use: [<span class="string">'css-loader'</span>, <span class="string">'sass-loader'</span>],<span class="comment">// 提取 css 文件，使用这些 loader 获得 css 模块</span></span><br><span class="line">    fallback: <span class="string">'style-loader'</span>,<span class="comment">// css 模块已取得，尚未提取前应用</span></span><br><span class="line">    publicPath: <span class="comment">// 重写此 loader 的 publicPath 配置</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> extractCSS = <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'stylesheets/[name]-one.css'</span>);</span><br><span class="line"><span class="keyword">const</span> extractLESS = <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'stylesheets/[name]-two.css'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: extractCSS.extract([ <span class="string">'css-loader'</span>, <span class="string">'postcss-loader'</span> ])</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/i</span>,</span><br><span class="line">        use: extractLESS.extract([ <span class="string">'css-loader'</span>, <span class="string">'less-loader'</span> ])</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    extractCSS,</span><br><span class="line">    extractLESS</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="NpmInstallWebpackPlugin"><a href="#NpmInstallWebpackPlugin" class="headerlink" title="NpmInstallWebpackPlugin"></a>NpmInstallWebpackPlugin</h2><p>npm-install-webpack-plugin 插件，加载缺失的依赖。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> NpmInstallPlugin(&#123;</span><br><span class="line">  dev: <span class="literal">false</span>,<span class="comment">// 使用 --save 或者 --save-dev</span></span><br><span class="line">  peerDependencies: <span class="literal">true</span>,<span class="comment">// 安装缺少的 peerDependencies</span></span><br><span class="line">  quiet: <span class="literal">false</span>,<span class="comment">// 减少控制台日志记录的数量</span></span><br><span class="line">  npm: <span class="string">'tnpm'</span><span class="comment">// 包加载方式，默认 'npm'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="I18nWebpackPlugin"><a href="#I18nWebpackPlugin" class="headerlink" title="I18nWebpackPlugin"></a>I18nWebpackPlugin</h2><p>i18n-webpack-plugin 插件，国际化???</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> I18nWebpackPlugin(&#123;</span><br><span class="line">  functionName: <span class="string">'__'</span>,<span class="comment">// 函数名</span></span><br><span class="line">  failOnMissing: <span class="literal">false</span>,<span class="comment">// 找不到映射文件时给予警告</span></span><br><span class="line">  hideMessage: <span class="literal">false</span><span class="comment">// 隐藏警告/错误信息</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="BabiliWebpackPlugin"><a href="#BabiliWebpackPlugin" class="headerlink" title="BabiliWebpackPlugin"></a>BabiliWebpackPlugin</h2><p>babili-webpack-plugin 插件，使用 babel-minify 根据浏览器是否支持 es5 最新特性，优化压缩代码。也可以在 babel-loader 配置中使用 babel-preset-minify 。比起 babel-loader 配置，babili-webpack-plugin 插件能优化全文件，包含不通过 babel-loader 加载的文件，即 node_modules 下的文件，以及由 webpack 生成的文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> BabiliPlugin(</span><br><span class="line">  babiliOptions = &#123; </span><br><span class="line">    plugins:[], </span><br><span class="line">    presets:[] </span><br><span class="line">  &#125;, </span><br><span class="line">  overrides = &#123;</span><br><span class="line">    test: <span class="regexp">/\.js($|\?)/i</span>,<span class="comment">// 待包含的文件</span></span><br><span class="line">    comments: <span class="regexp">/@preserve|@licen(s|c)e/</span>,<span class="comment">// 置为 false，将移除注释</span></span><br><span class="line">    sourceMap: webpackConfig.devtool,</span><br><span class="line">    parserOpts: &#123;&#125;,</span><br><span class="line">    babel: <span class="built_in">require</span>(<span class="string">"babel-core"</span>),<span class="comment">// 用于替代 babel-core</span></span><br><span class="line">    babili: <span class="built_in">require</span>(<span class="string">'babel-preset-minify'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="CompressionWebpackPlugin"><a href="#CompressionWebpackPlugin" class="headerlink" title="CompressionWebpackPlugin"></a>CompressionWebpackPlugin</h2><p>compression-webpack-plugin 插件，压缩静态资源。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> CompressionWebpackPlugin(&#123; </span><br><span class="line">  test: <span class="string">'.'</span>, </span><br><span class="line">  include: <span class="literal">undefined</span>,</span><br><span class="line">  exclude: <span class="literal">undefined</span>,</span><br><span class="line">  cache: <span class="literal">false</span>,<span class="comment">// 开启文件缓存</span></span><br><span class="line">  asset: [path].gz[query],<span class="comment">// 目标资源名称。[file] 会被替换成原始资源，[path] 会被替换成原始资源的路径，[query] 会被替换成查询字符串</span></span><br><span class="line">  filename: <span class="literal">false</span>,<span class="comment">// 函数，如 (asset) =&gt; asset</span></span><br><span class="line">  algorithm: <span class="string">'gzip'</span>,<span class="comment">// 压缩算法或算法名，如 (buffer, cb) =&gt; cb(buffer)</span></span><br><span class="line">  threshold: <span class="number">0</span>,<span class="comment">// 大于该值的文件将被压缩</span></span><br><span class="line">  minRatio: <span class="number">0.8</span>,<span class="comment">// 压缩比大于该值的将被压缩</span></span><br><span class="line">  deleteOriginalAssets: <span class="literal">false</span><span class="comment">// 是否删除原始资源</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="ZopfliWebpackPlugin"><a href="#ZopfliWebpackPlugin" class="headerlink" title="ZopfliWebpackPlugin"></a>ZopfliWebpackPlugin</h2><p>zopfli-webpack-plugin 插件，压缩资源。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ZopfliWebpackPlugin(&#123; </span><br><span class="line">  asset: [path].gz[query],<span class="comment">// 目标资源名称。[file] 会被替换成原始资源，[path] 会被替换成原始资源的路径，[query] 会被替换成查询字符串</span></span><br><span class="line">  filename: <span class="literal">false</span>,<span class="comment">// 函数，如 (asset) =&gt; asset</span></span><br><span class="line">  algorithm: <span class="string">'gzip'</span>,<span class="comment">// 压缩算法或算法名，如 (buffer, cb) =&gt; cb(buffer)</span></span><br><span class="line">  threshold: <span class="number">0</span>,<span class="comment">// 大于该值的文件将被压缩</span></span><br><span class="line">  minRatio: <span class="number">0.8</span>,<span class="comment">// 压缩比大于该值的将被压缩</span></span><br><span class="line">  deleteOriginalAssets: <span class="literal">false</span><span class="comment">// 是否删除原始资源</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="ComponentWebpackPlugin"><a href="#ComponentWebpackPlugin" class="headerlink" title="ComponentWebpackPlugin"></a>ComponentWebpackPlugin</h2><p>不详。。。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/04/webpack加载器指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/04/webpack加载器指南/" itemprop="url">webpack加载器指南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-04T00:00:00+08:00">2018-02-04</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/" itemprop="url" rel="index"><span itemprop="name">前端工程化</span></a></span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/04/webpack加载器指南/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/04/webpack加载器指南/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>加载器在 webpack 编译前预处理文件，链式调用多个加载器。</p>
<h2 id="babel-loader"><a href="#babel-loader" class="headerlink" title="babel-loader"></a>babel-loader</h2><p>babel-loader将 es6 降级为 es5。</p>
<p>参考文档：</p>
<p><a href="https://www.cnblogs.com/tugenhua0707/p/7863616.html" target="_blank" rel="noopener">Babel是如何编译JS代码的及理解抽象语法树(AST)</a></p>
<h3 id="options-选项"><a href="#options-选项" class="headerlink" title="options 选项"></a>options 选项</h3><p>参考文档：</p>
<p><a href="https://babeljs.cn/docs/usage/api/" target="_blank" rel="noopener">babel options</a>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认配置</span></span><br><span class="line">&#123;</span><br><span class="line">  plugins:[],<span class="comment">//	需要加载和使用的插件列表</span></span><br><span class="line">  presets: [],<span class="comment">//	需要加载和使用的 presets (一组插件) 列表</span></span><br><span class="line">  generatorOpts: &#123;&#125;,<span class="comment">// 包含要传递给 babel 代码生成器(babel-generator)的选项对象</span></span><br><span class="line">  parserOpts:&#123;&#125;,<span class="comment">// 需要传递给 babel 解析器，babylon 的选项对象</span></span><br><span class="line">  only: <span class="literal">null</span>,<span class="comment">// 待编译的文件，正则，字符串或数组形式</span></span><br><span class="line">  ignore: <span class="literal">null</span>,<span class="comment">// 无需编译的文件</span></span><br><span class="line">  minified: <span class="literal">false</span>,<span class="comment">// 保证输出最小化(不输出代码块最后一个分号，输出文字为字符串而不是转义字符串，安全情况下 new 后的 () 会被去除)</span></span><br><span class="line">  babelrc: <span class="literal">true</span>,<span class="comment">// 指定是否使用 .babelrc 和 babelignore 配置文件，命令行使用 --no-babelrc 代替</span></span><br><span class="line">  extends: <span class="literal">null</span>,<span class="comment">// 扩展 .babelrc 文件的路径</span></span><br><span class="line">  sourceType:	<span class="string">"module"</span>,<span class="comment">//	设置 babel 解析代码的模式。可以设置为 “script” 或 “module” </span></span><br><span class="line">  sourceRoot:	(moduleRoot),<span class="comment">//	所有 source 都是相对于 root 的</span></span><br><span class="line">  retainLines: <span class="literal">false</span>,<span class="comment">// 保留行号。这将导致代码变得很古怪，适用于不能使用 source map 的场景</span></span><br><span class="line">  sourceMaps: <span class="literal">false</span>,<span class="comment">//	如果为 true ，添加一个 map 属性在输出的返回值中。如果设置为 "inline" ，带有 sourceMappingURL 指令的注释被添加到返回代码的底部。如果设置为 "both" ，则会返回 map 属性并追加 source map 注释。命令行使用 --source-maps</span></span><br><span class="line">  sourceMapTarget: (filenameRelative),<span class="comment">//	在返回 souremap 时设置 file</span></span><br><span class="line">  inputSourceMap: <span class="literal">null</span>,<span class="comment">// 输出的 source map 将基于该 source map 对象</span></span><br><span class="line">  sourceFileName: (filenameRelative),<span class="comment">// 在返回的 source map 上设置 sources[0]</span></span><br><span class="line">  auxiliaryCommentAfter: <span class="literal">null</span>,<span class="comment">// 在所有非用户编写代码后添加注释</span></span><br><span class="line">  auxiliaryCommentBefore: <span class="literal">null</span>,<span class="comment">// 在所有非用户编写代码前添加注释</span></span><br><span class="line">  commets: <span class="literal">true</span>,<span class="comment">// 是否在生成的代码中添加注释</span></span><br><span class="line">  shouldPrintComment: <span class="literal">null</span>,<span class="comment">// 是否需要输出注释。具体调用为 shouldPrintComment(commentContents)。将覆盖 commets 选项</span></span><br><span class="line">  compact: <span class="string">'auto'</span>,<span class="comment">// 是否包含多余的空格符和换行符，当输入大于 500KB 时，compact 属性自动设置为真值</span></span><br><span class="line">  ast: <span class="literal">true</span><span class="comment">// 是否在返回对象包含 ast 抽象语法树 abstract syntax tree</span></span><br><span class="line">  code: <span class="literal">true</span>,<span class="comment">// 是否启用代码生成选项</span></span><br><span class="line">  env: &#123;&#125;,<span class="comment">// 配置给不同环境的选项。环境配置的优先级依次为 BABEL_ENV, NODE_ENV，默认'development'环境。env 配置如 &#123; env: &#123; 'product': /* options */ &#125; &#125;</span></span><br><span class="line">  filename: <span class="string">'unknown'</span>,<span class="comment">// 在错误信息是使用的文件名等</span></span><br><span class="line">  filenameRelative: (filename),<span class="comment">//	相对于 sourceRoot 的文件名</span></span><br><span class="line">  moduleId: <span class="literal">null</span>,<span class="comment">// 指定模块 ID 的自定义名称</span></span><br><span class="line">  moduleIds: <span class="literal">false</span>,<span class="comment">// 是否为模块指定明确的 ID。默认情况下，所有模块都是匿名的(不适用于 common 模块)</span></span><br><span class="line">  moduleRoot: (sourceRoot),<span class="comment">// AMD 模块格式化程序的可选前缀，可以被预先添加到模块定义的文件名当中</span></span><br><span class="line">  getModuleId: <span class="literal">null</span>,<span class="comment">// 指定回调函数 getModuleId(moduleName) 生成模块 ID。返回false，意味模块 ID 已被使用</span></span><br><span class="line">  highlightCode: <span class="literal">true</span>,<span class="comment">// ANSI 错误语法高亮显示</span></span><br><span class="line">  resolveModuleSource: <span class="literal">null</span>,<span class="comment">// 解析模块入口，例如 import "SOURCE"; 引入自定义值。具体调用为 resolveModuleSource(source, filename)</span></span><br><span class="line">  wrapPluginVisitorMethod: <span class="literal">null</span>,<span class="comment">// 可用于包装访问者模式的可选回调。注意: 这对于自我检查这样的事是有必要的，并且不需要实现任何方法。具体调用为 wrapPluginVisitorMethod(pluginAlias, visitorType, callback)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="plugins-presets-插件"><a href="#plugins-presets-插件" class="headerlink" title="plugins presets 插件"></a>plugins presets 插件</h3><p>参考文档：</p>
<p><a href="https://babeljs.cn/docs/plugins/" target="_blank" rel="noopener">babel plugins</a>。</p>
<p>plugins 为编译时调用的插件，presets 为官方封装的插件集合。编译时，plugin 运行在 preset 前，plugin 顺序执行，preset 反序执行。配置时，’babel-plugin-‘, ‘babel-preset-‘ 前缀可以忽略，babel 将自动拼接，并在 node_modules 目录中查找。当 babel 插件不在工程目录中时，可以通过插件的绝对路径加以配置，如 “plugins”: [“./node_modules/asdf/plugin”]。插件选项配置通过将插件名称和选项对象放置在同一个数组中实现。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// 执行顺序为 "transform-decorators-legacy", "transform-class-properties"</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    <span class="string">"transform-decorators-legacy"</span>,</span><br><span class="line">    <span class="string">"transform-class-properties"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 执行顺序为 "stage-2", "react", "es2015"</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    <span class="string">"es2015"</span>,</span><br><span class="line">    <span class="string">"react"</span>,</span><br><span class="line">    <span class="string">"stage-2"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 配置选项</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    [<span class="string">"transform-async-to-module-method"</span>, &#123;</span><br><span class="line">      <span class="attr">"module"</span>: <span class="string">"bluebird"</span>,</span><br><span class="line">      <span class="attr">"method"</span>: <span class="string">"coroutine"</span></span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="presets-官方插件集合"><a href="#presets-官方插件集合" class="headerlink" title="presets 官方插件集合"></a>presets 官方插件集合</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  // env 包含es2015, es2016, es2017 及最新版本</span><br><span class="line">  // 参考文档：[](https://babeljs.cn/docs/plugins/preset-env/)</span><br><span class="line">  [<span class="string">"babel-preset-env"</span>,&#123;</span><br><span class="line">    "targets": &#123;&#125;,// 设定适配环境，如 &#123; node: "6.10" &#125;。支持的环境有 browsers, chrome, opera, edge, firefox, safari, ie, ios, android, node, electron。浏览器端清单 https://github.com/ai/browserslist，如 &#123; "chrome": 52, "browsers": ["last 2 versions", "safari 7"] &#125;。uglify 属性设置为 true，uglify-js 压缩脚本时已编译为 es5 语法</span><br><span class="line">    "spec": false,// 是否允许插件启用 "spec" 转换，更符合规范，编译较慢</span><br><span class="line">    "loose": false,// 是否允许插件启用 "loose" 转换</span><br><span class="line">    "modules": "commonjs",// 将es6模块语法转换为另一个模块类型。可选值为 "amd" | "umd" | "systemjs" | "commonjs" | false。false 将不会转换任何模块</span><br><span class="line">    "include": [],// 包含的插件。include 与 exclude 选项仅仅适用于 preset 中包含的插件。可配置为 ["transform-es2015-arrow-functions", "es6.map"]。"es6.map" 为 [Built-ins](https://github.com/babel/babel-preset-env/blob/master/data/built-in-features.js)</span><br><span class="line">    "exclude": [],// 移除的插件</span><br><span class="line">    "useBuiltIns": false// 是否在 env 中引入 babel-ployfill，以避免在模块中调用 import "babel-polyfill"。npm &gt; 3，babel 6</span><br><span class="line">  &#125;],</span><br><span class="line"></span><br><span class="line">  [<span class="string">"babel-preset-es2015"</span>,&#123;</span><br><span class="line">    <span class="attr">"loose"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"spec"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"modules"</span>: <span class="string">"commonjs"</span></span><br><span class="line">  &#125;],</span><br><span class="line"></span><br><span class="line">  ["babel-preset-es2016",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  ["babel-preset-es2017",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  ["babel-preset-react",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  ["babel-preset-flow",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  // stage 3 候选：完成规范和浏览器初步实现。Stage 4 将到下一年度发行</span><br><span class="line">  ["babel-preset-stage-3",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  // stage 2  初稿: 完成初步规范。包含 preset-stage-3 所有插件</span><br><span class="line">  ["babel-preset-stage-2",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  // stage 1  提案: 初步尝试。包含 preset-stage-2, preset-stage-3 所有插件</span><br><span class="line">  ["babel-preset-stage-1",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  // stage 0  稻草人: 只是一个想法。包含 preset-stage-1, preset-stage-2, preset-stage-3 所有插件</span><br><span class="line">  ["babel-preset-stage-0",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="plugin-插件"><a href="#plugin-插件" class="headerlink" title="plugin 插件"></a>plugin 插件</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  // es3</span><br><span class="line">  [<span class="string">"babel-plugin-transform-es3-property-literals"</span>,&#123; &#125;],// 定义对象属性时包裹上双引号</span><br><span class="line">  [<span class="string">"babel-plugin-transform-es3-member-expression-literals"</span>,&#123; &#125;],// 使用对象属性时包裹上双引号</span><br><span class="line"></span><br><span class="line">  // es5</span><br><span class="line">  [<span class="string">"abel-plugin-transform-es5-property-mutators"</span>,&#123; &#125;],// 对象访问器属性 get, set 方法</span><br><span class="line"></span><br><span class="line">  // es2015</span><br><span class="line">  [<span class="string">"check-es2015-constants"</span>,&#123; &#125;],// 常量只读检查</span><br><span class="line">  [<span class="string">"transform-es2015-block-scoped-functions"</span>,&#123; &#125;],// 在块中声明的函数只在块中可用</span><br><span class="line">  ["transform-es2015-block-scoping",&#123;// let 块级作用域</span><br><span class="line">    "throwIfClosureRequired": false// for() 语句中定义的 let 在 &#123;&#125; 中使用，是否直接报错</span><br><span class="line">  &#125;],</span><br><span class="line">  [<span class="string">"transform-es2015-arrow-functions"</span>,&#123; </span><br><span class="line">    <span class="attr">"spec"</span>: <span class="literal">false</span></span><br><span class="line">  &#125;],// 箭头函数转换</span><br><span class="line">  ["transform-es2015-classes",&#123;// 类转换</span><br><span class="line">    "loose": false// loose 模式下，原型方法可枚举，且不能在子类中重复定义</span><br><span class="line">  &#125;],</span><br><span class="line">  ["transform-es2015-computed-properties",&#123; &#125;],// 对象计算属性转换，如 [x + 'foo'] 属性</span><br><span class="line">  ["transform-es2015-destructuring",&#123; &#125;],// 解构</span><br><span class="line">  ["transform-es2015-duplicate-keys",&#123; &#125;],// 将同名属性转换为计算属性，再由 transform-es2015-computed-properties 插件处理</span><br><span class="line">  ["transform-es2015-for-of",&#123; &#125;],// for of 语法</span><br><span class="line">  ["transform-es2015-function-name",&#123; &#125;],// function.name</span><br><span class="line">  ["transform-es2015-literals",&#123; &#125;],// 二进制、八进制整数，unicode 字面量</span><br><span class="line">  ["transform-es2015-modules-commonjs",&#123; &#125;],// 转换成 commonjs 模块。使用 babel-plugin-add-module-exports 插件，避免使用 require("your-module").default 调用模块，可直接使用 require("your-module")</span><br><span class="line">  ["transform-es2015-object-super",&#123; &#125;],// super 父类转换???</span><br><span class="line">  ["transform-es2015-parameters",&#123; &#125;],// 解构函数参数，设置默认值，...arr支持。默认使用 let 处理参数，需要配合使用 transform-es2015-block-scoping 插件</span><br><span class="line">  ["transform-es2015-shorthand-properties",&#123; &#125;],// 允许 &#123; a &#125; 方式赋值对象，转换为 &#123; a: a &#125;</span><br><span class="line">  ["transform-es2015-spread",&#123;// ...a</span><br><span class="line">    "loose": false</span><br><span class="line">  &#125;],</span><br><span class="line">  ["transform-es2015-sticky-regex",&#123; &#125;],// 正则表达式转换为正则构造函数形式</span><br><span class="line">  [<span class="string">"transform-es2015-template-literals"</span>,&#123; </span><br><span class="line">    "loose": false,// 设置为true时，模板字符串对象不会被 frozen</span><br><span class="line">    "spec": false// 是否用 String 函数包裹模板字符串内变量</span><br><span class="line">  &#125;],// 模板字符串</span><br><span class="line">  ["transform-es2015-typeof-symbol",&#123; &#125;],// typeof Symbol() === "symbol" 语法支持</span><br><span class="line">  ["transform-es2015-unicode-regex",&#123; &#125;],// unicode 正则???</span><br><span class="line">  ["transform-regenerator",&#123;// 生成器函数，页面需要引入 babel-ployfill 或 regenerator-runtime 运行时脚本。使用 async 函数，需要添加 syntax-async-functions 插件</span><br><span class="line">    "asyncGenerators": true,</span><br><span class="line">    "generators": true,</span><br><span class="line">    "async": true</span><br><span class="line">  &#125;],</span><br><span class="line"></span><br><span class="line">  // es2016</span><br><span class="line">  ["transform-exponentiation-operator",&#123; &#125;],// ** 求幂</span><br><span class="line"></span><br><span class="line">  // es2017</span><br><span class="line">  ["syntax-trailing-function-commas",&#123; &#125;],// 函数参数后加','，添加参数时只有一行改变，方便git diff</span><br><span class="line">  ["transform-async-to-generator",&#123; &#125;],// 将 acync 函数转化为生成器函数</span><br><span class="line"></span><br><span class="line">  // react 包含 preset-flow, babel-plugin-syntax-jsx, babel-plugin-transform-react-jsx, babel-plugin-transform-react-display-name</span><br><span class="line">  // preset-flow 包含 transform-flow-strip-types 插件，其余均为插件</span><br><span class="line">  ["transform-flow-strip-types",&#123; &#125;],// 移除 flow 类型，但不作类型校验，类型校验需要使用 flow 或另外的插件。如 function foo(one: any, two: number, three?): string &#123;&#125; 将转换为 function foo(one, two, three) &#123;&#125;</span><br><span class="line">  ["babel-plugin-syntax-jsx",&#123; &#125;],// 解析 JSX</span><br><span class="line">  ["babel-plugin-transform-react-jsx",&#123; &#125;],// 将 JSX 转换为 react 函数</span><br><span class="line">  ["babel-plugin-transform-react-display-name",&#123; &#125;],// 调用 React.createClass 或 createReactClass 函数时自动添加 displayName，如 var bar = createReactClass(&#123;&#125;) 将转换为 var bar = createReactClass(&#123; displayName: "bar" &#125;)</span><br><span class="line"></span><br><span class="line">  // flow</span><br><span class="line">  ["transform-flow-strip-types",&#123; &#125;],// react preset 包含</span><br><span class="line"></span><br><span class="line">  // stage 3</span><br><span class="line">  ["transform-object-rest-spread",&#123; &#125;],// ...a 语法支持</span><br><span class="line">  ["transform-async-generator-functions",&#123; &#125;],// async 函数转换为生成器函数</span><br><span class="line"></span><br><span class="line">  // stage 2</span><br><span class="line">  ["syntax-dynamic-import",&#123; &#125;],// import() 支持变量</span><br><span class="line">  ["transform-class-properties",&#123; &#125;],// 类静态属性，实例属性、方法等</span><br><span class="line"></span><br><span class="line">  // stage 1</span><br><span class="line">  ["transform-class-constructor-call",&#123; &#125;],// 类作为普通函数使用</span><br><span class="line">  ["transform-export-extensions",&#123; &#125;],// export * as ns from 'mod'; export v from 'mod'; 语法支持</span><br><span class="line"></span><br><span class="line">  // stage 0</span><br><span class="line">  ["transform-do-expressions",&#123; &#125;],// do &#123;&#125; 语法支持，构造块级作用域，最终执行语句作为返回值</span><br><span class="line">  ["transform-function-bind",&#123; &#125;],// obj::func 转换为 func.bind(obj)；::obj.func 转换为 obj.func.bind(obj)；obj::func(val) 转换为 func.call(obj, val)；::obj.func(val) 转换为 obj.func.call(obj, val)</span><br><span class="line">  </span><br><span class="line">  // 模块</span><br><span class="line">  ["es2015-modules-amd",&#123; &#125;],// 将模块导出为 amd 模块</span><br><span class="line">  ["es2015-modules-commonjs",&#123;// 将模块导出为 commonjs 模块</span><br><span class="line">    "loose": false,// loose 模式下，import, export 可在全局使用；非 loose 模式下，只能在外层使用。非 loose 模式下，通过 defineProperty 语句注入不可枚举的 __esModule 属性；loose 模式下，通过赋值注入 __esModule 属性</span><br><span class="line">    "strict": false,// strict 属性置为真，将阻止导出 __esModule 属性</span><br><span class="line">    "noInterop": false// 加载模块时，是否不使用 function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;，适用于不需要 default 属性的场景</span><br><span class="line">  &#125;],</span><br><span class="line">  ["es2015-modules-systemjs",&#123;// 将模块导出为 SystemJS 模块</span><br><span class="line">    "systemGlobal": "SystemJS"</span><br><span class="line">  &#125;],</span><br><span class="line">  ["es2015-modules-umd",&#123;// 依据 define, exports 变量有无，分别导出 amd, commonjs 等模块</span><br><span class="line">     "globals": &#123;&#125;,// 用于设置导出变量名，如 "globals": &#123; "es6-promise": "Promise" &#125;</span><br><span class="line">     "exactGlobals": true// 规范化注入的全局变量???</span><br><span class="line">  &#125;],</span><br><span class="line"></span><br><span class="line">  // 实验阶段</span><br><span class="line">  ["async-generator-functions",&#123; &#125;],// stage 3 包含</span><br><span class="line">  ["transform-async-to-module-method",&#123; &#125;],// 将 async 函数转换为 Bluebird coroutine</span><br><span class="line">  ["class-properties",&#123; &#125;],// stage 2 包含</span><br><span class="line">  ["transform-decorators-legacy",&#123; &#125;],// 装饰器，babel 7 包含在 stage 0 中。平常开发时，需要通过 plugins 配置注入</span><br><span class="line">  ["do-expressions",&#123; &#125;],// stage 0 包含</span><br><span class="line">  ["export-extensions",&#123; &#125;],// stage 1 包含</span><br><span class="line">  ["function-bind",&#123; &#125;],// stage 0 包含</span><br><span class="line">  ["object-rest-spread",&#123; &#125;],// stage 3 包含</span><br><span class="line"></span><br><span class="line">  // Minification</span><br><span class="line">  ["transform-inline-environment-variables",&#123;// 将环境变量以字符串形式注入模块</span><br><span class="line">    "include": [],// 注入的环境变量，如 "include": [ "NODE_ENV" ]</span><br><span class="line">    "exclude": []// 移除的环境变量</span><br><span class="line">  &#125;],</span><br><span class="line">  ["transform-inline-consecutive-adds",&#123; &#125;],// 将对象属性的赋值和数组 push 方法调用过程移入声明中，前提赋值和 push 紧跟在声明后</span><br><span class="line">  ["member-expression-literals",&#123;&#125;],// 对象属性名含关键字，以计算属性 [''] 表示；不含，采用 . 分割形式</span><br><span class="line">  ["transform-minify-booleans",&#123;&#125;],// 以 !0 代替 true，!1 代替 false</span><br><span class="line">  ["minify-dead-code-elimination",&#123;// 精简无用代码</span><br><span class="line">    "keepFnName": true,// 防止插件删除函数名</span><br><span class="line">    "keepFnArgs": true,// 防止插件删除函数参数</span><br><span class="line">    "keepClassName": true,// 防止插件删除类名</span><br><span class="line">  &#125;],</span><br><span class="line">  ["minify-flip-comparisons",&#123;&#125;],// 精简翻转输出，基于重复的内容进行压缩算法优化，例如 gzip。bar !== null 转换为 null !== bar</span><br><span class="line">  ["minify-guarded-expressions",&#123;&#125;],// 精简守护表达式，针对 &amp;&amp;, ||，0 &amp;&amp; new Foo() 转换为 0</span><br><span class="line">  ["minify-infinity",&#123;&#125;],// 精简无穷大，Infinity 转换为 1/0</span><br><span class="line">  ["minify-mangle-names",&#123;&#125;],// 根据作用域精简一次性使用的变量名</span><br><span class="line">  ["minify-numeric-literals",&#123;&#125;],// 通过科学计数法精简数值字面量</span><br><span class="line">  ["minify-replace",&#123;// 用给定节点替换变量</span><br><span class="line">    "identifierName": null,// 待替换的变量名，如 __DEV__</span><br><span class="line">    "replacement": &#123;&#125;// 替换规则，如 &#123; type: "numericLiteral", value: 0, &#125;，效果是将 __DEV__ 转换为 0</span><br><span class="line">  &#125;],</span><br><span class="line">  ["minify-simplify",&#123;&#125;],// 简化，if (x) a(); 将转换为 x &amp;&amp; a()，Number(foo) 将转换为 +foo</span><br><span class="line">  ["minify-type-constructors",&#123;// 将构造函数转化为字面量，不推荐在 IE8 中使用</span><br><span class="line">    "array": true,// 是否启用 Array 构造函数</span><br><span class="line">    "boolean": true,// 是否启用 Boolean 构造函数</span><br><span class="line">    "number": true,// 是否启用 Number 构造函数</span><br><span class="line">    "object": true,// 是否启用 Object 构造函数</span><br><span class="line">    "string": true// 是否启用 String 构造函数</span><br><span class="line">  &#125;],</span><br><span class="line">  ["transform-node-env-inline",&#123;&#125;],// 将 process.env.NODE_ENV === "development"; 转换为 true | false</span><br><span class="line">  ["transform-property-literals",&#123;&#125;],// 对非关键字属性取出双引号</span><br><span class="line">  ["transform-regexp-constructors",&#123;&#125;],// 正则构造函数转换为正则表达式</span><br><span class="line">  ["transform-remove-console",&#123;&#125;],// 移除console</span><br><span class="line">  ["transform-remove-debugger",&#123;&#125;],// 移除debugger</span><br><span class="line">  ["simplify-comparison-operators",&#123;&#125;],// 当比较类型相同时，将 ===, !== 转换为 ==, !=</span><br><span class="line">  ["transform-undefined-to-void",&#123;&#125;],// 将 undefined 转换为 void 0</span><br><span class="line"></span><br><span class="line">  // react</span><br><span class="line">  ["transform-react-constant-elements",&#123;&#125;],// 将常量元素(作为返回值)提取到最外层，如 const Hr = () =&gt; &#123; return &lt;hr className="hr" /&gt;; &#125;; 将转换为 const _ref = &lt;hr className="hr" /&gt;; const Hr = () =&gt; &#123; return _ref; &#125;; 若元素包含 ...props 或 ref 属性，将不予转换</span><br><span class="line">  ["transform-react-display-name",&#123;&#125;],// react preset 包含</span><br><span class="line">  ["transform-react-inline-elements",&#123;&#125;],// 将 React.createElement 转换为 babelHelpers.jsx，如 &lt;Baz foo="bar" key="1"&gt;&lt;/Baz&gt;; 将转换为 babelHelpers.jsx(Baz, &#123; foo: "bar" &#125;, "1"); 若元素包含 ...props 或 ref 属性，将不予转换</span><br><span class="line">  ["transform-react-jsx",&#123;&#125;],// react preset 包含</span><br><span class="line">  ["transform-react-jsx-compat",&#123;&#125;],// 将 JSX 转换为 React Pre-0.12 函数，如 var profile = &lt;div&gt;&lt;img src="avatar.png" class="profile" /&gt;&lt;/div&gt;; 将转换为 var profile = React.DOM.div(null, React.DOM.img(&#123; src: "avatar.png", "class": "profile" &#125;) );</span><br><span class="line">  ["transform-react-jsx-self",&#123;&#125;],// JSX 元素中添加 __self 属性为 this，以便于 react 运行时报错</span><br><span class="line">  ["transform-react-jsx-source",&#123;&#125;],// JSX 元素中添加 __source 属性为 &#123; fileName: 'this/file.js', lineNumber: 10 &#125; 等，以便于 react 运行时报错</span><br><span class="line"></span><br><span class="line">  // 其他</span><br><span class="line">  ["transform-eval",&#123;&#125;],// eval("(() =&gt; 'foo')"); 将转换为 eval("(function () &#123; return 'foo'; &#125;)");</span><br><span class="line">  ["transform-flow-comments",&#123;&#125;],// 将 flow 类型说明转换为注释???</span><br><span class="line">  ["transform-flow-strip-types",&#123;&#125;],// react, flow preset 包含</span><br><span class="line">  ["transform-jscript",&#123;&#125;],// 将函数表达式通过自调用匿名函数赋值</span><br><span class="line">  ["transform-object-assign",&#123;&#125;],// 将 Object.assign 函数转换为 ... 语句，不适用于 const &#123; assign &#125; = Object场景</span><br><span class="line">  ["transform-object-set-prototype-of-to-assign",&#123;&#125;],// 将 Object.setPrototypeOf 转换为 ... 语句</span><br><span class="line">  ["transform-proto-to-assign",&#123;&#125;],// 对象 __proto__ 赋值转换为 ... 语句</span><br><span class="line">  ["transform-regenerator",&#123;&#125;],// es2015 包含</span><br><span class="line">  ["transform-runtime",&#123;// 无需通过污染全局对象调用最新的 api，模块需要注入 babel-runtime。参考文档：[tranform-runtime](https://babeljs.cn/docs/plugins/transform-runtime/)</span><br><span class="line">    "helpers": true,// 是否内置 classCallCheck, extends 等。模块为 babel-runtime/helpers</span><br><span class="line">    "polyfill": true,// 是否内置 Promise, Set, Map, Symbol 等。模块为 babel-runtime/core-js</span><br><span class="line">    "regenerator": true,// 是否内置生成器函数，async 函数。模块为 babel-runtime/regenerator</span><br><span class="line">    "moduleName": "babel-runtime"// 改变模块名，import 相应作改变</span><br><span class="line">  &#125;],// JSX 元素中添加 __self 属性为 this，以便于 react 运行时报错</span><br><span class="line">  ["transform-strict-mode",&#123;&#125;],// 转换为严格模式</span><br><span class="line">  ["external-helpers",&#123;&#125;],// 将 babel 中的 helpers 通过 babel-cli 导出为独立文件，然后在页面直接加载</span><br><span class="line"></span><br><span class="line">  // ant-design</span><br><span class="line">  [<span class="string">"babel-plugin-import"</span>,&#123;</span><br><span class="line">    <span class="attr">"libraryName"</span>: <span class="string">"antd"</span>,</span><br><span class="line">    <span class="attr">"style"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;],</span><br><span class="line">  [<span class="string">"babel-plugin-import"</span>,&#123;</span><br><span class="line">    <span class="attr">"libraryName"</span>: <span class="string">"antd-mobile"</span>,</span><br><span class="line">    <span class="attr">"style"</span>: <span class="string">"css"</span></span><br><span class="line">  &#125;],</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="awesome-typescript-loader"><a href="#awesome-typescript-loader" class="headerlink" title="awesome-typescript-loader"></a>awesome-typescript-loader</h2><p>编译 typescript。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">      loader: <span class="string">'awesome-typescript-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        silent: <span class="literal">false</span>,<span class="comment">// 是否打印日志</span></span><br><span class="line">        compiler: <span class="string">'typescript'</span>,<span class="comment">// 选择编译器</span></span><br><span class="line">        useTranspileModule: <span class="literal">false</span>,<span class="comment">// 启用 transpileModule 模式???</span></span><br><span class="line">        instance: <span class="string">'at-loader'</span>,<span class="comment">// 使用多个编译器???</span></span><br><span class="line">        configFileName: <span class="string">'tsconfig.json'</span>,<span class="comment">// 配置文件名</span></span><br><span class="line">        transpileOnly: <span class="literal">false</span>,<span class="comment">// 置为真，跳过类型校验</span></span><br><span class="line">        errorsAsWarnings: <span class="literal">false</span>,<span class="comment">// 以警告方式对待错误</span></span><br><span class="line">        forceIsolatedModules: <span class="literal">false</span>,<span class="comment">// 模块不能包含依赖</span></span><br><span class="line">        ignoreDiagnostics: [],<span class="comment">// 跳过错误，如 [8014] 将跳过 stage-1 错误</span></span><br><span class="line">        useBabel: <span class="literal">false</span>,<span class="comment">// 使用 babel-loader</span></span><br><span class="line">        babelOptions: &#123;&#125;,<span class="comment">// 配置 babel-loader 选项</span></span><br><span class="line">        babelCore: <span class="literal">undefined</span>,<span class="comment">// @babel/core 路径。@babel/core 不在 node_modules 中需要配置；babel 7 需要配置为 "@babel/core"</span></span><br><span class="line">        useCache: <span class="literal">false</span>,<span class="comment">// 使用缓存，提升速度，供 babel-loader 使用</span></span><br><span class="line">        usePrecompiledFiles: <span class="literal">false</span>,<span class="comment">// 启用预编译文件</span></span><br><span class="line">        cacheDirectory: <span class="string">'.awcache'</span>,<span class="comment">// 缓存目录</span></span><br><span class="line">        reportFiles: []<span class="comment">// 诊断报道???，如 [ "src/**/*.&#123;ts,tsx&#125;" ]</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="vue-loader"><a href="#vue-loader" class="headerlink" title="vue-loader"></a>vue-loader</h2><p>编译 vue 组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.vue?$/</span>,</span><br><span class="line">      loader: <span class="string">'awesome-typescript-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        loaders: &#123;<span class="comment">// 组件各部分加载器</span></span><br><span class="line">          js: <span class="string">'babel-loader!eslint-loader'</span>,</span><br><span class="line">          template: <span class="string">'html-loader'</span>,</span><br><span class="line">          css: <span class="string">'style-loader!css-loader!less-loader'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        preLoaders: &#123;&#125;,<span class="comment">// 在 loaders 之前处理</span></span><br><span class="line">        postLoaders: &#123;&#125;,</span><br><span class="line">        postcss: [],<span class="comment">// 指定要应用于 .vue 文件中 CSS 的自定义 PostCSS 插件。在 11.0.0+ 版本中，推荐使用 PostCSS 配置文件代替。也可使用对象配置，如 &#123; plugins: [...],  options: &#123; parser: 'sugarss' &#125;, config: &#123; path: path.resolve('./src') &#125;, useConfigFile: false &#125;，config.path 指定加载 PostCSS 配置文件的路径或目录，config.ctx 指定为 PostCSS 插件提供的上下文，useConfigFile 是否禁用配置文件</span></span><br><span class="line">        cssSourceMap: <span class="literal">false</span>,<span class="comment">// 是否开启 CSS 的 source maps，关闭可提升编译速度，避免 css-loader 的 some relative path related bugs。webpack 配置中没有 devtool 的情况下自动设置为 false</span></span><br><span class="line">        esModule: <span class="literal">false</span>,<span class="comment">// 是否导出兼容 esModule 的代码。默认导出 commonjs 格式，像 module.exports = ....。esModule 为真时，导出 exports.__esModule = true; exports = ...，适用于与 Babel 以外的 transpiler 互操作，比如 TypeScript</span></span><br><span class="line">        preserveWhitespace: <span class="literal">true</span>,<span class="comment">// 置为否值，模版中 HTML 标签之间的空格将会被忽略</span></span><br><span class="line">        compilerModules: [],<span class="comment">// 为 vue-template-compiler 配置 modules 选项</span></span><br><span class="line">        compilerDirectives: [],<span class="comment">// 为 vue-template-compiler 配置 directives 选项</span></span><br><span class="line">        transformToRequire: &#123; <span class="attr">img</span>: <span class="string">'src'</span>, <span class="attr">image</span>: <span class="string">'xlink:href'</span> &#125;,<span class="comment">// 在模版编译过程中，编译器可以将某些属性，如 src 路径，转换为 require 调用。供 html-loader 使用</span></span><br><span class="line">        buble: &#123;&#125;,<span class="comment">// 配置 buble-loader 的选项 (如果存在)，并且 buble 编译传递模板渲染函数???</span></span><br><span class="line">        extractCSS: <span class="literal">true</span>,<span class="comment">// 使用 extract-text-webpack-plugin 自动提取 CSS。值可以为真，或 ExtractTextPlugin 插件的一个实例</span></span><br><span class="line">        optimizeSSR: <span class="literal">false</span><span class="comment">// 渲染函数将会把返回的 vdom 树的一部分编译为字符串，适用于服务器端渲染</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="style-loader"><a href="#style-loader" class="headerlink" title="style-loader"></a>style-loader</h2><p>配合 css-loader 一起使用。style-loader 用于将样式以 style 标签注入到页面中，同时 import 时将生成类名的 hash 值(标识符)对象；style-loader/url 模块将以 link 注入到页面中。style-loader/useable 模块将延迟注入页面，直到 import style from ‘./file.css’; style.use();// =style.ref() 中 use, ref 方法被调用时，才注入到页面中。当调用unuse, unref 方法时，将从页面上删除。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123; </span><br><span class="line">            loader: <span class="string">"style-loader"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              base: <span class="literal">true</span>,<span class="comment">// 设置模块 ID 基础，生成 ID 大于该值。当使用 DllPlugin 编译 css 时，用于避免多个编译结果的 ID 冲突，实现是 多个编译配置设置不同的 ID 范围值</span></span><br><span class="line">              attrs: &#123;&#125;,<span class="comment">// 添加自定义属性到注入页面的 style, link 标签中</span></span><br><span class="line">              transform: <span class="literal">false</span>,<span class="comment">// 转换/条件加载 CSS，通过传递转换/条件函数。用于载入页面前修改 css，函数返回 false 将不会加载 css 。配置如 css =&gt; css.replace('.classNameA', '.classNameB')。transform 也可配置为脚本的路径</span></span><br><span class="line">              insertAt: <span class="string">"bottom"</span>,<span class="comment">// 在给定位置插入 style 节点，可选值 "bottom", "top"</span></span><br><span class="line">              insertInto: <span class="string">"&lt;head&gt;"</span>,<span class="comment">// 在给定标签处插入 style 节点，值可以是 css 选择器，或 ShadowRoot???</span></span><br><span class="line">              singleton: <span class="literal">true</span>,<span class="comment">// 重用 style 标签插入 css 脚本，否则每个样式文件插入一个 style 标签</span></span><br><span class="line">              sourceMap: <span class="literal">false</span>,<span class="comment">// 是否启用 SourceMap，css 脚本将生成 Blob，相对路径将无法正常工作。解决方法是设置 publicPath 属性或将 convertToAbsoluteUrls 置为真???</span></span><br><span class="line">              convertToAbsoluteUrls: <span class="literal">false</span><span class="comment">// 启用 SourceMap 后，将相对 url 转换为绝对 url</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">"css-loader"</span> &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.url\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">"style-loader/url"</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">"css-loader"</span> &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.useable\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">"style-loader/useable"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">"css-loader"</span> &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="css-loader"><a href="#css-loader" class="headerlink" title="css-loader"></a>css-loader</h2><p>用于解析 css 脚本中的 @import, url() 语句，附加的资源文件调用 import, require 加载并解析。import, url() 语句解析时，根据 webpack 配置将调用对应的 file-loader, url-loader 加载器。因此 css-loader 基于 file-loader, url-loader 加载器。</p>
<p>可以直接将 css-loader 的结果作为字符串使用，例如 Angular 的组件样式???。如果有 SourceMap，它们也将包含在字符串结果中。</p>
<p>对使用 extract-text-webpack-plugin 预渲染的场景，应使用 css-loader/locals，而不是 style-loader!css-loader。它不会嵌入 CSS，但只导出标识符映射；由 extract-text-webpack-plugin 提取 css 后，再通过 link 标签嵌入页面。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 'css-loader' 导入资源转化为字符串，由开发者在页面中添加 link 标签后使用</span></span><br><span class="line">&#123;</span><br><span class="line">   test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">   use: [</span><br><span class="line">     <span class="string">'to-string-loader'</span>,</span><br><span class="line">     <span class="string">'css-loader'</span></span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">const</span> css = <span class="built_in">require</span>(<span class="string">'./test.css'</span>).toString();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line">&#123;</span><br><span class="line">   test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">   use: [</span><br><span class="line">     <span class="string">'file-loader?name=[name].[ext]'</span></span><br><span class="line">     <span class="string">'handlebars-loader'</span>, <span class="comment">// handlebars loader expects raw resource string</span></span><br><span class="line">     <span class="string">'extract-loader'</span>,<span class="comment">// 将 html, css 提取为纯粹的字符串，通过 handlebars 处理，由 file 注入页面</span></span><br><span class="line">     &#123;</span><br><span class="line">       loader: <span class="string">'css-loader'</span>,</span><br><span class="line">       options: &#123;</span><br><span class="line">         root: <span class="string">"/"</span>,<span class="comment">// 以 / 开头的 URL 默认不会被转译，设置 root 为 "."，将 /image.png 转换为 ./image.png</span></span><br><span class="line">         url: <span class="literal">true</span>,<span class="comment">// 是否编译 css 文件中 url() 语句</span></span><br><span class="line">         alias: &#123;&#125;,<span class="comment">// 别名，便于 import 导入</span></span><br><span class="line">         <span class="keyword">import</span>: <span class="literal">true</span>,<span class="comment">// 是否编译 css 文件中 @import 语句</span></span><br><span class="line">         modules: <span class="literal">false</span>,<span class="comment">// 是否启用 css-modules</span></span><br><span class="line">         minimize: <span class="literal">false</span>,<span class="comment">// 是否启用压缩，压缩通过 cssnano 实现。[cssnano 文档](http://cssnano.co/guides/)</span></span><br><span class="line">         sourceMap: <span class="literal">false</span>,<span class="comment">// 是否启用SourceMap</span></span><br><span class="line">         camelCase: <span class="literal">false</span>,<span class="comment">// 以驼峰化式类名导出类名。可选值有 true 类名将被驼峰化，'dashes' 只有破折号被驼峰化，'only' 类名将被驼峰化，初始类名从映射中移除，'dashesOnly' 只有破折号被驼峰化，初始类名从映射中移除</span></span><br><span class="line">         importLoaders: <span class="number">0</span>,<span class="comment">// 在 css-loader 前应用的加载器数量。css-loader 前有 postcss-loader 时，设置为 1；css-loader 前有 postcss-loader, sass-loader，设置为 2</span></span><br><span class="line">         localIdentName: [hash:base64],<span class="comment">// 配置生成的标识符，import style from 'a.css' 加载时，作为style 属性的值，如 '[path][name]__[local]--[hash:base64:5]'</span></span><br><span class="line">         getLocalIdent: <span class="literal">false</span>,<span class="comment">// 指定生成标识符的函数，如 (context, localIdentName, localName, options) =&gt; &#123; return 'whatever_random_class_name' &#125;</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">const</span> css = <span class="built_in">require</span>(<span class="string">'./test.css'</span>).toString();</span><br></pre></td></tr></table></figure>
<h3 id="css-modules"><a href="#css-modules" class="headerlink" title="css-modules"></a>css-modules</h3><p>启用启用 css-modules 时，会产生局部作用域 CSS，使用 :global(…) 或 :global 设置为全局作用域，类名将不会转换为标识符；使用 :local(…) 或 :locale 设置为局部，类名将转换为标识符。局部作用域的类名建议使用驼峰式书写。</p>
<p>样式属性中可使用 composes 属性，用于向一个类注入另一个类(该类可以是另一个 css 文件中的类)的样式。一个类下，composes 属性可设置多个。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// :local 为局部作用域，类名将转换为标识符，import 加载时生成映射形式；:global为全局作用域，类名保持不变</span><br><span class="line"><span class="selector-pseudo">:local(.className)</span> &#123;</span><br><span class="line">  <span class="attribute">composes</span>: edit hightlight from <span class="string">'./edit.css'</span>;</span><br><span class="line">  <span class="attribute">composes</span>: button from <span class="string">'module/button.css'</span>;</span><br><span class="line">  <span class="attribute">composes</span>: classFromThisModule;</span><br><span class="line">  <span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:local(.subClass)</span> &#123;</span><br><span class="line">  <span class="attribute">composes</span>: className;</span><br><span class="line">  <span class="attribute">background</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:local</span> <span class="selector-class">.className</span> <span class="selector-class">.subClass</span> <span class="selector-pseudo">:global(.global-class-name)</span> &#123; <span class="attribute">color</span>: blue; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="postcss-loader"><a href="#postcss-loader" class="headerlink" title="postcss-loader"></a>postcss-loader</h2><p>对 css 文件自动拼接浏览器兼容性前缀等。参考文档：<a href="https://github.com/postcss/postcss-loader。" target="_blank" rel="noopener">https://github.com/postcss/postcss-loader。</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.style.js$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        <span class="string">'style-loader'</span>,</span><br><span class="line">        &#123; <span class="attr">loader</span>: <span class="string">'css-loader'</span>, <span class="attr">options</span>: &#123; <span class="attr">importLoaders</span>: <span class="number">1</span> &#125; &#125;,</span><br><span class="line">        &#123; </span><br><span class="line">          loader: <span class="string">'postcss-loader'</span>, </span><br><span class="line">          options: &#123; </span><br><span class="line">            parser: <span class="literal">undefined</span>,<span class="comment">// 设置 PostCSS 解析器，可选值 'sugarss'，可配置为函数</span></span><br><span class="line">            syntax: <span class="literal">undefined</span>,<span class="comment">// 设置 PostCSS 语法解析器，可选值 'sugarss'，可配置为函数</span></span><br><span class="line">            stringifier: <span class="literal">undefined</span>,<span class="comment">// 设置 PostCSS 字符串化，可选值 'midas'，可配置为函数</span></span><br><span class="line">            exec: <span class="literal">true</span>,<span class="comment">// 将 css-in-js 编译为 css</span></span><br><span class="line">            config: &#123;</span><br><span class="line">              path: <span class="literal">undefined</span>,<span class="comment">// postcss.config.js 文件路径，默认自动从 css 文件目录向上查找</span></span><br><span class="line">              ctx: &#123;<span class="comment">// postcss 配置的上下文，传入 postcss.config.js</span></span><br><span class="line">                env: <span class="string">'development'</span>,<span class="comment">// process.env.NODE_ENV</span></span><br><span class="line">                file: loader.resourcePath,<span class="comment">// 包含 extname扩展名, dirname目录名, basename文件名</span></span><br><span class="line">                options: &#123;&#125;<span class="comment">// 选项</span></span><br><span class="line">                ...<span class="comment">// 其余参数</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            plugins: [],<span class="comment">// 可配置为函数形式，如(loader) =&gt; [ require('postcss-import')(&#123; root: loader.resourcePath &#125;), require('postcss-cssnext')(), require('autoprefixer')(), require('cssnano')() ]</span></span><br><span class="line">            sourceMap: <span class="literal">false</span><span class="comment">// 是否启用 SourceMap，可选值 true, "inline"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,&#123;</span><br><span class="line"></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// postcss.config.js 依旧生成 postcss-loader 选项</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">&#123; file, options, env &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  parser: file.extname === <span class="string">'.sss'</span> ? <span class="string">'sugarss'</span> : <span class="literal">false</span>,</span><br><span class="line">  plugins: &#123;</span><br><span class="line">    <span class="string">'postcss-import'</span>: &#123; <span class="attr">root</span>: file.dirname &#125;,</span><br><span class="line">    <span class="string">'postcss-cssnext'</span>: options.cssnext ? options.cssnext : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">'autoprefixer'</span>: env == <span class="string">'production'</span> ? options.autoprefixer : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">'cssnano'</span>: env === <span class="string">'production'</span> ? options.cssnano : <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// style.js</span></span><br><span class="line"><span class="keyword">import</span> colors <span class="keyword">from</span> <span class="string">'./styles/colors'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="string">'.menu'</span>: &#123;</span><br><span class="line">      color: colors.main,</span><br><span class="line">      height: <span class="number">25</span>,</span><br><span class="line">      <span class="string">'&amp;_link'</span>: &#123;</span><br><span class="line">      color: <span class="string">'white'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="less-loader"><a href="#less-loader" class="headerlink" title="less-loader"></a>less-loader</h2><p>将 less 文件编译成 css 文件。less 插件会作为 less-loader 的 peerDependency，因此安装 less-loader 的时候会自动安装 less 插件。</p>
<p>less-loader 4 起，查询文件可通过 webpack resolver 或 less 内置的 resolver。less-loader 应用一个 Less 插件，并且将所有查询参数传递给 webpack resolver。需要从 node_modules 导入 less 模块时，只要加一个 ~ 前缀，如 @import “~bootstrap/less/bootstrap”; 。使用 webpack resolver，可以引入任何导出 less 的文件，如 “js-to-less-loader” 导出的文件，与此同时，需要使用 issuer 属性约定请求资源的脚本文件名，如 issuer: /.less$/。</p>
<p>当 options 配置 paths 属性时，将使用 less 内置的 resolver 去查询文件。paths 属性以数组形式配置绝对路径。</p>
<p>options 配置参考 <a href="http://lesscss.org/usage/#command-line-usage-options" target="_blank" rel="noopener">less options</a>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [&#123;</span><br><span class="line">    test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">    use: [&#123;</span><br><span class="line">      loader: <span class="string">"style-loader"</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      loader: <span class="string">"css-loader"</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      loader: <span class="string">"less-loader"</span>, </span><br><span class="line">      options: &#123;</span><br><span class="line">        strictMath: <span class="literal">false</span>,<span class="comment">// 是否直接输出数学计算值</span></span><br><span class="line">        strictUnits: <span class="literal">false</span>,<span class="comment">// 是否支持 1px * 2px 运算，单位通过猜测获得</span></span><br><span class="line">        globalVar: &#123;&#125;,<span class="comment">// 全局变量</span></span><br><span class="line">        modifyVar: &#123;&#125;,<span class="comment">// 在 less 文件可改变的变量</span></span><br><span class="line">        paths: [],<span class="comment">// less 文件查找路径，如 [ path.resolve(__dirname, "node_modules") ]</span></span><br><span class="line">        plugins: [],<span class="comment">// 设置插件，如 [ new CleanCSSPlugin(&#123; advanced: true &#125;) ]</span></span><br><span class="line">        sourceMap: <span class="literal">false</span><span class="comment">// 是否启用 SourceMap，可选值 true, "inline"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      issuer: <span class="regexp">/\.less$/</span>,</span><br><span class="line">      use: [&#123;</span><br><span class="line">        loader: <span class="string">"js-to-less-loader"</span></span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="sass-loader"><a href="#sass-loader" class="headerlink" title="sass-loader"></a>sass-loader</h2><p>将 scss 文件编译成 css 文件。node-sass 插件会作为 sass-loader 的 peerDependency，因此安装 sass-loader 的时候会自动安装 node-sass 插件。</p>
<p>options 配置参考 <a href="http://lesscss.org/usage/#command-line-usage-options" target="_blank" rel="noopener">node-sass</a>。</p>
<p>sass-loader 中，url(…) 语法将相对于网站的根目录查找(没有 css-loader)，或相对 scss 文件查找(有 css-loader)。有 css-loader 场景，可通过 resolve-url-loader 加载器获得相对 scss 文件的 url。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">      use: [&#123;</span><br><span class="line">        loader: <span class="string">"style-loader"</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        loader: <span class="string">"css-loader"</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        loader: <span class="string">"sass-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          includePaths: [],<span class="comment">// 文件路径，如 ["absolute/path/a", "absolute/path/b"]</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="dynamic-css-loader"><a href="#dynamic-css-loader" class="headerlink" title="dynamic-css-loader"></a>dynamic-css-loader</h2><p>对 css 文件中的 import 语句，采用动态加载的方式。结合 extract-text-webpack-plugin, file-loader, extract-loader 使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/.../</span>,</span><br><span class="line">  use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">    use: [ ... ],</span><br><span class="line">    fallback: [</span><br><span class="line">      <span class="string">'dynamic-css-loader'</span>,</span><br><span class="line">      <span class="string">'file-loader'</span>,</span><br><span class="line">      <span class="string">'extract-loader'</span>,</span><br><span class="line">    ],</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="file-loader"><a href="#file-loader" class="headerlink" title="file-loader"></a>file-loader</h2><p>支持 import, require 加载文件，返回文件的 url。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'file-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            name: [hash].[ext],<span class="comment">// 文件名，模板字符串，支持占位符 ext 扩展名，name 文件名，path 相对于 context 的路径，hash 哈希值，N 当前文件名按照查询参数 regExp 匹配后获得到第 N 个匹配结果，等</span></span><br><span class="line">            context: <span class="keyword">this</span>.options.context,<span class="comment">// 文件查找的基本路径，默认为 webpack 配置项的 context</span></span><br><span class="line">            publicPath: __webpack_public_path__,<span class="comment">// 文件的 public path，默认为 webpack 配置项的 publicPath</span></span><br><span class="line">            outputPath: <span class="literal">undefined</span>,<span class="comment">// 文件导出目录</span></span><br><span class="line">            useRelativePath: <span class="literal">false</span>,<span class="comment">// 设置为真值时，生成 url 相对于 context</span></span><br><span class="line">            emitFile: <span class="literal">true</span><span class="comment">// 为真值时处理文件，为否值只获取 url</span></span><br><span class="line">          &#125;  </span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="url-loader"><a href="#url-loader" class="headerlink" title="url-loader"></a>url-loader</h2><p>基本功能同 file-loader，但当文件不大时，以 DataUrl 形式嵌入 html 页面中，避免请求服务器资源。DataUrl 主要实现为，将图片编码为 base64，存储在 url 中，并冠以 mime-type。base64 编码的数据体积通常是原数据的体积 4/3，且不会被浏览器缓存。缓存问题可通过 css 背景图片解决，图片资源嵌入 url(…) 语句，随 css 文件一同缓存在浏览器端。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="literal">undefined</span>,<span class="comment">// 文件大于 limit 值，使用 file-loader 加载；小于，使用 url-loader，如 limit: 8192</span></span><br><span class="line">              mimetype: <span class="string">"extname"</span>,<span class="comment">// 设置文件的 mime-type，默认通过扩展名获取</span></span><br><span class="line">              prefix: <span class="literal">false</span><span class="comment">// 提供给 file-loader 使用</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="html-loader"><a href="#html-loader" class="headerlink" title="html-loader"></a>html-loader</h2><p>处理 html 文件中的图片链接 img:src 等属性，需要结合 url-loader, file-loader 使用。</p>
<p>html-loader 只作字符处理，如 ‘Text <img src="image.png"><img src="~bootstrap-img"> Text’ 将转换为 ‘module.exports = “Text <img src="\\""" +="" require(".="" image.png")="" "\\"=""><img src="\\""" +="" require("bootstrap-img")="" "\\"=""> Text”;’</p>
<p>因此，若要导出 html 页面，需要配合 file-loader, extract-loader 使用。extract-loader 将 js 转换为 html，file-loader 输出 html 文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// html-loader 加载器选项，也可以设置在 webpackConfig 的 htmlLoader, otherHtmlLoaderConfig 属性中，加载时指定 config，如 html-loader?config=otherHtmlLoaderConfig</span></span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(html)$/</span>,</span><br><span class="line">  use: &#123;</span><br><span class="line">    loader: <span class="string">'html-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      attrs: [<span class="string">'img:src'</span>],<span class="comment">// 待处理的标签，如 ':data-src'。设置为 false，禁用对标签属性的处理。设置为 'img:src'，url-loader, file-loader 导出的链接赋值给 src 属性；设置为 ':data-src'，url-loader, file-loader 导出的链接赋值给 data-src 属性</span></span><br><span class="line">      minimize: <span class="literal">false</span>,<span class="comment">// 最小化输出</span></span><br><span class="line">      removeComments: <span class="literal">false</span>,<span class="comment">// 最小化选项</span></span><br><span class="line">      removeCommentsFromCDATA: <span class="literal">false</span>,</span><br><span class="line">      removeCDATASectionsFromCDATA: <span class="literal">false</span>,</span><br><span class="line">      collapseWhitespace: <span class="literal">false</span>,</span><br><span class="line">      conservativeCollapse: <span class="literal">false</span>,</span><br><span class="line">      removeAttributeQuotes: <span class="literal">false</span>,</span><br><span class="line">      useShortDoctype: <span class="literal">false</span>,</span><br><span class="line">      keepClosingSlash: <span class="literal">false</span>,</span><br><span class="line">      minifyJS: <span class="literal">false</span>,</span><br><span class="line">      minifyCSS: <span class="literal">false</span>,</span><br><span class="line">      removeScriptTypeAttributes: <span class="literal">false</span>,</span><br><span class="line">      removeStyleTypeAttributes: <span class="literal">false</span>,</span><br><span class="line">      root: <span class="literal">false</span>,<span class="comment">// 设置为 true 时，&lt;img src="/image.jpg"&gt; 中 src 属性将自动拼接网站根目录</span></span><br><span class="line">      interpolate: <span class="literal">false</span>,<span class="comment">// 设置为 true 时，自动转换 es6 模板字符串 $&#123;&#125;；设置为 'require'，只能在模板内使用 require。如 &lt;#list list as list&gt;&lt;a href="$&#123;list.href!&#125;" /&gt;$&#123;list.name&#125;&lt;/a&gt;&lt;/#list&gt;</span></span><br><span class="line">      exportAsDefault: <span class="literal">false</span>,<span class="comment">// 以 es5 格式导出 exports.default = "Hello world"; 默认导出格式为 module.exports = "Hello world";</span></span><br><span class="line">      exportAsEs6Default: <span class="literal">false</span>,<span class="comment">// 以 es6 格式导出 export default "Hello world";</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="raw-loader"><a href="#raw-loader" class="headerlink" title="raw-loader"></a>raw-loader</h2><p>将文件导入为字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.txt$/</span>,</span><br><span class="line">  loader: <span class="string">'raw-loader'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="i18n-loader"><a href="#i18n-loader" class="headerlink" title="i18n-loader"></a>i18n-loader</h2><p>将所有语言包加载到一个对象中，并根据 window.navigator.userLanguage 或 window.navigator.language 区分语言包。i18n/choose 模块用于选择正确的语言包，i18n/concat 模块将拼接所有合适的地区，i18n/merge 将所有语言包合并到对象中，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> locale = <span class="built_in">require</span>(<span class="string">"./colors.i18.json"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待准备就绪，在一个 web 项目中所有地区只需要一次</span></span><br><span class="line"><span class="comment">// 因为所有地区的语言被合并到一个块中</span></span><br><span class="line">locale(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(locale);<span class="comment">// 打印语言包</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.i18$/</span>,</span><br><span class="line">  use: [&#123;</span><br><span class="line">    loader: <span class="string">'i18n-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      locales: [],<span class="comment">// 将所有语言包打包到一个对象中，如 [ "de", "de-de", "fr" ]，同时开启同步加载模式</span></span><br><span class="line">      bundleTogether: <span class="literal">false</span><span class="comment">// 是否禁止所有语言包打包在一起</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    loader: <span class="string">'json-loader'</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="json-loader"><a href="#json-loader" class="headerlink" title="json-loader"></a>json-loader</h2><p>webpack 2 起，将自动导入json。若使用不同的扩展名，仍可使用 json-loader 导入 json 数据。</p>
<h2 id="json5-loader"><a href="#json5-loader" class="headerlink" title="json5-loader"></a>json5-loader</h2><p>用于导入 json5 文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.json5$/</span>,</span><br><span class="line">  loader: <span class="string">'json5-loader'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="svg-inline-loader"><a href="#svg-inline-loader" class="headerlink" title="svg-inline-loader"></a>svg-inline-loader</h2><p>用于导入 svg。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.svg$/</span>,</span><br><span class="line">  use: [&#123;</span><br><span class="line">    loader: <span class="string">'svg-inline-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      removeTags: <span class="literal">false</span>,<span class="comment">// 删除指定的标签和它的子元素，布尔型</span></span><br><span class="line">      removingTags: [],<span class="comment">// 待删除的标签，需要 removeTags 属性置为真，如 ['title', 'desc', 'defs', 'style']</span></span><br><span class="line">      warnTags: [],<span class="comment">// 警告标签</span></span><br><span class="line">      removeSVGTagAttrs: <span class="literal">true</span>,<span class="comment">// 是否删除 &lt;svg /&gt; 的 width 和 height 属性</span></span><br><span class="line">      removingTagAttrs: [],<span class="comment">// 删除内部的 &lt;svg /&gt;的属性</span></span><br><span class="line">      warnTagAttrs: [],<span class="comment">// 在console发出关于内部 &lt;svg /&gt; 属性的警告</span></span><br><span class="line">      classPrefix: <span class="literal">false</span>,<span class="comment">// svg 标签 class 添加前缀，避免命名冲突，可选值 true 或 字符串</span></span><br><span class="line">      idPrefix: <span class="literal">false</span><span class="comment">// svg 标签 id 添加前缀，避免命名冲突，可选值 true 或 字符串</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="null-loader"><a href="#null-loader" class="headerlink" title="null-loader"></a>null-loader</h2><p>使打包文件不包含部分类库额外引入的依赖。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: path.resolve(__dirname, <span class="string">'node_modules/library/polyfill.js'</span>),</span><br><span class="line">  loader: <span class="string">'null-loader'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="bundle-loader"><a href="#bundle-loader" class="headerlink" title="bundle-loader"></a>bundle-loader</h2><p>通过 require.ensure 方法实现文件的异步加载，设置回调对文件作处理，回调可设置多个。当文件加载完成后，执行回调；当回调在文件加载完成后添加，立即执行回调。为了同其他脚本作区分，配置时 test 属性可设置为 /.bundle.js$/。效果如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> load <span class="keyword">from</span> <span class="string">'test.bundle.js'</span>;</span><br><span class="line"></span><br><span class="line">load(<span class="function"><span class="params">file</span> =&gt;</span> &#123;&#125;);<span class="comment">// 首次调用文件后加载回调</span></span><br></pre></td></tr></table></figure>
<h2 id="coffee-loader"><a href="#coffee-loader" class="headerlink" title="coffee-loader"></a>coffee-loader</h2><p>编译 CoffeeScript。选项包含 literate = false 编译在 Markdown 中书写的 CoffeeScript 脚本，sourceMap = false 是否启用 source-map，transpile = false 配置 babel-preset 及 babel-plugin。</p>
<h2 id="coffee-redux-loader"><a href="#coffee-redux-loader" class="headerlink" title="coffee-redux-loader"></a>coffee-redux-loader</h2><p>编译 CoffeeScript。终极版???</p>
<h2 id="jshint-loader"><a href="#jshint-loader" class="headerlink" title="jshint-loader"></a>jshint-loader</h2><p>jshint 语法检查。jshint-loader 选项配置参考：<a href="http://jshint.com/docs/options/。" target="_blank" rel="noopener">http://jshint.com/docs/options/。</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      enforce: <span class="string">"pre"</span>, <span class="comment">// 预先加载 jshint loader</span></span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      use: [&#123;</span><br><span class="line">        loader: <span class="string">"jshint-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          camelcase: <span class="literal">true</span>,</span><br><span class="line">          emitErrors: <span class="literal">false</span>,<span class="comment">// jshint 默认显示警告类信息，emitErrors设为 true 将置为错误类信息</span></span><br><span class="line">          failOnHint: <span class="literal">false</span>,<span class="comment">// 设置为真值时，jshint 报错将打断 webpack 函数</span></span><br><span class="line">          reporter: <span class="function"><span class="keyword">function</span>(<span class="params">errors</span>) </span>&#123; &#125;<span class="comment">// 自定义报告函数，errors 为数组形式 [&#123; id, code, reason, evidence, line, character, scope &#125;]; 其中，reason 为错误消息，evidence 为错误编码，scope 为消息作用域。函数中，调用 this.emitWarning(...) 或 this.emitError(...) 显示消息。由 webpack 提供上下文 this</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="mocha-loader"><a href="#mocha-loader" class="headerlink" title="mocha-loader"></a>mocha-loader</h2><p>加载时运行 mocha 测试。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  rules: [&#123;</span><br><span class="line">    test: <span class="regexp">/test\.js$/</span>,</span><br><span class="line">    use: <span class="string">'mocha-loader'</span>,</span><br><span class="line">    exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="istanbul-instrumenter-loader"><a href="#istanbul-instrumenter-loader" class="headerlink" title="istanbul-instrumenter-loader"></a>istanbul-instrumenter-loader</h2><p>加载时运行 karam 测试。</p>
<p>参考文档：<br><a href="https://github.com/webpack-contrib/karma-webpack" target="_blank" rel="noopener">karma-webpack</a><br><a href="https://github.com/mattlewis92/karma-coverage-istanbul-reporter" target="_blank" rel="noopener">karma-coverage-istanbul-reporter</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.js$|\.jsx$/</span>,</span><br><span class="line">  use: &#123;</span><br><span class="line">    loader: <span class="string">'istanbul-instrumenter-loader'</span>,</span><br><span class="line">    options: &#123; </span><br><span class="line">      debug: <span class="literal">false</span>,<span class="comment">// 开启 debug 模式</span></span><br><span class="line">      compact: <span class="literal">true</span>,<span class="comment">// 生成压缩后代码</span></span><br><span class="line">      autoWrap: <span class="literal">false</span>,<span class="comment">// 函数外是否允许返回语句</span></span><br><span class="line">      esModules: <span class="literal">false</span>,<span class="comment">// ES2015 书写代码</span></span><br><span class="line">      coverageVariable: <span class="string">'__coverage__'</span>,<span class="comment">// 全局覆盖率变量名</span></span><br><span class="line">      preserveComments: <span class="literal">false</span>,<span class="comment">// 输出中保留注释</span></span><br><span class="line">      produceSourceMap: <span class="literal">false</span>,<span class="comment">// 生成 source-map</span></span><br><span class="line">      sourceMapUrlCallback: <span class="literal">null</span><span class="comment">// source-map url 查询后的回调</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  enforce: <span class="string">'post'</span>,</span><br><span class="line">  exclude: <span class="regexp">/node_modules|\.spec\.js$/</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="coverjs-loader"><a href="#coverjs-loader" class="headerlink" title="coverjs-loader"></a>coverjs-loader</h2><p>用于测试???</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cover-my-client-tests.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"./my-client-tests"</span>);</span><br><span class="line"></span><br><span class="line">after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">"cover-loader"</span>).reportHtml();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="exports-loader"><a href="#exports-loader" class="headerlink" title="exports-loader"></a>exports-loader</h2><p>exports 插入属性，或者赋值 module.exports。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"exports-loader?file,parse=helpers.parse!./file.js"</span>);</span><br><span class="line"><span class="comment">// adds below code to the file's source:</span></span><br><span class="line"><span class="comment">//  exports["file"] = file;</span></span><br><span class="line"><span class="comment">//  exports["parse"] = helpers.parse;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"exports-loader?file!./file.js"</span>);</span><br><span class="line"><span class="comment">// adds below code to the file's source:</span></span><br><span class="line"><span class="comment">//  module.exports = file;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"exports-loader?[name]!./file.js"</span>);</span><br><span class="line"><span class="comment">// adds below code to the file's source:</span></span><br><span class="line"><span class="comment">//  module.exports = file;</span></span><br></pre></td></tr></table></figure>
<h2 id="expose-loader"><a href="#expose-loader" class="headerlink" title="expose-loader"></a>expose-loader</h2><p>暴露全局变量，注入到 global 对象中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"expose-loader?$!jquery"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [&#123;</span><br><span class="line">    test: <span class="built_in">require</span>.resolve(<span class="string">'jquery'</span>),</span><br><span class="line">    use: [&#123;</span><br><span class="line">      loader: <span class="string">'expose-loader'</span>,</span><br><span class="line">      options: <span class="string">'jQuery'</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      loader: <span class="string">'expose-loader'</span>,</span><br><span class="line">      options: <span class="string">'$'</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="imports-loader"><a href="#imports-loader" class="headerlink" title="imports-loader"></a>imports-loader</h2><p>自动为文件注入局部变量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [&#123;</span><br><span class="line">    test: <span class="regexp">/test\/.js/</span></span><br><span class="line">    use: [&#123;</span><br><span class="line">      loader: <span class="string">'imports-loader'</span>,</span><br><span class="line">      options: &#123;&#125;<span class="comment">// 注入变量，如 &#123; angular: true &#125; 将注入 angular 类库；&#123; $: 'jquery' &#125; 将注入 jquery；&#123; config: '&gt;&#123; size: 50 &#125;' &#125; 将赋值 config = &#123; size: 50 &#125; 等</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="gzip-loader"><a href="#gzip-loader" class="headerlink" title="gzip-loader"></a>gzip-loader</h2><p>加载 gzip 压缩资源。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.gz$/</span>,</span><br><span class="line">        enforce: <span class="string">'pre'</span>,</span><br><span class="line">        use: <span class="string">'gzip-loader'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="yaml-frontmatter-loader"><a href="#yaml-frontmatter-loader" class="headerlink" title="yaml-frontmatter-loader"></a>yaml-frontmatter-loader</h2><p>将 yaml 转化为 json。</p>
<h2 id="react-proxy-loader"><a href="#react-proxy-loader" class="headerlink" title="react-proxy-loader"></a>react-proxy-loader</h2><p>通过 require.ensure 按需加载文件组件。组件实例 mixins 属性注入代理组件 require(‘react-proxy-loader!./a.js’).Mixin，在当前组件中调用loadComponent 即可获取 a.js 导出的组件，a.js 文件尚未加载完成，调用开发者配置的 renderUnavailable 方法进行渲染。或者，直接将 require(‘react-proxy-loader!./a.js’) 作为组件使用，a.js 文件尚未加载完成，render 方法返回 null。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Component = <span class="built_in">require</span>(<span class="string">"react-proxy-loader!./Component"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ComponentProxyMixin = <span class="built_in">require</span>(<span class="string">"react-proxy-loader!./Component"</span>).Mixin;</span><br><span class="line"><span class="keyword">var</span> ComponentProxy = React.createClass(&#123;</span><br><span class="line">	mixins: [ComponentProxyMixin],</span><br><span class="line">	renderUnavailable: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="script-loader"><a href="#script-loader" class="headerlink" title="script-loader"></a>script-loader</h2><p>在全局上下文中执行一次 js 脚本，加载时即执行。</p>
<h2 id="source-map-loader"><a href="#source-map-loader" class="headerlink" title="source-map-loader"></a>source-map-loader</h2><p>从 js 入口文件中提取 source-map 文件(该文件的内容由 webpackConfig devtool 配置项限定)。可设置 include, exclude 选项。</p>
<h2 id="cache-loader"><a href="#cache-loader" class="headerlink" title="cache-loader"></a>cache-loader</h2><p>在性能开销较大的 loader 前加载 cache-loader，可以将编译结果缓存到磁盘中，如 babel-loader 前。options 有 cacheDirectory 缓存目录，默认为 path.resolve(‘.cache-loader’)。</p>
<h2 id="worker-loader"><a href="#worker-loader" class="headerlink" title="worker-loader"></a>worker-loader</h2><p>将 js 转化为 webworker，父子线程间通信???</p>
<p>webworker 参考文档：<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API。" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API。</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file.js</span></span><br><span class="line"><span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'lodash'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o = &#123;<span class="attr">foo</span>: <span class="string">'foo'</span>&#125;</span><br><span class="line"></span><br><span class="line">_.has(o, <span class="string">'foo'</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将数据发送到父线程(parent thread)</span></span><br><span class="line">self.postMessage(&#123;<span class="attr">foo</span>: <span class="string">'foo'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应来自父线程(parent thread)的消息</span></span><br><span class="line">self.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123; <span class="built_in">console</span>.log(event); &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">var</span> MyWorker = <span class="built_in">require</span>(<span class="string">"worker-loader!./file.js"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> MyWorker();</span><br><span class="line">worker.postMessage(&#123;<span class="attr">a</span>: <span class="number">1</span>&#125;);</span><br><span class="line">worker.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;...&#125;;</span><br><span class="line">worker.addEventListener(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;...&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="multi-loader"><a href="#multi-loader" class="headerlink" title="multi-loader"></a>multi-loader</h2><p>控制多个加载器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> multi = <span class="built_in">require</span>(<span class="string">"multi-loader"</span>);</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      loader: multi(<span class="comment">// multi 参数中 loader 顺序执行，即先解析 css，再以字符串输出</span></span><br><span class="line">        <span class="string">"style-loader!css-loader!autoprefixer-loader"</span>,</span><br><span class="line">        <span class="string">"raw-loader"</span></span><br><span class="line">      )</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="thread-loader"><a href="#thread-loader" class="headerlink" title="thread-loader"></a>thread-loader</h2><p>作为前置 loader，将使之后的 loader 运行在独立的线程池中。但这些后置的 loader 不能产生新的文件，不能使用定制的 loader API，无法获取 webpack 的选项设置???</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">"thread-loader"</span>,</span><br><span class="line">      options: &#123;<span class="comment">// 有同样配置的 loader 会共享一个 worker 池(worker pool)</span></span><br><span class="line">        workers: <span class="number">2</span>,<span class="comment">// 产生的 worker 的数量，默认是 cpu 的核心数</span></span><br><span class="line">        workerParallelJobs: <span class="number">50</span>,<span class="comment">// 一个 worker 进程中并行执行工作的数量，默认为 20</span></span><br><span class="line">        workerNodeArgs: [<span class="string">'--max-old-space-size'</span>, <span class="string">'1024'</span>],<span class="comment">// 额外的 node.js 参数</span></span><br><span class="line">        poolTimeout: <span class="number">2000</span>,<span class="comment">// 闲置时定时删除 worker 进程，默认为 500ms。可以设置为无穷大， 这样在监视模式(--watch)下可以保持 worker 持续存在</span></span><br><span class="line">        poolParallelJobs: <span class="number">50</span>,<span class="comment">// 池(pool)分配给 worker 的工作数量，默认为 200。降低这个数值会降低总体的效率，但是会提升工作分布更均一</span></span><br><span class="line">        name: <span class="string">"my-pool"</span><span class="comment">// 池(pool)的名称，可以修改名称来创建其余选项都一样的池(pool)</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"expensive-loader"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预热 worker 池(worker pool)来防止启动 worker 时的高延时。这会启动池(pool)内最大数量的 worker 并把指定的模块载入 node.js 的模块缓存中</span></span><br><span class="line"><span class="keyword">const</span> threadLoader = <span class="built_in">require</span>(<span class="string">'thread-loader'</span>);</span><br><span class="line">threadLoader.warmup(options, [</span><br><span class="line">  <span class="string">'babel-loader'</span>,</span><br><span class="line">  <span class="string">'babel-preset-es2015'</span>,</span><br><span class="line">  <span class="string">'sass-loader'</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<h2 id="transform-loader"><a href="#transform-loader" class="headerlink" title="transform-loader"></a>transform-loader</h2><p>应用 browserify transforms???</p>
<p>browserify transforms 参考文档：<a href="https://github.com/browserify/browserify/wiki/list-of-transforms" target="_blank" rel="noopener">https://github.com/browserify/browserify/wiki/list-of-transforms</a></p>
<h2 id="val-loader"><a href="#val-loader" class="headerlink" title="val-loader"></a>val-loader</h2><p>根据输入加载不同文件，交由下一个中间件???</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ask = <span class="built_in">require</span>(<span class="string">'./ask.js'</span>);</span><br><span class="line"><span class="keyword">const</span> generateResult = <span class="built_in">require</span>(<span class="string">'./generateResult.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findAnswer</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ask(options.question)</span><br><span class="line">    .then(generateResult)</span><br><span class="line">    .then(<span class="function"><span class="params">result</span> =&gt;</span> (&#123;</span><br><span class="line">      code: result.code,</span><br><span class="line">      sourceMap: result.sourceMap,</span><br><span class="line">      ast: result.abstractSyntaxTree,<span class="comment">// 下一个 loader 使用相同的 ast，可以提升编译速度</span></span><br><span class="line">      dependencies: [<span class="comment">// 默认为 []，需要监听这些文件的变更</span></span><br><span class="line">        <span class="built_in">require</span>.resolve(<span class="string">'./ask.js'</span>),</span><br><span class="line">        <span class="built_in">require</span>.resolve(<span class="string">'./generateResult.js'</span>)</span><br><span class="line">      ],.</span><br><span class="line">      cacheable: <span class="literal">true</span><span class="comment">// 依赖没有变更时，使用缓存</span></span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = findAnswer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="built_in">require</span>.resolve(<span class="string">'path/to/findAnswer.js'</span>),</span><br><span class="line">      use: [&#123;</span><br><span class="line">        loader: <span class="string">'val-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          question: <span class="string">'What is the meaning of life?'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/03/浅析webpack-merge源码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/03/浅析webpack-merge源码/" itemprop="url">浅析webpack-merge源码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-03T14:48:30+08:00">2018-02-03</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/" itemprop="url" rel="index"><span itemprop="name">前端工程化</span></a></span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/03/浅析webpack-merge源码/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/03/浅析webpack-merge源码/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="merge方法"><a href="#merge方法" class="headerlink" title="merge方法"></a>merge方法</h2><p>webpack-merge 类库的 merge 方法基于 lodash 类库的 mergeWith 方法实现。</p>
<p>mergeWith 方法用于遍历数组项或对象属性，通过尾参 customizer 定制化数据处理函数，获得新的数组项或对象属性。customizer 函数的参数为 (objValue, srcValue, key, object, source, stack)。</p>
<p>webpack-merge 通过 join-arrays 模块导出的 joinArrays 函数将用户配置项 { customizeArray, customizeObject } 对象构建为 customizer 函数生成器。customizer 函数的处理逻辑为：当 objValue, srcValue 为函数时，该函数的返回值由 customizer 函数再次处理。当 objValue, srcValue 为数组时，通过 customizeArray 函数处理，参数为（objValue, srcValue, key）；若 customizeArray 函数未定义，合并数组项。当 objValue, srcValue 为对象时，通过 customizeObject 函数处理，若无返回值或 customizeObject 函数未定义，构建新的key值，调用 joinArrays 函数将 { customizeArray, customizeObject } 配置项转化成内层数据处理函数，并对 objValue, srcValue 的子孙属性深度处理。除此而外，深拷贝 source 或者将 source 作为返回值。特别的，当 customizeArray, customizeObject 函数均未作配置时，customizer 函数作深拷贝处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">joinArrays</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  customizeArray,</span></span></span><br><span class="line"><span class="function"><span class="params">  customizeObject,</span></span></span><br><span class="line"><span class="function"><span class="params">  key</span></span></span><br><span class="line"><span class="function"><span class="params">&#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">_joinArrays</span>(<span class="params">a, b, k</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> newKey = key ? <span class="string">`<span class="subst">$&#123;key&#125;</span>.<span class="subst">$&#123;k&#125;</span>`</span> : k;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isFunction(a) &amp;&amp; isFunction(b)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> _joinArrays(a(...args), b(...args), k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isArray(a) &amp;&amp; isArray(b)) &#123;</span><br><span class="line">      <span class="keyword">const</span> customResult = customizeArray &amp;&amp; customizeArray(a, b, newKey);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> customResult || [...a, ...b];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isPlainObject(a) &amp;&amp; isPlainObject(b)) &#123;</span><br><span class="line">      <span class="keyword">const</span> customResult = customizeObject &amp;&amp; customizeObject(a, b, newKey);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 第二层以同样的逻辑处理，如 'module.rules'等</span></span><br><span class="line">      <span class="keyword">return</span> customResult || mergeWith(&#123;&#125;, a, b, joinArrays(&#123;</span><br><span class="line">        customizeArray,</span><br><span class="line">        customizeObject,</span><br><span class="line">        key: newKey</span><br><span class="line">      &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isPlainObject(b)) &#123;</span><br><span class="line">      <span class="keyword">return</span> cloneDeep(b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在此基础上，webpack-merge 实现了 merge 方法。该方法支持单参数，通过接受{ customizeArray, customizeObject } 对象，返回值用于对数据（格式可以是数组，或多参数）做处理；也支持多参数，数据处理模式即为深拷贝。</p>
<h2 id="multiple-方法"><a href="#multiple-方法" class="headerlink" title="multiple 方法"></a>multiple 方法</h2><p>multiple 方法在 merge 方法的基础上构建，首先通过 merge 方法将配置数据复合为一，然后通过 lodash.values 方法以数组形式返回复合对象各属性的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> baseConfig = &#123;</span><br><span class="line">    server: &#123;</span><br><span class="line">      target: <span class="string">'node'</span>,</span><br><span class="line">      output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'lib.node.js'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    client: &#123;</span><br><span class="line">      output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'lib.js'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// specialized configuration</span></span><br><span class="line"><span class="keyword">var</span> production = &#123;</span><br><span class="line">    client: &#123;</span><br><span class="line">      output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'[name].[hash].js'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// output</span></span><br><span class="line">[&#123;</span><br><span class="line">  target: <span class="string">'node'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'lib.node.js'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,&#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'[name].[hash].js'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
<h2 id="unique-方法"><a href="#unique-方法" class="headerlink" title="unique 方法"></a>unique 方法</h2><p>unique 方法通过 lodash 类库的 differenceWith 方法实现。differenceWith 方法接受参数为 (array, values, comparator)，通过遍历 array 数组项，并调用 comparator 函数将数组项和 values 数组比较，将返回否值的数组项构建成新的数组。unique 方法用于构建 customizeArray 配置函数，且其接受参数为 (key, uniques, getter)，key 即属性名，uniques, getter 参数用于构建 differenceWith 方法中的参数 comparator。若getter返回值已存在 uniques 中，comparator 返回真值；否则返回否值，即该数组项拷贝到新数组中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// unique 方法源码</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeUnique</span>(<span class="params">key, uniques, getter = a =&gt; a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">a, b, k</span>) =&gt;</span> (</span><br><span class="line">    k === key &amp;&amp; [</span><br><span class="line">      ...a,</span><br><span class="line">      ...differenceWith(</span><br><span class="line">        b, a, item =&gt; uniques.indexOf(getter(item)) &gt;= <span class="number">0</span></span><br><span class="line">      )</span><br><span class="line">    ]</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// unique 方法使用</span></span><br><span class="line"><span class="comment">// 需要注意的是，若首个 plugins 中没有 HotModuleReplacementPlugin 构造函数</span></span><br><span class="line"><span class="comment">// 第二个 plugins 中的HotModuleReplacementPlugin 也不会拷贝到新数组中</span></span><br><span class="line"><span class="keyword">const</span> output = merge(&#123;</span><br><span class="line">  customizeArray: merge.unique(</span><br><span class="line">    <span class="string">'plugins'</span>,</span><br><span class="line">    [<span class="string">'HotModuleReplacementPlugin'</span>],</span><br><span class="line">    plugin =&gt; plugin.constructor &amp;&amp; plugin.constructor.name</span><br><span class="line">  )</span><br><span class="line">&#125;)(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="strategy-方法"><a href="#strategy-方法" class="headerlink" title="strategy 方法"></a>strategy 方法</h2><p>strategy 方法在 merge 方法基础上实现，通过配置项 rules 构建 { customizeArray, customizeObject } 对象，最终生成 customizer 数据处理函数。rules 以对象形式配置，定义了数据处理策略，其中，’prepend’ 为反向深拷贝，’replace’ 替换，默认为 ‘append’ 即正向深拷贝。与 merge 方法相同，rules 可以设置深度嵌套属性的处理规则，如 ‘module.rules’: ‘prepend’。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mergeStrategy = <span class="function">(<span class="params">rules = &#123;&#125;</span>) =&gt;</span> merge(&#123;</span><br><span class="line">  customizeArray: customizeArray(rules),</span><br><span class="line">  customizeObject: customizeObject(rules)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">customizeArray</span>(<span class="params">rules</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">a, b, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (rules[key]) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'prepend'</span>:</span><br><span class="line">        <span class="keyword">return</span> [...b, ...a];</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'replace'</span>:</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">      <span class="keyword">default</span>: <span class="comment">// append</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">customizeObject</span>(<span class="params">rules</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">a, b, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (rules[key]) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'prepend'</span>:</span><br><span class="line">        <span class="keyword">return</span> mergeWith(&#123;&#125;, b, a, joinArrays());</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'replace'</span>:</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">      <span class="keyword">default</span>: <span class="comment">// append</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="smart-方法"><a href="#smart-方法" class="headerlink" title="smart 方法"></a>smart 方法</h2><p>smart 方法为处理 module.rules 配置项而设计。首先提取 module.rules 数组，交由 lodash 模块的 unionWith 方法处理。unionWith 方法接受参数为 (…array, compator)，comparator(arrVal, othVal) 函数返回 false 时保留两个数组项，返回真值只保留 arrVal。特别的，comparator 执行过程中，可对引用对象 arrVal 进行再度插值操作，使其具有 othVal 的特性。为此，webpack-merge 类库构造了 uniteRules 函数对 module.rules 数组项进行处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mergeSmart = merge(&#123;</span><br><span class="line">  customizeArray: <span class="function">(<span class="params">a, b, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isRule(key.split(<span class="string">'.'</span>).slice(<span class="number">-1</span>)[<span class="number">0</span>])) &#123;</span><br><span class="line">      <span class="keyword">return</span> unionWith(a, b, uniteRules.bind(<span class="literal">null</span>, &#123;&#125;, key));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>uniteRules 函数接受参数为 {rules, key, newRule, rule}，其中 rules 用于配置 module.rules 合并策略，如 { rules.use: ‘prepend’ | ‘append’ | ‘replace’ }，key 即 ‘rules’，newRule, rule 为待合并的两个加载器配置项。uniteRules 函数的处理逻辑为：首先比较 newRule, rule 的 test, include, exclude, enforce, query 查询字符串，是否跳过合并；其次，将 newRule.loader 配置项赋给rule，作为返回值，因为无论 ‘prepend’ | ‘append’ | ‘replace’ 策略，都将返回 newRule.loader；其次将 rule.loader 转换为 [{ loader }]数组，同时newRule.use, rule.use 也转换为 [{ loader }] 数组，该数组同名 loader 将会被合并。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uniteRules</span>(<span class="params">rules, key, newRule, rule</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">String</span>(rule.test) !== <span class="built_in">String</span>(newRule.test)</span><br><span class="line">      || ((newRule.enforce || rule.enforce) &amp;&amp; rule.enforce !== newRule.enforce)</span><br><span class="line">      || (newRule.include &amp;&amp; !isSameValue(rule.include, newRule.include))</span><br><span class="line">      || (newRule.exclude &amp;&amp; !isSameValue(rule.exclude, newRule.exclude))) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!rule.test &amp;&amp; !rule.include &amp;&amp; !rule.exclude</span><br><span class="line">      &amp;&amp; (rule.loader &amp;&amp; rule.loader.split(<span class="string">'?'</span>)[<span class="number">0</span>]) !== (newRule.loader &amp;&amp; newRule.loader.split(<span class="string">'?'</span>)[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="comment">// Don't merge the rule if there isn't any identifying fields and the loaders don't match</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((rule.include || rule.exclude) &amp;&amp; (!newRule.include &amp;&amp; !newRule.exclude)) &#123;</span><br><span class="line">    <span class="comment">// Don't merge child without include/exclude to parent that has either</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// newRule.loader should always override</span></span><br><span class="line">  <span class="keyword">if</span> (newRule.loader) &#123;</span><br><span class="line">    <span class="keyword">const</span> optionsKey = newRule.options ? <span class="string">'options'</span> : newRule.query &amp;&amp; <span class="string">'query'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> rule.use;</span><br><span class="line">    <span class="keyword">delete</span> rule.loaders;</span><br><span class="line">    rule.loader = newRule.loader;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (optionsKey) &#123;</span><br><span class="line">      rule[optionsKey] = newRule[optionsKey];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((rule.use || rule.loaders || rule.loader) &amp;&amp; (newRule.use || newRule.loaders)) &#123;</span><br><span class="line">    <span class="keyword">const</span> expandEntry = <span class="function"><span class="params">loader</span> =&gt;</span> (</span><br><span class="line">      <span class="keyword">typeof</span> loader === <span class="string">'string'</span> ? &#123; loader &#125; : loader</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// this is only here to avoid breaking existing tests</span></span><br><span class="line">    <span class="keyword">const</span> unwrapEntry = <span class="function"><span class="params">entry</span> =&gt;</span> (</span><br><span class="line">      !entry.options &amp;&amp; !entry.query ? entry.loader : entry</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> entries;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将 &#123; loader &#125; 转化成 [&#123; loader, option?, query? &#125;]数组</span></span><br><span class="line">    <span class="keyword">if</span> (rule.loader) &#123;</span><br><span class="line">      <span class="keyword">const</span> optionsKey = rule.options ? <span class="string">'options'</span> : rule.query &amp;&amp; <span class="string">'query'</span>;</span><br><span class="line">      entries = [&#123; <span class="attr">loader</span>: rule.loader &#125;];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (optionsKey) &#123;</span><br><span class="line">        entries[<span class="number">0</span>][optionsKey] = rule[optionsKey];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">delete</span> rule.loader;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (optionsKey) &#123;</span><br><span class="line">        <span class="keyword">delete</span> rule[optionsKey];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// rule.use, rule.loaders 数组项若为字符串，转化为 &#123; loader &#125; 对象</span></span><br><span class="line">      entries = [].concat(rule.use || rule.loaders).map(expandEntry);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> newEntries = [].concat(newRule.use || newRule.loaders).map(expandEntry);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> loadersKey = rule.use || newRule.use ? <span class="string">'use'</span> : <span class="string">'loaders'</span>;</span><br><span class="line">    <span class="keyword">const</span> resolvedKey = <span class="string">`<span class="subst">$&#123;key&#125;</span>.<span class="subst">$&#123;loadersKey&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (rules[resolvedKey]) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'prepend'</span>:</span><br><span class="line">        rule[loadersKey] = [</span><br><span class="line">          ...differenceWith(newEntries, entries, uniteEntries),</span><br><span class="line">          ...entries</span><br><span class="line">        ].map(unwrapEntry);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'replace'</span>:</span><br><span class="line">        rule[loadersKey] = newRule.use || newRule.loaders;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        rule[loadersKey] = unionWith(</span><br><span class="line">          <span class="comment">// Remove existing entries so that we can respect the order of the new</span></span><br><span class="line">          <span class="comment">// entries</span></span><br><span class="line">          differenceWith(entries, newEntries, isEqual),</span><br><span class="line">          newEntries,</span><br><span class="line">          uniteEntries</span><br><span class="line">        ).map(unwrapEntry);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (newRule.include) &#123;</span><br><span class="line">    rule.include = newRule.include;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (newRule.exclude) &#123;</span><br><span class="line">    rule.exclude = newRule.exclude;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uniteEntries</span>(<span class="params">newEntry, entry</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> loaderNameRe = <span class="regexp">/^([^?]+)/ig</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [loaderName] = entry.loader.match(loaderNameRe);</span><br><span class="line">  <span class="keyword">const</span> [newLoaderName] = newEntry.loader.match(loaderNameRe);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (loaderName !== newLoaderName) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Replace query values with newer ones</span></span><br><span class="line">  mergeWith(entry, newEntry);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="smartStrategy-方法"><a href="#smartStrategy-方法" class="headerlink" title="smartStrategy 方法"></a>smartStrategy 方法</h2><p>smartStrategy 方法不同于 smart 方法只处理 module.rules 配置项，smartStrategy 方法对整个 webpack 配置进行处理。其中，对 module.rules 配置项，smartStrategy 方法处理逻辑雷同 smart 方法，其他配置项则同 strategy 方法。针对 module.rules 配置项，合并规则 rules 须配置为 { ‘module.rules’: ‘prepend’ | ‘replace’ | ‘append’, ‘module.rules.use’: ‘prepend’ | ‘replace’ | ‘append’ } 形式。’module.rules’ 属性设定 module.rules 合并策略，’module.rules.use’ 属性设定 rule.use 合并策略。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mergeSmartStrategy = <span class="function">(<span class="params">rules = &#123;&#125;</span>) =&gt;</span> merge(&#123;</span><br><span class="line">  customizeArray: <span class="function">(<span class="params">a, b, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> topKey = key.split(<span class="string">'.'</span>).slice(<span class="number">-1</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isRule(topKey)) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (rules[key]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'prepend'</span>:</span><br><span class="line">          <span class="keyword">return</span> [</span><br><span class="line">            ...differenceWith(b, a, (newRule, seenRule) =&gt; (</span><br><span class="line">              uniteRules(rules, key, newRule, seenRule, <span class="string">'prepend'</span>))</span><br><span class="line">            ),</span><br><span class="line">            ...a</span><br><span class="line">          ];</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'replace'</span>:</span><br><span class="line">          <span class="keyword">return</span> b;</span><br><span class="line">        <span class="keyword">default</span>: <span class="comment">// append</span></span><br><span class="line">          <span class="keyword">return</span> unionWith(a, b, uniteRules.bind(<span class="literal">null</span>, rules, key));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> customizeArray(rules)(a, b, key);</span><br><span class="line">  &#125;,</span><br><span class="line">  customizeObject: customizeObject(rules)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>备注：webpack-merge类库主要应用于webpack配置，对于roadhog等类库需要注入babelPlugins、babelPresets配置的，稍显鞭长莫及。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="https://lodash.com/docs" target="_blank" rel="noopener">lodash官方文档</a></p>
<p><a href="https://github.com/survivejs/webpack-merge" target="_blank" rel="noopener">webpack-merge仓库</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/01/webpack配置指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/01/webpack配置指南/" itemprop="url">webpack配置指南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-01T23:14:26+08:00">2018-02-01</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/" itemprop="url" rel="index"><span itemprop="name">前端工程化</span></a></span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端工程化/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/01/webpack配置指南/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/01/webpack配置指南/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="3-10-0"><a href="#3-10-0" class="headerlink" title="3.10.0"></a>3.10.0</h2><p>参考文档：<br><a href="https://webpack.js.org/configuration/" target="_blank" rel="noopener">webpack 3.10.0 官方文档</a><br><a href="http://www.css88.com/doc/webpack" target="_blank" rel="noopener">webpack 3.5.5 中文文档</a></p>
<h3 id="content-上下文"><a href="#content-上下文" class="headerlink" title="content 上下文"></a>content 上下文</h3><p>配置用于定位入口文件、loader的绝对路径，默认为工程目录。在基于webpack开发的打包工具中，content属性可设置为该类库的目录路径，以便于查找该类库加载的loader，入口文件采用绝对路径的方式引入。</p>
<pre><code>context: path.resolve(__dirname, &quot;app&quot;)
</code></pre><h3 id="entry-入口"><a href="#entry-入口" class="headerlink" title="entry 入口"></a>entry 入口</h3><p>配置入口文件，字符串、数组或对象形式（对象属性可以是数组形式）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串形式</span></span><br><span class="line">entry: <span class="string">'./src/app.js'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象形式</span></span><br><span class="line">entry: &#123;</span><br><span class="line">  home: <span class="string">"./home.js"</span>,</span><br><span class="line">  about: <span class="string">"./about.js"</span>,</span><br><span class="line">  contact: <span class="string">"./contact.js"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"></span><br><span class="line">entry: &#123;</span><br><span class="line">  app: <span class="string">'./src/app.js'</span>,</span><br><span class="line">  vendors: [ <span class="string">'react'</span>, <span class="string">'react-dom'</span>, <span class="string">'react-router'</span>, <span class="string">'redux'</span>, <span class="string">'react-redux'</span> ]<span class="comment">// 配置第三方库</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数形式，动态入口</span></span><br><span class="line">entry: <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">'./demo'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">entry: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> resolve([<span class="string">'./demo'</span>, <span class="string">'./demo2'</span>]))</span><br></pre></td></tr></table></figure>
<h3 id="output-输出"><a href="#output-输出" class="headerlink" title="output 输出"></a>output 输出</h3><h4 id="path"><a href="#path" class="headerlink" title="path"></a>path</h4><p>输出目录的绝对路径，如 path: path.resolve(__dirname, ‘/dist’)。</p>
<h4 id="pathinfo"><a href="#pathinfo" class="headerlink" title="pathinfo"></a>pathinfo</h4><p>打包文件是否添加包含模块的注释，默认为false。生产环境需置为false。</p>
<h4 id="publicPath"><a href="#publicPath" class="headerlink" title="publicPath"></a>publicPath</h4><p>浏览器端访问资源时的公开路径，作为前缀。绝对或相对路径形式，如 publicPath: ‘/assets/‘（相对服务器检索资源），页面访问资源为’/assets/spinner.gif’。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">publicPath: <span class="string">"https://cdn.example.com/assets/"</span>, <span class="comment">// CDN（总是 HTTPS 协议）</span></span><br><span class="line">publicPath: <span class="string">"//cdn.example.com/assets/"</span>, <span class="comment">// CDN (协议相同)</span></span><br><span class="line">publicPath: <span class="string">"/assets/"</span>, <span class="comment">// 相对于服务(server-relative)</span></span><br><span class="line">publicPath: <span class="string">"assets/"</span>, <span class="comment">// 相对于 HTML 页面</span></span><br><span class="line">publicPath: <span class="string">"../assets/"</span>, <span class="comment">// 相对于 HTML 页面</span></span><br><span class="line">publicPath: <span class="string">""</span>, <span class="comment">// 相对于 HTML 页面（目录相同）</span></span><br></pre></td></tr></table></figure>
<h4 id="filename"><a href="#filename" class="headerlink" title="filename"></a>filename</h4><p>输出文件名，如 filename: ‘bundle.js’ 或 ‘[name].js’。其中，name占位符会自动填充为待打包脚本的文件名。占位符包含 name 文件名，id 模块标识符，hash 模块标识符的hash值，chunkhash chunk内容的hash值，query 文件名?后面的字符串，下同。</p>
<h4 id="chunkFilename"><a href="#chunkFilename" class="headerlink" title="chunkFilename"></a>chunkFilename</h4><p>按需加载的非入口文件，包含require.ensure异步加载的脚本，如 chunkFilename: ‘[name].async.js’。</p>
<h4 id="chunkLoadTimeout"><a href="#chunkLoadTimeout" class="headerlink" title="chunkLoadTimeout"></a>chunkLoadTimeout</h4><p>访问按需加载资源的超时时间，默认为120000。</p>
<h4 id="jsonpFunction"><a href="#jsonpFunction" class="headerlink" title="jsonpFunction"></a>jsonpFunction</h4><p>按需加载资源的jsonp函数名，默认值为’webpackJsonp’。有多个编译过程需要修改，避免同名冲突。</p>
<h4 id="jsonpScriptType"><a href="#jsonpScriptType" class="headerlink" title="jsonpScriptType"></a>jsonpScriptType</h4><p>以jsonp形式按需加载资源时，注入页面的script节点的type值，默认为’text/Javascript’。可配置为’module’，即以es6语法形式加载脚本。</p>
<h4 id="crossOriginLoading"><a href="#crossOriginLoading" class="headerlink" title="crossOriginLoading"></a>crossOriginLoading</h4><p>启用jsonp跨域加载脚本，默认值为false，即不允许；可配置为’anonymous’（允许跨域，发送不带凭据的请求）或’use-credentials’（允许跨域，发送待凭据的请求）。</p>
<h4 id="library"><a href="#library" class="headerlink" title="library"></a>library</h4><p>开发类库时配置，配置为 libaryName 类库名。参考 <a href="http://www.css88.com/doc/webpack/guides/author-libraries/" target="_blank" rel="noopener">创建库 (Library)</a>。</p>
<h4 id="libraryTarget"><a href="#libraryTarget" class="headerlink" title="libraryTarget"></a>libraryTarget</h4><p>类库导出格式，默认值为’var’。可选值包含’var’（导出为变量），’this’（导出为this的属性），’commonjs’（导出为exports的属性，即node脚本的方法），’commonjs2’（通过module.exports导出，即node的一个模块），’amd’（requirejs模块化规范导出模块），’umd’（以AMD，CommonJS2 形式导出或者导出为 root 的属性）。</p>
<h4 id="libraryExport"><a href="#libraryExport" class="headerlink" title="libraryExport"></a>libraryExport</h4><p>配置导出的内容，默认值为 _entry<em>return</em> ，即将完全导出模块。若配置为 _entry<em>return</em>.default ，只导出 default 属性。若配置为 _entry<em>return</em>.methodName ，只导出 methodName 方法。</p>
<h4 id="auxiliaryComment"><a href="#auxiliaryComment" class="headerlink" title="auxiliaryComment"></a>auxiliaryComment</h4><p>在导出类库时，用于在导出容器中添加注释，配合 library, libraryTarget 属性一起使用。如 auxiliaryComment: ‘Test Comment’。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">webpackUniversalModuleDefinition</span>(<span class="params">root, factory</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Test Comment</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> exports === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">'object'</span>)</span><br><span class="line">    <span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">"lodash"</span>));</span><br><span class="line">  <span class="comment">// Test Comment</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd)</span><br><span class="line">    define([<span class="string">"lodash"</span>], factory);</span><br><span class="line">  <span class="comment">// Test Comment</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> exports === <span class="string">'object'</span>)</span><br><span class="line">    exports[<span class="string">"someLibName"</span>] = factory(<span class="built_in">require</span>(<span class="string">"lodash"</span>));</span><br><span class="line">  <span class="comment">// Test Comment</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    root[<span class="string">"someLibName"</span>] = factory(root[<span class="string">"_"</span>]);</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">__WEBPACK_EXTERNAL_MODULE_1__</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="umdNamedDefine"><a href="#umdNamedDefine" class="headerlink" title="umdNamedDefine"></a>umdNamedDefine</h4><p>当 libraryTarget 属性 配置为 ‘umd’ 时，设置 umdNamedDefine 为真，将对 UMD 构建过程中的 AMD 模块进行命名，否则就使用匿名的 define。</p>
<h4 id="sourceMapFilename"><a href="#sourceMapFilename" class="headerlink" title="sourceMapFilename"></a>sourceMapFilename</h4><p>source map文件名，默认值为’[file].map’。占位符除包含entry的所有占位符外，还包含 file 模块文件名，filebase 模块的basename，带扩展名。</p>
<h4 id="devtoolModuleFilenameTemplate"><a href="#devtoolModuleFilenameTemplate" class="headerlink" title="devtoolModuleFilenameTemplate"></a>devtoolModuleFilenameTemplate</h4><p>定义每个 source map 的 sources 数组项的名称，模板字符串或函数。模板占位符包含 absolute-resource-path 绝对路径文件名，id 模块标识符，hash 模块标识符的hash值，all-loaders 自动和显式的loader，参数取决于第一个loader的名称，loaders 显式的loader，参数取决于第一个loader的名称，resource 文件路径加首个loader的查询参数，resource-path 文件路径。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">devtoolModuleFilenameTemplate: <span class="string">"webpack:///[resource-path]?[loaders]"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line">devtoolModuleFilenameTemplate: <span class="function"><span class="params">info</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`webpack:///<span class="subst">$&#123;info.resourcePath&#125;</span>?<span class="subst">$&#123;info.loaders&#125;</span>`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="devtoolFallbackModuleFilenameTemplate"><a href="#devtoolFallbackModuleFilenameTemplate" class="headerlink" title="devtoolFallbackModuleFilenameTemplate"></a>devtoolFallbackModuleFilenameTemplate</h4><p>使用devtoolModuleFilenameTemplate使多个模块产生相同的名称时，devtoolFallbackModuleFilenameTemplate属性是备用的解决方案，配置同上。</p>
<h4 id="hotUpdateChunkFilename"><a href="#hotUpdateChunkFilename" class="headerlink" title="hotUpdateChunkFilename"></a>hotUpdateChunkFilename</h4><p>配置热更新文件名，默认为’[id].[hash].hot-update.js’，没必要修改。</p>
<h4 id="hotUpdateFunction"><a href="#hotUpdateFunction" class="headerlink" title="hotUpdateFunction"></a>hotUpdateFunction</h4><p>热更新加载的jsonp函数名，默认为’webpackHotUpdate’，只在浏览器端使用。</p>
<h4 id="hotUpdateMainFilename"><a href="#hotUpdateMainFilename" class="headerlink" title="hotUpdateMainFilename"></a>hotUpdateMainFilename</h4><p>热更新的主文件名 ，默认值为’[hash].hot-update.json’，没必要修改。占位符只有 hash。</p>
<h4 id="hashDigest"><a href="#hashDigest" class="headerlink" title="hashDigest"></a>hashDigest</h4><p>生成 hash 时的编码方式，默认为 ‘hex’。</p>
<h4 id="hashDigestLength"><a href="#hashDigestLength" class="headerlink" title="hashDigestLength"></a>hashDigestLength</h4><p>散列摘要的前缀长度。</p>
<h4 id="hashFunction"><a href="#hashFunction" class="headerlink" title="hashFunction"></a>hashFunction</h4><p>散列算法。</p>
<h4 id="hashSalt"><a href="#hashSalt" class="headerlink" title="hashSalt"></a>hashSalt</h4><p>可选的加盐值。</p>
<h4 id="strictModuleExceptionHandling"><a href="#strictModuleExceptionHandling" class="headerlink" title="strictModuleExceptionHandling"></a>strictModuleExceptionHandling</h4><p>默认为否值。如为真值，模块报错后，再次引用，将重复报错，因此无需配置。</p>
<h4 id="sourcePrefix"><a href="#sourcePrefix" class="headerlink" title="sourcePrefix"></a>sourcePrefix</h4><p>配置打包文件每行的前缀，默认使用空字符串，没必要配置。</p>
<h3 id="module-模块"><a href="#module-模块" class="headerlink" title="module 模块"></a>module 模块</h3><h4 id="noParse"><a href="#noParse" class="headerlink" title="noParse"></a>noParse</h4><p>无需webpack解析的文件名，正则或函数形式，如 module.noParse: /jquery|lodash/ 或 module.noParse: function(content) { return /jquery|lodash/.test(content); }。</p>
<h4 id="rules"><a href="#rules" class="headerlink" title="rules"></a>rules</h4><p>用于配置加载器，如 module.rules: [{ test: /.ts$/, use: ‘ts-loader’ }]。</p>
<ul>
<li>rule.test，资源文件名须匹配的条件，可以是正则，或正则数组，或字符串，或函数（返回真值匹配），或对象（匹配所有属性），下同。与rule.resource属性相冲。</li>
<li>rule.include，资源文件所在目录。</li>
<li>rule.exclude，资源文件排除的目录。</li>
<li>rule.and，资源文件名须匹配所有条件。</li>
<li>rule.or，资源文件名须匹配其中一条条件。</li>
<li>rule.not，资源文件名须排除的条件。</li>
<li>rule.resourceQuery，加载文件时须匹配的查询字符串，如 rule.resourceQuery : /inline/，可使用 import Foo from ‘./foo.css?inline’。</li>
<li>rule.resource，资源文件匹配的规则，可以用rule.test, rule.include, rule.exclude替代配置。</li>
<li>rule.issuer，请求资源的脚本文件名。</li>
<li>rule.use，指定加载器，数组形式。加载器执行顺序为从右到左。</li>
<li>rule.use.loader，指定加载器，如 use: [ { loader: “style-loader “} ]，简写形式为use: [ “style-loader” ]。</li>
<li>rule.use.options | rule.use.query，传入loader的配置项，如 use: [{ loader: “css-loader”, options: { modules: true } }。</li>
<li><p>rule.parser，配置解析选项，约定模块可以使用的模块化加载语法，默认值为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">parser: &#123;</span><br><span class="line">  amd: <span class="literal">false</span>, <span class="comment">// 禁用 AMD</span></span><br><span class="line">  commonjs: <span class="literal">false</span>, <span class="comment">// 禁用 CommonJS</span></span><br><span class="line">  system: <span class="literal">false</span>, <span class="comment">// 禁用 SystemJS</span></span><br><span class="line">  harmony: <span class="literal">false</span>, <span class="comment">// 禁用 ES2015 Harmony import/export</span></span><br><span class="line">  requireInclude: <span class="literal">false</span>, <span class="comment">// 禁用 require.include</span></span><br><span class="line">  requireEnsure: <span class="literal">false</span>, <span class="comment">// 禁用 require.ensure</span></span><br><span class="line">  requireContext: <span class="literal">false</span>, <span class="comment">// 禁用 require.context</span></span><br><span class="line">  browserify: <span class="literal">false</span>, <span class="comment">// 禁用特殊处理的 browserify bundle</span></span><br><span class="line">  requireJs: <span class="literal">false</span>, <span class="comment">// 禁用 requirejs.*</span></span><br><span class="line">  node: <span class="literal">false</span>, <span class="comment">// 禁用 __dirname, __filename, module, require.extensions, require.main 等。</span></span><br><span class="line">  node: &#123;...&#125; <span class="comment">// 在模块级别(module level)上重新配置 [node](/configuration/node) 层(layer)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>rule.rules，配置嵌套规则。</p>
</li>
<li><p>rule.oneOf，以数组顺序优先选用嵌套规则，如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">use: [&#123;</span><br><span class="line">  test: <span class="regexp">/.css$/</span>,</span><br><span class="line">  oneOf: [</span><br><span class="line">    &#123;</span><br><span class="line">      resourceQuery: <span class="regexp">/inline/</span>, <span class="comment">// foo.css?inline</span></span><br><span class="line">      use: <span class="string">'url-loader'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      resourceQuery: <span class="regexp">/external/</span>, <span class="comment">// foo.css?external</span></span><br><span class="line">      use: <span class="string">'file-loader'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>rule.enforce，指定 loader 调用顺序，可选值为’pre’（前置）, ‘inline’（行内）, ‘normal’（普通）, ‘post’（后置），留空即为默认值’normal’。</p>
</li>
</ul>
<h3 id="resolve-解析"><a href="#resolve-解析" class="headerlink" title="resolve 解析"></a>resolve 解析</h3><h4 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h4><p>配置资源文件的别名，影响 webpack 查找资源的方式。</p>
<h4 id="enforceExtension"><a href="#enforceExtension" class="headerlink" title="enforceExtension"></a>enforceExtension</h4><p>是否允许加载无扩展名的文件，默认为 false。</p>
<h4 id="extensions"><a href="#extensions" class="headerlink" title="extensions"></a>extensions</h4><p>自动解析的文件扩展名，默认值为 extensions: [“.js”, “.json”]。</p>
<h4 id="mainFields"><a href="#mainFields" class="headerlink" title="mainFields"></a>mainFields</h4><p>决定类库导入的方式，默认值为 mainFields: [“browser”, “module”, “main”]，即优先以类库 package.json 文件中’browser’属性导入模块，其次’module’，其次’main’。</p>
<h4 id="mainFiles"><a href="#mainFiles" class="headerlink" title="mainFiles"></a>mainFiles</h4><p>解析目录时使用的文件名，默认值为 mainFiles: [“index”]。</p>
<h4 id="modules"><a href="#modules" class="headerlink" title="modules"></a>modules</h4><p>告诉 webpack 在哪个目录中查找模块，如 modules: [path.resolve(__dirname, “src”), “node_modules”]。</p>
<h4 id="unsafeCache"><a href="#unsafeCache" class="headerlink" title="unsafeCache"></a>unsafeCache</h4><p>指定需要缓存的模块，默认为 unsafeCache: true。unsafeCache: /src\/utilities/配置只缓存utilities模块。</p>
<h4 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h4><p>额外使用的解析插件列表，如 plugins: [new DirectoryNamedWebpackPlugin()]。</p>
<h4 id="cachePredicate"><a href="#cachePredicate" class="headerlink" title="cachePredicate"></a>cachePredicate</h4><p>指定异步加载脚本是否需要被缓存，函数形式，默认值为 cachePredicate: function() { return true }。</p>
<h4 id="resolveLoader"><a href="#resolveLoader" class="headerlink" title="resolveLoader"></a>resolveLoader</h4><p>指定 webpack 查找loader的方式，如resolveLoader: {  modules: [“node_modules”], extensions: [“.js”, “.json”], mainFields: [“loader”, “main”] }。</p>
<h4 id="moduleExtensions"><a href="#moduleExtensions" class="headerlink" title="moduleExtensions"></a>moduleExtensions</h4><p>rule.use配置loader时待添加的后缀。</p>
<h3 id="plugins-插件"><a href="#plugins-插件" class="headerlink" title="plugins 插件"></a>plugins 插件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="comment">// 导入非 webpack 默认自带插件</span></span><br><span class="line"><span class="keyword">var</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">var</span> DashboardPlugin = <span class="built_in">require</span>(<span class="string">'webpack-dashboard/plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在配置中添加插件</span></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="comment">// 构建优化插件</span></span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;<span class="comment">// 提取公共资源</span></span><br><span class="line">    name: <span class="string">'vendor'</span>,</span><br><span class="line">    filename: <span class="string">'vendor-[hash].min.js'</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;<span class="comment">// 压缩代码</span></span><br><span class="line">    compress: &#123;</span><br><span class="line">      warnings: <span class="literal">false</span>,</span><br><span class="line">      drop_console: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> ExtractTextPlugin(&#123;<span class="comment">// 提取并压缩css</span></span><br><span class="line">    filename: <span class="string">'build.min.css'</span>,</span><br><span class="line">    allChunks: <span class="literal">true</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> webpack.IgnorePlugin(<span class="regexp">/^\.\/locale$/</span>, /moment$/),</span><br><span class="line">  <span class="comment">// 编译时(compile time)插件</span></span><br><span class="line">  <span class="keyword">new</span> webpack.DefinePlugin(&#123;<span class="comment">// 定义全局变量</span></span><br><span class="line">    <span class="string">'process.env.NODE_ENV'</span>: <span class="string">'"production"'</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="comment">// webpack-dev-server 强化插件</span></span><br><span class="line">  <span class="keyword">new</span> DashboardPlugin(),</span><br><span class="line">  <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="devServer-开发服务器"><a href="#devServer-开发服务器" class="headerlink" title="devServer 开发服务器"></a>devServer 开发服务器</h3><p>使用 webpack-dev-server 启动本地开发环境的服务器。由 webpack-dev-server 启动的服务，访问 /webpack-dev-server 路径可查看加载的资源。</p>
<h4 id="inline"><a href="#inline" class="headerlink" title="inline"></a>inline</h4><p>dev server 使用内联模式启动，将处理实时重载的脚本注入到打包文件中，开发者可在浏览器控制台查看构建信息。当配置为 inline: false 时，将启用 iframe 模式，处理实时重载的脚本将注入到 iframe 标签中。</p>
<h4 id="lazy"><a href="#lazy" class="headerlink" title="lazy"></a>lazy</h4><p>dev server 使用惰性模式，在请求资源时重新编译脚本，webpack 不会监听任何文件的变动。</p>
<h4 id="hot"><a href="#hot" class="headerlink" title="hot"></a>hot</h4><p>是否启用 webpack 模块热替换特性，可通过命令行 –hot 启动。</p>
<h4 id="hotOnly"><a href="#hotOnly" class="headerlink" title="hotOnly"></a>hotOnly</h4><p>启用热替换特性时，编译失败时，是否避免刷新页面，可通过命令行 –hot 启动。</p>
<h4 id="open"><a href="#open" class="headerlink" title="open"></a>open</h4><p>是否自动打开浏览器，可通过命令行 –open 配置。</p>
<h4 id="openPage"><a href="#openPage" class="headerlink" title="openPage"></a>openPage</h4><p>打开浏览器时指定页面，如 openPage: ‘/different/page’，可通过命令行 –open-page “/different/page” 配置。</p>
<h4 id="overlay"><a href="#overlay" class="headerlink" title="overlay"></a>overlay</h4><p>浏览器端显示构建失败和警告信息，配置为 overlay: true 只提示构建失败信息，overlay: { warnings: true, errors: true } 同时显示失败和警告信息。</p>
<h4 id="useLocalIp"><a href="#useLocalIp" class="headerlink" title="useLocalIp"></a>useLocalIp</h4><p>浏览器端以 ip 打开网页，可通过命令行 –useLocalIp 配置。</p>
<h4 id="historyApiFallback"><a href="#historyApiFallback" class="headerlink" title="historyApiFallback"></a>historyApiFallback</h4><p>通过 html5 histroy api 控制路由，设置为真值，404 错误页面将重定向到 index.html。rewrites 选项开启更细粒度的重定向；disableDotRule 选项用于在路径中使用’.’（常见于 Angular）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">historyApiFallback: &#123;</span><br><span class="line">  rewrites: [</span><br><span class="line">    &#123; <span class="attr">from</span>: <span class="regexp">/^\/$/</span>, <span class="attr">to</span>: <span class="string">'/views/landing.html'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">from</span>: <span class="regexp">/^\/subpage/</span>, <span class="attr">to</span>: <span class="string">'/views/subpage.html'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">from</span>: <span class="regexp">/./</span>, <span class="attr">to</span>: <span class="string">'/views/404.html'</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h4><p>通过代理服务器转发请求。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">proxy: &#123;</span><br><span class="line">  <span class="string">"/api"</span>: &#123;</span><br><span class="line">    target: <span class="string">"http://localhost:3000"</span>,<span class="comment">// 代理服务器转发到的目标服务器地址</span></span><br><span class="line">    secure: <span class="literal">true</span>,<span class="comment">// 是否接受 https 服务，且使用无效证书的目标服务器</span></span><br><span class="line">    pathRewrite: &#123;<span class="string">"^/api"</span> : <span class="string">""</span>&#125;,<span class="comment">// 重写请求路径</span></span><br><span class="line">    bypass: <span class="function"><span class="keyword">function</span>(<span class="params">req, res, proxyOptions</span>) </span>&#123;<span class="comment">// 请求 html 页面资源时，跳过代理</span></span><br><span class="line">      <span class="keyword">if</span> (req.headers.accept.indexOf(<span class="string">"html"</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Skipping proxy for browser request."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"/index.html"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">proxy: [&#123;<span class="comment">// 设置多个代理</span></span><br><span class="line">  context: [<span class="string">"/auth"</span>, <span class="string">"/api"</span>],</span><br><span class="line">  target: <span class="string">"http://localhost:3000"</span>,</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
<h4 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h4><p>访问 dev server 服务器实例，添加钩子或中间件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setup(app)&#123;</span><br><span class="line">  app.get(<span class="string">'/some/path'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.json(&#123; <span class="attr">custom</span>: <span class="string">'response'</span> &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="quiet"><a href="#quiet" class="headerlink" title="quiet"></a>quiet</h4><p>配置为真值时，将隐藏构建信息，包含错误和警告提示。</p>
<h4 id="info"><a href="#info" class="headerlink" title="info"></a>info</h4><p>该配置项只能通过命令行配置，默认为true，是否输出日志，如 –info=false。</p>
<h4 id="noInfo"><a href="#noInfo" class="headerlink" title="noInfo"></a>noInfo</h4><p>是否隐藏构建信息，错误和警告除外。</p>
<h4 id="clientLogLevel"><a href="#clientLogLevel" class="headerlink" title="clientLogLevel"></a>clientLogLevel</h4><p>控制台打印日志级别，默认为 info。可选项 none, error, warning 或 info。</p>
<h4 id="color"><a href="#color" class="headerlink" title="color"></a>color</h4><p>是否带颜色输出日志，可通过命令行 –color 启动。</p>
<h4 id="stats"><a href="#stats" class="headerlink" title="stats"></a>stats</h4><p>细粒度控制台打印的信息，同 webapckConfig.stats。</p>
<h4 id="filename-1"><a href="#filename-1" class="headerlink" title="filename"></a>filename</h4><p>lazy 属性为true，惰性模式启动服务器时，配置 filename 可使资源被请求时才启动打包，如 filename: “bundle.js”。</p>
<h4 id="host"><a href="#host" class="headerlink" title="host"></a>host</h4><p>配置主机ip，如 host: “0.0.0.0”，可通过命令行 –host 0.0.0.0 配置。</p>
<h4 id="port"><a href="#port" class="headerlink" title="port"></a>port</h4><p>配置端口号，如 port: 8080，可通过命令行 –port 8080 配置。</p>
<h4 id="public"><a href="#public" class="headerlink" title="public"></a>public</h4><p>使用内联模式，且通过 ngnix 代理 dev server 时，设置 public 主机url，如public: “myapp.test:80”。可通过命令行 –public myapp.test:80 配置。</p>
<h4 id="publicPath-1"><a href="#publicPath-1" class="headerlink" title="publicPath"></a>publicPath</h4><p>浏览器端访问打包文件的路径，默认为’/‘，可配置为相对路径或完整url，如 publicPath: “<a href="http://localhost:8080/assets/&quot;，此时访问资源" target="_blank" rel="noopener">http://localhost:8080/assets/&quot;，此时访问资源</a> bundle.js 的地址为 <a href="http://localhost:8080/assets/bundle.js。" target="_blank" rel="noopener">http://localhost:8080/assets/bundle.js。</a></p>
<h4 id="contentBase"><a href="#contentBase" class="headerlink" title="contentBase"></a>contentBase</h4><p>指定服务器从哪里获取静态资源，默认为工程目录，可配置为字符串或数组，false表示禁用。publicPath 指定打包文件加载路径，优先级较高。可通过命令行 –content-base /path/to/content/dir 配置。</p>
<h4 id="watchContentBase"><a href="#watchContentBase" class="headerlink" title="watchContentBase"></a>watchContentBase</h4><p>监听 contentBase 静态资源改动，可通过命令行 –watch-content-base 配置。</p>
<h4 id="staticOptions"><a href="#staticOptions" class="headerlink" title="staticOptions"></a>staticOptions</h4><p>配置通过 contentBase 访问的静态资源选项，如 staticOptions: { redirect: false }。</p>
<h4 id="headers"><a href="#headers" class="headerlink" title="headers"></a>headers</h4><p>在所有响应中添加头部配置，如 headers: { “X-Custom-Foo”: “bar” }。</p>
<h4 id="disableHostCheck"><a href="#disableHostCheck" class="headerlink" title="disableHostCheck"></a>disableHostCheck</h4><p>是否禁用请求头 host 检查，可通过命令行 –disable-host-check 配置。</p>
<h4 id="allowedHosts"><a href="#allowedHosts" class="headerlink" title="allowedHosts"></a>allowedHosts</h4><p>allowedHosts配置将校验请求头中的 host 主机，匹配的予以访问权限，如 allowedHosts: [ ‘.host.com’, ‘host2.com’ ]，以’.’起始的配置项可以作为子域名。该配置项可以通过命令行 –allowed-hosts .host.com,host2.com 配置。</p>
<h4 id="bonjour"><a href="#bonjour" class="headerlink" title="bonjour"></a>bonjour</h4><p>是否通过零配置网络服务规范自动生成ip地址，可通过命令行 –bonjour 启动。</p>
<h4 id="compress"><a href="#compress" class="headerlink" title="compress"></a>compress</h4><p>服务是否通过 gzip 压缩，可通过命令行 –compress 启动。</p>
<h4 id="https"><a href="#https" class="headerlink" title="https"></a>https</h4><p>启动 https 服务，默认启动 http 服务。可通过命令行  –https –key /path/to/server.key –cert /path/to/server.crt –cacert /path/to/ca.pem 配置。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">https: &#123;<span class="comment">// 配置自签名证书</span></span><br><span class="line">  key: fs.readFileSync(<span class="string">"/path/to/server.key"</span>),</span><br><span class="line">  cert: fs.readFileSync(<span class="string">"/path/to/server.crt"</span>),</span><br><span class="line">  ca: fs.readFileSync(<span class="string">"/path/to/ca.pem"</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h4><p>使用Unix socket通信，如 socket: ‘socket’，可通过命令行 –socket socket 配置。</p>
<h4 id="pfx"><a href="#pfx" class="headerlink" title="pfx"></a>pfx</h4><p>配置数字证书ssl pfx的路径，如 pfx: ‘/path/to/file.pfx’，可通过命令行 –pfx /path/to/file.pfx 配置。</p>
<h4 id="pfxPassphrase"><a href="#pfxPassphrase" class="headerlink" title="pfxPassphrase"></a>pfxPassphrase</h4><p>访问数字证书ssl pfx的密码，如 pfxPassphrase: ‘passphrase’，可通过命令行 –pfx-passphrase passphrase 配置。</p>
<h4 id="progress"><a href="#progress" class="headerlink" title="progress"></a>progress</h4><p>将运行进度输出到控制台，只能使用命令行 –progress 配置。</p>
<h4 id="stdin"><a href="#stdin" class="headerlink" title="stdin"></a>stdin</h4><p>标准输入停止时关闭 dev server，只能通过命令行 –stdin 配置。</p>
<h4 id="watchOptions"><a href="#watchOptions" class="headerlink" title="watchOptions"></a>watchOptions</h4><p>监听配置。</p>
<h3 id="devtool-开发工具"><a href="#devtool-开发工具" class="headerlink" title="devtool 开发工具"></a>devtool 开发工具</h3><p>devtool配置影响生成source map的方式，默认不配置，即不生成source map。打包脚本可通过SourceMap查找实际的报错行号。开发环境可配置为’cheap-module-eval-source-map’；生产环境可配置为’nosources-source-map’。</p>
<p>devtool配置性能：</p>
<img src="/2018/02/01/webpack配置指南/sourceMap.png">
<h3 id="target-构建目标"><a href="#target-构建目标" class="headerlink" title="target 构建目标"></a>target 构建目标</h3><p>指定构建目标，即打包文件适配的环境，字符串或函数。字符串可选值为 web 浏览器环境（默认值），node 类node环境，使用require加载文件，async-node 类node环境，使用fs和vm异步加载文件，electron-main 编译为Electron主进程，electron-renderer 编译为Electron渲染进程，node-webkit 编译为Webkit可用，使用jsonp加载，webworker 编译成WebWorker。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回undefined，避免使用插件构建；返回 'web'，指定 'web' 插件构建</span></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  target: <span class="function"><span class="params">()</span> =&gt;</span> <span class="literal">undefined</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定 'web' 插件构建</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  target: <span class="function">(<span class="params">compiler</span>) =&gt;</span> &#123;</span><br><span class="line">    compiler.apply(</span><br><span class="line">      <span class="keyword">new</span> webpack.JsonpTemplatePlugin(options.output),</span><br><span class="line">      <span class="keyword">new</span> webpack.LoaderTargetPlugin(<span class="string">"web"</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Watch-监听"><a href="#Watch-监听" class="headerlink" title="Watch 监听"></a>Watch 监听</h3><ul>
<li>watch 是否启用 Watch 模式监听文件改动，以重启编译过程。webpack 默认为 false，webpack-dev-server 和 webpack-dev-middleware 默认为 true。</li>
<li>watchOptions 定义 watch 监听模式的选项。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">watchOptions: &#123;</span><br><span class="line">  aggregateTimeout: <span class="number">300</span>,<span class="comment">// 以毫秒值为单位，该时间段内的文件改动将一次性影响 webpack 的编译过程，默认为 300</span></span><br><span class="line">  ignored: <span class="regexp">/node_modules/</span>,<span class="comment">// 避免监听某些文件的改动，节省内存开销，可以配置为 "files/**/*.js"</span></span><br><span class="line">  poll: <span class="number">1000</span><span class="comment">// 布尔值或数值，真值开启轮询，监听文件变动；数值时，以该时间间隔检查文件变动</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="externals-外部扩展"><a href="#externals-外部扩展" class="headerlink" title="externals 外部扩展"></a>externals 外部扩展</h3><p>用于将第三方类库打包到输出文件中，而是通过运行时由外部注入，如externals: { jquery: ‘jQuery’ }。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串</span></span><br><span class="line">externals: <span class="string">'jQuery'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组</span></span><br><span class="line">externals: &#123;</span><br><span class="line">  subtract: [<span class="string">'./math'</span>, <span class="string">'subtract'</span>]<span class="comment">// './math' 模块下的子模块 subtract 由外部注入</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象</span></span><br><span class="line">externals : &#123;</span><br><span class="line">  lodash : &#123;</span><br><span class="line">    commonjs: <span class="string">"lodash"</span>,<span class="comment">// commonjs 或 amd 模块系统下，通过 lodash 访问</span></span><br><span class="line">    amd: <span class="string">"lodash"</span>,</span><br><span class="line">    root: <span class="string">"_"</span> <span class="comment">// 全局变量下，通过 _ 访问</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数</span></span><br><span class="line">externals: [</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">context, request, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^yourregex$/</span>.test(request))&#123;</span><br><span class="line">      <span class="keyword">return</span> callback(<span class="literal">null</span>, <span class="string">'commonjs '</span> + request);<span class="comment">// 'commonjs ' + request 由外部注入</span></span><br><span class="line">    &#125;</span><br><span class="line">    callback();</span><br><span class="line">  &#125;</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正则</span></span><br><span class="line">externals: <span class="regexp">/^(jquery|\$)$/i</span></span><br></pre></td></tr></table></figure>
<h3 id="node-注入node"><a href="#node-注入node" class="headerlink" title="node 注入node"></a>node 注入node</h3><p>全局注入 node 变量，提供类 node 环境的功能，由 NodeStuffPlugin 插件为’web’ 或 ‘webworker’ 环境提供ployfill。对象形式，属性的值可以是 true 提供plyfill，”mock” 提供mock，功能很少或没有，”empty” 供空对象，false 什么都不提供。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 默认值</span><br><span class="line">node: &#123;</span><br><span class="line">  console: false,</span><br><span class="line">  global: true,</span><br><span class="line">  process: true,</span><br><span class="line">  __filename: true,// 入口文件的文件名，相对于webpackConfig.context</span><br><span class="line">  __dirname: true,// 入口文件的目录名，相对于webpackConfig.context</span><br><span class="line">  Buffer: true,</span><br><span class="line">  setImmediate: true</span><br><span class="line"></span><br><span class="line">  // 更多选项，请查看“其他 Node.js 核心库”</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 其他</span><br><span class="line">node: &#123;</span><br><span class="line">  dns: &quot;mock&quot;,</span><br><span class="line">  fs: &quot;empty&quot;,</span><br><span class="line">  path: true,</span><br><span class="line">  url: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="performance-性能"><a href="#performance-性能" class="headerlink" title="performance 性能"></a>performance 性能</h3><h4 id="hints"><a href="#hints" class="headerlink" title="hints"></a>hints</h4><p>资源过大时，打开/关闭提示，默认为”warning”，可选值为 false | “error” | “warning”。开发环境推荐使用”warning”，生产环境推荐使用”error”。</p>
<h4 id="maxEntrypointSize"><a href="#maxEntrypointSize" class="headerlink" title="maxEntrypointSize"></a>maxEntrypointSize</h4><p>限制入口文件打包时的最大体积，默认为 250000 (bytes)。</p>
<h4 id="maxAssetSize"><a href="#maxAssetSize" class="headerlink" title="maxAssetSize"></a>maxAssetSize</h4><p>限制所有单个资源的最大体积，默认为 250000 (bytes)。</p>
<h4 id="assetFilter"><a href="#assetFilter" class="headerlink" title="assetFilter"></a>assetFilter</h4><p>配置需要计算最大体积以节省性能的文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">assetFilename</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !(<span class="regexp">/\.map$/</span>.test(assetFilename))</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他</span></span><br><span class="line">performance: &#123;</span><br><span class="line">  assetFilter: <span class="function"><span class="keyword">function</span>(<span class="params">assetFilename</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> assetFilename.endsWith(<span class="string">'.js'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="stats-统计"><a href="#stats-统计" class="headerlink" title="stats 统计"></a>stats 统计</h3><p>细粒度地控制输出日志，字符串或对象形式。字符串可选项包含”errors-only” 只包含错误，”minimal” 包含错误和新的编译信息，”none” 没有输出，”normal” 标准输出，”detailed” 详细输出，”verbose” 全部输出。也可配置为对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">stats: &#123;</span><br><span class="line">  <span class="comment">// 增加资源信息</span></span><br><span class="line">  assets: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 对资源按指定的项进行排序</span></span><br><span class="line">  assetsSort: <span class="string">"field"</span>,</span><br><span class="line">  <span class="comment">// 增加缓存了的（但没构建）模块的信息</span></span><br><span class="line">  cached: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Show cached assets (setting this to `false` only shows emitted files)</span></span><br><span class="line">  cachedAssets: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 增加子级的信息</span></span><br><span class="line">  children: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 增加包信息（设置为 `false` 能允许较少的冗长输出）</span></span><br><span class="line">  chunks: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 将内置模块信息增加到包信息</span></span><br><span class="line">  chunkModules: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 增加包 和 包合并 的来源信息</span></span><br><span class="line">  chunkOrigins: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 对包按指定的项进行排序</span></span><br><span class="line">  chunksSort: <span class="string">"field"</span>,</span><br><span class="line">  <span class="comment">// 用于缩短请求的上下文目录</span></span><br><span class="line">  context: <span class="string">"../src/"</span>,</span><br><span class="line">  <span class="comment">// `webpack --colors` 等同于</span></span><br><span class="line">  colors: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Display the distance from the entry point for each module</span></span><br><span class="line">  depth: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// Display the entry points with the corresponding bundles</span></span><br><span class="line">  entrypoints: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 增加错误信息</span></span><br><span class="line">  errors: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 增加错误的详细信息（就像解析日志一样）</span></span><br><span class="line">  errorDetails: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Exclude assets from being displayed in stats</span></span><br><span class="line">  <span class="comment">// This can be done with a String, a RegExp, a Function getting the assets name</span></span><br><span class="line">  <span class="comment">// and returning a boolean or an Array of the above.</span></span><br><span class="line">  excludeAssets: <span class="string">"filter"</span> | <span class="regexp">/filter/</span> | <span class="function">(<span class="params">assetName</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span> |</span><br><span class="line">    [<span class="string">"filter"</span>] | [<span class="regexp">/filter/</span>] | [<span class="function">(<span class="params">assetName</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span>],</span><br><span class="line">  <span class="comment">// Exclude modules from being displayed in stats</span></span><br><span class="line">  <span class="comment">// This can be done with a String, a RegExp, a Function getting the modules source</span></span><br><span class="line">  <span class="comment">// and returning a boolean or an Array of the above.</span></span><br><span class="line">  excludeModules: <span class="string">"filter"</span> | <span class="regexp">/filter/</span> | <span class="function">(<span class="params">moduleSource</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span> |</span><br><span class="line">    [<span class="string">"filter"</span>] | [<span class="regexp">/filter/</span>] | [<span class="function">(<span class="params">moduleSource</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span>],</span><br><span class="line">  <span class="comment">// See excludeModules</span></span><br><span class="line">  exclude: <span class="string">"filter"</span> | <span class="regexp">/filter/</span> | <span class="function">(<span class="params">moduleSource</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span> |</span><br><span class="line">    [<span class="string">"filter"</span>] | [<span class="regexp">/filter/</span>] | [<span class="function">(<span class="params">moduleSource</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span>],</span><br><span class="line">  <span class="comment">// 增加编译的哈希值</span></span><br><span class="line">  hash: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Set the maximum number of modules to be shown</span></span><br><span class="line">  maxModules: <span class="number">15</span>,</span><br><span class="line">  <span class="comment">// 增加内置的模块信息</span></span><br><span class="line">  modules: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 对模块按指定的项进行排序</span></span><br><span class="line">  modulesSort: <span class="string">"field"</span>,</span><br><span class="line">  <span class="comment">// Show dependencies and origin of warnings/errors (since webpack 2.5.0)</span></span><br><span class="line">  moduleTrace: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Show performance hint when file size exceeds `performance.maxAssetSize`</span></span><br><span class="line">  performance: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Show the exports of the modules</span></span><br><span class="line">  providedExports: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 增加 public path 的信息</span></span><br><span class="line">  publicPath: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 增加模块被引入的原因</span></span><br><span class="line">  reasons: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 增加模块的源码</span></span><br><span class="line">  source: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 增加时间信息</span></span><br><span class="line">  timings: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Show which exports of a module are used</span></span><br><span class="line">  usedExports: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 增加 webpack 版本信息</span></span><br><span class="line">  version: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 增加提示</span></span><br><span class="line">  warnings: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Filter warnings to be shown (since webpack 2.4.0),</span></span><br><span class="line">  <span class="comment">// can be a String, Regexp, a function getting the warning and returning a boolean</span></span><br><span class="line">  <span class="comment">// or an Array of a combination of the above. First match wins.</span></span><br><span class="line">  warningsFilter: <span class="string">"filter"</span> | <span class="regexp">/filter/</span> | [<span class="string">"filter"</span>, /filter/] | <span class="function">(<span class="params">warning</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpeg"
                alt="Alfred" />
            
              <p class="site-author-name" itemprop="name">Alfred</p>
              <p class="site-description motion-element" itemprop="description">人苦不知足，既得陇，复望蜀</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Alfred-sg" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/xiu-fan-79/activities" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-globe"></i>知乎</a>
                  </span>
                
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alfred</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.0.2</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.2"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.2"></script>



  

  
    <script id="dsq-count-scr" src="https://alfred.disqus.com/count.js" async></script>
  

  





	





  












  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
