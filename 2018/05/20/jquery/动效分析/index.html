<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.0.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="analyst,jquery," />


<meta name="description" content="动效基础在阅读 jquery/effects 模块源码之前，有必要先了解一下制作前端动效的一些基本知识，其内容包含动效实现的基本原理、缓动函数等。对于以上内容，笔者将在这一小节一一加以介绍。 基本原理动效实现的基本原理如同逐帧制作动画，相隔时间较短的两帧动画可以促使人类视觉误以为那是连续的一个过程。术语刷新率 fps 指每秒更新多少帧画面。通常，每秒刷新 24 张画面最适宜于人类视觉，也就是单张画">
<meta name="keywords" content="analyst,jquery">
<meta property="og:type" content="article">
<meta property="og:title" content="jquery 动效分析">
<meta property="og:url" content="http://yoursite.com/2018/05/20/jquery/动效分析/index.html">
<meta property="og:site_name" content="修子范语">
<meta property="og:description" content="动效基础在阅读 jquery/effects 模块源码之前，有必要先了解一下制作前端动效的一些基本知识，其内容包含动效实现的基本原理、缓动函数等。对于以上内容，笔者将在这一小节一一加以介绍。 基本原理动效实现的基本原理如同逐帧制作动画，相隔时间较短的两帧动画可以促使人类视觉误以为那是连续的一个过程。术语刷新率 fps 指每秒更新多少帧画面。通常，每秒刷新 24 张画面最适宜于人类视觉，也就是单张画">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2018/05/20/jquery/动效分析/easing.png">
<meta property="og:updated_time" content="2018-06-11T04:53:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jquery 动效分析">
<meta name="twitter:description" content="动效基础在阅读 jquery/effects 模块源码之前，有必要先了解一下制作前端动效的一些基本知识，其内容包含动效实现的基本原理、缓动函数等。对于以上内容，笔者将在这一小节一一加以介绍。 基本原理动效实现的基本原理如同逐帧制作动画，相隔时间较短的两帧动画可以促使人类视觉误以为那是连续的一个过程。术语刷新率 fps 指每秒更新多少帧画面。通常，每秒刷新 24 张画面最适宜于人类视觉，也就是单张画">
<meta name="twitter:image" content="http://yoursite.com/2018/05/20/jquery/动效分析/easing.png">






  <link rel="canonical" href="http://yoursite.com/2018/05/20/jquery/动效分析/"/>


  <title>jquery 动效分析 | 修子范语</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">修子范语</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Alfredo's Notes</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/20/jquery/动效分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">jquery 动效分析</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-20T00:00:00+08:00">2018-05-20</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/jquery/" itemprop="url" rel="index"><span itemprop="name">jquery</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/20/jquery/动效分析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/20/jquery/动效分析/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="动效基础"><a href="#动效基础" class="headerlink" title="动效基础"></a>动效基础</h2><p>在阅读 jquery/effects 模块源码之前，有必要先了解一下制作前端动效的一些基本知识，其内容包含动效实现的基本原理、缓动函数等。对于以上内容，笔者将在这一小节一一加以介绍。</p>
<h3 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h3><p>动效实现的基本原理如同逐帧制作动画，相隔时间较短的两帧动画可以促使人类视觉误以为那是连续的一个过程。术语刷新率 fps 指每秒更新多少帧画面。通常，每秒刷新 24 张画面最适宜于人类视觉，也就是单张画面的滞留时间为 25 毫秒。因此，制作小球动效等价于在时间轴上计算小球当前的运动位置这一数学命题，即算术表达式 x = fn(t)。</p>
<h2 id="缓动函数"><a href="#缓动函数" class="headerlink" title="缓动函数"></a>缓动函数</h2><p>常规的缓动函数表达式为 x = fn(t, b, c, d)，其中 x 为当前样式，t 为动画执行事件，b 为起始样式，c 为最终样式，d 为动画总时长。在已知 b, c, d 三个参数的情形下，缓动函数可以表述为 x = fn(t)，其斜率为速度，二次导数为加速度。</p>
<p>常见的缓动函数可以查看 <a href="https://esings.net/zh-cn" target="_blank" rel="noopener">缓动函数速查表</a>。缓动函数名中，后缀 In 表示加速，Out 表示减速，InOut 标识先加速、后减速；后缀 Sine 表示由三角函数实现，Quad 表示由二次方函数实现，Cubic 为三次方，Quart 为四次方，Quint 为五次方，Circ 为开平方根，Expo 为开立方根，Elastic 为结合三角函数和开立方根的初级弹簧效果，Back 为使用常数 1.70158 计算的回退效果，Bounce 为高级弹簧效果。linear 为线性函数。</p>
<img src="/2018/05/20/jquery/动效分析/easing.png">
<p>jquery.esing 类库列出了多种缓动函数集合，参数 p 为动画已执行时间占动画总时长的百分比，返回值当前移动距离占总移动距离的百分比。代码如下（包含 jquery 中提供的 linear, swing 函数）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> c1 = <span class="number">1.70158</span>;</span><br><span class="line"><span class="keyword">const</span> c2 = c1 * <span class="number">1.525</span>;</span><br><span class="line"><span class="keyword">const</span> c3 = c1 + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> c4 = ( <span class="number">2</span> * <span class="built_in">Math</span>.PI ) / <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> c5 = ( <span class="number">2</span> * <span class="built_in">Math</span>.PI ) / <span class="number">4.5</span>;</span><br><span class="line"></span><br><span class="line">$.esing = &#123;</span><br><span class="line">  linear(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">  &#125;,</span><br><span class="line">  swing(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.5</span> - <span class="built_in">Math</span>.Math.cos( p * <span class="built_in">Math</span>.PI ) / <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInQuad(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p * p;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeOutQuad(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> - ( <span class="number">1</span> - p ) * ( <span class="number">1</span> - p );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInOutQuad(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p &lt; <span class="number">0.5</span> ? </span><br><span class="line">      <span class="number">2</span> * p * p : </span><br><span class="line">      <span class="number">1</span> - <span class="built_in">Math</span>.pow( <span class="number">-2</span> * p + <span class="number">2</span>, <span class="number">2</span> ) / <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInCubic(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p * p * p;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeOutCubic(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> - <span class="built_in">Math</span>.pow( <span class="number">1</span> - p, <span class="number">3</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInOutCubic(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p &lt; <span class="number">0.5</span> ? </span><br><span class="line">      <span class="number">4</span> * p * p * p : </span><br><span class="line">      <span class="number">1</span> - <span class="built_in">Math</span>.pow( <span class="number">-2</span> * p + <span class="number">2</span>, <span class="number">3</span> ) / <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInQuart(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p * p * p * p;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeOutQuart(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> - <span class="built_in">Math</span>.pow( <span class="number">1</span> - p, <span class="number">4</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInOutQuart(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p &lt; <span class="number">0.5</span> ?</span><br><span class="line">      <span class="number">8</span> * p * p * p * p :</span><br><span class="line">      <span class="number">1</span> - <span class="built_in">Math</span>.pow( <span class="number">-2</span> * p + <span class="number">2</span>, <span class="number">4</span> ) / <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInQuint(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p * p * p * p * p;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeOutQuint(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> - <span class="built_in">Math</span>.pow( <span class="number">1</span> - p, <span class="number">5</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInOutQuint(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p &lt; <span class="number">0.5</span> ?</span><br><span class="line">      <span class="number">16</span> * p * p * p * p * p :</span><br><span class="line">      <span class="number">1</span> - <span class="built_in">Math</span>.pow( <span class="number">-2</span> * p + <span class="number">2</span>, <span class="number">5</span> ) / <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInSine(p) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> - <span class="built_in">Math</span>.cos( p * <span class="built_in">Math</span>.PI/<span class="number">2</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeOutSine(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sin( p * <span class="built_in">Math</span>.PI/<span class="number">2</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInOutSine(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> -( <span class="built_in">Math</span>.cos( <span class="built_in">Math</span>.PI * p ) - <span class="number">1</span> ) / <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInEppo(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p === <span class="number">0</span> ? <span class="number">0</span> : <span class="built_in">Math</span>.pow( <span class="number">2</span>, <span class="number">10</span> * p - <span class="number">10</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeOutEppo(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p === <span class="number">1</span> ? <span class="number">1</span> : <span class="number">1</span> - <span class="built_in">Math</span>.pow( <span class="number">2</span>, <span class="number">-10</span> * p );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInOutEppo(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p === <span class="number">0</span> ? <span class="number">0</span> : p === <span class="number">1</span> ? <span class="number">1</span> : p &lt; <span class="number">0.5</span> ?</span><br><span class="line">      <span class="built_in">Math</span>.pow( <span class="number">2</span>, <span class="number">20</span> * p - <span class="number">10</span> ) / <span class="number">2</span> :</span><br><span class="line">      ( <span class="number">2</span> - <span class="built_in">Math</span>.pow( <span class="number">2</span>, <span class="number">-20</span> * p + <span class="number">10</span> ) ) / <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInCirc(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> - <span class="built_in">Math</span>.sqrt( <span class="number">1</span> - <span class="built_in">Math</span>.pow( p, <span class="number">2</span> ) );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeOutCirc(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt( <span class="number">1</span> - <span class="built_in">Math</span>.pow( p - <span class="number">1</span>, <span class="number">2</span> ) );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInOutCirc(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p &lt; <span class="number">0.5</span> ?</span><br><span class="line">      ( <span class="number">1</span> - <span class="built_in">Math</span>.sqrt( <span class="number">1</span> - <span class="built_in">Math</span>.pow( <span class="number">2</span> * p, <span class="number">2</span> ) ) ) / <span class="number">2</span> :</span><br><span class="line">      ( <span class="built_in">Math</span>.sqrt( <span class="number">1</span> - <span class="built_in">Math</span>.pow( <span class="number">-2</span> * p + <span class="number">2</span>, <span class="number">2</span> ) ) + <span class="number">1</span> ) / <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInElastic(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p === <span class="number">0</span> ? <span class="number">0</span> : p === <span class="number">1</span> ? <span class="number">1</span> :</span><br><span class="line">      -<span class="built_in">Math</span>.pow( <span class="number">2</span>, <span class="number">10</span> * p - <span class="number">10</span> ) * <span class="built_in">Math</span>.sin( ( p * <span class="number">10</span> - <span class="number">10.75</span> ) * c4 );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeOutElastic(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p === <span class="number">0</span> ? <span class="number">0</span> : p === <span class="number">1</span> ? <span class="number">1</span> :</span><br><span class="line">      <span class="built_in">Math</span>.pow( <span class="number">2</span>, <span class="number">-10</span> * p ) * <span class="built_in">Math</span>.sin( ( p * <span class="number">10</span> - <span class="number">0.75</span> ) * c4 ) + <span class="number">1</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInOutElastic(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p === <span class="number">0</span> ? <span class="number">0</span> : p === <span class="number">1</span> ? <span class="number">1</span> : p &lt; <span class="number">0.5</span> ?</span><br><span class="line">      -( <span class="built_in">Math</span>.pow( <span class="number">2</span>, <span class="number">20</span> * p - <span class="number">10</span> ) * <span class="built_in">Math</span>.sin( ( <span class="number">20</span> * p - <span class="number">11.125</span> ) * c5 )) / <span class="number">2</span> :</span><br><span class="line">      <span class="built_in">Math</span>.pow( <span class="number">2</span>, <span class="number">-20</span> * p + <span class="number">10</span> ) * <span class="built_in">Math</span>.sin( ( <span class="number">20</span> * p - <span class="number">11.125</span> ) * c5 ) / <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInBack(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> c3 * p * p * p - c1 * p * p;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeOutBack(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> + c3 * <span class="built_in">Math</span>.pow( p - <span class="number">1</span>, <span class="number">3</span> ) + c1 * <span class="built_in">Math</span>.pow( p - <span class="number">1</span>, <span class="number">2</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInOutBack(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p &lt; <span class="number">0.5</span> ?</span><br><span class="line">      ( <span class="built_in">Math</span>.pow( <span class="number">2</span> * p, <span class="number">2</span> ) * ( ( c2 + <span class="number">1</span> ) * <span class="number">2</span> * p - c2 ) ) / <span class="number">2</span> :</span><br><span class="line">      ( <span class="built_in">Math</span>.pow( <span class="number">2</span> * p - <span class="number">2</span>, <span class="number">2</span> ) *( ( c2 + <span class="number">1</span> ) * ( p * <span class="number">2</span> - <span class="number">2</span> ) + c2 ) + <span class="number">2</span> ) / <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInBounce(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> - bounceOut( <span class="number">1</span> - p );</span><br><span class="line">  &#125;,</span><br><span class="line">  easeOutBounce(p) &#123;</span><br><span class="line">    <span class="keyword">var</span> n1 = <span class="number">7.5625</span>,</span><br><span class="line">      d1 = <span class="number">2.75</span>;</span><br><span class="line">    <span class="keyword">if</span> ( p &lt; <span class="number">1</span> / d1 ) &#123;</span><br><span class="line">      <span class="keyword">return</span> n1 * p * p;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( p &lt; <span class="number">2</span> / d1 ) &#123;</span><br><span class="line">      <span class="keyword">return</span> n1 * (p -= (<span class="number">1.5</span> / d1)) * p + <span class="number">0.75</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( p &lt; <span class="number">2.5</span> / d1 ) &#123;</span><br><span class="line">      <span class="keyword">return</span> n1 * (p -= (<span class="number">2.25</span> / d1)) * p + <span class="number">0.9375</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> n1 * (p-=(<span class="number">2.625</span>/d1))*p + <span class="number">0.984375</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  easeInOutBounce(p)&#123;</span><br><span class="line">    <span class="keyword">return</span> p &lt; <span class="number">0.5</span> ?</span><br><span class="line">      ( <span class="number">1</span> - bounceOut( <span class="number">1</span> - <span class="number">2</span> * p ) ) / <span class="number">2</span> :</span><br><span class="line">      ( <span class="number">1</span> + bounceOut( <span class="number">2</span> * p - <span class="number">1</span> ) ) / <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>关于各式缓动函数的由来、及其与贝塞尔曲线的关系，笔者暂时没能力加以分析。</p>
<h3 id="requestAnimationFrame"><a href="#requestAnimationFrame" class="headerlink" title="requestAnimationFrame"></a>requestAnimationFrame</h3><p>有了缓动函数，就需要通过定时器运作动画脚本，间隔 25 毫秒刷新元素的显示样式。通常，我们会使用 setInterval 函数创建定时器，但在这种情况下，当页面上有多个动画脚本时，创建的多个定时器无疑会影响性能，就容易造成动画的执行延时。为了优化性能，我们可借助于创建队列的方式，把待执行的动画脚本添加到队列中，再使用单个定时器在 25 毫秒取出队列中的函数加以执行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> millisec = <span class="number">25</span>;</span><br><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="keyword">const</span> uuid = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  [...queue.values()].map(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">    fn(<span class="keyword">new</span> <span class="built_in">Date</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.setInterval(animate, millisec);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> request = <span class="function"><span class="params">handler</span> =&gt;</span> &#123;</span><br><span class="line">  uuid++;</span><br><span class="line">  queue.set(uuid, handler);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> uuid;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cancel = <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">  queue.delete(id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  request,</span><br><span class="line">  cancel</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>对于上述 js 代码，浏览器端提供的 requestAnimationFrame 接口也实现了相同的功能，由浏览器管控 dom 渲染的时机、事件队列等，刷新率为 60 帧左右，不能快进，也不能放慢，不适用于帧率要求较高的动画，如游戏等。requestAnimationFrame 函数的返回值为 ID，可用于终止动画；通过调用 cancelAnimationFrame 接口的方式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAnimationFrame</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; </span><br><span class="line">    requestAnimationFrame, cancelAnimationFrame, </span><br><span class="line">    mozRequestAnimationFrame, mozCancelAnimationFrame, </span><br><span class="line">    webiketRequestAnimationFrame, webkitCancelAnimationFrame </span><br><span class="line">  &#125; = <span class="built_in">window</span>;</span><br><span class="line">  <span class="keyword">const</span> EmptyFunction = <span class="function"><span class="params">timestamp</span> =&gt;</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// IE10, Chrome24</span></span><br><span class="line">  <span class="keyword">if</span> ( requestAnimationFrame )&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      request: requestAnimationFrame,</span><br><span class="line">      cancel: cancelAnimationFrame</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// FireFox 11 以下没有实现 mozCancelAnimationFrame 接口</span></span><br><span class="line">  <span class="comment">// 且 mozRequestAnimationFrame 接口只用于触发 'MozBeforePaint' 事件</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( mozRequestAnimationFrame &amp;&amp; mozCancelAnimationFrame )&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      request: mozRequestAnimationFrame,</span><br><span class="line">      cancel: mozCancelAnimationFrame</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// webkit 某个版本没有返回 id，动画不能清除</span></span><br><span class="line">  <span class="comment">// webkit 某个版本没有给动画函数注入 time 参数</span></span><br><span class="line">  <span class="comment">// webkit 早期版本使用 webkitCancelRequestAnimationFrame 清除动画</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( webiketRequestAnimationFrame &amp;&amp; webiketRequestAnimationFrame(EmptyFunction) )&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      request: <span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webiketRequestAnimationFrame(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> fn(<span class="keyword">new</span> <span class="built_in">Date</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      cancel: webkitCancelAnimationFrame || webkitCancelRequestAnimationFrame</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h4><p>除了 setInterval, requestAnimationFrame 方法，还可以借助 setTimeout 函数（通过递归调用）、postMessage 异步方法（同 setImmediate 函数，在所有页面脚本执行完成后被调用，通过 addEventListener 方法监听 ‘message’ 事件）实现动画，IE10 还可以借助 setImmediate 方法。</p>
<p>通过自制脚本，可以侦测 setInterval, setTimeout, requestAnimationFrame, postMessage 诸方法在 1s 时间内的最小帧数，最大帧数以及平均帧数，并以图形化界面输出。关于这部分内容，可参考司徒正美的《Javascript 框架设计》一书第 381 页。笔者不作详谈。</p>
<p>关于 setImmediate 方法以及 node 端 process.nextTick 方法的实现原理，笔者将在后续的文章中加以分析。</p>
<h3 id="动画队列"><a href="#动画队列" class="headerlink" title="动画队列"></a>动画队列</h3><p>动画队列是指以联动方式组织同一个元素的动画流程，当前一个动画执行完成后，再执行下一个动画。</p>
<h2 id="jQuery-基础"><a href="#jQuery-基础" class="headerlink" title="jQuery 基础"></a>jQuery 基础</h2><p>这部分内容将介绍 jQuery/effects 动画模块所涉及的 jQuery 接口。关于这些接口的实现，读者可参详网上内容。当然，笔者也将在后续的文章加以详谈。</p>
<h3 id="Promise-对象"><a href="#Promise-对象" class="headerlink" title="Promise 对象"></a>Promise 对象</h3><p>$.deferred 方法用于创建 Promise 延迟对象。该Promise 对象中，promise 方法，可以为 Promise 对象添加额外的属性和方法；progress, done, fail, always 方法可用于挂载回调函数；notifyWith, resolveWith, rejectWith 方法用于触发回调函数的执行。</p>
<p>Promise 对象在动效模块中的表现就是在动画执行期间或动画执行完成后，触发特定回调函数的执行。</p>
<p>在 jQuery 动效源码中，我们也将看到嵌套使用 promise.done 方法（defaultPrefilter 函数中嵌套使用 anim.always 方法，以清除缓存中的 queue 属性），以确保某个回调函数必然最后执行。因为该回调函数在包裹它的回调执行期间，被添加回调队列中，也就是回调队列中的最后一项。</p>
<h3 id="css-操作"><a href="#css-操作" class="headerlink" title="css 操作"></a>css 操作</h3><p>$.css(prop, [val]) 方法用于获取或设置元素的显示样式。</p>
<p>$.cssHooks 集合形式，为指定 css 样式设置 $.css 方法的执行逻辑，如 $.cssHooks.borderRadius 是为对圆角进行处理，其值为 { get: (elem, computed, extra) =&gt; {}, set: (elem, value) =&gt; {}, expand: value =&gt; {} } 形式的对象。其中，get, set 方法影响 css 样式的取值、赋值操作，expand 方法对样式的值进行处理。</p>
<p>adjustCSS(elem, prop, valueParts, tween)，内部方法，转换并获得待设置的 css 样式值。参数 valueParts 为新设置的 css 属性，包含 +/- 符号、数值和单位，有两种设定形式，包含 +/- 号时，在原值上累加；不包含，取 valueParts 中的数值作为新的样式值。在第一种情形下，valueParts 中的单位若与获取到的样式值的原单位不符，需要将原样式值转换为新单位下的相应值。参数 tween 在动画情形中使用，其 cur 方法用于获取当前样式值，在 adjustCSS 方法执行过程中，其 unit, start, end 属性将相应得到修正。</p>
<p>showHide(elems, showFlag)，内部方法，用于显式或隐藏元素。</p>
<h3 id="data-缓存"><a href="#data-缓存" class="headerlink" title="data 缓存"></a>data 缓存</h3><p>jQuery 中创建的 Data 实例，是通过挂载在特定的节点上实现的，又分为两类，第一类通过 dataPriv 函数创建私有的 Data 实例，第二类通过 dataUser 函数创建外部使用的 Data 实例。data 实例又包含 cache(owner), get(owner, key), set(owner, key, value), access(owner, key, [value]), remove(owner, key), hasData(owner) 方法，其中，参数 owner 为挂载缓存数据的对象，通常为节点。</p>
<p>当全量取出 data 缓存数据时（在不设定 key 键的情况下），作为引用对象，修改其值，也将影响缓存数据。这一点在 jQuery 动效源码中 defaultPrefilter 处理 queue 队列时有使用。</p>
<h3 id="queue-队列"><a href="#queue-队列" class="headerlink" title="queue 队列"></a>queue 队列</h3><p>jQuery.queue(elem, type, data) 方法通过 dataPriv 数据缓存创建、添加或获取以 <code>${queueName}queue</code> 为主键的函数队列。</p>
<p>jQuery.dequeue(elem, type) 方法取出 <code>${queueName}queue</code> 函数队列中首个函数并执行。每个队列函数获得的参数为 elem, next, hooks，其中，next 借助于 jQuery.dequeue 方法执行第二个队列函数，hooks 为 <code>${queueName}queueHooks</code> 钩子函数集合。当 type 为默认的 ‘fx’ 时，在队列顶端插入 ‘inprogress’ 字符串，标记当前有队列函数在执行中，阻止 $.queue 方法运作过程取出首个队列函数并执行，而只能通过 $.dequeue 或 jQuery.dequeue 方法执行队列函数。不得不说，jQuery 中的多态性、各模块间的耦合度几至于芜杂，并不简单明朗，也许借助于类的方式可以写得更为晓畅明白。</p>
<p>jQuery._queueHooks(elem, type) 方法取出 <code>${queueName}queueHooks</code> 钩子函数集合，或其默认值。默认的钩子函数集合只包含 empty 方法，即如前所述，其用于从 dataPriv 缓存中移除 <code>${queueName}queue</code> 属性。</p>
<p>$.queue(queueName, [queue || callback]) 创建、添加或获取 <code>${queueName}queue</code> 函数队列。当添加队列函数时，其会调用 jQuery.dequeue 取出居于首位的队列函数并执行，若其取出的 <code>${queueName}queue</code> 首项不是 ‘inprogress’ 字符串。</p>
<p>$.dequeue(queueName) 方法从 <code>${queueName}queue</code> 函数队列中取出顶端的函数并执行，且下一个队列函数将作为参数 next 传入前一个队列函数中，queue 缓存数据则会即时移除该顶端函数；所有队列函数取出执行后，调用 <code>${queueName}queueHooks</code> 钩子函数集合中的 empty 方法，用于从 dataPriv 缓存中移除 <code>${queueName}queue</code> 属性。</p>
<p>$.clearQueue(queueName) 方法用于清空 <code>${queueName}queue</code> 函数队列。</p>
<p>queue 队列在动效模块中的表现就是组织动画队列。jQuery 的动画可分为两种情形，其一立即执行，多个动画也将并行执行，其二使用动画队列，挨个执行。jQuery 默认使用动画队列方式处理动效。</p>
<p>使用 $.queue 方法添加动画函数时，默认首个动画会立即执行。当再度调用 $.queue 方法添加第二个动画函数时，因为其从 queue 队列中取出的首项为 ‘inprogress’ 字符串，第二个动画函数在 $.queue 方法执行期间得不到执行。若在此时，第一个动画函数执行完成后的回调中使用 jQuery.dequeue 方法，则将触发第二个动画函数的执行。这部分源码参见下文。下文中，queue 队列指代本节中的 <code>${queueName}queue</code> 函数队列，queueHooks 钩子函数集合指代 <code>${queueName}queueHooks</code> 钩子函数集合，queueHooks.empty 指代钩子函数集合中的 empty 方法，dataPriv.queue 指代 dataPriv[<code>${queueName}queue</code>] 队列函数。</p>
<h2 id="动效模块设计"><a href="#动效模块设计" class="headerlink" title="动效模块设计"></a>动效模块设计</h2><p>jQuery 对动效模块的设计中，首先映入眼帘的是 Animation 函数，其基本骨架是以 deferred 模块组织异步逻辑。其中，tick 内含定时任务函数用于计算动画已执行时长百分比，并触发挂载在 promise 对象上的 progress, done, fail 回调函数的执行；animation 内部变量既包含基本的动画属性和方法，又兼有 promise 对象的属性和方法，随后通过该 animation 对象挂载 progress, done, fail 回调。</p>
<p>在 Animation 函数中，propFilter 函数用于转换 Animation 函数参数中的样式配置项及缓动配置项；Animation.prefilters 数组为动画执行前的一组预处理函数，既能影响应用于动画上的一些属性，又能通过 animation 的 progress, done, fail, always 方法影响异步回调。默认的 defaultPrefilter 函数用于清空 queue 队列，以及对显示隐藏动画作特殊处理。</p>
<p>tick 定时任务通过 jQuery.fx.timer 函数执行，其实现是添加到 jQuery.timers 动画队列中，由 schedule 调度函数通过 window.requestAnimationFrame 方法或 window.setTimeout 函数在一定时间内取出执行。所以，jQuery 中所有动画可理解为均借助于单个定时器实现。在 schedule 函数调度实现的基础上，jQuery 中所有动画可以通过 jQuery.fx.stop 函数终止动画的运作。</p>
<p>以上描述均不涉及 jQuery 动画中的样式变更凭何实现，那么 jQuery 动画中的样式变更到底是怎么实现的呢？原来在定时任务 tick 执行过程中，jQuery 会取出 animation.tweens 数组并执行数组项的 run 方法。tween 又是怎样一个概念呢？tween 针对单个 css 样式属性，通过当前样式值及动画已执行时长计算待调整的样式值，并对元素的样式做出调整。因此在 Animation 函数的实现中，程序首先将遍历待变更的 css 样式属性创建 tween；当 jQuery.fx.timer 函数触发 tick 定时任务函数执行时，在 tick 函数执行过程中，将遍历 tween 数组并执行其 run 方法，促使元素的样式得到更新。</p>
<p>以上内容，可以分为四个板块：</p>
<ol>
<li><p>以 jQuery.fx.timer 等函数为核心的定时任务调用机制。</p>
</li>
<li><p>Tween 实例的创建和执行，以通过缓动函数更新节点样式。</p>
</li>
<li><p>基于 promise 实现的 Animation 函数，设置定时任务 tick 函数，并约定回调执行时机，处理参数，执行 prefilter 预处理器，挂载回调。</p>
</li>
<li><p>由以上三点，提供对外接口，如 $.animate, $.stop, $.finish 方法。</p>
</li>
</ol>
<h2 id="动效模块实现"><a href="#动效模块实现" class="headerlink" title="动效模块实现"></a>动效模块实现</h2><h3 id="jQuery-fx-timer-定时任务"><a href="#jQuery-fx-timer-定时任务" class="headerlink" title="jQuery.fx.timer 定时任务"></a>jQuery.fx.timer 定时任务</h3><p>当有定时任务 timer 函数，通过 jQuery.fx.timer 函数存入 jQuery.timers 定时任务队列中，再调用 jQuery.fx.start 函数，以启动定时任务调用程序。当用户反复调用 jQuery.fx.timer 函数时，为了避免定时任务调用程序多次执行，jQuery.fx.start 函数中带有 inProgress 标识。当定时任务调用程序已启动，inProgress 标识置为真值，实际的调度函数 schedule 将不再被重复调用。</p>
<p>通过 jQuery.fx.start 函数调用的调度函数 schedule 中，或者借助于 window.requestAnimationFrame 方法或者借助于 window.setTimeout 方法，以在间隔一定时间内递归调用 schedule 函数，从而触发 jQuery.fx.tick 函数的执行。</p>
<p>jQuery.fx.tick 函数中，程序将取出 jQuery.timers 队列中的所有定时任务并同步执行执行，若定时任务返回否值，则将其从 jQuery.timers 队列中移除。即当某个定时任务返回真值时，该定时任务将在一定时间间隔后再次被调用，直到其返回否值。</p>
<p>借助于 inProgress 标识为真值时，实际的调度函数 schedule 才会遍历 jQuery.timers 队列中的定时任务并予以执行，jQuery.fx.stop 方法通过将 inProgress 标识置为 null 的方式，可用于终止定时任务调用程序。而在 schedule 调度函数的执行逻辑中，当 jQuery.timers 队列已清空，也会通过调用 jQuery.fx.stop 方法，将 inProgress 标识置为 null。</p>
<p>在 jQuery 动画模块中，作为 timer 定时任务函数的是，Animation 函数体内创建的 tick 函数，其执行逻辑为在动画执行期间更新样式并触发 progress 回调，在动画完成后触发 done, fail 回调。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fxNow;</span><br><span class="line">jQuery.timers = [];</span><br><span class="line">jQuery.fx.interval = <span class="number">13</span>;</span><br><span class="line"></span><br><span class="line">jQuery.fx.timer = <span class="function"><span class="keyword">function</span>(<span class="params"> timer </span>) </span>&#123;</span><br><span class="line">	jQuery.timers.push( timer );</span><br><span class="line">	jQuery.fx.start();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">jQuery.fx.start = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( inProgress ) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	inProgress = <span class="literal">true</span>;</span><br><span class="line">	schedule();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">schedule</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( inProgress ) &#123;</span><br><span class="line">		<span class="keyword">if</span> ( <span class="built_in">document</span>.hidden === <span class="literal">false</span> &amp;&amp; <span class="built_in">window</span>.requestAnimationFrame ) &#123;</span><br><span class="line">			<span class="built_in">window</span>.requestAnimationFrame( schedule );</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">window</span>.setTimeout( schedule, jQuery.fx.interval );</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		jQuery.fx.tick();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jQuery.fx.tick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> timer,</span><br><span class="line">		i = <span class="number">0</span>,</span><br><span class="line">		timers = jQuery.timers;</span><br><span class="line"></span><br><span class="line">	fxNow = <span class="built_in">Date</span>.now();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> ( ; i &lt; timers.length; i++ ) &#123;</span><br><span class="line">		timer = timers[ i ];</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Run the timer and safely remove it when done (allowing for external removal)</span></span><br><span class="line">		<span class="keyword">if</span> ( !timer() &amp;&amp; timers[ i ] === timer ) &#123;</span><br><span class="line">			timers.splice( i--, <span class="number">1</span> );</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ( !timers.length ) &#123;</span><br><span class="line">		jQuery.fx.stop();</span><br><span class="line">	&#125;</span><br><span class="line">	fxNow = <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">jQuery.fx.stop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	inProgress = <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Tween-样式更新"><a href="#Tween-样式更新" class="headerlink" title="Tween 样式更新"></a>Tween 样式更新</h3><h4 id="Tween-构造函数"><a href="#Tween-构造函数" class="headerlink" title="Tween 构造函数"></a>Tween 构造函数</h4><p>Tween 在实例化过程中，首先记录关联的节点 this.elem、待更新的样式属性 this.prop、缓动函数类型 this.easing、选项 this.options（包含动画执行时长 duration、步进函数 step = (currentStyle, tween) =&gt; {}。其中，步进函数执行时的上下文为节点元素，即 this.elem），随后计算起始样式值 this.start，并记录结束样式值 this.end、样式的单位 this.unit。</p>
<p>在 Tween 实例的 run 方法中，将更新节点的样式值。其实现的具体逻辑为，根据传参动 percent 画已执行时长百分比，通过缓动函数 eased = fn(percent, duration * percent, 0, 1, duration)，计算样式已变更值占所需变更值的百分比 eased，并存入 this.pos 属性中，由此获得新的样式值 this.now。（缓动函数见前文）</p>
<p>在 Tween 实例的执行逻辑中，jQuery 额外构建了一套节点样式取值、赋值机制，即通过 Tween.propHooks 样式处理集合进行操作。其所需面对的一种情形是，this.elem 不是节点元素，或者指定的样式属性 this.prop 不是节点所有的属性，来自于用户自定义。在这种情况下，Tween.propHooks 作为一种钩子处理集合，将截获样式的获取和赋值，由 elem 引用对象以 elem[this.prop] = this.now 的形式存储待更新的样式。同时针对 IE 9 及其以下浏览器，scrollTop 作为特殊的样式，其样式赋值操作将直接作用于 elem 元素，而不是 elem.style 样式集合中。</p>
<p>与此同时，若用户在 jQuery.fx.step 步进函数集合中注册了针对某一个样式的特殊行为，样式赋值操作将只唤醒该行为，而不会对节点 this.elem 进行处理。如需对 this.elem 节点的样式进行处理，仍需要由用户承担额外的开发工作。</p>
<p>关于选项中的步进函数 options.step，其可用于以日志形式记录待更新样式的值、或者在样式更新的某个值上作特殊处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Tween</span>(<span class="params"> elem, options, prop, end, easing </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> Tween.prototype.init( elem, options, prop, end, easing );</span><br><span class="line">&#125;</span><br><span class="line">jQuery.Tween = Tween;</span><br><span class="line"></span><br><span class="line">Tween.prototype = &#123;</span><br><span class="line">	<span class="keyword">constructor</span>: Tween,</span><br><span class="line">	init: function( elem, options, prop, end, easing, unit ) &#123;</span><br><span class="line">		<span class="keyword">this</span>.elem = elem;</span><br><span class="line">		<span class="keyword">this</span>.prop = prop;</span><br><span class="line">		<span class="keyword">this</span>.easing = easing || jQuery.easing._default;</span><br><span class="line">		<span class="keyword">this</span>.options = options;</span><br><span class="line">		<span class="keyword">this</span>.start = <span class="keyword">this</span>.now = <span class="keyword">this</span>.cur();</span><br><span class="line">		<span class="keyword">this</span>.end = end;</span><br><span class="line">		<span class="keyword">this</span>.unit = unit || ( jQuery.cssNumber[ prop ] ? <span class="string">""</span> : <span class="string">"px"</span> );</span><br><span class="line">	&#125;,</span><br><span class="line">	cur: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> hooks = Tween.propHooks[ <span class="keyword">this</span>.prop ];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> hooks &amp;&amp; hooks.get ?</span><br><span class="line">			hooks.get( <span class="keyword">this</span> ) :</span><br><span class="line">			Tween.propHooks._default.get( <span class="keyword">this</span> );</span><br><span class="line">	&#125;,</span><br><span class="line">	run: <span class="function"><span class="keyword">function</span>(<span class="params"> percent </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> eased,</span><br><span class="line">			hooks = Tween.propHooks[ <span class="keyword">this</span>.prop ];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( <span class="keyword">this</span>.options.duration ) &#123;</span><br><span class="line">			<span class="keyword">this</span>.pos = eased = jQuery.easing[ <span class="keyword">this</span>.easing ](</span><br><span class="line">				percent, <span class="keyword">this</span>.options.duration * percent, <span class="number">0</span>, <span class="number">1</span>, <span class="keyword">this</span>.options.duration</span><br><span class="line">			);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">this</span>.pos = eased = percent;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">this</span>.now = ( <span class="keyword">this</span>.end - <span class="keyword">this</span>.start ) * eased + <span class="keyword">this</span>.start;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( <span class="keyword">this</span>.options.step ) &#123;</span><br><span class="line">			<span class="keyword">this</span>.options.step.call( <span class="keyword">this</span>.elem, <span class="keyword">this</span>.now, <span class="keyword">this</span> );</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( hooks &amp;&amp; hooks.set ) &#123;</span><br><span class="line">			hooks.set( <span class="keyword">this</span> );</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			Tween.propHooks._default.set( <span class="keyword">this</span> );</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Tween.prototype.init.prototype = Tween.prototype;</span><br><span class="line"></span><br><span class="line">Tween.propHooks = &#123;</span><br><span class="line">	_default: &#123;</span><br><span class="line">		get: <span class="function"><span class="keyword">function</span>(<span class="params"> tween </span>) </span>&#123;</span><br><span class="line">			<span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Use a property on the element directly when it is not a DOM element,</span></span><br><span class="line">			<span class="comment">// or when there is no matching style property that exists.</span></span><br><span class="line">			<span class="keyword">if</span> ( tween.elem.nodeType !== <span class="number">1</span> ||</span><br><span class="line">				tween.elem[ tween.prop ] != <span class="literal">null</span> &amp;&amp; tween.elem.style[ tween.prop ] == <span class="literal">null</span> ) &#123;</span><br><span class="line">				<span class="keyword">return</span> tween.elem[ tween.prop ];</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Passing an empty string as a 3rd parameter to .css will automatically</span></span><br><span class="line">			<span class="comment">// attempt a parseFloat and fallback to a string if the parse fails.</span></span><br><span class="line">			<span class="comment">// Simple values such as "10px" are parsed to Float;</span></span><br><span class="line">			<span class="comment">// complex values such as "rotate(1rad)" are returned as-is.</span></span><br><span class="line">			result = jQuery.css( tween.elem, tween.prop, <span class="string">""</span> );</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Empty strings, null, undefined and "auto" are converted to 0.</span></span><br><span class="line">			<span class="keyword">return</span> !result || result === <span class="string">"auto"</span> ? <span class="number">0</span> : result;</span><br><span class="line">		&#125;,</span><br><span class="line">		set: <span class="function"><span class="keyword">function</span>(<span class="params"> tween </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Use step hook for back compat.</span></span><br><span class="line">			<span class="comment">// Use cssHook if its there.</span></span><br><span class="line">			<span class="comment">// Use .style if available and use plain properties where available.</span></span><br><span class="line">			<span class="keyword">if</span> ( jQuery.fx.step[ tween.prop ] ) &#123;</span><br><span class="line">				jQuery.fx.step[ tween.prop ]( tween );</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( tween.elem.nodeType === <span class="number">1</span> &amp;&amp;</span><br><span class="line">				( tween.elem.style[ jQuery.cssProps[ tween.prop ] ] != <span class="literal">null</span> ||</span><br><span class="line">					jQuery.cssHooks[ tween.prop ] ) ) &#123;</span><br><span class="line">				jQuery.style( tween.elem, tween.prop, tween.now + tween.unit );</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				tween.elem[ tween.prop ] = tween.now;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Support: IE &lt;=9 only</span></span><br><span class="line"><span class="comment">// Panic based approach to setting things on disconnected nodes</span></span><br><span class="line">Tween.propHooks.scrollTop = Tween.propHooks.scrollLeft = &#123;</span><br><span class="line">	set: <span class="function"><span class="keyword">function</span>(<span class="params"> tween </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ( tween.elem.nodeType &amp;&amp; tween.elem.parentNode ) &#123;</span><br><span class="line">			tween.elem[ tween.prop ] = tween.now;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">jQuery.easing = &#123;</span><br><span class="line">	linear: <span class="function"><span class="keyword">function</span>(<span class="params"> p </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> p;</span><br><span class="line">	&#125;,</span><br><span class="line">	swing: <span class="function"><span class="keyword">function</span>(<span class="params"> p </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0.5</span> - <span class="built_in">Math</span>.cos( p * <span class="built_in">Math</span>.PI ) / <span class="number">2</span>;</span><br><span class="line">	&#125;,</span><br><span class="line">	_default: <span class="string">"swing"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Back compat &lt;1.8 extension point</span></span><br><span class="line">jQuery.fx.step = &#123;&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="创建-Tween-实例"><a href="#创建-Tween-实例" class="headerlink" title="创建 Tween 实例"></a>创建 Tween 实例</h4><p>不得不说，jQuery 有五花八门的拦截机制，部分是为了满足吊诡的开发需要，部分是为了便于对 jQuery 作一层封装。其实既不借助于事件系统，也不像 webpack 那样采用回调链的方式（适用于异步形式，可以拦截后续的流程），而是使用注册 hooks 集合，针对属性对原始行为作一些拓展。Tween 构造函数中如此，创建 Tween 实例也是如此。</p>
<p>在 Animation 函数中，jQuery 将针对每个待调整的样式属性创建各自的 Tween 实例，默认采用 animition.createTween 方法。这一过程由 Animation.tweeners[ “<em>“ ] 方法实现，当样式值带有 +, - 号时，adjustCSS 用于调整结束样式。除此之外，用户可以使用 Animation.tweener(callback) 方法改变 Animation.tweeners[ “</em>“ ] 方法的行为，或者使用 Animation.tweener(prop, callback) 方法创建自定义的 tween，用于变更样式值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTween</span>(<span class="params"> value, prop, animation </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> tween,</span><br><span class="line">		collection = ( Animation.tweeners[ prop ] || [] ).concat( Animation.tweeners[ <span class="string">"*"</span> ] ),</span><br><span class="line">		index = <span class="number">0</span>,</span><br><span class="line">		length = collection.length;</span><br><span class="line">	<span class="keyword">for</span> ( ; index &lt; length; index++ ) &#123;</span><br><span class="line">		<span class="keyword">if</span> ( ( tween = collection[ index ].call( animation, prop, value ) ) ) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// We're done with this property</span></span><br><span class="line">			<span class="keyword">return</span> tween;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animation</span>(<span class="params"> elem, properties, options </span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> animation = deferred.promise( &#123;</span><br><span class="line">			tweens: [],</span><br><span class="line">			createTween: <span class="function"><span class="keyword">function</span>(<span class="params"> prop, end </span>) </span>&#123;</span><br><span class="line">				<span class="keyword">var</span> tween = jQuery.Tween( elem, animation.opts, prop, end,</span><br><span class="line">						animation.opts.specialEasing[ prop ] || animation.opts.easing );</span><br><span class="line">				animation.tweens.push( tween );</span><br><span class="line">				<span class="keyword">return</span> tween;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">		&#125; );</span><br><span class="line"></span><br><span class="line">  jQuery.map( props, createTween, animation );</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jQuery.Animation = jQuery.extend( Animation, &#123;</span><br><span class="line">	tweeners: &#123;</span><br><span class="line">		<span class="string">"*"</span>: [ <span class="function"><span class="keyword">function</span>(<span class="params"> prop, value </span>) </span>&#123;</span><br><span class="line">			<span class="keyword">var</span> tween = <span class="keyword">this</span>.createTween( prop, value );</span><br><span class="line">			adjustCSS( tween.elem, prop, rcssNum.exec( value ), tween );</span><br><span class="line">			<span class="keyword">return</span> tween;</span><br><span class="line">		&#125; ]</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	tweener: <span class="function"><span class="keyword">function</span>(<span class="params"> props, callback </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ( isFunction( props ) ) &#123;</span><br><span class="line">			callback = props;</span><br><span class="line">			props = [ <span class="string">"*"</span> ];</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			props = props.match( rnothtmlwhite );</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">var</span> prop,</span><br><span class="line">			index = <span class="number">0</span>,</span><br><span class="line">			length = props.length;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> ( ; index &lt; length; index++ ) &#123;</span><br><span class="line">			prop = props[ index ];</span><br><span class="line">			Animation.tweeners[ prop ] = Animation.tweeners[ prop ] || [];</span><br><span class="line">			Animation.tweeners[ prop ].unshift( callback );</span><br><span class="line">		&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Animation-动画函数"><a href="#Animation-动画函数" class="headerlink" title="Animation 动画函数"></a>Animation 动画函数</h3><p>剥离 jQuery.fx.timer 定时任务执行机制和 Tween 样式变更机制后，Animation 函数的实现也极为简单。其主要逻辑为，借助 deferred 模块创建 promise 对象，构建 tick 函数用于设置 promise 回调的执行时机以及调用 tween.run 方法更新样式，为 promise 对象设置回调函数。</p>
<p>除了设置 promise 回调相关内容、启动定时任务执行脚本外，Animation 函数还有一些预处理操作。其中，propFilter 对参数进行预处理；Animation.prefilters 对 queue 队列以及特殊样式进行预处理，其返回值中的 stop 方法将注册为 queueHooks 钩子函数集合的 stop 方法；选项 options.start 由用户对 animation 进行一些预处理操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animation</span>(<span class="params"> elem, properties, options </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> result,</span><br><span class="line">		stopped,</span><br><span class="line">		index = <span class="number">0</span>,</span><br><span class="line">		length = Animation.prefilters.length,</span><br><span class="line">		deferred = jQuery.Deferred().always( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Don't match elem in the :animated selector</span></span><br><span class="line">			<span class="keyword">delete</span> tick.elem;</span><br><span class="line">		&#125; ),</span><br><span class="line">		tick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> ( stopped ) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">var</span> currentTime = fxNow || createFxNow(),</span><br><span class="line">				remaining = <span class="built_in">Math</span>.max( <span class="number">0</span>, animation.startTime + animation.duration - currentTime ),</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Support: Android 2.3 only</span></span><br><span class="line">				<span class="comment">// Archaic crash bug won't allow us to use `1 - ( 0.5 || 0 )` (#12497)</span></span><br><span class="line">				temp = remaining / animation.duration || <span class="number">0</span>,</span><br><span class="line">				percent = <span class="number">1</span> - temp,</span><br><span class="line">				index = <span class="number">0</span>,</span><br><span class="line">				length = animation.tweens.length;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> ( ; index &lt; length; index++ ) &#123;</span><br><span class="line">				animation.tweens[ index ].run( percent );</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			deferred.notifyWith( elem, [ animation, percent, remaining ] );</span><br><span class="line"></span><br><span class="line">			<span class="comment">// If there's more to do, yield</span></span><br><span class="line">			<span class="keyword">if</span> ( percent &lt; <span class="number">1</span> &amp;&amp; length ) &#123;</span><br><span class="line">				<span class="keyword">return</span> remaining;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// If this was an empty animation, synthesize a final progress notification</span></span><br><span class="line">			<span class="keyword">if</span> ( !length ) &#123;</span><br><span class="line">				deferred.notifyWith( elem, [ animation, <span class="number">1</span>, <span class="number">0</span> ] );</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Resolve the animation and report its conclusion</span></span><br><span class="line">			deferred.resolveWith( elem, [ animation ] );</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;,</span><br><span class="line">		animation = deferred.promise( &#123;</span><br><span class="line">			elem: elem,</span><br><span class="line">			props: jQuery.extend( &#123;&#125;, properties ),</span><br><span class="line">			opts: jQuery.extend( <span class="literal">true</span>, &#123;</span><br><span class="line">				specialEasing: &#123;&#125;,</span><br><span class="line">				easing: jQuery.easing._default</span><br><span class="line">			&#125;, options ),</span><br><span class="line">			originalProperties: properties,</span><br><span class="line">			originalOptions: options,</span><br><span class="line">			startTime: fxNow || createFxNow(),</span><br><span class="line">			duration: options.duration,</span><br><span class="line">			tweens: [],</span><br><span class="line">			createTween: <span class="function"><span class="keyword">function</span>(<span class="params"> prop, end </span>) </span>&#123;</span><br><span class="line">				<span class="keyword">var</span> tween = jQuery.Tween( elem, animation.opts, prop, end,</span><br><span class="line">						animation.opts.specialEasing[ prop ] || animation.opts.easing );</span><br><span class="line">				animation.tweens.push( tween );</span><br><span class="line">				<span class="keyword">return</span> tween;</span><br><span class="line">			&#125;,</span><br><span class="line">			stop: <span class="function"><span class="keyword">function</span>(<span class="params"> gotoEnd </span>) </span>&#123;</span><br><span class="line">				<span class="keyword">var</span> index = <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">					<span class="comment">// If we are going to the end, we want to run all the tweens</span></span><br><span class="line">					<span class="comment">// otherwise we skip this part</span></span><br><span class="line">					length = gotoEnd ? animation.tweens.length : <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">if</span> ( stopped ) &#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				stopped = <span class="literal">true</span>;</span><br><span class="line">				<span class="keyword">for</span> ( ; index &lt; length; index++ ) &#123;</span><br><span class="line">					animation.tweens[ index ].run( <span class="number">1</span> );</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Resolve when we played the last frame; otherwise, reject</span></span><br><span class="line">				<span class="keyword">if</span> ( gotoEnd ) &#123;</span><br><span class="line">					deferred.notifyWith( elem, [ animation, <span class="number">1</span>, <span class="number">0</span> ] );</span><br><span class="line">					deferred.resolveWith( elem, [ animation, gotoEnd ] );</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					deferred.rejectWith( elem, [ animation, gotoEnd ] );</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; ),</span><br><span class="line">		props = animation.props;</span><br><span class="line"></span><br><span class="line">	propFilter( props, animation.opts.specialEasing );</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> ( ; index &lt; length; index++ ) &#123;</span><br><span class="line">		result = Animation.prefilters[ index ].call( animation, elem, props, animation.opts );</span><br><span class="line">		<span class="keyword">if</span> ( result ) &#123;</span><br><span class="line">			<span class="keyword">if</span> ( isFunction( result.stop ) ) &#123;</span><br><span class="line">				jQuery._queueHooks( animation.elem, animation.opts.queue ).stop =</span><br><span class="line">					result.stop.bind( result );</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	jQuery.map( props, createTween, animation );</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ( isFunction( animation.opts.start ) ) &#123;</span><br><span class="line">		animation.opts.start.call( elem, animation );</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Attach callbacks from options</span></span><br><span class="line">	animation</span><br><span class="line">		.progress( animation.opts.progress )</span><br><span class="line">		.done( animation.opts.done, animation.opts.complete )</span><br><span class="line">		.fail( animation.opts.fail )</span><br><span class="line">		.always( animation.opts.always );</span><br><span class="line"></span><br><span class="line">	jQuery.fx.timer(</span><br><span class="line">		jQuery.extend( tick, &#123;</span><br><span class="line">			elem: elem,</span><br><span class="line">			anim: animation,</span><br><span class="line">			queue: animation.opts.queue</span><br><span class="line">		&#125; )</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> animation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="propFilter"><a href="#propFilter" class="headerlink" title="propFilter"></a>propFilter</h4><p>propFilter 函数以引用对象形式对传参样式属性集合 props, 缓动函数类型集合 specialEasing 进行处理。首先，其将 props 属性转化为驼峰式书写形式，同时 props 属性的值支持以二元数组形式约定样式和缓动函数类型。其次，当传入的 props 属性作为复合属性、且在 jQuery.cssHooks 注册了预处理集合，且该集合中存在 expand 处理，传入的 props 属性的值将经过 expand 方法处理，由返回值定义该操作哪些样式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">propFilter</span>(<span class="params"> props, specialEasing </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> index, name, easing, value, hooks;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// camelCase, specialEasing and expand cssHook pass</span></span><br><span class="line">	<span class="keyword">for</span> ( index <span class="keyword">in</span> props ) &#123;</span><br><span class="line">		name = camelCase( index );</span><br><span class="line">		easing = specialEasing[ name ];</span><br><span class="line">		value = props[ index ];</span><br><span class="line">		<span class="keyword">if</span> ( <span class="built_in">Array</span>.isArray( value ) ) &#123;</span><br><span class="line">			easing = value[ <span class="number">1</span> ];</span><br><span class="line">			value = props[ index ] = value[ <span class="number">0</span> ];</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( index !== name ) &#123;</span><br><span class="line">			props[ name ] = value;</span><br><span class="line">			<span class="keyword">delete</span> props[ index ];</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		hooks = jQuery.cssHooks[ name ];</span><br><span class="line">		<span class="keyword">if</span> ( hooks &amp;&amp; <span class="string">"expand"</span> <span class="keyword">in</span> hooks ) &#123;</span><br><span class="line">			value = hooks.expand( value );</span><br><span class="line">			<span class="keyword">delete</span> props[ name ];</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Not quite $.extend, this won't overwrite existing keys.</span></span><br><span class="line">			<span class="comment">// Reusing 'index' because we have the correct "name"</span></span><br><span class="line">			<span class="keyword">for</span> ( index <span class="keyword">in</span> value ) &#123;</span><br><span class="line">				<span class="keyword">if</span> ( !( index <span class="keyword">in</span> props ) ) &#123;</span><br><span class="line">					props[ index ] = value[ index ];</span><br><span class="line">					specialEasing[ index ] = easing;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			specialEasing[ name ] = easing;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Animation-prefilters"><a href="#Animation-prefilters" class="headerlink" title="Animation.prefilters"></a>Animation.prefilters</h4><p>jQuery.Animation.prefilters 作为预处理函数队列，可通过 jQuery.Animation.prefilter 添加，默认只有一个预处理函数 defaultPrefilter。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jQuery.Animation = jQuery.extend( Animation, &#123;</span><br><span class="line">	prefilters: [ defaultPrefilter ],</span><br><span class="line"></span><br><span class="line">	prefilter: <span class="function"><span class="keyword">function</span>(<span class="params"> callback, prepend </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ( prepend ) &#123;</span><br><span class="line">			Animation.prefilters.unshift( callback );</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			Animation.prefilters.push( callback );</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure>
<p>defaultPrefilter 函数的处理内容有两块，其一针对即时执行的动画，当类型为 ‘fx’ 的 queue 队列的长度变为 0 时，也即队列等待执行的动画时，使用 queueHooks.empty 方法移除 dataPriv 中与当前 queue 相关的属性；其二元素的 display 属性需要在动画起始、结束时作特殊处理。</p>
<p>对于内容一，有一点疑问，既然动画没有添加到 queue 队列中，为什么还要调用 queueHooks 钩子清除缓存中的数据呢？作为用于避免内存浪费的保证吗？</p>
<p>内容一的实现，在于缓存在元素上的 hooks.unqueued 标识，动画执行期间加 1，动画执行完成后减 1，由此可以判断所有动画是否均已执行完成。当 hooks.unqueued 标识重新变成 0 值时，且缓存中的 queue 队列长度也为 0，调用钩子集合中的 empty 方法，移除 dataPriv.queue 属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defaultPrefilter</span>(<span class="params"> elem, props, opts </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> hooks, oldfire,</span><br><span class="line">		isBox = <span class="string">"width"</span> <span class="keyword">in</span> props || <span class="string">"height"</span> <span class="keyword">in</span> props,</span><br><span class="line">		anim = <span class="keyword">this</span>,</span><br><span class="line">		orig = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Queue-skipping animations hijack the fx hooks</span></span><br><span class="line">	<span class="keyword">if</span> ( !opts.queue ) &#123;</span><br><span class="line">		hooks = jQuery._queueHooks( elem, <span class="string">"fx"</span> );</span><br><span class="line">		<span class="keyword">if</span> ( hooks.unqueued == <span class="literal">null</span> ) &#123;</span><br><span class="line">			hooks.unqueued = <span class="number">0</span>;</span><br><span class="line">			oldfire = hooks.empty.fire;</span><br><span class="line">			hooks.empty.fire = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">				<span class="keyword">if</span> ( !hooks.unqueued ) &#123;</span><br><span class="line">					oldfire();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;</span><br><span class="line">		hooks.unqueued++;</span><br><span class="line"></span><br><span class="line">		anim.always( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Ensure the complete handler is called before this completes</span></span><br><span class="line">			anim.always( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">				hooks.unqueued--;</span><br><span class="line">				<span class="keyword">if</span> ( !jQuery.queue( elem, <span class="string">"fx"</span> ).length ) &#123;</span><br><span class="line">					hooks.empty.fire();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; );</span><br><span class="line">		&#125; );</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>内容二的实现，借助于 dataShow 缓存数据，其包含 display, hidden 属性，挂载元素相关的每种动画执行期间，dataShow.display 属性取决于元素本身的 display 样式属性。若其为 ‘none’，则通过 showHide 方法将该元素展示在视图上，然后取其 display 样式属性存入 dataShow.display 属性中，而缓存 dataShow.display 的意义就在于动画执行期间将元素的 display 样式设定为缓存值，以使动画得以展示。若其为 ‘inline’ 或 ‘inline-block’（确切的说，是动画执行期间的 display 样式，包含前一条元素的 display 属性为 ‘none’ 的情况），dataShow.display 属性直接取元素的 display 属性，而缓存 dataShow.display 的意义就在于，首次动画执行期间将元素的 display 样式设为 ‘inline-block’，且对于纯粹的展示型动画（即动画变更样式只包含 ‘toggle’, ‘show’, ‘hide’），在动画执行结束后再将元素的 display 样式设为 dataShow.display 缓存值；当首次动画执行期间再启动第二个动画时，则跳过该部分处理、沿用第一个动画的处理方式。这里存在两个问题，其一，当元素包含除显示状态之外的样式变动时，动画执行结束后，元素的 display 属性将定格为 ‘inline-block’，而不是初始的 ‘inline’；其二，当第二个动画插入执行时，且第一个只包含显示状态相关动画，当第一个动画执行完成后，元素的 display 样式将可能被设为 ‘inline’，这是否会影响第二个动画的执行？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rfxtypes = <span class="regexp">/^(?:toggle|show|hide)$/</span>；</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defaultPrefilter</span>(<span class="params"> elem, props, opts </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> prop, value, toggle, propTween, restoreDisplay, display,</span><br><span class="line">		isBox = <span class="string">"width"</span> <span class="keyword">in</span> props || <span class="string">"height"</span> <span class="keyword">in</span> props,</span><br><span class="line">		anim = <span class="keyword">this</span>,</span><br><span class="line">		orig = &#123;&#125;,</span><br><span class="line">		style = elem.style,</span><br><span class="line">		hidden = elem.nodeType &amp;&amp; isHiddenWithinTree( elem ),</span><br><span class="line">		dataShow = dataPriv.get( elem, <span class="string">"fxshow"</span> );</span><br><span class="line">		</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Detect show/hide animations</span></span><br><span class="line">	<span class="keyword">for</span> ( prop <span class="keyword">in</span> props ) &#123;</span><br><span class="line">		value = props[ prop ];</span><br><span class="line">		<span class="keyword">if</span> ( rfxtypes.test( value ) ) &#123;</span><br><span class="line">			<span class="keyword">delete</span> props[ prop ];</span><br><span class="line">			toggle = toggle || value === <span class="string">"toggle"</span>;</span><br><span class="line">			<span class="keyword">if</span> ( value === ( hidden ? <span class="string">"hide"</span> : <span class="string">"show"</span> ) ) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Pretend to be hidden if this is a "show" and</span></span><br><span class="line">				<span class="comment">// there is still data from a stopped show/hide</span></span><br><span class="line">				<span class="keyword">if</span> ( value === <span class="string">"show"</span> &amp;&amp; dataShow &amp;&amp; dataShow[ prop ] !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">					hidden = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Ignore all other no-op show/hide data</span></span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			orig[ prop ] = dataShow &amp;&amp; dataShow[ prop ] || jQuery.style( elem, prop );</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Bail out if this is a no-op like .hide().hide()</span></span><br><span class="line">	propTween = !jQuery.isEmptyObject( props );</span><br><span class="line">	<span class="keyword">if</span> ( !propTween &amp;&amp; jQuery.isEmptyObject( orig ) ) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Restrict "overflow" and "display" styles during box animations</span></span><br><span class="line">	<span class="keyword">if</span> ( isBox &amp;&amp; elem.nodeType === <span class="number">1</span> ) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Support: IE &lt;=9 - 11, Edge 12 - 15</span></span><br><span class="line">		<span class="comment">// Record all 3 overflow attributes because IE does not infer the shorthand</span></span><br><span class="line">		<span class="comment">// from identically-valued overflowX and overflowY and Edge just mirrors</span></span><br><span class="line">		<span class="comment">// the overflowX value there.</span></span><br><span class="line">		opts.overflow = [ style.overflow, style.overflowX, style.overflowY ];</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Identify a display type, preferring old show/hide data over the CSS cascade</span></span><br><span class="line">		restoreDisplay = dataShow &amp;&amp; dataShow.display;</span><br><span class="line">		<span class="keyword">if</span> ( restoreDisplay == <span class="literal">null</span> ) &#123;</span><br><span class="line">			restoreDisplay = dataPriv.get( elem, <span class="string">"display"</span> );</span><br><span class="line">		&#125;</span><br><span class="line">		display = jQuery.css( elem, <span class="string">"display"</span> );</span><br><span class="line">		<span class="keyword">if</span> ( display === <span class="string">"none"</span> ) &#123;</span><br><span class="line">			<span class="keyword">if</span> ( restoreDisplay ) &#123;</span><br><span class="line">				display = restoreDisplay;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Get nonempty value(s) by temporarily forcing visibility</span></span><br><span class="line">				showHide( [ elem ], <span class="literal">true</span> );</span><br><span class="line">				restoreDisplay = elem.style.display || restoreDisplay;</span><br><span class="line">				display = jQuery.css( elem, <span class="string">"display"</span> );</span><br><span class="line">				showHide( [ elem ] );</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Animate inline elements as inline-block</span></span><br><span class="line">		<span class="keyword">if</span> ( display === <span class="string">"inline"</span> || display === <span class="string">"inline-block"</span> &amp;&amp; restoreDisplay != <span class="literal">null</span> ) &#123;</span><br><span class="line">			<span class="keyword">if</span> ( jQuery.css( elem, <span class="string">"float"</span> ) === <span class="string">"none"</span> ) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Restore the original display value at the end of pure show/hide animations</span></span><br><span class="line">				<span class="keyword">if</span> ( !propTween ) &#123;</span><br><span class="line">					anim.done( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">						style.display = restoreDisplay;</span><br><span class="line">					&#125; );</span><br><span class="line">					<span class="keyword">if</span> ( restoreDisplay == <span class="literal">null</span> ) &#123;</span><br><span class="line">						display = style.display;</span><br><span class="line">						restoreDisplay = display === <span class="string">"none"</span> ? <span class="string">""</span> : display;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				style.display = <span class="string">"inline-block"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ( opts.overflow ) &#123;</span><br><span class="line">		style.overflow = <span class="string">"hidden"</span>;</span><br><span class="line">		anim.always( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			style.overflow = opts.overflow[ <span class="number">0</span> ];</span><br><span class="line">			style.overflowX = opts.overflow[ <span class="number">1</span> ];</span><br><span class="line">			style.overflowY = opts.overflow[ <span class="number">2</span> ];</span><br><span class="line">		&#125; );</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Implement show/hide animations</span></span><br><span class="line">	propTween = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">for</span> ( prop <span class="keyword">in</span> orig ) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// General show/hide setup for this element animation</span></span><br><span class="line">		<span class="keyword">if</span> ( !propTween ) &#123;</span><br><span class="line">			<span class="keyword">if</span> ( dataShow ) &#123;</span><br><span class="line">				<span class="keyword">if</span> ( <span class="string">"hidden"</span> <span class="keyword">in</span> dataShow ) &#123;</span><br><span class="line">					hidden = dataShow.hidden;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				dataShow = dataPriv.access( elem, <span class="string">"fxshow"</span>, &#123; <span class="attr">display</span>: restoreDisplay &#125; );</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Store hidden/visible for toggle so `.stop().toggle()` "reverses"</span></span><br><span class="line">			<span class="keyword">if</span> ( toggle ) &#123;</span><br><span class="line">				dataShow.hidden = !hidden;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Show elements before animating them</span></span><br><span class="line">			<span class="keyword">if</span> ( hidden ) &#123;</span><br><span class="line">				showHide( [ elem ], <span class="literal">true</span> );</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* eslint-disable no-loop-func */</span></span><br><span class="line"></span><br><span class="line">			anim.done( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* eslint-enable no-loop-func */</span></span><br><span class="line"></span><br><span class="line">				<span class="comment">// The final step of a "hide" animation is actually hiding the element</span></span><br><span class="line">				<span class="keyword">if</span> ( !hidden ) &#123;</span><br><span class="line">					showHide( [ elem ] );</span><br><span class="line">				&#125;</span><br><span class="line">				dataPriv.remove( elem, <span class="string">"fxshow"</span> );</span><br><span class="line">				<span class="keyword">for</span> ( prop <span class="keyword">in</span> orig ) &#123;</span><br><span class="line">					jQuery.style( elem, prop, orig[ prop ] );</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; );</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Per-property setup</span></span><br><span class="line">		propTween = createTween( hidden ? dataShow[ prop ] : <span class="number">0</span>, prop, anim );</span><br><span class="line">		<span class="keyword">if</span> ( !( prop <span class="keyword">in</span> dataShow ) ) &#123;</span><br><span class="line">			dataShow[ prop ] = propTween.start;</span><br><span class="line">			<span class="keyword">if</span> ( hidden ) &#123;</span><br><span class="line">				propTween.end = propTween.start;</span><br><span class="line">				propTween.start = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">propFilter</span>(<span class="params"> props, specialEasing </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> index, name, easing, value, hooks;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// camelCase, specialEasing and expand cssHook pass</span></span><br><span class="line">	<span class="keyword">for</span> ( index <span class="keyword">in</span> props ) &#123;</span><br><span class="line">		name = camelCase( index );</span><br><span class="line">		easing = specialEasing[ name ];</span><br><span class="line">		value = props[ index ];</span><br><span class="line">		<span class="keyword">if</span> ( <span class="built_in">Array</span>.isArray( value ) ) &#123;</span><br><span class="line">			easing = value[ <span class="number">1</span> ];</span><br><span class="line">			value = props[ index ] = value[ <span class="number">0</span> ];</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( index !== name ) &#123;</span><br><span class="line">			props[ name ] = value;</span><br><span class="line">			<span class="keyword">delete</span> props[ index ];</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		hooks = jQuery.cssHooks[ name ];</span><br><span class="line">		<span class="keyword">if</span> ( hooks &amp;&amp; <span class="string">"expand"</span> <span class="keyword">in</span> hooks ) &#123;</span><br><span class="line">			value = hooks.expand( value );</span><br><span class="line">			<span class="keyword">delete</span> props[ name ];</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Not quite $.extend, this won't overwrite existing keys.</span></span><br><span class="line">			<span class="comment">// Reusing 'index' because we have the correct "name"</span></span><br><span class="line">			<span class="keyword">for</span> ( index <span class="keyword">in</span> value ) &#123;</span><br><span class="line">				<span class="keyword">if</span> ( !( index <span class="keyword">in</span> props ) ) &#123;</span><br><span class="line">					props[ index ] = value[ index ];</span><br><span class="line">					specialEasing[ index ] = easing;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			specialEasing[ name ] = easing;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h3><h2 id="动效模块应用"><a href="#动效模块应用" class="headerlink" title="动效模块应用"></a>动效模块应用</h2>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/analyst/" rel="tag"># analyst</a>
          
            <a href="/tags/jquery/" rel="tag"># jquery</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/19/设计模式/策略模式/" rel="next" title="策略模式">
                <i class="fa fa-chevron-left"></i> 策略模式
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpeg"
                alt="Alfred" />
            
              <p class="site-author-name" itemprop="name">Alfred</p>
              <p class="site-description motion-element" itemprop="description">人苦不知足，既得陇，复望蜀</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Alfred-sg" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/xiu-fan-79/activities" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-globe"></i>知乎</a>
                  </span>
                
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#动效基础"><span class="nav-number">1.</span> <span class="nav-text">动效基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本原理"><span class="nav-number">1.1.</span> <span class="nav-text">基本原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓动函数"><span class="nav-number">2.</span> <span class="nav-text">缓动函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#requestAnimationFrame"><span class="nav-number">2.1.</span> <span class="nav-text">requestAnimationFrame</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#备注"><span class="nav-number">2.1.1.</span> <span class="nav-text">备注</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#动画队列"><span class="nav-number">2.2.</span> <span class="nav-text">动画队列</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jQuery-基础"><span class="nav-number">3.</span> <span class="nav-text">jQuery 基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Promise-对象"><span class="nav-number">3.1.</span> <span class="nav-text">Promise 对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#css-操作"><span class="nav-number">3.2.</span> <span class="nav-text">css 操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#data-缓存"><span class="nav-number">3.3.</span> <span class="nav-text">data 缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#queue-队列"><span class="nav-number">3.4.</span> <span class="nav-text">queue 队列</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动效模块设计"><span class="nav-number">4.</span> <span class="nav-text">动效模块设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动效模块实现"><span class="nav-number">5.</span> <span class="nav-text">动效模块实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#jQuery-fx-timer-定时任务"><span class="nav-number">5.1.</span> <span class="nav-text">jQuery.fx.timer 定时任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tween-样式更新"><span class="nav-number">5.2.</span> <span class="nav-text">Tween 样式更新</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Tween-构造函数"><span class="nav-number">5.2.1.</span> <span class="nav-text">Tween 构造函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建-Tween-实例"><span class="nav-number">5.2.2.</span> <span class="nav-text">创建 Tween 实例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Animation-动画函数"><span class="nav-number">5.3.</span> <span class="nav-text">Animation 动画函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#propFilter"><span class="nav-number">5.3.1.</span> <span class="nav-text">propFilter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Animation-prefilters"><span class="nav-number">5.3.2.</span> <span class="nav-text">Animation.prefilters</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#接口设计"><span class="nav-number">5.4.</span> <span class="nav-text">接口设计</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动效模块应用"><span class="nav-number">6.</span> <span class="nav-text">动效模块应用</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alfred</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.0.2</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.2"></script>



  

  
    <script id="dsq-count-scr" src="https://alfred.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2018/05/20/jquery/动效分析/';
        this.page.identifier = '2018/05/20/jquery/动效分析/';
        this.page.title = 'jquery 动效分析';
      };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://alfred.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        loadComments();
      
    </script>
  





	





  












  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
