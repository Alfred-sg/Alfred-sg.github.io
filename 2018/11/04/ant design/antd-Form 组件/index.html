<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.0.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="analyst,react,antd," />


<meta name="description" content="ant design 中的 Form 组件基于 rc-form 实现。本文第一部分将介绍 rc-form 库；第二部分再介绍 ant design 中的 Form 组件。 rc-form常规收集表单数据并作校验，只需以 store 实时记录表单数据，校验后重绘表单。这样的思路以业务代码为例，就是，以数据模型 model 集成数据处理操作，再通过 setState 将 model 中的实时数据注入组">
<meta name="keywords" content="analyst,react,antd">
<meta property="og:type" content="article">
<meta property="og:title" content="antd-Form 组件">
<meta property="og:url" content="http://yoursite.com/2018/11/04/ant design/antd-Form 组件/index.html">
<meta property="og:site_name" content="修子范语">
<meta property="og:description" content="ant design 中的 Form 组件基于 rc-form 实现。本文第一部分将介绍 rc-form 库；第二部分再介绍 ant design 中的 Form 组件。 rc-form常规收集表单数据并作校验，只需以 store 实时记录表单数据，校验后重绘表单。这样的思路以业务代码为例，就是，以数据模型 model 集成数据处理操作，再通过 setState 将 model 中的实时数据注入组">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2018/11/04/ant%20design/antd-Form%20组件/rc-form时序图.png">
<meta property="og:image" content="http://yoursite.com/2018/11/04/ant%20design/antd-Form%20组件/rc-form类图.png">
<meta property="og:updated_time" content="2018-11-18T10:45:14.571Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="antd-Form 组件">
<meta name="twitter:description" content="ant design 中的 Form 组件基于 rc-form 实现。本文第一部分将介绍 rc-form 库；第二部分再介绍 ant design 中的 Form 组件。 rc-form常规收集表单数据并作校验，只需以 store 实时记录表单数据，校验后重绘表单。这样的思路以业务代码为例，就是，以数据模型 model 集成数据处理操作，再通过 setState 将 model 中的实时数据注入组">
<meta name="twitter:image" content="http://yoursite.com/2018/11/04/ant%20design/antd-Form%20组件/rc-form时序图.png">






  <link rel="canonical" href="http://yoursite.com/2018/11/04/ant design/antd-Form 组件/"/>


  <title>antd-Form 组件 | 修子范语</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">修子范语</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Alfredo's Notes</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/04/ant design/antd-Form 组件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="修子范语">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">antd-Form 组件</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-04T00:00:00+08:00">2018-11-04</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/font-color-0b8235-antd-font-组件库/" itemprop="url" rel="index"><span itemprop="name"><font color=#0b8235>antd</font> 组件库</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/11/04/ant design/antd-Form 组件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/11/04/ant design/antd-Form 组件/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>ant design 中的 Form 组件基于 <font color="#0b8235">rc-form</font> 实现。本文第一部分将介绍 <font color="#0b8235">rc-form</font> 库；第二部分再介绍 ant design 中的 Form 组件。</p>
<h2 id="rc-form"><a href="#rc-form" class="headerlink" title="rc-form"></a>rc-form</h2><p>常规收集表单数据并作校验，只需以 <font color="#ffa500">store</font> 实时记录表单数据，校验后重绘表单。这样的思路以业务代码为例，就是，以数据模型 <font color="#ffa500">model</font> 集成数据处理操作，再通过 <font color="#008dff">setState</font> 将 <font color="#ffa500">model</font> 中的实时数据注入组件中，并驱动组件重绘（除了 <font color="#008dff">setState</font> 方法以外，也可以使用 <font color="#008dff">forceUpdate</font> 方法重绘组件，并在 <font color="#008dff">render</font> 阶段重新访问 <font color="#ffa500">model</font>  中的实时数据）。从业务角度对数据及其操作进行建模，必然着眼于实际的业务场景，其类结构也会和数据表有千丝万缕的联系；而表单中的数据更具一般性特征，即能对应多个数据表，对其进行抽象也须从视图层入手。可以推想的是，抽象的表单数据模型必然包含字段名和字段的值构成的映射 <font color="#f81d22">valuesMap</font>，字段名和校验结果构成的映射 <font color="#f81d22">errorsMap</font>，以及字段名和校验状态构成的映射 <font color="#f81d22">validatingMap</font>，这样才能绘制出表单中的字段项。</p>
<p>在 <font color="#0b8235">rc-form</font> 中，上述数据模型的具体实现为 <font color="#ffa500">FieldsStore</font> 类。如前所述，<font color="#ffa500">FieldsStore</font> 实例与视图层的交互逻辑为，在用户行为驱动字段项的数据改变时，即时存储表单数据及校验文案，继而调用表单组件实例的 <font color="#008dff">forceUpdate</font> 方法强制重绘；在绘制过程中，再从 <font color="#ffa500">FieldsStore</font> 实例读取实时的表单数据、校验文案及校验状态。建模方面，<font color="#ffa500">FieldsStore</font> 实例以 <font color="#f81d22">fields</font> 属性存储表单的实时数据，其结构为键值对形式 <font color="#0b8235">{ [name]: { value, errors, validating, dirty, touched } }</font> 。其中，<font color="#f81d22">name</font> 为字段名；<font color="#f81d22">value</font> 为字段的值；<font color="#f81d22">errors</font> 为校验结果；<font color="#f81d22">validating</font> 为校验状态；<font color="#f81d22">dirty</font> 为脏值标识（当字段的值已作变更、但未作校验时，那么脏值标识就为 <font color="blue">true</font>；已作校验则置为 <font color="blue">false</font>）；<font color="#f81d22">touched</font> 为更新标识，即用户行为触发时，字段值已作收集标识，收集的值通常是更新后的值 （若 <font color="#ffa500">FieldsStore</font> 实例在 <font color="#008dff">onChange</font> 发生时收集数据，<font color="#f81d22">touched</font> 标识也意味着数据已作变更。当然，如果此时用户再将数据更新为初始值，<font color="#f81d22">touched</font> 标识将依旧为 <font color="blue">true</font>，并不能反映表单数据的更新状态。但是在一般情况下，可以根据 <font color="#f81d22">touched</font> 标识判断表单数据是否有过更改）。</p>
<p>除了实时更新的数据外，驱动校验需要校验规则 <font color="#f81d22">validateRules</font>、触发事件 <font color="#f81d22">validateTrigger</font>；字段的初始值 <font color="#f81d22">initialValue</font>（当字段的值还没存入 <font color="#f81d22">fields</font> 中时，以初始值替代）；从 <font color="#ffa500">event</font> 对象获取字段的值，也跟 <font color="#ffa500">dom</font> 节点的类型相关，如 <font color="#ffa500">input</font>, <font color="#ffa500">radio</font>, <font color="#ffa500">checkbox</font> 类型，可以借助 <font color="#008dff">getValueFromEvent</font> 函数从 <font color="#ffa500">event</font> 对象获取的字段的值；注入字段组件的值需要作特殊的数据转换，其一 <font color="#ffa500">radio</font> 原生组件通过 <font color="#f81d22">props.checked</font> 接受字段的实时值，其二对于自定义组件，不只接受实时值的 <font color="#f81d22">props</font> 属性是特殊的，收集的数据和注入组件中的数据也会存在结果差异，这可以借助 <font color="#008dff">getValueProps</font> 函数作转换操作；在某些场合下，收集的表单数据需要经过特殊转换（<font color="#0b8235">antd</font> 提供的案例是<a href="https://codepen.io/afc163/pen/JJVXzG?editors=001" target="_blank" rel="noopener">全选按钮</a>），这可以借助 <font color="#008dff">normalize</font> 函数实现。<font color="#ffa500">FieldsStore</font> 实例使用 fieldsMeta 属性存储这些元数据，其结构为 <font color="#0b8235">{ [name]: { validate, initialValue, getValueFromEvent, valuePropName, getValueProps, normalize } }</font>。其中，<font color="#f81d22">validate</font> 包含 <font color="#f81d22">validateRules</font>, <font color="#f81d22">validateTrigger</font>。</p>
<p>与业务实体不同的是，<font color="#ffa500">FieldsStore</font> 实例仅止于存储字段的表单数据和元数据，提供一些便捷的访问器操作，却没有包含数据校验等操作，也没有关联上表单及字段组件。对于用户自定义表单组件，需要提供获取、更新及校验表单数据的方法，以便组织与远程接口密切相关的交互逻辑。对于字段组件，校验规则等与指定字段强关联的配置项适合在使用字段组件时通过 <font color="#f81d22">props</font> 注入；同时，在字段组件的值发生变更时，需要收集该字段的值及启动对该字段的校验，因此需要将特定的绑定函数添加到 <font color="#f81d22">props</font> 中。这些字段元数据写入 <font color="#ffa500">FieldsStore</font> 就适合在绘制字段组件的过程中实现，因此就需要特定的方法用于装饰字段组件或其 <font color="#f81d22">props</font> 属性。在 <font color="#0b8235">rc-form</font> 中，<font color="#ffa500">BaseForm</font> 用于实现这部分功能。</p>
<p>想要为用户自定义组件注入工具函数，可以使用 <font color="#0b8235">HOC</font> 高阶组件将工具函数配置为自定义子组件的 <font color="#f81d22">props</font>  形式实现。<font color="#ffa500">BaseForm</font> 就是这样的高阶组件。在 <font color="#ffa500">BaseForm</font> 的 <font color="#008dff">render</font>  阶段，将为用户自定义组件注入 <font color="#f81d22">props.form</font> 操纵表单的工具函数集。工具函数集中包含 <font color="#008dff">getFieldValue</font>, <font color="#008dff">getFieldsValue</font>, <font color="#008dff">getFieldError</font>, <font color="#008dff">getFieldsError</font>, <font color="#008dff">isFieldsValidating</font>, <font color="#008dff">isFieldValidating</font>, <font color="#008dff">isFieldTouched</font>, <font color="#008dff">isFieldsTouched</font> 方法用于获取字段的值、校验文案、校验状态、是否更新标识等；<font color="#008dff">setFieldsInitialValue</font> 方法用于设置字段的初始值；<font color="#008dff">setFieldsValue</font> 方法用于设置字段的值；<font color="#008dff">setFields</font> 方法用于设置表单的实时数据，包含字段的值及校验文案等；<font color="#008dff">resetFields</font> 方法用于重置表单；<font color="#008dff">validateFields</font> 方法用于校验表单；<font color="#008dff">getFieldProps</font> 方法用于转换传入字段组件的 <font color="#f81d22">props</font> 数据（包含特定的绑定函数），并收集字段组件的元数据；<font color="#008dff">getFieldDecorator</font> 方法基于 <font color="#008dff">getFieldProps</font> 方法，不同于 <font color="#008dff">getFieldProps</font> 方法用于装饰字段组件的 <font color="#f81d22">props</font>，<font color="#008dff">getFieldDecorator</font> 用于直接装饰字段组件，这样就可以直接获取并封装传入字段组件实例的 <font color="#008dff">props.onChange</font> 等属性或方法；<font color="#008dff">getFieldInstance</font> 方法用于获取字段实例。</p>
<p>关于校验文案和校验状态的绘制，参见本文的第二部分。</p>
<p>以时序图的方式表达 <font color="#0b8235">rc-form</font> 的工作流程为：<br><img src="/2018/11/04/ant%20design/antd-Form%20组件/rc-form时序图.png"></p>
<p><font color="#0b8235">rc-form</font> 的类图结构为：<br><img src="/2018/11/04/ant%20design/antd-Form%20组件/rc-form类图.png"></p>
<h3 id="FieldsStore"><a href="#FieldsStore" class="headerlink" title="FieldsStore"></a>FieldsStore</h3><p><font color="#ffa500">FieldsStore</font> 实例除用来存储表单的元数据及值数据等之外，还支持以 <font color="blue">‘.’</font>, <font color="blue">‘[|]’</font> 分割定义字段名，便于在表单中编辑和收集嵌套结构的数据。<font color="#0b8235">rc-form</font> 中嵌套字段名的实现，借助了 <font color="#0b8235">lodash</font> 库提供的 <font color="#008dff">set</font>, <font color="#008dff">get</font> 方法，以及内部封装的一些工具函数，具体可以参见源码，这里不作详解。</p>
<h4 id="fields-实时数据"><a href="#fields-实时数据" class="headerlink" title="fields 实时数据"></a>fields 实时数据</h4><p><font color="#0b8235">fields = { [name]: { value, errors, validating, dirty, touched } }</font> 属性，存储表单项的值、校验信息、校验状态、脏值标识等，可在初始化时设置，由 <font color="#008dff">updateFields</font>, <font color="#008dff">setFields</font>, <font color="#008dff">getField</font> 等提供交互接口。</p>
<ol>
<li>数据特性：<ul>
<li><font color="#f81d22">name</font> 字段的名称。</li>
<li><font color="#f81d22">value</font> 字段的值。</li>
<li><font color="#f81d22">errors</font> 校验文案，数组形式。</li>
<li><font color="#f81d22">validating</font> 校验状态。</li>
<li><font color="#f81d22">dirty</font> 脏值标识。真值时意味着字段数据已作变更，但未作校验。</li>
<li><font color="#f81d22">touched </font>更新标识。真值时意味着用户行为已促使字段数据发生了变更。</li>
</ul>
</li>
<li>相关方法：<ul>
<li>初始化 <font color="#008dff">constructor(fields)</font> 和 <font color="#008dff">updateFields(fields)</font> 方法执行阶段，只接受 Field 实例，为全量更新。</li>
<li><font color="#008dff">setFields(fields)</font> 可混入新的字段，并更新字段的值，为部分更新。</li>
<li><font color="#008dff">resetFields(ns)</font> 方法只输出空值，本身并不改变 <font color="#f81d22">fields</font> 存储的数据。</li>
<li><font color="#008dff">getField(name)</font> 获取 <font color="#f81d22">fields</font> 中存储的数据并字段名。</li>
<li><font color="#008dff">getFieldMember(name, member)</font> 方法基于 <font color="#008dff">getField</font>，用于辅助获取 <font color="#f81d22">fields[name]</font> 的成员属性，辅助实现 <font color="#008dff">isFieldValidating</font>, <font color="#008dff">isFieldTouched</font> 方法。</li>
<li><font color="#008dff">getNestedAllFields</font> 剔除虚拟隐藏项后，获取表单的实时数据。获得的实时数据既包含 <font color="#f81d22">fields</font> 属性中的实时数据，又包含 <font color="#008dff">getNotCollectedFields</font> 方法获得的未收集数据。返回数据为键值对形式，整体结构类似于 <font color="#f81d22">fields</font> 属性。rc-form 之所以没有 <font color="#008dff">getFields</font> 方法，是因为用户行为没有触发字段数据变更或没有调用 <font color="#008dff">setFields</font> 更新字段数据，<font color="#f81d22">fields</font> 属性将不会包含该字段的数据。</li>
</ul>
</li>
</ol>
<h4 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h4><p><font color="#0b8235">fieldsMeta = { [name] = { validate, hidden, getValueFromEvent, initialValue, valuePropName, getValueProps, normalize } }</font> 属性，存储表单项的元数据，由 <font color="#008dff">setFieldMeta(name, meta)</font>, <font color="#008dff">getFieldMeta(name)</font> 提供交互接口。</p>
<ol>
<li>数据特性：<ul>
<li><font color="#f81d22">name</font> 字段的名称。</li>
<li><font color="#f81d22">validate</font> 校验规则和触发事件，<font color="#0b8235">[{ rules, trigger }]</font> 形式。</li>
<li><font color="#f81d22">hidden</font> 设置为 <font color="blue">true</font> 时，<font color="#008dff">getFieldsValue</font>, <font color="#008dff">getFieldsError</font> 等方法将无法获取该字段的数据及校验信息等实时数据。本文假设设置了 <font color="#f81d22">hidden</font> 为 <font color="blue">true</font> 的字段为虚拟隐藏项。</li>
<li><font color="#008dff">getValueFromEvent(event)</font> 用于从 <font color="#f81d22">event</font> 对象中获取字段的值。</li>
<li><font color="#f81d22">initialValue</font> 字段的初始值。</li>
<li><font color="#f81d22">valuePropName</font> 约定字段的值以何种 <font color="#f81d22">props</font> 属性注入字段组件中。</li>
<li><font color="#008dff">getValueProps(value)</font> 用于转化字段的值，输出 <font color="#f81d22">props</font> 以注入字段组件中。</li>
<li><font color="#008dff">normalize(newValue, oldValue, values)</font> 用于转换存入 <font color="#ffa500">FieldsStore</font>  实例的字段值。</li>
</ul>
</li>
<li>相关方法：<ul>
<li><font color="#008dff">setFieldMeta(name, meta)</font> 设置字段的元数据。</li>
<li><font color="#008dff">getFieldMeta(name)</font> 获取字段的元数据。</li>
<li><font color="#008dff">setFieldsInitialValue(initialValues)</font> 将初始值添加到 <font color="#f81d22">fieldsMeta</font> 属性中。初始值设置须在字段组件绘制完成后，否则无法设置该字段的初始值。</li>
</ul>
</li>
</ol>
<h4 id="清除数据"><a href="#清除数据" class="headerlink" title="清除数据"></a>清除数据</h4><p><font color="#008dff">clearField(name)</font> 方法用于清除 <font color="#f81d22">fieldsMeta</font> , <font color="#f81d22">fields</font>  属性中存储的元数据和实时数据。</p>
<h4 id="辅助方法"><a href="#辅助方法" class="headerlink" title="辅助方法"></a>辅助方法</h4><ul>
<li><font color="#008dff">getValidFieldsName</font> 获取剔除虚拟隐藏项后的字段名列表。</li>
<li><font color="#008dff">getValidFieldsFullName(maybePartialName)</font> 获取所有以 <font color="#f81d22">maybePartialName</font> 起始或等值的字段名，不包含虚拟隐藏项。</li>
<li><font color="#008dff">getNestedField(name, getter)</font> 基于 <font color="#008dff">getValidFieldsFullName(name)</font> 获取匹配的字段名列表并加以遍历，使用 <font color="#008dff">getter(name)</font> 作进一步处理，<font color="#008dff">getter</font> 函数如 <font color="#008dff">getFieldError</font> 等实例方法，用于以键值对形式获取字段的值及校验信息。</li>
<li><font color="#008dff">getNestedFields(names, getter)</font> 使用数组的 <font color="#008dff">reduce</font> 方法遍历 <font color="#f81d22">names</font> 或 <font color="#008dff">getValidFieldsName</font> 方法的返回值，使用 <font color="#008dff">getter(name)</font> 函数作进一步处理，<font color="#008dff">getter</font> 函数如 <font color="#008dff">getFieldValue</font>, <font color="#008dff">getFieldError</font> 等实例方法，用于以键值对形式获取表单数据及校验信息。</li>
<li><font color="#008dff">flattenRegisteredFields(fields)</font> 将深度嵌套的数据结构转化以嵌套字段名为键的扁平化结构，同时，可校验字段组件实例是否已完成渲染。</li>
<li><font color="#008dff">isValidNestedFieldName</font> 用于校验字段名不能作为另一个字段名的成员。</li>
<li><font color="#008dff">getNotCollectedFields</font> 剔除虚拟隐藏项后，获取 <font color="#f81d22">fields</font> 属性中尚未收集的字段数据（即用户行为促使字段数据更新，也没有调用 <font color="#008dff">setFields</font> 方法更新数据）。返回数据为键值对形式 <font color="#0b8235">{ [name]: { name, value, dirty } }</font>，值是由 <font color="#008dff">createFormField</font> 函数创建的 <font color="#ffa500">Field</font> 实例，整体结构类似于 <font color="#f81d22">fields</font> 属性。</li>
</ul>
<h4 id="字段名获取"><a href="#字段名获取" class="headerlink" title="字段名获取"></a>字段名获取</h4><ul>
<li><font color="#008dff">getValidFieldsName</font> 见上文。</li>
<li><font color="#008dff">getAllFieldsName</font> 全量字段名列表，包含虚拟隐藏项。</li>
<li><font color="#008dff">getValidFieldsFullName(maybePartialName)</font> 见上文。</li>
</ul>
<h4 id="数据赋值"><a href="#数据赋值" class="headerlink" title="数据赋值"></a>数据赋值</h4><ul>
<li><font color="#008dff">setFieldsInitialValue(initialValues)</font> 见上文。</li>
<li><font color="#008dff">setFields(fields)</font> 见上文。</li>
</ul>
<h4 id="数据获取"><a href="#数据获取" class="headerlink" title="数据获取"></a>数据获取</h4><ul>
<li><font color="#008dff">getFieldValuePropValue(fieldMeta)</font> 基于参数 <font color="#f81d22">fieldMeta</font> 元数据获取注入字段组件的 <font color="#f81d22">props</font> 属性，该 <font color="#f81d22">props</font> 属性内容为字段的值（可能是初始值）。<font color="#f81d22">props</font> 属性数据可经由 <font color="#f81d22">fieldMeta.valuePropName</font> 配置项设定键或经由 <font color="#008dff">fieldMeta.getValueProps(value)</font> 方法转换，既提供 <font color="#f81d22">props</font> 的属性名，又提供属性的值。<font color="#f81d22">props</font> 属性可以在 <font color="#ffa500">BaseForm</font> 实例的 <font color="#008dff">getFieldProps</font>, <font color="#008dff">getFieldDecorator</font>  方法中使用。</li>
<li><font color="#008dff">getValueFromFields(name, fields)</font> 从参数 <font color="#f81d22">fields</font> 中获取字段的值 <font color="#f81d22">value</font>。如 <font color="#f81d22">value</font> 属性尚不在存在，则从 <font color="#f81d22">fieldsMeta</font> 元数据中获取字段的初始值。</li>
<li><font color="#008dff">getFieldValue(name)</font> 基于 <font color="#008dff">getNestedField</font>, <font color="#008dff">getValueFromFields</font> 实例方法，获取匹配字段的值。</li>
<li><font color="#008dff">getFieldsValue(names)</font> 基于 <font color="#008dff">getNestedFields</font>, <font color="#008dff">getFieldValue</font>  实例方法，获取表单数据，但不包含虚拟隐藏项。</li>
<li><font color="#008dff">getAllValues</font> 根据 <font color="#f81d22">fieldsMeta</font> 属性获取表单的全量数据，包含虚拟隐藏项。</li>
</ul>
<h4 id="错误信息获取"><a href="#错误信息获取" class="headerlink" title="错误信息获取"></a>错误信息获取</h4><ul>
<li><font color="#008dff">getFieldError(name)</font> 基于 <font color="#008dff">getNestedField</font>, <font color="#008dff">getFieldMember</font> 实例方法，获取校验文案。</li>
<li><font color="#008dff">getFieldsError(names)</font> 基于 <font color="#008dff">getNestedFields</font>, <font color="#008dff">getFieldError</font> 实例方法，获取校验文案。</li>
<li><font color="#008dff">isFieldValidating(name)</font> 基于 <font color="#008dff">getFieldMember</font> 实例方法，获取校验状态。</li>
<li><font color="#008dff">isFieldsValidating(names)</font> 基于 <font color="#008dff">getValidFieldsName</font>, <font color="#008dff">isFieldValidating</font> 实例方法，获取校验状态。</li>
<li><font color="#008dff">isFieldTouched(name)</font> 基于 <font color="#008dff">getFieldMember</font> 实例方法，获取字段的更新状态。</li>
<li><font color="#008dff">isFieldsTouched(names)</font> 基于 <font color="#008dff">getValidFieldsName</font>, <font color="#008dff">isFieldTouched</font> 实例方法，获取字段的更新状态。</li>
</ul>
<h3 id="BaseForm"><a href="#BaseForm" class="headerlink" title="BaseForm"></a>BaseForm</h3><p>如上文所说，<font color="#ffa500">BaseForm</font> 作为自定义组件的外层容器，它提供了数据收集、数据校验、数据更新的方法。除此以外，<font color="#ffa500">BaseForm</font> 另有一种特殊逻辑。当字段组件实例从视图中移除时，须得调用 <font color="#ffa500">FieldsStore</font> 实例的 <font color="#008dff">clearField</font> 方法以清除缓存的实时数据和元数据。这一过程通常在 <font color="#f81d22">ref</font> 引用函数内执行，通过参数 —— 组件实例的真值情况判断字段组件是否已作销毁。而当字段组件更新时，<font color="#0b8235">react 16</font> 的机制会在 <font color="#008dff">getFieldProps</font> 方法执行之后，调用两次 <font color="#f81d22">ref</font> 引用函数，第一次 <font color="#f81d22">ref</font> 引用函数的参数为否值，表示前一个实例需要被销毁；第二次 <font color="#f81d22">ref</font> 引用函数的参数为否值，表示创建新的字段组件实例。当执行第一次 <font color="#f81d22">ref</font> 引用函数时，<font color="#ffa500">FieldsStore</font> 实例的实时数据和元数据都将被销毁。这样，即便字段组件仍旧在视图中有所表现，元数据如校验规则的丢失也将使促使字段组件在值变更时无法得到正常的校验。鉴于此，<font color="#ffa500">BaseForm</font> 提供 <font color="#f81d22">clearedFieldMetaCache</font> 属性缓存待移除字段的实时数据和元数据，且在第二次执行 <font color="#f81d22">ref</font> 引用函数时尝试恢复 <font color="#ffa500">FieldsStore</font> 实例中的相应数据。</p>
<h4 id="createBaseForm"><a href="#createBaseForm" class="headerlink" title="createBaseForm"></a>createBaseForm</h4><p><font color="#008dff">createBaseForm(option, mixins)</font>，创建装饰函数。如上文所说，装饰函数能为用户自定义表单组件包裹上 <font color="#0b8235">HOC</font> 容器，即 <font color="#ffa500">BaseForm</font>。参数 <font color="#f81d22">option</font> 为 <font color="#0b8235">HOC</font> 组件提供 <font color="#f81d22">validateMessages</font>, <font color="#008dff">onFieldsChange</font>, <font color="#008dff">onValuesChange</font>, <font color="#008dff">mapProps</font>, <font color="#008dff">mapPropsToFields</font>, <font color="#f81d22">fieldNameProp</font>, <font color="#f81d22">fieldMetaProp</font>, <font color="#f81d22">fieldDataProp</font>, <font color="#f81d22">formPropName</font>, <font color="#f81d22">name</font> 配置项，参数 <font color="#f81d22">mixins</font> 为混入 <font color="#0b8235">HOC</font> 组件的实例方法。</p>
<ul>
<li><font color="#f81d22">validateMessages</font> 用于更改 <font color="#0b8235">async-validator</font> 库的校验文案。</li>
<li><font color="#008dff">onFieldsChange(props, changedFields, oldFields)</font> 当 <font color="#ffa500">BaseForm</font>  组件实例的 <font color="#008dff">setFields</font> 方法执行时被调用。即用户行为触发表单数据收集或校验时，或开发者显示调用 <font color="#ffa500">BaseForm</font> 组件实例的 <font color="#008dff">setFields</font>, <font color="#008dff">setFieldsValue</font> 方法时，都将调用 <font color="#008dff">onFieldsChange</font> 函数。</li>
<li><font color="#008dff">onValuesChange(props, changedValues, oldValues)</font> 当用户行为触发表单数据收集或校验时，或开发者显示调用 <font color="#ffa500">BaseForm</font>  组件实例的 <font color="#008dff">setFields</font>, <font color="#008dff">setFieldsValue</font> 方法时，都将调用 <font color="#008dff">onValuesChange</font> 函数。</li>
<li><font color="#008dff">mapProps({ [formPropName] }, restProps)</font> 用于修改注入自定义表单组件的 <font color="#f81d22">props</font>；<font color="#0b8235">{ [formPropName] }</font> 即 <font color="#ffa500">BaseForm</font>  组件实例注入用户自定义组件的表单操作函数集；执行上下文为 <font color="#ffa500">BaseForm</font>  组件实例。</li>
<li><font color="#008dff">mapPropsToFields(props)</font> 将 <font color="#ffa500">BaseForm</font> 组件实例获得的 <font color="#f81d22">props</font> 转化为 <font color="#ffa500">FieldsStore</font> 构造器的参数，通常用于将状态管理器中的 <font color="#ffa500">store</font> 数据转换为表单所需的 <font color="#f81d22">fields</font>。</li>
<li><font color="#f81d22">fieldNameProp</font> 用于设定字段组件接受字段名的 <font color="#f81d22">props</font> 属性名，其值默认为字段名或表单名加字段名的形式，因此可以通过访问字段组件实例的 <font color="#f81d22">props</font> 获取到字段名。</li>
<li><font color="#f81d22">fieldMetaProp</font> 用于设定字段组件接受元数据的 <font color="#f81d22">props</font> 属性名，因此可以通过访问字段组件实例的 <font color="#f81d22">props</font> 获取到字段的元数据。</li>
<li><font color="#f81d22">fieldDataProp</font> 用于设定字段组件接受实时数据的 <font color="#f81d22">props</font> 属性名，因此可以通过访问字段组件实例的 <font color="#f81d22">props</font> 获取到字段的实时数据，包含字段的值、校验信息、校验状态、脏值标识、更新标识。</li>
<li><font color="#f81d22">formPropName</font> 用于设定用户自定义组件接受表单操作函数集的 <font color="#f81d22">props</font> 属性名，默认为 <font color="blue">form</font>。</li>
<li><font color="#f81d22">name</font> 表单名。</li>
</ul>
<h4 id="表单及字段组件生命周期相关"><a href="#表单及字段组件生命周期相关" class="headerlink" title="表单及字段组件生命周期相关"></a>表单及字段组件生命周期相关</h4><ol>
<li><p>数据缓存：</p>
<ul>
<li><font color="#f81d22">instances</font> 缓存字段组件实例。</li>
<li><font color="#f81d22">cachedBind</font> 缓存绑定函数及 <font color="#008dff">saveRef</font> 内置的引用函数。</li>
<li><font color="#f81d22">clearedFieldMetaCache</font> 缓存待移除字段的实时数据和元数据。<font color="#008dff">getFieldProps</font> 方法执行时清除 <font color="#f81d22">clearedFieldMetaCache[name]</font> 缓存数据。<font color="#008dff">saveRef</font> 方法执行时可能尝试使用 <font color="#f81d22">clearedFieldMetaCache[name]</font> 恢复 <font color="#ffa500">FieldsStore</font> 实例中的实时数据和元数据，并清除 <font color="#f81d22">clearedFieldMetaCache[name]</font> 缓存；也可能将 <font color="#ffa500">FieldsStore</font>  实例中的实时数据和元数据存入 <font color="#f81d22">clearedFieldMetaCache[name]</font> 缓存。参见 <font color="#008dff">saveRef</font> 方法及前文。</li>
<li><font color="#f81d22">renderFields</font> 缓存 <font color="#008dff">getFieldProps</font> 方法已执行标识。</li>
<li><font color="#f81d22">domFields</font> 属性缓存字段组件实例仍在视图中有所表现的标识。</li>
</ul>
</li>
<li><p>相关方法</p>
<ul>
<li><font color="#008dff">getInitialState</font> 在获取 <font color="#ffa500">BaseForm</font> 组件实例的初始 <font color="#f81d22">state</font> 时，将调用 <font color="#008dff">option.mapPropsToFields</font> 以获得初始 <font color="#f81d22">fields</font>，并创建 <font color="#ffa500">FieldsStore</font> 实例（备注：在 <font color="#ffa500">BaseForm</font>  组件的 <font color="#008dff">componentWillReceiveProps</font> 生命周期中，也将调用 <font color="#008dff">option.mapPropsToFields</font> 获取 <font color="#f81d22">fields</font>，以便使用 <font color="#ffa500">FieldsStore</font> 实例的 <font color="#008dff">updateFields</font> 全量更新缓存数据）。除此而外，<font color="#008dff">getInitialState</font> 方法还将创建 <font color="#f81d22">instances</font>, <font color="#f81d22">cachedBind</font>, <font color="#f81d22">clearedFieldMetaCache</font>, <font color="#f81d22">renderFields</font>, <font color="#f81d22">domFields</font> 缓存，并为 <font color="#ffa500">BaseForm</font>  组件注入 <font color="#008dff">getFieldsValue</font>, <font color="#008dff">getFieldValue</font>, <font color="#008dff">setFieldsInitialValue</font>, <font color="#008dff">getFieldsError</font>, <font color="#008dff">getFieldError</font>, <font color="#008dff">isFieldValidating</font>, <font color="#008dff">isFieldsValidating</font>, <font color="#008dff">isFieldsTouched</font>, <font color="#008dff">isFieldTouched</font> 实例方法。</li>
<li><font color="#008dff">saveRef(name, _, component)</font> 作为 <font color="#ffa500">BaseForm</font>  为字段组件提供的引用函数，其在字段组件挂载、卸载、重绘阶段都会被调用。可根据参数 <font color="#f81d22">component</font> 判断组件的渲染状态。当 <font color="#f81d22">component</font> 为空值，使用 <font color="#0b8235">clearedFieldMetaCache[name] = { field, meta }</font> 收集字段的元数据和表单数据，并清除 <font color="#ffa500">FieldsStore</font> 实例中的相关数据，清理 <font color="#f81d22">instances[name]</font>, <font color="#f81d22">cachedBind[name]</font> 等缓存；若 <font color="#f81d22">component</font> 为字段组件实例，<font color="#f81d22">domFields[name]</font> 缓存标记将置为真值，<font color="#f81d22">instances[name]</font> 将缓存字段组件实例，并尝试使用 <font color="#f81d22">clearedFieldMetaCache</font> 缓存以恢复 <font color="#ffa500">FieldsStore</font>  实例中的相关数据，等恢复完成后，再行清理 <font color="#f81d22">clearedFieldMetaCache[name]</font> 缓存。</li>
<li><font color="#008dff">recoverClearedField(name)</font> 通过 <font color="#f81d22">clearedFieldMetaCache[name] </font>缓存恢复 <font color="#ffa500">FieldsStore</font>  实例存储的字段实时数据和元数据，完成后清除 <font color="#f81d22">clearedFieldMetaCache[name]</font> 缓存。</li>
<li><font color="#008dff">cleanUpUselessFields</font> 根据 <font color="#f81d22">renderFields</font>, <font color="#f81d22">domFields</font> 缓存判断字段组件是否未作渲染，如未作渲染，调用 <font color="#008dff">clearField</font> 清理 <font color="#ffa500">FieldsStore</font> 实例存储的字段实时数据和元数据。在 <font color="#ffa500">BaseForm</font>  组件的 <font color="#008dff">componentDidMount</font>, <font color="#008dff">componentDidUpdate</font> 生命周期中执行。</li>
<li><font color="#008dff">clearField(name)</font> 清除 <font color="#ffa500">FieldsStore</font>  实例存储的字段实时数据和元数据，并删除 <font color="#f81d22">instances[name]</font>, <font color="#f81d22">cachedBind[name]</font> 缓存。</li>
</ul>
</li>
</ol>
<h4 id="字段组件-props-处理及绑定函数"><a href="#字段组件-props-处理及绑定函数" class="headerlink" title="字段组件 props 处理及绑定函数"></a>字段组件 props 处理及绑定函数</h4><ul>
<li><font color="#008dff">getFieldProps(name, usersFieldOption)</font> 为 <font color="#ffa500">FieldsStore</font>  实例收集元数据，如转换校验规则；并装饰字段组件的 <font color="#f81d22">props</font>，如指定字段组件的 <font color="#f81d22">ref</font> 引用为 <font color="#ffa500">BaseForm</font> 组件实例的 <font color="#008dff">saveRef</font> 方法、为字段组件实例绑定 <font color="#008dff">onCollect</font>, <font color="#008dff">onCollectValidate</font> 方法以收集或校验表单数据、元数据 <font color="#0b8235">{ [fieldMetaProp]: fieldMeta }</font> 及实时数据 <font color="#0b8235">{ [fieldDataProp]: field }</font>、字段名 <font color="#0b8235">{ [fieldNameProp]: name }</font>。备注：<font color="#008dff">getFieldProps</font> 在字段组件实例化过程中执行，首先将清理 <font color="#f81d22">clearedFieldMetaCache</font> 缓存，最后记录 <font color="#f81d22">renderFields</font> 缓存，最终输出字段组件实例使用的 <font color="#f81d22">props</font>。</li>
<li><font color="#008dff">getFieldDecorator(name, fieldOption)</font> 基于 <font color="#008dff">getFieldProps</font> 方法，直接装饰字段组件。这样就能获得开发者设定在字段组件实例上的 <font color="#f81d22">ref</font> 引用函数及 <font color="#f81d22">props</font> 属性如 <font color="#008dff">onChange</font> 等绑定函数等，并以 <font color="#f81d22">fieldMeta.ref</font>, <font color="#f81d22">fieldMeta.originalProps</font> 形式存入元数据中。其意义是在 <font color="#ffa500">BaseForm</font>  提供的 <font color="#008dff">saveRef</font> 执行过程中，可以调用到开发者设定在字段组件实例上的 <font color="#f81d22">ref</font> 引用函数；在 <font color="#ffa500">BaseForm</font> 提供的 <font color="#008dff">onCollect</font>, <font color="#008dff">onCollectValidate</font> 绑定函数执行过程中，可以调用到开发者设定在字段组件实例上的 <font color="#008dff">onChange</font> 绑定函数。<font color="#008dff">getFieldDecorator</font> 函数也将使用初始值绘制字段项。</li>
<li><font color="#008dff">onCollect(name_, action, …args)</font> 基于 <font color="#008dff">onCollectCommon</font> 方法，在事件触发时，实时更新 <font color="#ffa500">FieldsStore</font> 实例存储的实时数据。实时数据更新通过调用 <font color="#008dff">setFields</font> 方法实现。</li>
<li><font color="#008dff">onCollectValidate(name_, action, …args)</font> 基于 <font color="#008dff">onCollectCommon</font>, <font color="#008dff">validateFieldsInternal</font> 方法，在事件触发时，既实时更新 <font color="#ffa500">FieldsStore</font>  实例存储的实时数据，又实时校验字段。实时数据更新通过调用 <font color="#008dff">setFields</font> 方法实现。</li>
</ul>
<h4 id="表单数据赋值和校验"><a href="#表单数据赋值和校验" class="headerlink" title="表单数据赋值和校验"></a>表单数据赋值和校验</h4><ul>
<li><font color="#008dff">setFields(maybeNestedFields, callback)</font> 以参数 <font color="#f81d22">maybeNestedFields</font> 部分更新 <font color="#ffa500">FieldsStore</font> 实例中的实时数据，并执行 <font color="#008dff">option.onFieldsChange</font> 方法，再调用 <font color="#008dff">forceUpdate</font> 重绘表单并执行回调。</li>
<li><font color="#008dff">setFieldsValue(changedValues, callback)</font> 基于 <font color="#008dff">setFields</font> 方法，更新表单数据，并执行 <font color="#008dff">option.onValuesChange</font> 方法。若 <font color="#f81d22">changedValues</font> 中相关的字段组件未作渲染，予以警告提示。</li>
<li><font color="#008dff">resetFields(ns)</font> 基于 <font color="#008dff">setFields</font> 方法，重置表单数据，并清除相关 <font color="#f81d22">clearedFieldMetaCache</font> 缓存。</li>
<li><font color="#008dff">validateFields(ns, opt, cb)</font> 基于 <font color="#008dff">validateFieldsInternal</font>，校验表单数据。</li>
</ul>
<h4 id="辅助方法-1"><a href="#辅助方法-1" class="headerlink" title="辅助方法"></a>辅助方法</h4><ul>
<li><font color="#008dff">getCacheBind(name, action, fn)</font> 以 <font color="#0b8235">cachedBind[name][action] = { fn, oriFn }</font> 形式缓存 <font color="#008dff">onCollect</font>, <font color="#008dff">onCollectValidate</font>, <font color="#008dff">saveRef</font> 方法，便于使用 <font color="#f81d22">name</font> 进行查找。</li>
<li><font color="#008dff">onCollectCommon(name, action, args)</font> 在 <font color="#f81d22">action</font> 事件触发时，调用自定义绑定函数 <font color="#008dff">fieldMeta[action]</font> 或 <font color="#008dff">fieldMeta.originalProps[action]</font>，通过 <font color="#008dff">fieldMeta.getValueFromEvent</font> 收集字段的值，并执行 <font color="#008dff">option.onValuesChange</font> 绑定函数，返回 <font color="#0b8235">{ name, field, fieldMeta }</font>。</li>
<li><font color="#008dff">getRules(fieldMeta, action)</font> 获取匹配的校验规则。</li>
<li><font color="#008dff">validateFieldsInternal(fields, { fieldNames, action, options }, callback)</font> 校验指定字段。可复用之前的校验结果，收集待校验的字段并予以校验，转化校验文案并执行 <font color="#008dff">callback</font> 回调。若异步校验期间字段的值发生改变，将得到校验已过期文案。在校验起始阶段，调用 <font color="#008dff">setFields</font> 记录校验中状态；校验结束阶段，调用 <font color="#008dff">setFields</font> 记录校验结果。</li>
<li><font color="#008dff">getFieldInstance(name)</font>，获取字段组件实例。</li>
</ul>
<p>数据缓存并恢复机制的相关源码为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">getFieldProps(name, usersFieldOption = &#123;&#125;) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!name) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Must call `getFieldProps` with valid name string!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    warning(</span><br><span class="line">      <span class="keyword">this</span>.fieldsStore.isValidNestedFieldName(name),</span><br><span class="line">      <span class="string">'One field name cannot be part of another, e.g. `a` and `a.b`.'</span></span><br><span class="line">    );</span><br><span class="line">    warning(</span><br><span class="line">      !(<span class="string">'exclusive'</span> <span class="keyword">in</span> usersFieldOption),</span><br><span class="line">      <span class="string">'`option.exclusive` of `getFieldProps`|`getFieldDecorator` had been remove.'</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> <span class="keyword">this</span>.clearedFieldMetaCache[name];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fieldOption = &#123;</span><br><span class="line">    name,</span><br><span class="line">    trigger: DEFAULT_TRIGGER,</span><br><span class="line">    valuePropName: <span class="string">'value'</span>,</span><br><span class="line">    validate: [],</span><br><span class="line">    ...usersFieldOption,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    rules,</span><br><span class="line">    trigger,</span><br><span class="line">    validateTrigger = trigger,</span><br><span class="line">    validate,</span><br><span class="line">  &#125; = fieldOption;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fieldMeta = <span class="keyword">this</span>.fieldsStore.getFieldMeta(name);</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'initialValue'</span> <span class="keyword">in</span> fieldOption) &#123;</span><br><span class="line">    fieldMeta.initialValue = fieldOption.initialValue;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> inputProps = &#123;</span><br><span class="line">    ...this.fieldsStore.getFieldValuePropValue(fieldOption),</span><br><span class="line">    ref: <span class="keyword">this</span>.getCacheBind(name, <span class="string">`<span class="subst">$&#123;name&#125;</span>__ref`</span>, <span class="keyword">this</span>.saveRef),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (fieldNameProp) &#123;</span><br><span class="line">    inputProps[fieldNameProp] = formName ? <span class="string">`<span class="subst">$&#123;formName&#125;</span>_<span class="subst">$&#123;name&#125;</span>`</span> : name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> validateRules = normalizeValidateRules(validate, rules, validateTrigger);</span><br><span class="line">  <span class="keyword">const</span> validateTriggers = getValidateTriggers(validateRules);</span><br><span class="line">  validateTriggers.forEach(<span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (inputProps[action]) <span class="keyword">return</span>;</span><br><span class="line">    inputProps[action] = <span class="keyword">this</span>.getCacheBind(name, action, <span class="keyword">this</span>.onCollectValidate);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// make sure that the value will be collect</span></span><br><span class="line">  <span class="keyword">if</span> (trigger &amp;&amp; validateTriggers.indexOf(trigger) === <span class="number">-1</span>) &#123;</span><br><span class="line">    inputProps[trigger] = <span class="keyword">this</span>.getCacheBind(name, trigger, <span class="keyword">this</span>.onCollect);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> meta = &#123;</span><br><span class="line">    ...fieldMeta,</span><br><span class="line">    ...fieldOption,</span><br><span class="line">    validate: validateRules,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.fieldsStore.setFieldMeta(name, meta);</span><br><span class="line">  <span class="keyword">if</span> (fieldMetaProp) &#123;</span><br><span class="line">    inputProps[fieldMetaProp] = meta;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fieldDataProp) &#123;</span><br><span class="line">    inputProps[fieldDataProp] = <span class="keyword">this</span>.fieldsStore.getField(name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This field is rende#f81d22, record it</span></span><br><span class="line">  <span class="keyword">this</span>.renderFields[name] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> inputProps;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">saveRef(name, _, component) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!component) &#123;</span><br><span class="line">    <span class="comment">// after destroy, delete data</span></span><br><span class="line">    <span class="keyword">this</span>.clearedFieldMetaCache[name] = &#123;</span><br><span class="line">      field: <span class="keyword">this</span>.fieldsStore.getField(name),</span><br><span class="line">      meta: <span class="keyword">this</span>.fieldsStore.getFieldMeta(name),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.clearField(name);</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>.domFields[name];</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.domFields[name] = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">this</span>.recoverClearedField(name);</span><br><span class="line">  <span class="keyword">const</span> fieldMeta = <span class="keyword">this</span>.fieldsStore.getFieldMeta(name);</span><br><span class="line">  <span class="keyword">if</span> (fieldMeta) &#123;</span><br><span class="line">    <span class="keyword">const</span> ref = fieldMeta.ref;</span><br><span class="line">    <span class="keyword">if</span> (ref) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> ref === <span class="string">'string'</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`can not set ref string for <span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      ref(component);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.instances[name] = component;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">recoverClearedField(name) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.clearedFieldMetaCache[name]) &#123;</span><br><span class="line">    <span class="keyword">this</span>.fieldsStore.setFields(&#123;</span><br><span class="line">      [name]: <span class="keyword">this</span>.clearedFieldMetaCache[name].field,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.fieldsStore.setFieldMeta(name, <span class="keyword">this</span>.clearedFieldMetaCache[name].meta);</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>.clearedFieldMetaCache[name];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ol>
<li><p><font color="#008dff">createForm(options)</font> 基于 <font color="#008dff">createBaseForm</font>，为 <font color="#0b8235">HOC</font> 组件注入默认的 <font color="#008dff">getForm</font> 方法，将 <font color="#f81d22">form</font> 表单操作函数工具集通过 <font color="#f81d22">props</font> 注入到用户自定义表单组件中。<font color="#f81d22">form</font> 中含有的方法，参见上文。</p>
</li>
<li><p><font color="#008dff">createDOMForm(option)</font> 基于 <font color="#008dff">createBaseForm</font>，在传递给用户自定义表单组件的 <font color="#f81d22">props.form</font> 混入 <font color="#008dff">validateFieldsAndScroll</font> 方法，校验失败时滚动到首个错误字段处。该方法引用了 <font color="#0b8235">react-dom</font>，只适用于浏览器平台，不适用于手机端。</p>
<ul>
<li><font color="#008dff">validateFieldsAndScroll(ns, opt, cb)</font> 基于 <font color="#0b8235">dom-scroll-into-view</font> 库实现，首先通过 <font color="#008dff">getBoundingClientRect</font> 获得校验失败字段的 <font color="#f81d22">top</font> 值，其次通过 getComputedStyle 或 <font color="#f81d22">style</font> 属性获得字段节点首个滚动的父元素，最后调用 <font color="#0b8235">dom-scroll-into-view</font> 库提供的 api 滚动页面。</li>
</ul>
</li>
<li><p><font color="#ffa500">FormScope</font> 以组件形式提供接口。<font color="#f81d22">option</font> 配置项通过 <font color="#f81d22">props</font> 传入，在 <font color="#008dff">render</font> 阶段调用 <font color="#008dff">createDOMForm</font>，并将 <font color="#f81d22">form</font> 传入函数组件 <font color="#f81d22">children</font> 中。</p>
</li>
<li><p><font color="#008dff">createFormField</font> 生成 <font color="#ffa500">Field</font> 实例。</p>
</li>
</ol>
<h2 id="antd-Form-组件"><a href="#antd-Form-组件" class="headerlink" title="antd-Form 组件"></a>antd-Form 组件</h2><h3 id="Form-组件"><a href="#Form-组件" class="headerlink" title="Form 组件"></a>Form 组件</h3><p><font color="#ffa500">Form</font> 组件本身并不承载逻辑，而是通过 <font color="#f81d22">props.className</font>, <font color="#f81d22">props.prefixCls</font>, <font color="#f81d22">props.layout</font>, <font color="#f81d22">props.hideRequiredMark</font>, <font color="#f81d22">props.onSubmit</font> 设定注入 <font color="#f81d22">form</font> 原生节点的样式类及绑定函数，以影响表单内部节点渲染时的样式。同时，<font color="#ffa500">Form</font> 组件将为子组件传入 <font color="#f81d22">context.vertical</font> 以区分是水平布局，还是垂直布局。</p>
<p><font color="#ffa500">Form</font> 组件拥有 <font color="#f81d22">Item</font> 静态属性指向 <font color="#ffa500">FormItem</font> 组件；<font color="#008dff">createFormField</font> 静态方法指向 <font color="#0b8235">rc-form</font> 提供的同名方法；<font color="#008dff">createForm</font> 静态方法调用 <font color="#0b8235">rc-form</font> 提供的 <font color="#008dff">createBaseForm</font> 方法，用于装饰用户自定义表单组件。</p>
<h3 id="FormItem-组件"><a href="#FormItem-组件" class="headerlink" title="FormItem 组件"></a>FormItem 组件</h3><p><font color="#ffa500">FormItem</font> 组件用于设定表单项的布局，其可配置的 <font color="#f81d22">props</font> 属性包含必填标记 <font color="#f81d22">hideRequiredMark</font>, 字段名 <font color="#f81d22">label</font>, 校验文案 <font color="#f81d22">help</font>, 额外内容 <font color="#f81d22">extra</font>。</p>
<p>同受控组件和非受控组件，<font color="#ffa500">FormItem</font> 组件提供两种使用方式：其一，当未设定校验信息相关的 <font color="#f81d22">props</font> 属性时，<font color="#ffa500">FormItem</font> 组件将自动根据内部字段组件实例的状况渲染校验文案及校验状态；其二，当设定校验信息相关的 <font color="#f81d22">props</font> 属性时，<font color="#ffa500">FormItem</font> 组件将根据开发者传入的 <font color="#f81d22">props</font> 渲染校验文案及校验状态。在第一种使用方式下，<font color="#ffa500">FormItem</font> 组件只可以包含一个字段组件；在第二种使用方式下，<font color="#ffa500">FormItem</font> 组件中可以包含多个字段组件，布局也更为灵活。这里说的相关 <font color="#f81d22">props</font> 属性包含：校验文案 <font color="#f81d22">help</font>, 校验状态 <font color="#f81d22">validateStatus</font>（用于绘制反馈图标）, 必填标识 <font color="#f81d22">required</font>, 字段名 <font color="#f81d22">id</font>（影响点击 <font color="#f81d22">label</font> 时聚焦哪个字段元素）。</p>
<p>那么，<font color="#ffa500">FormItem</font> 又是怎样自动收集字段组件的校验数据呢？因为在 <font color="#ffa500">BaseForm</font>  组件提供的 getFieldProp 方法，字段的字段名、元数据和实时数据都将作为特殊的 props 属性传入到字段组件中，所以作为字段组件容器的 <font color="#ffa500">FormItem</font>，就可以通过这些特殊的 <font color="#f81d22">props</font> 属性判断子组件实例是不是一个字段组件实例，当其为字段组件实例时，进一步收集实时的校验信息，从校验规则中获取是否必填标识，以完成渲染。</p>
<p>此外，<font color="#ffa500">FormItem</font> 可以使用 <font color="#f81d22">props.labelCol</font>, <font color="#f81d22">props.wrapperCol</font> 属性栅格化布局标签组件和字段组件，其实现借助于 <font color="#0b8235">antd</font> 提供的 <font color="#ffa500">Row</font>, <font color="#ffa500">Col</font> 组件。当点击标签 <font color="#f81d22">label</font> 时，<font color="#ffa500">FormItem</font> 提供的绑定函数能为字段组件获得焦点。这里不再多加介绍。</p>
<p>获取字段组件实例的相关源码为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">getControls(children: React.ReactNode, <span class="attr">recursively</span>: boolean) &#123;</span><br><span class="line">  <span class="keyword">let</span> controls: React.ReactElement&lt;any&gt;[] = [];</span><br><span class="line">  <span class="keyword">const</span> childrenArray = React.Children.toArray(children);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; childrenArray.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!recursively &amp;&amp; controls.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> child = childrenArray[i] <span class="keyword">as</span> React.ReactElement&lt;any&gt;;</span><br><span class="line">    <span class="keyword">if</span> (child.type &amp;&amp;</span><br><span class="line">      (child.type <span class="keyword">as</span> any === FormItem || (child.type <span class="keyword">as</span> any).displayName === <span class="string">'FormItem'</span>)) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!child.props) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (FIELD_META_PROP <span class="keyword">in</span> child.props) &#123; <span class="comment">// And means FIELD_DATA_PROP in child.props, too.</span></span><br><span class="line">      controls.push(child);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (child.props.children) &#123;</span><br><span class="line">      controls = controls.concat(<span class="keyword">this</span>.getControls(child.props.children, recursively));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> controls;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>以上即简要分析了 ant-desing 中 Form 组件的实现，文中难免有谬误或思考上的不足处，仍望读者海涵。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/analyst/" rel="tag"># analyst</a>
          
            <a href="/tags/react/" rel="tag"># react</a>
          
            <a href="/tags/antd/" rel="tag"># antd</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/10/react/react相关/react-jsonschema-form源码分析/" rel="next" title="react-jsonschema-form源码分析">
                <i class="fa fa-chevron-left"></i> react-jsonschema-form源码分析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/06/设计模式/代理模式/" rel="prev" title="代理模式">
                代理模式 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpeg"
                alt="Alfred" />
            
              <p class="site-author-name" itemprop="name">Alfred</p>
              <p class="site-description motion-element" itemprop="description">人苦不知足，既得陇，复望蜀</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">37</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Alfred-sg" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/xiu-fan-79/activities" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-globe"></i>知乎</a>
                  </span>
                
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#rc-form"><span class="nav-number">1.</span> <span class="nav-text">rc-form</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FieldsStore"><span class="nav-number">1.1.</span> <span class="nav-text">FieldsStore</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#fields-实时数据"><span class="nav-number">1.1.1.</span> <span class="nav-text">fields 实时数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#元数据"><span class="nav-number">1.1.2.</span> <span class="nav-text">元数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#清除数据"><span class="nav-number">1.1.3.</span> <span class="nav-text">清除数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#辅助方法"><span class="nav-number">1.1.4.</span> <span class="nav-text">辅助方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字段名获取"><span class="nav-number">1.1.5.</span> <span class="nav-text">字段名获取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据赋值"><span class="nav-number">1.1.6.</span> <span class="nav-text">数据赋值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据获取"><span class="nav-number">1.1.7.</span> <span class="nav-text">数据获取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#错误信息获取"><span class="nav-number">1.1.8.</span> <span class="nav-text">错误信息获取</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BaseForm"><span class="nav-number">1.2.</span> <span class="nav-text">BaseForm</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#createBaseForm"><span class="nav-number">1.2.1.</span> <span class="nav-text">createBaseForm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#表单及字段组件生命周期相关"><span class="nav-number">1.2.2.</span> <span class="nav-text">表单及字段组件生命周期相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字段组件-props-处理及绑定函数"><span class="nav-number">1.2.3.</span> <span class="nav-text">字段组件 props 处理及绑定函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#表单数据赋值和校验"><span class="nav-number">1.2.4.</span> <span class="nav-text">表单数据赋值和校验</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#辅助方法-1"><span class="nav-number">1.2.5.</span> <span class="nav-text">辅助方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他"><span class="nav-number">1.3.</span> <span class="nav-text">其他</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#antd-Form-组件"><span class="nav-number">2.</span> <span class="nav-text">antd-Form 组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Form-组件"><span class="nav-number">2.1.</span> <span class="nav-text">Form 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FormItem-组件"><span class="nav-number">2.2.</span> <span class="nav-text">FormItem 组件</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alfred</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.0.2</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.2"></script>



  

  
    <script id="dsq-count-scr" src="https://alfred.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2018/11/04/ant design/antd-Form 组件/';
        this.page.identifier = '2018/11/04/ant design/antd-Form 组件/';
        this.page.title = 'antd-Form 组件';
      };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://alfred.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        loadComments();
      
    </script>
  





	





  












  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
