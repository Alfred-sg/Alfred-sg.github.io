<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">

    

    
    <title>Menu | 修子范语</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="analyst,react,antd">
    
    <meta name="description" content="antd 中的 Menu 组件用于绘制菜单栏，其实现基于 rc-menu。本文第一部分介绍菜单栏实现的整体结构；第二部分介绍 rc-menu；第三部分介绍 Menu 组件。 需要声明的是，本文使用 RcMenu 指代 rc-menu 输出的 Menu 组件或其实例，使用 Menu 指代 antd 输出的 Menu 组件或其实例、或抽象意义的菜单栏组件，余同。 整体结构在视图上，菜单栏分为水平布局和">
<meta name="keywords" content="analyst,react,antd">
<meta property="og:type" content="article">
<meta property="og:title" content="Menu">
<meta property="og:url" content="http://xzfyu.com/2018/12/10/frontend/antd/Menu/index.html">
<meta property="og:site_name" content="修子范语">
<meta property="og:description" content="antd 中的 Menu 组件用于绘制菜单栏，其实现基于 rc-menu。本文第一部分介绍菜单栏实现的整体结构；第二部分介绍 rc-menu；第三部分介绍 Menu 组件。 需要声明的是，本文使用 RcMenu 指代 rc-menu 输出的 Menu 组件或其实例，使用 Menu 指代 antd 输出的 Menu 组件或其实例、或抽象意义的菜单栏组件，余同。 整体结构在视图上，菜单栏分为水平布局和">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://xzfyu.com/2018/12/10/frontend/antd/Menu/rc-menu整体结构.png">
<meta property="og:updated_time" content="2020-03-08T10:28:26.017Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Menu">
<meta name="twitter:description" content="antd 中的 Menu 组件用于绘制菜单栏，其实现基于 rc-menu。本文第一部分介绍菜单栏实现的整体结构；第二部分介绍 rc-menu；第三部分介绍 Menu 组件。 需要声明的是，本文使用 RcMenu 指代 rc-menu 输出的 Menu 组件或其实例，使用 Menu 指代 antd 输出的 Menu 组件或其实例、或抽象意义的菜单栏组件，余同。 整体结构在视图上，菜单栏分为水平布局和">
<meta name="twitter:image" content="http://xzfyu.com/2018/12/10/frontend/antd/Menu/rc-menu整体结构.png">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/3.4.1/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
    
    


</head>
</html>
<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">Alfredo&#39;s Notes</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/">主页</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/">backend</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/java/">java</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/java-工程/">java 工程</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/spring/">spring</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/web-服务/">web 服务</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/其他/">其他</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/异步消息/">异步消息</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/数据库技术/">数据库技术</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/架构/">架构</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/缓存/">缓存</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/远程通信/">远程通信</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/backend/部署/">部署</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/">frontend</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/antd/">antd</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/architecture/">architecture</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/css/">css</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/editor/">editor</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/es/">es</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/guide/">guide</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/js/">js</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/library/">library</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/react/">react</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/vue/">vue</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/webpack/">webpack</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/frontend/前端工程化/">前端工程化</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/数据技术/">数据技术</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/数据技术/sql/">sql</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/数据技术/大数据/">大数据</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/数据技术/读书笔记/">读书笔记</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/计算机科学/">计算机科学</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/计算机科学/操作系统/">操作系统</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/计算机科学/算法/">算法</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/计算机科学/设计模式/">设计模式</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/计算机科学/软件工程/">软件工程</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/读书笔记/">读书笔记</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/踩坑/">踩坑</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/随笔/">随笔</a></li></ul>
                                    
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/about/index.html">关于</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/frontend/">frontend</a><i class="icon fa fa-angle-right"></i><a class="page-title-link" href="/categories/frontend/antd/">antd</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-frontend/antd/Menu" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        Menu
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
      <a href="/2018/12/10/frontend/antd/Menu/" class="article-date">
         <time datetime="2018-12-09T16:00:00.000Z" itemprop="datePublished">2018-12-10</time>
      </a>
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/analyst/">analyst</a>, <a class="tag-link" href="/tags/antd/">antd</a>, <a class="tag-link" href="/tags/react/">react</a>
    </div>

                

                

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <p>antd 中的 Menu 组件用于绘制菜单栏，其实现基于 <a href="https://github.com/react-component/menu" target="_blank" rel="noopener">rc-menu</a>。本文第一部分介绍菜单栏实现的整体结构；第二部分介绍 rc-menu；第三部分介绍 Menu 组件。</p>
<p>需要声明的是，本文使用 RcMenu 指代 rc-menu 输出的 Menu 组件或其实例，使用 Menu 指代 antd 输出的 Menu 组件或其实例、或抽象意义的菜单栏组件，余同。</p>
<h2 id="整体结构"><a href="#整体结构" class="headerlink" title="整体结构"></a>整体结构</h2><p>在视图上，菜单栏分为水平布局和垂直布局两种，又支持层叠嵌套（如主菜单 Menu 嵌套子菜单 SubMenu）；子菜单的展开形式分为内嵌和浮层两种。Menu 组件通过 props.mode 区分所采用的模式：vertical 为垂直模式；horizontal 为水平模式；inline 为内嵌模式。菜单栏的垂直布局和水平布局借助样式实现。在水平布局中，超出菜单栏宽度的菜单项需要合并展示，这部分处理逻辑由 rc-menu 中的 DomWrap 组件实现。</p>
<p>在内容上，主菜单和子菜单相仿，功能上有交集。在 rc-menu 中，主菜单 Menu 和子菜单 SubMenu 均通过 SubPopupMenu 组件绘制内容，SubPopupMenu 又使用 DomWrap 控制水平布局时的元素展示。SubPopupMenu 自有的处理逻辑为：控制菜单栏的激活状态（通过 componentDidUpdate, onKeyDown, onItemHover 方法达成，详见下文）。用过 antd 的同学应该了解，Menu 组件下可使用 SubMenu, MenuItem, MenuItemGroup 绘制子菜单或菜单项，父子元素之间就会有状态管理方面的通信需求。针对这个问题，SubPopupMenu 使用 React.clone 方法将父组件实现的状态管理函数或其 props 属性注入到子组件中，从而串联了主菜单与子菜单、主菜单与菜单项、以及子菜单与菜单项。</p>
<p>菜单栏的状态管理分为三种：菜单项的激活状态、菜单项的选中状态、子菜单的展开折叠状态。rc-menu 借助 <a href="https://github.com/yesmeck/mini-store" target="_blank" rel="noopener">mini-store</a> 管理这些状态：activeKey 激活的菜单项，selectedKeys 选中的菜单项，openKeys 展开的子菜单。如上文所说，activeKey 由 SubPopupMenu 处理其更新逻辑。selectedKeys, openKeys 均由 RcMenu 处理其更新逻辑。交互层面，当 props.selectedKeys, props.openKeys 变更时，RcMenu 提供的 updateMiniStore 方法将负责更新 store 中的存储数据；当用户行为发生时，RcMenu 提供的 onSelect, onDeSelect, onOpenChange 方法将负责更新 store 中的存储数据，这些方法又通过 SubPopupMenu 长传到 SubMenu, MenuItem, MenuItemGroup 中。简而言之，RcMenu 既通过 props 接受使用者传入的菜单栏整体配置数据，又集成了 selectedKeys, openKeys 的状态管理函数。</p>
<p>在 RcMenu 提供 onSelect, onDeSelect, onOpenChange 方法和 SubPopupMenu 提供的 onItemHover 方法的基础上，子菜单 RcSubMenu 既将 onSelect, onDeSelect 透传给菜单项，又使用 onOpenChange 控制展开折叠状态，onItemHover 更新激活状态。不同于主菜单，子菜单需要以内嵌或浮层形式表现内容，且需要在展开与折叠过程中显示动效。借助 <a href="https://github.com/react-component/trigger" target="_blank" rel="noopener">rc-trigger</a>、<a href="https://github.com/react-component/animate" target="_blank" rel="noopener">rc-animate</a> 库，RcSubMenu 集成了浮层显示功能和动效展示逻辑。即，通过 props.mode 判断菜单栏是否采用 inline 模式，RcSubMenu 将以浮层形式绘制子菜单内容；子菜单展开与折叠过程中所采用的动效，取决于顶层容器 Menu 主菜单接受 props 配置。</p>
<p>菜单项 RcMenuItem 通过 props 接受 RcMenu 提供的 onSelect, onDeSelect 方法和 SubPopupMenu 提供的 onItemHover 方法，以便在点击事件、鼠标移入移出时更新 store 中的状态。在 RcMenuItem 的基础上，RcMenuItemGroup 用于绘制成组的菜单项。</p>
<p>下图是 rc-menu 的整体结构:<br><img src="/2018/12/10/frontend/antd/Menu/rc-menu整体结构.png"></p>
<p>在 rc-menu 实现状态管理的基础上，antd 提供的 Menu 组件用于桥接侧边栏和菜单栏的关联性，维护内置的动效显示，以及样式处理。详见下文。</p>
<h2 id="rc-menu"><a href="#rc-menu" class="headerlink" title="rc-menu"></a>rc-menu</h2><p>rc-menu 的类图为：<br><img src="/2018/12/10/frontend/antd/Menu/rc-menu类图.png"></p>
<p>rc-menu 中的状态管理：</p>
<ol>
<li>selectedKeys 选中的菜单项：由 RcMenu 提供 onSelect, onDeselect 方法加以管理。onSelect, onDeselect 方法将长传到 RcMenuItem 组件，以便在 RcMenuItem 的 onKeyDown, onClick 行为中更新状态。同时，在 RcMenu 的 componentDidUpdate 生命周期中，也将 props.selectedKeys 更新状态值。</li>
<li>openKeys 展开的子菜单：由 RcMenu 提供 onOpenChange 方法加以管理。onOpenChange 方法将长传到 RcSubMenu 组件并封装为 RcSubMenu.triggerOpenChange 方法，以便在 RcSubMenu 的 onKeyDown, onTitleClick, onPopupVisibleChange 行为中更新状态。同时，在 RcMenu 的 componentDidUpdate 生命周期中，也将 props.openKeys 更新状态值。</li>
<li>activeKey 激活的菜单项：由辅助函数 updateActiveKey 加以管理。updateActiveKey 函数被 SubPopupMenu 的 componentDidUpdate, onItemHover 方法调用。其中，onItemHover 方法将长传到 RcSubMenu 或 RcMenuItem 组件，以便在 RcSubMenu 的 onTitleMouseEnter, onTitleMouseLeave 行为或 RcMenuItem 的 onMouseEnter, onMouseLeave 行为中更新状态。</li>
<li>defaultActiveFirst 是否激活首个菜单项，辅助计算激活的菜单项：由辅助函数 updateDefaultActiveFirst 加以管理。updateDefaultActiveFirst 函数被 RcSubMenu 的 constructor, onKeyDown, onMouseEnter, onTitleClick 方法调用。其中，constructor 将视 RcSubMenu 接受的 props.defaultActiveFirst 设置状态；onKeyDown 将状态更新为 true；onMouseEnter, onTitleClick 均更新为 false。</li>
</ol>
<p>rc-menu 中的 key 键用于辅助状态管理。key 键仅对于子菜单或菜单项才有效。在默认情况下，SubPopupMenu 会以 ‘0-menu-‘ 作为前缀，递归创建子菜单或菜单项的 key 键，并设置为该子菜单或菜单项的 props.eventKey。当菜单项作为子菜单的元素时，那么菜单项的 key 键就以子菜单的 props.eventKey 作为前缀。当使用者为子菜单或菜单项设置了 key 键时，rc-menu 将以它作为该子菜单或菜单项的 props.eventKey 键。因此，相同的 key 键是不被允许的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当 SubPopupMenu 作为 RcMenu 的直系子元素时，返回 '0-menu-'</span></span><br><span class="line"><span class="comment">// 其余情况获取子菜单或菜单项的 props.eventKey</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getEventKey</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> props.eventKey || <span class="string">'0-menu-'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动创建 key 键并返回，或者返回使用者设置的 key 键</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getKeyFromChildrenIndex</span>(<span class="params">child, menuEventKey, index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> prefix = menuEventKey || <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">return</span> child.key || <span class="string">`<span class="subst">$&#123;prefix&#125;</span>item_<span class="subst">$&#123;index&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 store 中，selectedKeys, openKeys 以 key 键作为数组项；activeKey, defaultActiveFirst 以 key 键作为属性名。当用户行为发生时，key 键将被封装到对象中，通过逐级调用 props 方法，冒泡给 RcMenu 实例的 onOpenChange, onSelect, onDeselect 或者 SubPopupMenu 实例的 onItemHover 方法，最终改变 store 的状态。需要说明的是，菜单项的 onClick 也会逐级调用 props 方法，以数组形式拼接子菜单的 key 键，最终冒泡给 RcMenu 接受的 props.onClick 方法。而 RcMenu 接受的 props.onDestory 方法，则是逐级向下传递，最终在每个菜单项的 componentWillUnmount 生命周期中，均执行 onDestory 方法，参数即菜单项的 key 键。特别的，RcMenu 实现的 onKeyDown 实例方法将逐级往下调用 SubPopupMenu, RcSubMenu, RcMenuItem 中的 onKeyDown 方法。在这个过程中，SubPopupMenu 构建的 onKeyDown 实例方法也将在 DomWrap 组件被绑定为视图元素 onKeyDown 事件发生时的执行函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Menu</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 以引用形式调用，可依次改变选中的菜单项</span></span><br><span class="line">  <span class="comment">// 当遇到子菜单时，先展开子菜单，再选中子菜单项</span></span><br><span class="line">  onKeyDown = <span class="function">(<span class="params">e, callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// this.innerMenu.getWrappedInstance 用于获得 Menu 下直系子元素 —— SubPopupMenu 实例</span></span><br><span class="line">    <span class="keyword">this</span>.innerMenu.getWrappedInstance().onKeyDown(e, callback);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubPopupMenu</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  onKeyDown = <span class="function">(<span class="params">e, callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> keyCode = e.keyCode;</span><br><span class="line">    <span class="keyword">let</span> handled;</span><br><span class="line">    <span class="comment">// 依次选中菜单项或展开子菜单</span></span><br><span class="line">    <span class="keyword">this</span>.getFlatInstanceArray().forEach(<span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (obj &amp;&amp; obj.props.active &amp;&amp; obj.onKeyDown) &#123;</span><br><span class="line">        handled = obj.onKeyDown(e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (handled) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> activeItem = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (keyCode === KeyCode.UP || keyCode === KeyCode.DOWN) &#123;</span><br><span class="line">      activeItem = <span class="keyword">this</span>.step(keyCode === KeyCode.UP ? <span class="number">-1</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (activeItem) &#123;</span><br><span class="line">      e.preventDefault();</span><br><span class="line">      updateActiveKey(<span class="keyword">this</span>.props.store, getEventKey(<span class="keyword">this</span>.props), activeItem.props.eventKey);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> callback === <span class="string">'function'</span>) &#123;</span><br><span class="line">        callback(activeItem);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubMenu</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  onKeyDown = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> keyCode = e.keyCode;</span><br><span class="line">    <span class="keyword">const</span> menu = <span class="keyword">this</span>.menuInstance;</span><br><span class="line">    <span class="keyword">const</span> &#123; isOpen, store &#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 展开子菜单，更新 defaultActiveFirst 状态</span></span><br><span class="line">    <span class="keyword">if</span> (keyCode === KeyCode.ENTER) &#123;</span><br><span class="line">      <span class="keyword">this</span>.onTitleClick(e);</span><br><span class="line">      updateDefaultActiveFirst(store, <span class="keyword">this</span>.props.eventKey, <span class="literal">true</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (keyCode === KeyCode.RIGHT) &#123;</span><br><span class="line">      <span class="comment">// 展开状态，选中子菜单项；menu 为 SubMenu 下直系子元素 —— SubPopupMenu 实例</span></span><br><span class="line">      <span class="keyword">if</span> (isOpen) &#123;</span><br><span class="line">        menu.onKeyDown(e);</span><br><span class="line">      <span class="comment">// 未展开状态，展开子菜单并更新 defaultActiveFirst 状态</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.triggerOpenChange(<span class="literal">true</span>);</span><br><span class="line">        updateDefaultActiveFirst(store, <span class="keyword">this</span>.props.eventKey, <span class="literal">true</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (keyCode === KeyCode.LEFT) &#123;</span><br><span class="line">      <span class="keyword">let</span> handled;</span><br><span class="line">      <span class="keyword">if</span> (isOpen) &#123;</span><br><span class="line">        handled = menu.onKeyDown(e);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!handled) &#123;</span><br><span class="line">        <span class="keyword">this</span>.triggerOpenChange(<span class="literal">false</span>);</span><br><span class="line">        handled = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> handled;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isOpen &amp;&amp; (keyCode === KeyCode.UP || keyCode === KeyCode.DOWN)) &#123;</span><br><span class="line">      <span class="keyword">return</span> menu.onKeyDown(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MenuItem</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  onKeyDown = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> keyCode = e.keyCode;</span><br><span class="line">    <span class="keyword">if</span> (keyCode === KeyCode.ENTER) &#123;</span><br><span class="line">      <span class="keyword">this</span>.onClick(e);<span class="comment">// 更新菜单的选中状态</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上介绍了 rc-menu 中的状态管理和事件处理逻辑，下面将扼要地介绍 rc-menu 中的各组件。</p>
<h3 id="SubPopupMenu"><a href="#SubPopupMenu" class="headerlink" title="SubPopupMenu"></a>SubPopupMenu</h3><p>SubPopupMenu 对激活状态的管理可参见上文，可参见上文及源码。这里只介绍 SubPopupMenu 的层级关系。</p>
<p>SubPopupMenu 可以作为 RcMenu 或 RcSubMenu 的直系子元素，其下可渲染 RcSubMenu 或 RcMenuItem 元素。在其实现中，既将 RcMenu 接受的 props 菜单栏整体配置项注入到子元素；又将 RcMenu 或 SubPopupMenu 提供的状态管理函数（均封装为 SubPopupMenu 的实例方法）注入 RcSubMenu 或 RcMenuItem。上述过程，见于 renderCommonMenuItem 方法，该方法由 renderMenuItem 直接调用。</p>
<p>renderMenuItem 方法的实现与 ref 引用处理一样，两者均让人心生纳闷：前者没有实现的必要；后者在 componentDidMount 生命周期管理实例引用，当菜单内容变化时仍会以缓存持有引用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubPopupMenu</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  renderCommonMenuItem = <span class="function">(<span class="params">child, i, extraProps</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> state = <span class="keyword">this</span>.props.store.getState();</span><br><span class="line">    <span class="keyword">const</span> props = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> key = getKeyFromChildrenIndex(child, props.eventKey, i);<span class="comment">// 创建或获取 key 键</span></span><br><span class="line">    <span class="keyword">const</span> childProps = child.props;</span><br><span class="line">    <span class="keyword">const</span> isActive = key === state.activeKey;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 混入菜单栏整体配置或状态管理函数、事件绑定函数</span></span><br><span class="line">    <span class="keyword">const</span> newChildProps = &#123;</span><br><span class="line">      mode: childProps.mode || props.mode,</span><br><span class="line">      level: props.level,</span><br><span class="line">      inlineIndent: props.inlineIndent,</span><br><span class="line">      renderMenuItem: <span class="keyword">this</span>.renderMenuItem,</span><br><span class="line">      rootPrefixCls: props.prefixCls,</span><br><span class="line">      index: i,</span><br><span class="line">      parentMenu: props.parentMenu,</span><br><span class="line">      <span class="comment">// customized ref function, need to be invoked manually in child's componentDidMount</span></span><br><span class="line">      manualRef: childProps.disabled ? <span class="literal">undefined</span> :</span><br><span class="line">        createChainedFunction(child.ref, saveRef.bind(<span class="keyword">this</span>)),</span><br><span class="line">      eventKey: key,</span><br><span class="line">      active: !childProps.disabled &amp;&amp; isActive,</span><br><span class="line">      multiple: props.multiple,</span><br><span class="line">      onClick: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        (childProps.onClick || noop)(e);</span><br><span class="line">        <span class="keyword">this</span>.onClick(e);</span><br><span class="line">      &#125;,</span><br><span class="line">      onItemHover: <span class="keyword">this</span>.onItemHover,</span><br><span class="line">      openTransitionName: <span class="keyword">this</span>.getOpenTransitionName(),</span><br><span class="line">      openAnimation: props.openAnimation,</span><br><span class="line">      subMenuOpenDelay: props.subMenuOpenDelay,</span><br><span class="line">      subMenuCloseDelay: props.subMenuCloseDelay,</span><br><span class="line">      forceSubMenuRender: props.forceSubMenuRender,</span><br><span class="line">      onOpenChange: <span class="keyword">this</span>.onOpenChange,</span><br><span class="line">      onDeselect: <span class="keyword">this</span>.onDeselect,</span><br><span class="line">      onSelect: <span class="keyword">this</span>.onSelect,</span><br><span class="line">      builtinPlacements: props.builtinPlacements,</span><br><span class="line">      itemIcon: childProps.itemIcon || <span class="keyword">this</span>.props.itemIcon,</span><br><span class="line">      expandIcon: childProps.expandIcon || <span class="keyword">this</span>.props.expandIcon,</span><br><span class="line">      ...extraProps,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (props.mode === <span class="string">'inline'</span>) &#123;</span><br><span class="line">      newChildProps.triggerSubMenuAction = <span class="string">'click'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> React.cloneElement(child, newChildProps);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">// props 处理及解构</span></span><br><span class="line">    <span class="comment">// renderMenuItem 将调用 renderCommonMenuItem 渲染子元素</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;DOMWrap &#123;...props&#125; prefixCls=&#123;prefixCls&#125; mode=&#123;mode&#125; tag=<span class="string">"ul"</span> level=&#123;level&#125; </span><br><span class="line">        theme=&#123;theme&#125; hiddenClassName=&#123;<span class="string">`<span class="subst">$&#123;prefixCls&#125;</span>-hidden`</span>&#125; visible=&#123;visible&#125;</span><br><span class="line">        overflowedIndicator=&#123;overflowedIndicator&#125; &#123;...domProps&#125;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          React.Children.map(props.children, (c, i) =&gt; </span><br><span class="line">            <span class="keyword">this</span>.renderMenuItem(c, i, eventKey || <span class="string">'0-menu-'</span>)</span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &lt;<span class="regexp">/DOMWrap&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="DomWrap"><a href="#DomWrap" class="headerlink" title="DomWrap"></a>DomWrap</h3><p>对于水平布局的菜单栏，DOMWrap 借助 <a href="https://github.com/que-etc/resize-observer-polyfill" target="_blank" rel="noopener">resize-observer-polyfill</a>，<a href="http://javascript.ruanyifeng.com/dom/mutationobserver.html" target="_blank" rel="noopener">MutationObserver</a> ，当 DOMWrap 实例或其子元素的 dom 内容或尺寸调整时，重新加以渲染。这样，在 DOMWrap 中就可以计算最后一个待显示的菜单项，并将这个菜单项和其余菜单项以 SubMenu 形式合并展示。其处理逻辑有：</p>
<ol>
<li>在 componentDidMount 生命周期为 DOMWrap 实例及其子元素绑定 dom 变更的监听函数。</li>
<li>当 dom 变更时，由监听函数调用 setChildrenWidthAndResize 实例方法。setChildrenWidthAndResize 先计算菜单项全显示时的总宽度，再将该宽度和菜单栏实际宽度对比，由此更新 state.lastVisibleIndex（最后一个待显示的菜单项的索引）。</li>
<li>在重绘阶段，DomWrap 将在每个已显示的菜单项后插入一个不予显示的 SubMenu 组件（其样式类带有 ‘overflowed-submenu’ 后缀，eventKey 为 ‘overflowed-indicator’ 后缀）；而待合并的菜单项将会用一个显示的 SubMenu 组件包裹，这样在点击时就可以显示浮层。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DOMWrap</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setChildrenWidthAndResize();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.level === <span class="number">1</span> &amp;&amp; <span class="keyword">this</span>.props.mode === <span class="string">'horizontal'</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> menuUl = ReactDOM.findDOMNode(<span class="keyword">this</span>);</span><br><span class="line">      <span class="keyword">if</span> (!menuUl) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.resizeObserver = <span class="keyword">new</span> ResizeObserver(<span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span><br><span class="line">        entries.forEach(<span class="keyword">this</span>.setChildrenWidthAndResize);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 为 DOMWrap 及其子元素绑定监听函数</span></span><br><span class="line">      [].slice.call(menuUl.children).concat(menuUl).forEach(<span class="function"><span class="params">el</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.resizeObserver.observe(el);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 当子元素列表改变时，重新为子元素绑定监听函数，避免触发不必要的回调</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> MutationObserver !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.mutationObserver = <span class="keyword">new</span> MutationObserver(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.resizeObserver.disconnect();</span><br><span class="line">          [].slice.call(menuUl.children).concat(menuUl).forEach(<span class="function"><span class="params">el</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.resizeObserver.observe(el);</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">this</span>.setChildrenWidthAndResize();</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">this</span>.mutationObserver.observe(</span><br><span class="line">          menuUl,</span><br><span class="line">          &#123; <span class="attr">attributes</span>: <span class="literal">false</span>, <span class="attr">childList</span>: <span class="literal">true</span>, <span class="attr">subTree</span>: <span class="literal">false</span> &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getOverflowedSubMenuItem = <span class="function">(<span class="params">keyPrefix, overflowedItems, renderPlaceholder</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// this.props.overflowedIndicator 通常是 '...'</span></span><br><span class="line">    <span class="keyword">const</span> &#123; overflowedIndicator, level, mode, prefixCls, theme, <span class="attr">style</span>: propStyle &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">if</span> (level !== <span class="number">1</span> || mode !== <span class="string">'horizontal'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> copy = <span class="keyword">this</span>.props.children[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">children</span>: throwAway, title, eventKey, ...rest &#125; = copy.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> style = &#123; ...propStyle &#125;;</span><br><span class="line">    <span class="keyword">let</span> key = <span class="string">`<span class="subst">$&#123;keyPrefix&#125;</span>-overflowed-indicator`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (overflowedItems.length === <span class="number">0</span> &amp;&amp; renderPlaceholder !== <span class="literal">true</span>) &#123;</span><br><span class="line">      style = &#123;</span><br><span class="line">        ...style,</span><br><span class="line">        display: <span class="string">'none'</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (renderPlaceholder) &#123;</span><br><span class="line">      style = &#123;</span><br><span class="line">        ...style,</span><br><span class="line">        visibility: <span class="string">'hidden'</span>,</span><br><span class="line">        position: <span class="string">'absolute'</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      key = <span class="string">`<span class="subst">$&#123;key&#125;</span>-placeholder`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> popupClassName = theme ? <span class="string">`<span class="subst">$&#123;prefixCls&#125;</span>-<span class="subst">$&#123;theme&#125;</span>`</span> : <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;&#125;;</span><br><span class="line">    menuAllProps.forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (rest[k] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        props[k] = rest[k];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;SubMenu title=&#123;overflowedIndicator&#125; className=&#123;<span class="string">`<span class="subst">$&#123;prefixCls&#125;</span>-overflowed-submenu`</span>&#125;</span><br><span class="line">        popupClassName=&#123;popupClassName&#125; &#123;...props&#125; key=&#123;key&#125;</span><br><span class="line">        eventKey=&#123;<span class="string">`<span class="subst">$&#123;keyPrefix&#125;</span>-overflowed-indicator`</span>&#125; disabled=&#123;<span class="literal">false</span>&#125; style=&#123;style&#125;&gt;</span><br><span class="line">        &#123;overflowedItems&#125;</span><br><span class="line">      &lt;<span class="regexp">/SubMenu&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  renderChildren(children) &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; lastVisibleIndex &#125; = this.state;</span></span><br><span class="line"><span class="regexp">    return (children || []).reduce((acc, childNode, index) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      let item = childNode;</span></span><br><span class="line"><span class="regexp">      if (this.props.mode === 'horizontal') &#123;</span></span><br><span class="line"><span class="regexp">        let overflowed = this.getOverflowedSubMenuItem(childNode.props.eventKey, []);</span></span><br><span class="line"><span class="regexp">        if (lastVisibleIndex !== undefined &amp;&amp;</span></span><br><span class="line"><span class="regexp">          this.props.className.indexOf(`$&#123;this.props.prefixCls&#125;-root`) !== -1</span></span><br><span class="line"><span class="regexp">        ) &#123;</span></span><br><span class="line"><span class="regexp">          if (index &gt; lastVisibleIndex) &#123;</span></span><br><span class="line"><span class="regexp">            /</span><span class="regexp">/ 修改 eventKey 是为了防止隐藏状态下还会触发 openkeys 事件</span></span><br><span class="line"><span class="regexp">            item = React.cloneElement(childNode, &#123;</span></span><br><span class="line"><span class="regexp">              style: &#123; display: 'none' &#125;,</span></span><br><span class="line"><span class="regexp">              eventKey: `$&#123;childNode.props.eventKey&#125;-hidden`,</span></span><br><span class="line"><span class="regexp">              className: `$&#123;childNode.className&#125; $&#123;MENUITEM_OVERFLOWED_CLASSNAME&#125;`</span></span><br><span class="line"><span class="regexp">            &#125;);</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">          if (index === lastVisibleIndex + 1) &#123;</span></span><br><span class="line"><span class="regexp">            this.overflowedItems = children.slice(lastVisibleIndex + 1).map(c =&gt; &#123;</span></span><br><span class="line"><span class="regexp">              return React.cloneElement(c, &#123; </span></span><br><span class="line"><span class="regexp">                key: c.props.eventKey, </span></span><br><span class="line"><span class="regexp">                mode: 'vertical-left' </span></span><br><span class="line"><span class="regexp">              &#125;);</span></span><br><span class="line"><span class="regexp">            &#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">            overflowed = this.getOverflowedSubMenuItem(</span></span><br><span class="line"><span class="regexp">              childNode.props.eventKey,</span></span><br><span class="line"><span class="regexp">              this.overflowedItems,</span></span><br><span class="line"><span class="regexp">            );</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        const ret = [...acc, overflowed, item];</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        if (index === children.length - 1) &#123;</span></span><br><span class="line"><span class="regexp">          /</span><span class="regexp">/ 设置占位符，以计算 overflowed indicator 的宽度</span></span><br><span class="line"><span class="regexp">          ret.push(this.getOverflowedSubMenuItem(childNode.props.eventKey, [], true));</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        return ret;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      return [...acc, item];</span></span><br><span class="line"><span class="regexp">    &#125;, []);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ Tag 即 this.props.tag，默认为 ul</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;Tag &#123;...rest&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &#123;this.renderChildren(this.props.children)&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Tag&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SubMenu"><a href="#SubMenu" class="headerlink" title="SubMenu"></a>SubMenu</h3><p>除了上文提到的，SubMenu 的处理逻辑还包含：</p>
<ol>
<li>通过 store 获取 props.isOpen 子菜单是否展开, props.active 子菜单是否激活, props.selectedKeys 辅助计算子菜单或子菜单项是否被选中。三者均影响样式。</li>
<li>组件层级上，SubMenu 根据菜单栏是否采用 inline 模式，以决定使用 Trigger 组件（rc-trigger 提供）包裹子元素，或者单纯绘制子元素；继而使用 Animate 组件（rc-animate 提供）绘制子元素，子元素均统一由 SubPopupMenu 组件渲染。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Menu</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 获取传入子组件的 props.openTransitionName 属性</span></span><br><span class="line">  getOpenTransitionName = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> props = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">let</span> transitionName = props.openTransitionName;</span><br><span class="line">    <span class="keyword">const</span> animationName = props.openAnimation;</span><br><span class="line">    <span class="keyword">if</span> (!transitionName &amp;&amp; <span class="keyword">typeof</span> animationName === <span class="string">'string'</span>) &#123;</span><br><span class="line">      transitionName = <span class="string">`<span class="subst">$&#123;props.prefixCls&#125;</span>-open-<span class="subst">$&#123;animationName&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> transitionName;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubMenu</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  renderChildren(children) &#123;</span><br><span class="line">    <span class="comment">// 构建 baseProps，按条件只绘制空内容...</span></span><br><span class="line">    <span class="keyword">const</span> animProps = &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> transitionAppear = haveRendered || !baseProps.visible || !baseProps.mode === <span class="string">'inline'</span>;</span><br><span class="line">    <span class="keyword">if</span> (baseProps.openTransitionName) &#123;</span><br><span class="line">      animProps.transitionName = baseProps.openTransitionName;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> baseProps.openAnimation === <span class="string">'object'</span>) &#123;</span><br><span class="line">      animProps.animation = &#123; ...baseProps.openAnimation &#125;;</span><br><span class="line">      <span class="keyword">if</span> (!transitionAppear) &#123;</span><br><span class="line">        <span class="keyword">delete</span> animProps.animation.appear;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Animate &#123;...animProps&#125; showProp=<span class="string">"visible"</span> component=<span class="string">""</span> transitionAppear=&#123;transitionAppear&#125;&gt;</span><br><span class="line">        &lt;SubPopupMenu &#123;...baseProps&#125; id=&#123;<span class="keyword">this</span>._menuId&#125;&gt;&#123;children&#125;&lt;<span class="regexp">/SubPopupMenu&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Animate&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">// props 处理及结构...</span></span><br><span class="line">    <span class="keyword">const</span> isOpen = props.isOpen;</span><br><span class="line">    <span class="keyword">const</span> isInlineMode = props.mode === <span class="string">'inline'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 展开按钮</span></span><br><span class="line">    <span class="keyword">let</span> icon = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (props.mode !== <span class="string">'horizontal'</span>) &#123;</span><br><span class="line">      icon = <span class="keyword">this</span>.props.expandIcon; <span class="comment">// ReactNode</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.props.expandIcon === <span class="string">'function'</span>)</span><br><span class="line">        icon = React.createElement(<span class="keyword">this</span>.props.expandIcon, &#123; ...this.props &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> title = (</span><br><span class="line">      &lt;div ref=&#123;<span class="keyword">this</span>.saveSubMenuTitle&#125; style=&#123;style&#125; className=&#123;<span class="string">`<span class="subst">$&#123;prefixCls&#125;</span>-title`</span>&#125;</span><br><span class="line">        &#123;...titleMouseEvents&#125; &#123;...titleClickEvents&#125; aria-expanded=&#123;isOpen&#125;</span><br><span class="line">        &#123;...ariaOwns&#125; aria-haspopup=<span class="string">"true"</span></span><br><span class="line">        title=&#123;<span class="keyword">typeof</span> props.title === <span class="string">'string'</span> ? props.title : <span class="literal">undefined</span>&#125;&gt;</span><br><span class="line">        &#123;props.title&#125;</span><br><span class="line">        &#123;icon || <span class="xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">className</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">prefixCls</span>&#125;<span class="attr">-arrow</span>`&#125; /&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">const</span> children = <span class="keyword">this</span>.renderChildren(props.children);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;li &#123;...props&#125; &#123;...mouseEvents&#125; className=&#123;className&#125; role=<span class="string">"menuitem"</span>&gt;</span><br><span class="line">        &#123;isInlineMode &amp;&amp; title&#125;</span><br><span class="line">        &#123;isInlineMode &amp;&amp; children&#125;</span><br><span class="line">        &#123;!isInlineMode &amp;&amp; (</span><br><span class="line">          &lt;Trigger prefixCls=&#123;prefixCls&#125;</span><br><span class="line">            popupClassName=&#123;<span class="string">`<span class="subst">$&#123;prefixCls&#125;</span>-popup <span class="subst">$&#123;popupClassName&#125;</span>`</span>&#125;</span><br><span class="line">            getPopupContainer=&#123;getPopupContainer&#125;</span><br><span class="line">            builtinPlacements=&#123;<span class="built_in">Object</span>.assign(&#123;&#125;, placements, builtinPlacements)&#125;</span><br><span class="line">            popupPlacement=&#123;popupPlacement&#125; popupVisible=&#123;isOpen&#125;</span><br><span class="line">            popupAlign=&#123;popupAlign&#125; popup=&#123;children&#125;</span><br><span class="line">            action=&#123;disabled ? [] : [triggerSubMenuAction]&#125;</span><br><span class="line">            mouseEnterDelay=&#123;subMenuOpenDelay&#125;</span><br><span class="line">            mouseLeaveDelay=&#123;subMenuCloseDelay&#125;</span><br><span class="line">            onPopupVisibleChange=&#123;<span class="keyword">this</span>.onPopupVisibleChange&#125;</span><br><span class="line">            forceRender=&#123;forceSubMenuRender&#125;&gt;</span><br><span class="line">            &#123;title&#125;</span><br><span class="line">          &lt;<span class="regexp">/Trigger&gt;</span></span><br><span class="line"><span class="regexp">        )&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>li&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>Menu 用于绘制主菜单，参见上文或源码。</p>
<p>MenuItem 用于绘制菜单项，将根据 store 中的 activeKey, selectedKeys 渲染样式。除了常规的事件处理函数之外，当菜单项被激活时，MenuItem 将借助 <a href="http://yiminghe.me/dom-scroll-into-view/" target="_blank" rel="noopener">dom-scroll-into-view</a> 使屏幕滚动到指定区域。MenuItem 与 SubMenu 一样，也将使用 props.level 菜单项的层级计算左边距。</p>
<p>MenuItemGroup 用于绘制成组的菜单项，并且带有标题。在 MenuItemGroup 中，实际绘制菜单项所需的 props.renderMenuItem 方法由 SubPopupMenu 提供。</p>
<p>Divider 用于绘制分割线。</p>
<h2 id="Menu"><a href="#Menu" class="headerlink" title="Menu"></a>Menu</h2><h3 id="Menu-1"><a href="#Menu-1" class="headerlink" title="Menu"></a>Menu</h3><p>Menu 作为菜单的容器，其上桥接 Sider 布局组件传入的 context.siderCollapsed, context.collapsedWidth；其下为子菜单或菜单项注入 context.inlineCollapsed, context.antdMenuTheme。其中，context.siderCollapsed 表示侧边栏是否折叠；context.collapsedWidth 表示侧边栏宽度；context.inlineCollapsed 表示内嵌模式的菜单是否折叠，或者侧边栏是否折叠；context.antdMenuTheme 表示菜单所采用的样式风格。</p>
<p>组件层级上，Menu 使用 RcMenu 绘制内容。当传入 props.openKeys 时，Menu 将表现为受控组件，其内置的 state.openKeys 将根据 props.openKeys 作调整，使用者也可以通过 props.onOpenChange 实时获取到实时展开的菜单项；当没有传入 props.openKeys 时，Menu 将表现为非受控组件，state.openKeys 将根据用户行为更新。</p>
<p>在非内嵌模式下，Menu 为 RcMenu 绑定 onClick = this.handleClick 实例方法，以在当用户点击菜单栏的空白区域或子菜单项时，可隐藏弹出的浮层。</p>
<p>在动效处理上，当菜单栏由 inline 模式切换到其他模式或者在 inline 模式下收起菜单（实际菜单需要垂直布局显示）时，先需显示 inline 模式下子菜单的折叠动效，在动效执行完成后，再转换成其他模式（介于 rc-menu 没有针对动效时延的处理）。Menu 使用 switchingModeFromInline 实例属性记录模式转换及折叠状态切换。在此基础上，getRealMenuMode 用于计算菜单实际采用的显示模式，再由 getMenuOpenAnimation 获得待显示的功效。当动效执行完成时，handleTransitionEnd 实例方法将重置 switchingModeFromInline 缓存。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cssAnimation <span class="keyword">from</span> <span class="string">'css-animation'</span>;</span><br><span class="line"><span class="keyword">import</span> raf <span class="keyword">from</span> <span class="string">'raf'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params">node: HTMLElement, show: boolean, done: (</span>) =&gt; <span class="title">void</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> height: number;</span><br><span class="line">  <span class="keyword">let</span> requestAnimationFrameId: number;</span><br><span class="line">  <span class="keyword">return</span> cssAnimation(node, <span class="string">'ant-motion-collapse'</span>, &#123;</span><br><span class="line">    start() &#123;</span><br><span class="line">      <span class="keyword">if</span> (!show) &#123;</span><br><span class="line">        node.style.height = <span class="string">`<span class="subst">$&#123;node.offsetHeight&#125;</span>px`</span>;</span><br><span class="line">        node.style.opacity = <span class="string">'1'</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        height = node.offsetHeight;</span><br><span class="line">        node.style.height = <span class="string">'0px'</span>;</span><br><span class="line">        node.style.opacity = <span class="string">'0'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    active() &#123;</span><br><span class="line">      <span class="keyword">if</span> (requestAnimationFrameId) &#123;</span><br><span class="line">        raf.cancel(requestAnimationFrameId);</span><br><span class="line">      &#125;</span><br><span class="line">      requestAnimationFrameId = raf(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        node.style.height = <span class="string">`<span class="subst">$&#123;show ? height : <span class="number">0</span>&#125;</span>px`</span>;</span><br><span class="line">        node.style.opacity = show ? <span class="string">'1'</span> : <span class="string">'0'</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    end() &#123;</span><br><span class="line">      <span class="keyword">if</span> (requestAnimationFrameId) &#123;</span><br><span class="line">        raf.cancel(requestAnimationFrameId);</span><br><span class="line">      &#125;</span><br><span class="line">      node.style.height = <span class="string">''</span>;</span><br><span class="line">      node.style.opacity = <span class="string">''</span>;</span><br><span class="line">      done();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> animation = &#123;</span><br><span class="line">  enter(node: HTMLElement, <span class="attr">done</span>: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> animate(node, <span class="literal">true</span>, done);</span><br><span class="line">  &#125;,</span><br><span class="line">  leave(node: HTMLElement, <span class="attr">done</span>: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> animate(node, <span class="literal">false</span>, done);</span><br><span class="line">  &#125;,</span><br><span class="line">  appear(node: HTMLElement, <span class="attr">done</span>: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> animate(node, <span class="literal">true</span>, done);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Menu</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">MenuProps</span>, <span class="title">MenuState</span>&gt; </span>&#123;</span><br><span class="line">  componentWillReceiveProps(nextProps: MenuProps, <span class="attr">nextContext</span>: SiderContext) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.mode === <span class="string">'inline'</span> &amp;&amp;</span><br><span class="line">        nextProps.mode !== <span class="string">'inline'</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.switchingModeFromInline = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'openKeys'</span> <span class="keyword">in</span> nextProps) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">openKeys</span>: nextProps.openKeys! &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((nextProps.inlineCollapsed &amp;&amp; !<span class="keyword">this</span>.props.inlineCollapsed) ||</span><br><span class="line">        (nextContext.siderCollapsed &amp;&amp; !<span class="keyword">this</span>.context.siderCollapsed)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.switchingModeFromInline = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">this</span>.inlineOpenKeys = <span class="keyword">this</span>.state.openKeys;<span class="comment">// 缓存 inline 模式展开的菜单项</span></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">openKeys</span>: [] &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((!nextProps.inlineCollapsed &amp;&amp; <span class="keyword">this</span>.props.inlineCollapsed) ||</span><br><span class="line">        (!nextContext.siderCollapsed &amp;&amp; <span class="keyword">this</span>.context.siderCollapsed)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">openKeys</span>: <span class="keyword">this</span>.inlineOpenKeys &#125;);</span><br><span class="line">      <span class="keyword">this</span>.inlineOpenKeys = [];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Restore vertical mode when menu is collapsed responsively when mounted</span></span><br><span class="line">  <span class="comment">// https://github.com/ant-design/ant-design/issues/13104</span></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> not a perfect solution, looking a new way to avoid setting switchingModeFromInline in this situation</span></span><br><span class="line">  <span class="comment">// 折叠状态刷新页面，因为未执行动效，switchingModeFromInline 仍为真，显示为 inline 模式</span></span><br><span class="line">  handleMouseEnter = <span class="function">(<span class="params">e: MouseEvent</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.restoreModeVerticalFromInline();</span><br><span class="line">    <span class="keyword">const</span> &#123; onMouseEnter &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">if</span> (onMouseEnter) &#123;</span><br><span class="line">      onMouseEnter(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleTransitionEnd = <span class="function">(<span class="params">e: TransitionEvent</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// when inlineCollapsed menu width animation finished</span></span><br><span class="line">    <span class="comment">// https://github.com/ant-design/ant-design/issues/12864</span></span><br><span class="line">    <span class="keyword">const</span> widthCollapsed = e.propertyName === <span class="string">'width'</span> &amp;&amp; e.target === e.currentTarget;</span><br><span class="line">    <span class="comment">// Fix for &lt;Menu style=&#123;&#123; width: '100%' &#125;&#125; /&gt;, the width transition won't trigger when menu is collapsed</span></span><br><span class="line">    <span class="comment">// https://github.com/ant-design/ant-design-pro/issues/2783</span></span><br><span class="line">    <span class="keyword">const</span> iconScaled = e.propertyName === <span class="string">'font-size'</span> &amp;&amp; (e.target <span class="keyword">as</span> HTMLElement).className.indexOf(<span class="string">'anticon'</span>) &gt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (widthCollapsed || iconScaled) &#123;</span><br><span class="line">      <span class="keyword">this</span>.restoreModeVerticalFromInline();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重置 switchingModeFromInline，并重绘菜单</span></span><br><span class="line">  restoreModeVerticalFromInline() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.switchingModeFromInline) &#123;</span><br><span class="line">      <span class="keyword">this</span>.switchingModeFromInline = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 是否折叠，取决于侧边栏的折叠情况、内嵌模式的折叠情况</span></span><br><span class="line">  getInlineCollapsed() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; inlineCollapsed &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.context.siderCollapsed !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.context.siderCollapsed;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> inlineCollapsed;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 由 inline 模式转换成其他模式时，首先保持 inline 模式，目的是执行子菜单折叠动效</span></span><br><span class="line">  <span class="comment">// 在 inline 模式下，收起菜单也将先保持 inline 模式</span></span><br><span class="line">  getRealMenuMode() &#123;</span><br><span class="line">    <span class="keyword">const</span> inlineCollapsed = <span class="keyword">this</span>.getInlineCollapsed();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.switchingModeFromInline &amp;&amp; inlineCollapsed) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'inline'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> &#123; mode &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> inlineCollapsed ? <span class="string">'vertical'</span> : mode;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getMenuOpenAnimation(menuMode: MenuMode) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; openAnimation, openTransitionName &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">let</span> menuOpenAnimation = openAnimation || openTransitionName;</span><br><span class="line">    <span class="keyword">if</span> (openAnimation === <span class="literal">undefined</span> &amp;&amp; openTransitionName === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (menuMode) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'horizontal'</span>:</span><br><span class="line">          menuOpenAnimation = <span class="string">'slide-up'</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'vertical'</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'vertical-left'</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'vertical-right'</span>:</span><br><span class="line">          <span class="comment">// When mode switch from inline submenu should hide without animation</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">this</span>.switchingModeFromInline) &#123;</span><br><span class="line">            menuOpenAnimation = <span class="string">''</span>;</span><br><span class="line">            <span class="keyword">this</span>.switchingModeFromInline = <span class="literal">false</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            menuOpenAnimation = <span class="string">'zoom-big'</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'inline'</span>:</span><br><span class="line">          menuOpenAnimation = animation;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> menuOpenAnimation;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SubMenu-1"><a href="#SubMenu-1" class="headerlink" title="SubMenu"></a>SubMenu</h3><p>SubMenu 使用 RcSubMenu 绘制子菜单。逻辑上，SubMenu 通过 context.antdMenuTheme 设置子菜单的主题样式；又实现 onKeyDown 方法，以桥接 SubPopupMenu 和 RcSubMenu 中的同名方法（参见上文）。</p>
<h3 id="MenuItem"><a href="#MenuItem" class="headerlink" title="MenuItem"></a>MenuItem</h3><p>MenuItem 使用 RcMenuItem 绘制菜单项。逻辑上，MenuItem 既像 SubMenu 那样实现了 onKeyDown 方法；又使用 Tooltip 绘制气泡框。当 context.inlineCollapsed 为 true 且 props.level 为 1（菜单项层级为1）时，将使用<a href="https://ant.design/components/tooltip-cn/" target="_blank" rel="noopener">气泡框组件</a>绘制子元素。</p>
<h3 id="样式处理"><a href="#样式处理" class="headerlink" title="样式处理"></a>样式处理</h3><ol>
<li>菜单折叠前后展示样式：</li>
</ol>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.@&#123;menu-prefix-cls&#125;</span> &#123;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-tag">-item</span>,</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-tag">-submenu-title</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">    <span class="attribute">transition</span>: color .<span class="number">3s</span> <span class="variable">@ease-in-out</span>, border-color .<span class="number">3s</span> <span class="variable">@ease-in-out</span>, background .<span class="number">3s</span> <span class="variable">@ease-in-out</span>, padding .<span class="number">15s</span> <span class="variable">@ease-in-out</span>;</span><br><span class="line">    <span class="selector-class">.@&#123;iconfont-css-prefix&#125;</span> &#123;</span><br><span class="line">      <span class="attribute">min-width</span>: <span class="number">14px</span>;</span><br><span class="line">      <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="variable">@font-size-base</span>;</span><br><span class="line">      <span class="attribute">transition</span>: font-size .<span class="number">15s</span> <span class="variable">@ease-out</span>, margin .<span class="number">3s</span> <span class="variable">@ease-in-out</span>;</span><br><span class="line">      + <span class="selector-tag">span</span> &#123;</span><br><span class="line">        <span class="attribute">transition</span>: opacity .<span class="number">3s</span> <span class="variable">@ease-in-out</span>, width .<span class="number">3s</span> <span class="variable">@ease-in-out</span>;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-tag">-inline-collapsed</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="variable">@menu-collapsed-width</span>;</span><br><span class="line">    &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-item</span>,</span><br><span class="line">    &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-item-group</span> &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-item-group-list</span> &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-item</span>,</span><br><span class="line">    &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-item-group</span> &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-item-group-list</span> &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu</span> &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-title</span>,</span><br><span class="line">    &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu</span> &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-title</span> &#123;</span><br><span class="line">      <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">text-overflow</span>: clip;<span class="comment">// 裁剪超出文本</span></span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">0</span> (<span class="variable">@menu-collapsed-width</span> - <span class="number">16px</span>) / <span class="number">2</span> <span class="meta">!important</span>;</span><br><span class="line">      <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-arrow</span> &#123;<span class="comment">// 隐藏展开折叠图标</span></span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="selector-class">.@&#123;iconfont-css-prefix&#125;</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">        <span class="attribute">line-height</span>: <span class="variable">@menu-item-height</span>;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">        + <span class="selector-tag">span</span> &#123;<span class="comment">// 隐藏文本</span></span><br><span class="line">          <span class="attribute">max-width</span>: <span class="number">0</span>;</span><br><span class="line">          <span class="attribute">display</span>: inline-block;</span><br><span class="line">          <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>子菜单浮层：</li>
</ol>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.@&#123;menu-prefix-cls&#125;</span> &#123;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-tag">-submenu</span> &#123;</span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-tag">-popup</span> &#123;</span><br><span class="line">      <span class="attribute">position</span>: absolute;</span><br><span class="line">      <span class="attribute">border-radius</span>: <span class="variable">@border-radius-base</span>;</span><br><span class="line">      <span class="attribute">z-index</span>: <span class="variable">@zindex-dropdown</span>;</span><br><span class="line">      <span class="attribute">background</span>: <span class="variable">@menu-popup-bg</span>;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.submenu-title-wrapper</span> &#123;</span><br><span class="line">        <span class="attribute">padding-right</span>: <span class="number">20px</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="selector-tag">&amp;</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">top</span>: -<span class="number">7px</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">' '</span>;</span><br><span class="line">        <span class="attribute">opacity</span>: .<span class="number">0001</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>折叠按钮旋转动效：</li>
</ol>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.@&#123;menu-prefix-cls&#125;</span> &#123;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-tag">-submenu</span> &#123;<span class="selector-tag">&amp;</span><span class="selector-tag">-vertical</span>,</span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-tag">-vertical-left</span>,</span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-tag">-vertical-right</span>,</span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-tag">-inline</span> &#123;</span><br><span class="line">      &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-title</span> <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-arrow</span> &#123;</span><br><span class="line">        <span class="attribute">transition</span>: transform .<span class="number">3s</span> <span class="variable">@ease-in-out</span>;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">        <span class="attribute">right</span>: <span class="number">16px</span>;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">        <span class="selector-tag">&amp;</span><span class="selector-pseudo">:before</span>,</span><br><span class="line">        <span class="selector-tag">&amp;</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">          <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">          <span class="attribute">position</span>: absolute;</span><br><span class="line">          <span class="attribute">vertical-align</span>: baseline;</span><br><span class="line">          <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">          <span class="attribute">background-image</span>: linear-gradient(to right, <span class="variable">@menu-item-color</span>, <span class="variable">@menu-item-color</span>);<span class="comment">// 渐变</span></span><br><span class="line">          <span class="attribute">width</span>: <span class="number">6px</span>;</span><br><span class="line">          <span class="attribute">height</span>: <span class="number">1.5px</span>;</span><br><span class="line">          <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span><br><span class="line">          <span class="attribute">transition</span>: background .<span class="number">3s</span> <span class="variable">@ease-in-out</span>, transform .<span class="number">3s</span> <span class="variable">@ease-in-out</span>, top .<span class="number">3s</span> <span class="variable">@ease-in-out</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-tag">&amp;</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">          <span class="attribute">transform</span>: rotate(<span class="number">45deg</span>) translateY(-<span class="number">2px</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-tag">&amp;</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">          <span class="attribute">transform</span>: rotate(-<span class="number">45deg</span>) translateY(<span class="number">2px</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-title</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-arrow</span> &#123;</span><br><span class="line">        <span class="selector-tag">&amp;</span><span class="selector-pseudo">:after</span>,</span><br><span class="line">        <span class="selector-tag">&amp;</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">          <span class="attribute">background</span>: linear-gradient(to right, <span class="variable">@menu-highlight-color</span>, <span class="variable">@menu-highlight-color</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-tag">-inline</span> &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-title</span> <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-arrow</span> &#123;</span><br><span class="line">      <span class="selector-tag">&amp;</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: rotate(-<span class="number">45deg</span>) translateX(<span class="number">2px</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="selector-tag">&amp;</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: rotate(<span class="number">45deg</span>) translateX(-<span class="number">2px</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-tag">-open</span> &#123;</span><br><span class="line">      <span class="selector-tag">&amp;</span><span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-inline</span> &gt; <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-title</span> <span class="selector-class">.@&#123;menu-prefix-cls&#125;</span><span class="selector-tag">-submenu-arrow</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: translateY(-<span class="number">2px</span>);</span><br><span class="line">        <span class="selector-tag">&amp;</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">          <span class="attribute">transform</span>: rotate(-<span class="number">45deg</span>) translateX(-<span class="number">2px</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-tag">&amp;</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">          <span class="attribute">transform</span>: rotate(<span class="number">45deg</span>) translateX(<span class="number">2px</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>清除浮动：</li>
</ol>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span>() &#123;</span><br><span class="line">  <span class="attribute">zoom</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-pseudo">:before</span>,</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">    <span class="attribute">display</span>: table;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.@&#123;menu-prefix-cls&#125;</span> &#123;</span><br><span class="line">  <span class="selector-class">.clearfix</span>;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-tag">-horizontal</span> &#123;</span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">      <span class="attribute">content</span>: <span class="string">"\20"</span>;</span><br><span class="line">      <span class="attribute">display</span>: block;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">clear</span>: both;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>本文对子菜单的浮层显示和菜单栏的动效处理仍有不足。关于 rc-animate, rc-trigger，笔者将在后续的文章中加以分析。</p>

        </div>
        <footer class="article-footer">
            

    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间">QQ空间</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
    <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博">腾讯微博</a>
    <a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网">人人网</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>



        </footer>
    </div>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Alfred"
        },
        "headline": "Menu",
        "image": "http://xzfyu.com/2018/12/10/frontend/antd/Menu/rc-menu整体结构.png",
        "keywords": "analyst react antd",
        "genre": "frontend antd",
        "datePublished": "2018-12-10",
        "dateCreated": "2018-12-10",
        "dateModified": "2020-03-08",
        "url": "http://xzfyu.com/2018/12/10/frontend/antd/Menu/",
        "description": "antd 中的 Menu 组件用于绘制菜单栏，其实现基于 rc-menu。本文第一部分介绍菜单栏实现的整体结构；第二部分介绍 rc-menu；第三部分介绍 Menu 组件。
需要声明的是，本文使用 RcMenu 指代 rc-menu 输出的 Menu 组件或其实例，使用 Menu 指代 antd 输出的 Menu 组件或其实例、或抽象意义的菜单栏组件，余同。
整体结构在视图上，菜单栏分为水平布局和",
        "wordCount": 7600
    }
</script>

</article>

    <section id="comments">
    
        
<div id="comment-container"></div>


    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/Alfred-sg" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2019/01/14/frontend/react16/React/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            react api 整理
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2018/11/27/frontend/antd/Radio, Checkbox/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">Radio, Checkbox</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/frontend/">frontend</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/frontend/architecture/">architecture</a></p>
                            <p class="item-title"><a href="/2020/12/31/frontend/architecture/前端工程体系/" class="title">前端工程体系</a></p>
                            <p class="item-date"><time datetime="2020-12-30T16:00:00.000Z" itemprop="datePublished">2020-12-31</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/frontend/">frontend</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/frontend/architecture/">architecture</a></p>
                            <p class="item-title"><a href="/2020/06/09/frontend/architecture/前端技术汇总贴/" class="title">前端技术汇总贴</a></p>
                            <p class="item-date"><time datetime="2020-06-08T16:00:00.000Z" itemprop="datePublished">2020-06-09</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/frontend/">frontend</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/frontend/react/">react</a></p>
                            <p class="item-title"><a href="/2020/04/29/frontend/react16/react fiber 代码梳理篇/" class="title">react fiber 代码梳理篇</a></p>
                            <p class="item-date"><time datetime="2020-04-28T16:00:00.000Z" itemprop="datePublished">2020-04-29</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/计算机科学/">计算机科学</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/计算机科学/软件工程/">软件工程</a></p>
                            <p class="item-title"><a href="/2020/04/29/计算机科学/软件工程/体系结构设计/" class="title">架构入门</a></p>
                            <p class="item-date"><time datetime="2020-04-28T16:00:00.000Z" itemprop="datePublished">2020-04-29</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/frontend/">frontend</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/frontend/architecture/">architecture</a></p>
                            <p class="item-title"><a href="/2020/04/12/frontend/architecture/模块化机制/" class="title">前端模块化机制</a></p>
                            <p class="item-date"><time datetime="2020-04-11T16:00:00.000Z" itemprop="datePublished">2020-04-12</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/backend/">backend</a><span class="category-list-count">25</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/backend/java/">java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/backend/java-工程/">java 工程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/backend/spring/">spring</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/backend/web-服务/">web 服务</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/backend/其他/">其他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/backend/异步消息/">异步消息</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/backend/数据库技术/">数据库技术</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/backend/架构/">架构</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/backend/缓存/">缓存</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/backend/远程通信/">远程通信</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/backend/部署/">部署</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/">frontend</a><span class="category-list-count">88</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/antd/">antd</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/architecture/">architecture</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/css/">css</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/editor/">editor</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/es/">es</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/guide/">guide</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/js/">js</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/library/">library</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/react/">react</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/vue/">vue</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/webpack/">webpack</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/前端工程化/">前端工程化</a><span class="category-list-count">13</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据技术/">数据技术</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据技术/sql/">sql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据技术/大数据/">大数据</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据技术/读书笔记/">读书笔记</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机科学/">计算机科学</a><span class="category-list-count">13</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/计算机科学/操作系统/">操作系统</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机科学/算法/">算法</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机科学/设计模式/">设计模式</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机科学/软件工程/">软件工程</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/踩坑/">踩坑</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a><span class="category-list-count">3</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/analyst/" style="font-size: 20px;">analyst</a> <a href="/tags/antd/" style="font-size: 14.44px;">antd</a> <a href="/tags/carrier/" style="font-size: 18.89px;">carrier</a> <a href="/tags/css/" style="font-size: 11.11px;">css</a> <a href="/tags/fiber-renconciler/" style="font-size: 10px;">fiber-renconciler</a> <a href="/tags/git/" style="font-size: 11.11px;">git</a> <a href="/tags/java/" style="font-size: 16.67px;">java</a> <a href="/tags/jquery/" style="font-size: 10px;">jquery</a> <a href="/tags/js/" style="font-size: 12.22px;">js</a> <a href="/tags/js设计模式/" style="font-size: 13.33px;">js设计模式</a> <a href="/tags/lint/" style="font-size: 10px;">lint</a> <a href="/tags/prettier/" style="font-size: 10px;">prettier</a> <a href="/tags/proxy/" style="font-size: 11.11px;">proxy</a> <a href="/tags/react/" style="font-size: 17.78px;">react</a> <a href="/tags/react-components/" style="font-size: 10px;">react-components</a> <a href="/tags/react16/" style="font-size: 10px;">react16</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/test/" style="font-size: 12.22px;">test</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/validate/" style="font-size: 10px;">validate</a> <a href="/tags/vue/" style="font-size: 14.44px;">vue</a> <a href="/tags/webpack/" style="font-size: 15.56px;">webpack</a> <a href="/tags/性能/" style="font-size: 10px;">性能</a> <a href="/tags/算法/" style="font-size: 12.22px;">算法</a> <a href="/tags/虚拟-dom/" style="font-size: 10px;">虚拟 dom</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="https://www.zhihu.com/people/xiu-fan-79/activities">知乎</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2020 Alfred</p>
                
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

        
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    var gitalk = new Gitalk({
        clientID: 'b91413aac6da3042133d',
        clientSecret: '0ea2891e8a1163db789b8e5a4379771adb419be3',
        id: '87f79f15e1a281db8559b990fc167236',
        repo: 'Alfred-sg.github.io',
        owner: 'Alfred-sg',
        admin: "Alfred-sg"
    })
    gitalk.render('comment-container')
</script>





    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    

    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
